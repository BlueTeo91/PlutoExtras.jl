<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"><meta charset="utf-8">
<meta name="pluto-insertion-spot-meta">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#2a2928"><meta name="color-scheme" content="light dark"><link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon-16x16.347d2855.png" integrity="sha384-3qsGeVLdddzV9oIkj3PhXXQX2CZCjOD/CiyrPQOX6InOWw3HAHClrsQhPfX9uRAj" crossorigin="anonymous"><link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon-32x32.8789add4.png" integrity="sha384-cOe5vSoBIgKNgkUL27p9RpsGVY0uBg9PejLccDy+fR8ZD1Iv5dF1MGHjIZAIZwm6" crossorigin="anonymous"><link rel="icon" type="image/png" sizes="96x96" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon-96x96.48689391.png" integrity="sha384-TN49cYb8GyNmrZT14bsYXXo4l1x1NJeJ/EHuVAauAKsNPopPHLojijs9jFT4Vs8c" crossorigin="anonymous"><link rel="pluto-logo-big" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/logo.004c1d7c.svg" integrity="sha384-GkQkODcGxsrSRJCkeakBXihum0GUM44cwBgKyutDimectXCbCgj6Vu3jlrueqEcN" crossorigin="anonymous"><link rel="pluto-logo-small" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon_unsaturated.d1387b25.svg" integrity="sha384-omwjH+Qy3hpAVf5FYd/pkaDBuVAfsEDRN7eBxEA8Ek00OAWP+aiV+GpEYk3I7lyo" crossorigin="anonymous"><script type="module" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.c73f088f.js" integrity="sha384-DX1flYmpVrvPu5Z9JJtDatXQGsS20eFFpJuNDVzFK+yfHdoLNoBYPb79KrbknLzZ" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/juliamono.c6034ab4.css" integrity="sha384-n0za6lUXlyf4XC+nGkZWj3TLDnRbNpAcoi4PZGSlQMPoyqGa9kGY+ZXkUgZGIhQt" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.e1a53700.css" integrity="sha384-L38U7X8v0kZCLcn973v3EAbuJy7tzzkX02adfa2LDv1pWRGiT7b2NuAkH1oOJWKS" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/vollkorn.089565a8.css" integrity="sha384-jnV/84VtSgBLF70H+s2rxJcOUZIMDR+X/ElFZA83i9ZtZSWiIMFAgPyrWkOJV08q" crossorigin="anonymous"><script defer="">console.log("Pluto.jl, by Fons van der Plas (https://github.com/fonsp), MikoÅ‚aj Bochenski (https://github.com/malyvsen), Michiel Dral (https://github.com/dralletje) and friends ðŸŒˆ");</script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.4b96dd74.js" defer="" integrity="sha384-Y+UtWANyXLeovyghpAI8j9/VZXWboD6G5ZCckOsJO99PawAh/utJxFikf62WBaSu" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.9f9dc874.js" defer="" integrity="sha384-tkFo1EK72I9JvoTmHFa199dfRzW8mkXPUkHb/N7UhYI+bxKzX3Kh8LNCZz1ltsFF" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.90ede145.js" defer="" integrity="sha384-CuNU9gQg6fa/yynNqNWjHWzPm4nj+d7O6+HXsNGSqClhs/bYQIbBC3Lw/kh8Ukui" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.dbeed08a.js" defer="" integrity="sha384-1BEdQwXfZi4ZpsNV8w1X8pQcVK1/DS/+/M8OTo3gol7mdEspSN7nT6llX57NQCSt" crossorigin="anonymous"></script><script id="iframe-resizer-content-window-script" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.6386bd9d.js" crossorigin="anonymous" defer="" integrity="sha384-tgN2a0VDi/lCYwZuDqT7L+A/Y/9kpxf3HV7zv2BJ5Fu7zW0EClq0nM4crfK3TRPs"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.23c14a79.css" type="text/css" integrity="sha384-jLh920NaGkBLzSCGy8Gmwt4oVTxaevvnAKcgWLvK8tgTEKiVEAN9OoYSRTDBcMJY" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.3394571b.css" type="text/css" media="all" data-pluto-file="hide-ui" integrity="sha384-CZthudKXQngXEkYHKw7orzD3ShUAud4YcXeMNAI4M+C79j5BokFyKOsZh0iDW5wr" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.d3307b27.css" type="text/css" integrity="sha384-3x2qZDazgbcSpu1KwtC7K1OB1Tkfg6mRNoxs0wf+u5qGDUVfPW9p0dgiiuz/vnWq" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.1f4cf2ca.css" type="text/css" integrity="sha384-lBSBsn8FT1UzGOsNVudfV8RSHQEuNWqrCb6xQnF10uvF9AiCzYsCRXvKlhtQvV3c" crossorigin="anonymous"><link rel="preload" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/juliamono.c6034ab4.css" as="style" integrity="sha384-n0za6lUXlyf4XC+nGkZWj3TLDnRbNpAcoi4PZGSlQMPoyqGa9kGY+ZXkUgZGIhQt" crossorigin="anonymous"><link rel="preload" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/vollkorn.089565a8.css" as="style" integrity="sha384-jnV/84VtSgBLF70H+s2rxJcOUZIMDR+X/ElFZA83i9ZtZSWiIMFAgPyrWkOJV08q" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.e82e08bd.css" type="text/css" integrity="sha384-7YN+h8b6N4N65qk8TG/J2KPF95D8z3sGNd06rokz4CX9oWu0KnRAF5cVWu3BkkaN" crossorigin="anonymous"><script data-pluto-file="launch-parameters">
window.pluto_notebook_id = undefined;
window.pluto_isolated_cell_ids = undefined;
window.pluto_notebookfile = "data:text/julia;charset=utf-8;base64,IyMjIEEgUGx1dG8uamwgbm90ZWJvb2sgIyMjCiMgdjAuMTkuMjIKCiM+IGN1c3RvbV9hdHRycyA9IFsiaGlkZS1lbmFibGVkIl0KCnVzaW5nIE1hcmtkb3duCnVzaW5nIEludGVyYWN0aXZlVXRpbHMKCiMgVGhpcyBQbHV0byBub3RlYm9vayB1c2VzIEBiaW5kIGZvciBpbnRlcmFjdGl2aXR5LiBXaGVuIHJ1bm5pbmcgdGhpcyBub3RlYm9vayBvdXRzaWRlIG9mIFBsdXRvLCB0aGUgZm9sbG93aW5nICdtb2NrIHZlcnNpb24nIG9mIEBiaW5kIGdpdmVzIGJvdW5kIHZhcmlhYmxlcyBhIGRlZmF1bHQgdmFsdWUgKGluc3RlYWQgb2YgYW4gZXJyb3IpLgptYWNybyBiaW5kKGRlZiwgZWxlbWVudCkKICAgIHF1b3RlCiAgICAgICAgbG9jYWwgaXYgPSB0cnkgQmFzZS5sb2FkZWRfbW9kdWxlc1tCYXNlLlBrZ0lkKEJhc2UuVVVJRCgiNmU2OTZjNzItNjU0Mi0yMDY3LTcyNjUtNDIyMDZjNzU2MTUwIiksICJBYnN0cmFjdFBsdXRvRGluZ2V0amVzIildLkJvbmRzLmluaXRpYWxfdmFsdWUgY2F0Y2g7IGIgLT4gbWlzc2luZzsgZW5kCiAgICAgICAgbG9jYWwgZWwgPSAkKGVzYyhlbGVtZW50KSkKICAgICAgICBnbG9iYWwgJChlc2MoZGVmKSkgPSBDb3JlLmFwcGxpY2FibGUoQmFzZS5nZXQsIGVsKSA/IEJhc2UuZ2V0KGVsKSA6IGl2KGVsKQogICAgICAgIGVsCiAgICBlbmQKZW5kCgojIOKVlOKVkOKVoSAxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjAKIyDilaDilZDilaEgc2hvd19sb2dzID0gZmFsc2UKIyDilaDilZDilaEgc2tpcF9hc19zY3JpcHQgPSB0cnVlCiM94pWg4pWQ4pWhCmJlZ2luCglpbXBvcnQgUGtnCglQa2cuYWN0aXZhdGUoQmFzZS5jdXJyZW50X3Byb2plY3QoKSkKCXVzaW5nIFJldmlzZQplbmQKICDilaDilZDilaEgPSMKCiMg4pWU4pWQ4pWhIDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyYwpiZWdpbgoJdXNpbmcgUGx1dG9FeHRyYXMKCXVzaW5nIFBsdXRvRXh0cmFzLlN0cnVjdEJvbmRNb2R1bGUgIyBUaGlzIHN1Ym1vZHVsZSBoYXMgdGhlIGZlYXR1cmVzIGxpc3RlZCBpbiB0aGlzIG5vdGVib29rCgl1c2luZyBQbHV0b1VJCgl1c2luZyBIeXBlcnRleHRMaXRlcmFsCmVuZAoKIyDilZTilZDilaEgNWZiZDE0MDEtYzdhMS00ZDRmLWIxNmQtYWM5ZDQ1ZTJmZWQ1Cm1kIiIiCiMgUGFja2FnZXMKIiIiCgojIOKVlOKVkOKVoSBjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDMKRXh0ZW5kZWRUYWJsZU9mQ29udGVudHMoKQoKIyDilZTilZDilaEgNWE5YjI3YzMtZGYwMi00MTVjLTg3YmQtMDZlYmQzYzlkMjQ2Cm1kIiIiCiMgU3RydWN0Qm9uZAoiIiIKCiMg4pWU4pWQ4pWhIDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYQptZCIiIgpHZW5lcmF0aW5nIGF1dG9tYXRpYyB3aWRnZXRzIGZvciBjdXN0b20gc3RydWN0cyBpcyBxdWl0ZSBzdHJhaWdodGZvcndhcmQgd2l0aCB0aGUgYWlkIG9mIHRoZSBgQGZpZWxkZGF0YWAgbWFjcm8gYW5kIHRoZSBgU3RydWN0Qm9uZGAgdHlwZS4KClRoZSB0b3AtbGVmdCBhcnJvdyBjYW4gYmUgdXNlZCB0byBzaG93LWhpZGUgdGhlIGZpZWxkIGVsZW1lbnRzICh1c2VmdWwgaW5zaWRlIGEgYEJvbmRUYWJsZWAsIHNob3duIGJlbG93KSwgd2hpbGUgdGhlIGdyZWVuIHRvZ2dsZSBvbiB0aGUgdG9wLXJpZ2h0IGNhbiBiZSB1c2VkIHRvIGRpc2FibGUgdGVtcG9yYXJpbHkgdGhlIHN5bmNoIGJldHdlZW4gdGhlIEpTIHdpZGdldHMgYW5kIHRoZSBib25kIHZhbHVlcyBpbiBQbHV0by4KIiIiCgojIOKVlOKVkOKVoSA5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTcKYmVnaW4KIiIiCglzdHJ1Y3QgQVNECiIiIgpCYXNlLkBrd2RlZiBzdHJ1Y3QgQVNECglhOjpJbnQgCgliOjpJbnQKCWM6OlN0cmluZwoJIlRoaXMgZmllbGQgaXMgX3NwZWNpYWxfIgoJZDo6U3RyaW5nCgllOjpJbnQKZW5kCkBmaWVsZGRhdGEgQVNEIGJlZ2luCglhID0gKG1kIk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgYGBMYVRlWGBgIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQoJYyA9ICgiTm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbiIsIFRleHRGaWVsZCgpKQoJZCA9IFRleHRGaWVsZCgpICMgTm8gZGVzY3JpcHRpb24sIGRlZmF1bHRzIHRvIHRoZSBkb2NzdHJpbmcgc2luY2UgaXQncyBwcmVzZW50CgllID0gU2xpZGVyKDIwOjI1KSAjIE5vIGRlc2NyaXB0aW9uLCBkZWZhdWx0cyB0byB0aGUgZmllbGRuYW1lIGFzIG5vIGRvY3N0cmluZyBpcyBwcmVzZW50CmVuZAphc2RfYm9uZCA9IEBiaW5kIGFzZCBTdHJ1Y3RCb25kKEFTRDsgZGVzY3JpcHRpb24gPSAiQ3VzdG9tIERlc2NyaXB0aW9uIikKZW5kCgojIOKVlOKVkOKVoSAxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODkKYXNkCgojIOKVlOKVkOKVoSA2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2UKbWQiIiIKIyBATlRCb25kCiIiIgoKIyDilZTilZDilaEgOGM4ZmQ1NDktMGFmYy00NDUyLWJkNmEtNjU2NDg2MmExZDYzCm1kIiIiClNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgYFN0cnVjdEJvbmRgIHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiAKClRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gYEBOVEJvbmRgIHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLgoKVGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSBgU3RydWN0Qm9uZGAgd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLgoiIiIKCiMg4pWU4pWQ4pWhIDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NApudF9ib25kID0gQGJpbmQgbnQgQE5UQm9uZCAiTXkgRmFuY3kgTlR1cGxlIiBiZWdpbgoJYSA9ICgiRGVzY3JpcHRpb24iLCBTbGlkZXIoMToxMCkpCgliID0gKG1kIioqQm9sZCoqIGZpZWxkIiwgU2xpZGVyKDE6MTApKQoJYyA9IFNsaWRlcigxOjEwKSAjIE5vIGRlc2NyaXB0aW9uLCBkZWZhdWx0cyB0byB0aGUgbmFtZSBvZiB0aGUgZmllbGQKZW5kCgojIOKVlOKVkOKVoSBjMTgzZTM4Zi04NGUzLTRhMWYtYTYzMS02ZDFkYjM5ZjExNzkKbnQKCiMg4pWU4pWQ4pWhIDhhYjJhZjRjLTkyYTItNDI5Zi1iNjQxLTk1YTAyODgwOGFlNQptZCIiIgojIEBCb25kc0xpc3QKIiIiCgojIOKVlOKVkOKVoSAyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTkKbWQiIiIKSW4gc29tZSBjYXNlcywgb25lIGRvZXMgbm90IHdhbnQgdG8gaGF2ZSBhIHNpbmdsZSBib25kIHdyYXBwaW5nIGVpdGhlciBhIFN0cnVjdHVyZSBvciBhIE5hbWVkVHVwbGUsIGFuZCBzaW5nbGUgaW5kZXBlbmRlbnQgYm9uZHMgYXJlIG1vcmUgY29udmVuaWVudC4KCmBAQm9uZHNMaXN0YCBpcyBhIGNvbnZlbmllbmNlIG1hY3JvIHRvIGNyZWF0ZSBhbiBvYmplY3Qgb2YgdHlwZSBgQm9uZHNMaXN0YCB3aGljaCBzaW1wbHkgYWxsb3cgdG8gYWRkIGEgZGVzY3JpcHRpb24gdG8gc2VwYXJhdGUgYm9uZHMgYW5kIGdyb3VwIHRoZW0gYWxsIHRvZ2V0aGVyIGluIGEgdGFibGUtbGlrZSBmb3JtYXQgZXF1aXZhbGVudCB0byB0aG9zZSBvZiBgU3RydWN0Qm9uZGAuCgohISEgbm90ZQoJVW5saWtlIGBTdHJ1Y3RCb25kYCwgYSBCb25kc0xpc3QgaXMgYWxyZWFkeSBjb21wb3NlZCBvZiBib25kIGNyZWF0ZWQgd2l0aCBgQGJpbmRgIGFuZCBpdCBqdXN0IGdyb3VwcyB0aGVtIHVwIHdpdGggYSBkZXNjcmlwdGlvbi4gVGhlIG91dHB1dCBvZiBgQEJvbmRzTGlzdGAgaXMgbm90IHN1cHBvc2VkIHRvIGJlIGJvdW5kIHRvIGEgdmFyaWFibGUgdXNpbmcgYEBiaW5kYC5cCglUaGUgYm9uZHMgZ3JvdXBlZCBpbiBhIEJvbmRzTGlzdCBzdGlsbCBhY3QgYW5kIHVwZGF0ZSBpbmRlcGVuZGVudGx5IGZyb20gb25lIGFub3RoZXIuCgpTZWUgdGhlIGV4YW1wbGUgYmVsb3cgZm9yIHVuZGVyc3RhbmRpbmcgdGhlIHN5bnRoYXguIFRoZSBoZWFkZXIgb2YgYSBCb25kc0xpc3QgaXMgc2hvd24gaW4gYW4gb3JhbmdlIGJhY2tncm91bmQgdG8gZWFzaWx5IGRpZmZlcmVudGlhdGUgaXQgZnJvbSBgU3RydWN0Qm9uZGAuCiIiIgoKIyDilZTilZDilaEgNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJkCmJsID0gQEJvbmRzTGlzdCAiTXkgR3JvdXAgb2YgQm9uZHMiIGxldCB0diA9IFBsdXRvVUkuRXhwZXJpbWVudGFsLnRyYW5zZm9ybWVkX3ZhbHVlCgkgIyBXZSB1c2UgdHJhbnNmb3JtZWRfdmFsdWUgdG8gdHJhbnNsYXRlIEdIeiB0byBIeiBpbiB0aGUgYm91bmQgdmFyaWFibGUgYGZyZXFgCgkiRnJlcXVlbmN5IFtHSHpdIiA9IEBiaW5kIGZyZXEgdHYoeCAtPiB4ICogMWU5LCBFZGl0YWJsZSgyMDsgc3VmZml4ID0gIiBHSHoiKSkKCW1kIkFsdGl0dWRlIGBgaGBgIFttXSIgPSBAYmluZCBhbHQgU2NydWJiYWJsZSgxMDA6MTA6MjAwKQplbmQKCiMg4pWU4pWQ4pWhIDhkOTEyMjk3LTkyNWUtNGM4Yi05OGI4LTE5YjQzYzliMjlkNwpmcmVxCgojIOKVlOKVkOKVoSA5YTFiYWEzZC0xNDIwLTQ3M2MtODM4MC1iYjVjMjM4ODFlMDAKbWQiIiIKIyBQb3BvdXQKIiIiCgojIOKVlOKVkOKVoSA5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDMKbWQiIiIKVGhlIHN0cnVjdHVyZXMgYWJvdmUgY2FuIGFsc28gYmUgdXNlZCBuZXN0ZWQgd2l0aGluIG9uZSBhbm90aGVyLiBUbyBmYWNpbGl0YXRlIGFjY2Vzc2luZyBuZXN0ZWQgc3RydWN0dXJlcywgb25lIGNhbiB1c2UgdGhlIGBQb3BvdXRgIHR5cGUuCgpJbiBpdHMgc2ltcGxlIGZvcm0sIHlvdSBjYW4gZ2l2ZSBhbiBpbnN0YW5jZSBvZiBhIFN0cnVjdEJvbmQsIGEgYm9uZCB3cmFwcGluZyBhIFN0cnVjdEJvbmQgb3IgYSBCb25kc0xpc3QgYXMgaW5wdXQgdG8gUG9wb3V0IHRvIGNyZWF0ZSBhIHRhYmxlIHRoYXQgaXMgaGlkZGVuIGJlaGluZCBhIHBvcHVwIHdpbmRvdy4KSWYgYW4gaW5zdGFuY2UgcHJlc2VudCwgYnV0IHlvdSB3YW50IGEgY3VzdG9tIHR5cGUgZm9yIHdoaWNoIHlvdSBoYXZlIGRlZmluZWQgY3VzdG9tIGJvbmRzIGFuZCBkZXNjcmlwdGlvbnMgd2l0aCBgQGZpZWxkZGF0YWAgdG8gYXBwZWFyIGFzIHBvcG91dCwgeW91IGNhbiB1c2UgdGhlIGZ1bmN0aW9uIGBwb3BvdXR3cmFwKFRZUEUpYCB0byBnZW5lcmF0ZSBhIHNtYWxsIGljb24gd2hpY2ggaGlkZXMgYSBwb3B1cCBjb250YWluaW5nIHRoZSBgU3RydWN0Qm9uZGAgb2YgdGhlIHByb3ZpZGVkIHR5cGUgYFRZUEVgLgoKVGhlIFN0cnVjdEJvbmQgdGFibGUgYXBwZWFycyBvbiBob3ZlciB1cG9uIHRoZSBpY29uLCBjYW4gYmUgbWFkZSBmaXhlZCBieSBjbGlja2luZyBvbiB0aGUgaWNvbiBhbmQgY2FuIHRoZW4gYmUgbW92ZWQgYXJvdW5kIG9yIHJlc2l6ZWQuCkEgZG91YmxlIGNsaWNrIG9uIHRoZSBoZWFkZXIgb2YgdGhlIHBvcG91dCBoaWRlcyBpdCBhZ2FpbjoKIiIiCgojIOKVlOKVkOKVoSA5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzkKYmVnaW4KQmFzZS5Aa3dkZWYgc3RydWN0IExPTAoJYTo6SW50IAoJYjo6SW50CmVuZApAZmllbGRkYXRhIExPTCBiZWdpbgoJYSA9IChtZCJXb25kZXIhIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCBCPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQplbmQKZW5kCgojIOKVlOKVkOKVoSA2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjIKcG9wb3V0d3JhcChMT0wpCgojIOKVlOKVkOKVoSAzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDEKbWQiIiIKVGhlIGFiaWxpdHkgdG8gYWxzbyB3cmFwIHByZS1leGlzdGluZyBib25kcyBhcm91bmQgU3RydWN0Qm9uZHMgaXMgY29udmVuaWVudCBmb3Igb3JnYW5pemluZyB0aGUgdmFyaW91cyBib25kcyBvbmUgaGF2ZSBpbiBhIGBCb25kc0xpc3RgIG9yIGBCb25kVGFibGVgCgpBcyBhbiBleGFtcGxlLCBvbmUgY2FuIGNyZWF0ZSBhIGBCb25kc0xpc3RgIGNvbnRhaW5pbmcgdGhlIHR3byBgU3RydWN0Qm9uZGAgYm9uZHMgZ2VuZXJhdGVkIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBub3RlYm9vayB3aXRoIHRoZSBmb2xsd2luZyBjb2RlLgoiIiIKCiMg4pWU4pWQ4pWhIDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZgpibGMgPSBAQm9uZHNMaXN0ICJQb3BvdXQgQ29udGFpbmVyIiBiZWdpbgoJIlN0cnVjdHVyZSBBU0QiID0gUG9wb3V0KGFzZF9ib25kKQoJIk5hbWVkVHVwbGUiID0gUG9wb3V0KG50X2JvbmQpCmVuZAoKIyDilZTilZDilaEgMzczYmMyNDQtMTEwYS00M2Y4LWFhYTEtNTFiNWNiNzUxMTI4Cm1kIiIiCiMgQm9uZFRhYmxlCiIiIgoKIyDilZTilZDilaEgYjNmYjIzYjgtODY1Mi00NjliLThkMGMtMGM2YzI3MjNiNjMxCm1kIiIiClRoZSBmaW5hbCBjb252ZW5pZW5jZSBzdHJ1Y3R1cmUgcHJvdmlkZWQgYnkgdGhpcyBtb2R1bGUgaXMgdGhlIGBCb25kVGFibGVgLiBJdCBjYW4gYmUgY3JlYXRlZCB0byBncm91cCBhIGxpc3Qgb2YgYm9uZHMgaW4gYSBmbG9hdGluZyB0YWJsZSB0aGF0IHN0YXlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIG5vdGVib29rIChzaW1pbGFyIHRvIHRoZSBUYWJsZU9mQ29udGVudHMgb2YgUGx1dG9VSSkgYW5kIGNhbiBiZSBtb3ZlZCBhcm91bmQgYW5kIHJlc2l6ZWQgb3IgaGlkZGVuIGZvciBjb252ZW5pZW5jZS4KClRoZSBCb25kVGFibGUgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBlaXRoZXIgd2l0aCBib25kcyBjb250YWluaW5nIGBTdHJ1Y3RCb25kYCBvciB3aXRoIGBCb25kc0xpc3RgLiBGdXR1cmUgdHlwZXMgd2l0aCBzaW1pbGFyIHN0cnVjdHVyZSB3aWxsIGFsc28gYmUgYWRkZWQuCgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgYSBib25kdGFibGUgY29udGFpbmluZyBhbGwgdGhlIGV4YW1wbGVzIG9mIHRoaXMgbm90ZWJvb2suCiIiIgoKIyDilZTilZDilaEgNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4CkJvbmRUYWJsZShbCglhc2RfYm9uZCwKCW50X2JvbmQsCglibCwKCWJsYwpdOyBkZXNjcmlwdGlvbiA9ICJNeSBCb25kcyIpCgojIOKVlOKVkOKVoSBDZWxsIG9yZGVyOgojIOKVoOKVkDFmZmM2NDg5LTZhM2QtNGJkMS05NGU1LTRhODQzYjYxNGIyMAojIOKVn+KUgDVmYmQxNDAxLWM3YTEtNGQ0Zi1iMTZkLWFjOWQ0NWUyZmVkNQojIOKVoOKVkDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyYwojIOKVoOKVkGNmYTc5MTk2LTllMDQtNGQwZS1hNmIxLTU2NDFlMTIzZjNkMwojIOKVn+KUgDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NgojIOKVn+KUgDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYQojIOKVoOKVkDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhNwojIOKVoOKVkDE0NDJhMmViLWIzOGItNDc1Ny1iMDJjLTk2YjU5OTA4NDg4OQojIOKVn+KUgDY1YTNlZDhlLTYyMDQtNGFlZS1hZGZjLWJlZmU5ZWE1MTUzZQojIOKVoOKVkDhjOGZkNTQ5LTBhZmMtNDQ1Mi1iZDZhLTY1NjQ4NjJhMWQ2MwojIOKVoOKVkDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NAojIOKVoOKVkGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3OQojIOKVn+KUgDhhYjJhZjRjLTkyYTItNDI5Zi1iNjQxLTk1YTAyODgwOGFlNQojIOKVn+KUgDI5NTkyMTk0LTJmODktNDljYy05YTIwLTdhOGU5Y2Q0NGFlOQojIOKVoOKVkDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZAojIOKVoOKVkDhkOTEyMjk3LTkyNWUtNGM4Yi05OGI4LTE5YjQzYzliMjlkNwojIOKVn+KUgDlhMWJhYTNkLTE0MjAtNDczYy04MzgwLWJiNWMyMzg4MWUwMAojIOKVn+KUgDkzMjU1YzI0LWQ0ODYtNDE2ZC1hZWZjLTc1NzVmZWZmNzU0MwojIOKVoOKVkDk3OGY3MGVhLTM5M2UtNGYzZC05M2ZiLWM1YTgzNDQzZDA3OQojIOKVoOKVkDZjNTZjMjA1LWFjNzItNDU1Ni1iOTVlLWIyNzhlNGIzZjgyMgojIOKVn+KUgDM4NTM1Y2JlLTA5M2QtNDQ1Mi1iMmE5LTk5OTE4MzE5OTgwMQojIOKVoOKVkDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZgojIOKVn+KUgDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOAojIOKVn+KUgGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMQojIOKVoOKVkDc1ZmM0MGEzLTQyMzEtNDEyNS1iNTJjLWFkMjFmNWI4YTM4OAo=";
window.pluto_disable_ui = true;
window.pluto_slider_server_url = undefined;
window.pluto_binder_url = "https://mybinder.org/v2/gh/fonsp/pluto-on-binder/v0.19.22";
window.pluto_statefile = "data:;base64,3gARpWJvbmRzhKNhbHSBpXZhbHVlzJaibnSBpXZhbHVlkZORCJEDkQWjYXNkgaV2YWx1ZZGVkQKRBpGjQVNEkaCRBKRmcmVxgaV2YWx1ZRSsY2VsbF9yZXN1bHRz3gAZ2SQ2MDkxY2RmNC1jMGVjLTQ1ZjYtOGFhMC1kNGZhZjY2NjZkMmSKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52iIoPGJvbmRzbGlzdC1jb250YWluZXIgY2xhc3M9J25vLXBvcG91dCc+Cgk8Ym9uZHNsaXN0LWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nY29sbGFwc2UgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nIHRpdGxlPSJUaGlzIGxpc3QgY29udGFpbnMgaW5kZXBlbmRlbnQgYm9uZHMiPk15IEdyb3VwIG9mIEJvbmRzPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgZnJlcWAnPgoJCUZyZXF1ZW5jeSBbR0h6XQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPGJvbmQgZGVmPSJmcmVxIiB1bmlxdWVfaWQ9IlQ2TElFOHpIQVRIUCI+CjxzY3JpcHQ+Cgljb25zdCBkM2Zvcm1hdCA9IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCgljb25zdCBlbHAgPSBodG1sYAoJPHNwYW4gY2xhc3M9Im51bWJlcl9FZGl0YWJsZSIgc3R5bGU9IgoJdG91Y2gtYWN0aW9uOiBub25lOwoJcGFkZGluZzogMGVtIC4yZW07Cglib3JkZXItcmFkaXVzOiAuM2VtOwoJZm9udC13ZWlnaHQ6IGJvbGQ7Ij48c3BhbiBjb250ZW50RWRpdGFibGU9dHJ1ZT4yMDwvc3Bhbj4gR0h6PC9zcGFuPgoJYAoKCWNvbnN0IGZvcm1hdHRlciA9IHMgPT4gZDNmb3JtYXQuZm9ybWF0KCIiKShzKQoJY29uc3QgZWwgPSBlbHAucXVlcnlTZWxlY3Rvcigic3BhbiIpCgoJbGV0IGxvY2FsVmFsID0gcGFyc2VGbG9hdCgyMCkKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcigyMCkKCQoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGVscCwidmFsdWUiLHsKCQlnZXQ6ICgpID0+IGxvY2FsVmFsLAoJCXNldDogeCA9PiB7CgkJCWxvY2FsVmFsID0gcGFyc2VGbG9hdCh4KQoJCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoeCkKCQl9Cgl9KQoKCS8vIEZ1bmN0aW9uIHRvIGJsdXIgdGhlIGVsZW1lbnQgd2hlbiBwcmVzc2luZyBlbnRlciBpbnN0ZWFkIG9mIGFkZGluZyBhIG5ld2xpbmUKCWNvbnN0IG9uRW50ZXIgPSAoZSkgPT4gewoJCWlmIChlLmtleUNvZGUgPT09IDEzKSB7CgkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCWlmIChlbC5pbm5lclRleHQgPT09ICIiKSB7CgkJCWVscC52YWx1ZSA9IDIwICAgCgkJfSBlbHNlIHsKCQkJZWxwLnZhbHVlID0gIGVsLmlubmVyVGV4dAoJCX0KCQllbHAuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgkJZWwuYmx1cigpCgkJfQoJfQoKCWVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywoZSkgPT4gewoJCWNvbnNvbGUubG9nKGUpCgkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKQoJfSkKCglmdW5jdGlvbiBzZWxlY3RUZXh0KGVsKXsKCQl2YXIgc2VsLCByYW5nZTsKCQlpZiAod2luZG93LmdldFNlbGVjdGlvbiAmJiBkb2N1bWVudC5jcmVhdGVSYW5nZSkgeyAvL0Jyb3dzZXIgY29tcGF0aWJpbGl0eQoJCXNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKCQlpZihzZWwudG9TdHJpbmcoKSA9PSAnJyl7IC8vbm8gdGV4dCBzZWxlY3Rpb24KCQkJd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCXJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsgLy9yYW5nZSBvYmplY3QKCQkJCXJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhlbCk7IC8vc2V0cyBSYW5nZQoJCQkJc2VsLnJlbW92ZUFsbFJhbmdlcygpOyAvL3JlbW92ZSBhbGwgcmFuZ2VzIGZyb20gc2VsZWN0aW9uCgkJCQlzZWwuYWRkUmFuZ2UocmFuZ2UpOy8vYWRkIFJhbmdlIHRvIGEgU2VsZWN0aW9uLgoJCQl9LDEpOwoJCX0KCQl9ZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7IC8vb2xkZXIgaWUKCQkJc2VsID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CgkJCWlmKHNlbC50ZXh0ID09ICcnKXsgLy9ubyB0ZXh0IHNlbGVjdGlvbgoJCQkJcmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpOy8vQ3JlYXRlcyBUZXh0UmFuZ2Ugb2JqZWN0CgkJCQlyYW5nZS5tb3ZlVG9FbGVtZW50VGV4dChlbCk7Ly9zZXRzIFJhbmdlCgkJCQlyYW5nZS5zZWxlY3QoKTsgLy9tYWtlIHNlbGVjdGlvbi4KCQkJfQoJCX0KCX0KCgllbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJyxvbkVudGVyKQoJZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKSA9PiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpKSAvLyBtb2RpZnkgdGV4dAoJZWxwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSkgPT4gc2VsZWN0VGV4dChlbCkpIC8vIFNlbGVjdCBhbGwgdGV4dAoKCXJldHVybiBlbHAKCjwvc2NyaXB0Pgo8c3R5bGU+CglAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBsaWdodCkgewoJCXNwYW4ubnVtYmVyX0VkaXRhYmxlIHsKCQkJYmFja2dyb3VuZDogaHNsKDIwNCwgOTUlLCA4NCUpOwoJCX0KCX0KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKCQlzcGFuLm51bWJlcl9FZGl0YWJsZSB7CgkJCWJhY2tncm91bmQ6IGhzbCgyMDQsIDk1JSwgNDAlKTsKCQl9Cgl9Cjwvc3R5bGU+CjwvYm9uZD4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBncmlkOwoJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJfQoJCWJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCgkJYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kLXZhbHVlIGJvbmQgewoJCQlkaXNwbGF5OiBmbGV4OyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJCWJvbmQtdmFsdWUgaW5wdXQgewoJCQl3aWR0aDogMTAwJTsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgo8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYWx0YCc+CgkJPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPkFsdGl0dWRlIDxzcGFuIGNsYXNzPSJ0ZXgiPiRoJDwvc3Bhbj4gJiM5MTttJiM5Mzs8L3A+CjwvZGl2PgoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPGJvbmQgZGVmPSJhbHQiIHVuaXF1ZV9pZD0ib24zZHF1SEZWV1pqIj48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxMDAsIDExMCwgMTIwLCAxMzAsIDE0MCwgMTUwLCAxNjAsIDE3MCwgMTgwLCAxOTAsIDIwMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij4xNTA8L3NwYW4+CmAKCgoKbGV0IG9sZF94ID0gMApsZXQgb2xkX2luZGV4ID0gMApjb25zdCBpbml0aWFsX2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIDE1MCkKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoMTUwKQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L2JvbmQ+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCQoJPC9ib25kc2xpc3QtY29udGVudHM+Cgk8c2NyaXB0IGlkPSdhY2d2ZG9zb2V5Jz4KCQljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb250YWluZXIuY29sbGFwc2UgPSAoZm9yY2UpID0+IHsKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJCX0KCQljb25zdCBjb2xsYXBzZV9idG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi5jb2xsYXBzZScpCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gY29udGFpbmVyLmNvbGxhcHNlKCkKCTwvc2NyaXB0PgoJPHN0eWxlPgoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQlkaXNwbGF5OiBmbGV4OwoJCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CgkJfQkJCgkJYm9uZHNsaXN0LWhlYWRlcjpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJCXRvcDogMHB4OwoJCQlib3R0b206IDBweDsKCQkJbGVmdDogMHB4OwoJCQlyaWdodDogMHB4OwoJCQl6LWluZGV4OiAtMTsKCQkJYmFja2dyb3VuZDogI2ZmYWM0NTQwOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dCA+IGJvbmRzbGlzdC1oZWFkZXIgewoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCXBhZGRpbmctdG9wOiAxMnB4OwoJCQltYXJnaW4tdG9wOiAtMTJweDsKCQkJei1pbmRleDogMTA7CgkJfQoJCWJvbmRzbGlzdC1jb250ZW50cyB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dDpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWp1c3RpZnktc2VsZjogY2VudGVyOwoJCQlib3JkZXItYm90dG9tOiAycHggc29saWQ7CgkJCXBhZGRpbmctdG9wOiA1cHg7CgkJCXdpZHRoOiAxMDAlOwoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQkJei1pbmRleDogMjA7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuYm9uZHNsaXN0LWljb24gewoJCQktLXNpemU6IDE3cHg7CgkJCWRpc3BsYXk6IGJsb2NrOwoJCQlhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQliYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQliYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkID4gYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQkJd2lkdGg6IDMwcHg7CgkJCW1hcmdpbjogMCAxMHB4OwoJCX0KCQlib25kc2xpc3QtaGVhZGVyIHsKCQkJZGlzcGxheTogZmxleDsKCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCXdpZHRoOiAxMDAlOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQlmbGV4LWdyb3c6IDE7CgkJCWZvbnQtc2l6ZTogMThweDsKCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewoJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgYm9uZHNsaXN0LWhlYWRlciArICogewoJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIgewoJCQlkaXNwbGF5OiBncmlkOwoJCSAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkgICAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCSAgICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJICAgIHJvdy1nYXA6IDVweDsKCQl9CgkJYm9uZHN0YWJsZS1jb250YWluZXIgYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQkKPC9zdHlsZT4KPC9ib25kc2xpc3QtY29udGFpbmVyPgqkbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlomJssmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQkDS9sL7BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJkuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAV7uybVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaaL88Ym9uZCBkZWY9ImFzZCIgdW5pcXVlX2lkPSJ4dVJWbUJjT2g3SHkiPjxzdHJ1Y3QtYm9uZCBjbGFzcz0nQVNEJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+QVNEPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWJ1cWlkcHFycCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5NYXJrZG93biBkZXNjcmlwdGlvbiwgaW5jbHVkaW5nIDxzcGFuIGNsYXNzPSJ0ZXgiPiRMYVRlWCQ8L3NwYW4+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnJweWlma3hjaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd2cnB5aWZreGNpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidnJweWlma3hjaSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PHNwYW4+RmllbGQgd2l0aCA8Yj5IVE1MPC9iPiBkZXNjcmlwdGlvbjwvc3Bhbj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ25tcW1xem5ibScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNjcmlwdD4KLy8gd2VpcmQgaW1wb3J0IHRvIG1ha2UgaXQgZmFzdGVyLiBUaGUgYGF3YWl0IGltcG9ydGAgY2FuIHN0aWxsIGRlbGF5IGV4ZWN1dGlvbiBieSBvbmUgZnJhbWUgaWYgaXQgaXMgYWxyZWFkeSBsb2FkZWQuLi4Kd2luZG93LmQzZm9ybWF0ID0gd2luZG93LmQzZm9ybWF0ID8/IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCmNvbnN0IGFyZ21pbiA9IHhzID0+IHhzLmluZGV4T2YoTWF0aC5taW4oLi4ueHMpKQpjb25zdCBjbG9zZXN0X2luZGV4ID0gKHhzLCB5KSA9PiBhcmdtaW4oeHMubWFwKHggPT4gTWF0aC5hYnMoeC15KSkpCgpjb25zdCB2YWx1ZXMgPSBbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTBdCgpjb25zdCBlbCA9IGh0bWxgCjxzcGFuIHRpdGxlPSJDbGljayBhbmQgZHJhZyB0aGlzIG51bWJlciBsZWZ0IG9yIHJpZ2h0ISIgc3R5bGU9ImN1cnNvcjogY29sLXJlc2l6ZTsKdG91Y2gtYWN0aW9uOiBub25lOwpiYWNrZ3JvdW5kOiByZ2IoMjUyLCAyMDksIDIwNCk7CmNvbG9yOiBibGFjazsKcGFkZGluZzogMGVtIC4yZW07CmJvcmRlci1yYWRpdXM6IC4zZW07CmZvbnQtd2VpZ2h0OiBib2xkOyI+Njwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgNikKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoNikKCmNvbnN0IG9uU2NydWIgPSAoZSkgPT4gewoJY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRYIC0gb2xkX3gKCWNvbnN0IG5ld19pbmRleCA9IE1hdGgubWluKHZhbHVlcy5sZW5ndGgtMSwgTWF0aC5tYXgoMCwgCgkJTWF0aC5yb3VuZChvZmZzZXQvMTApICsgb2xkX2luZGV4CgkpKQoKCWlmKG5ld19pbmRleCAhPT0gY3VycmVudF9pbmRleCkgewoJCWN1cnJlbnRfaW5kZXggPSBuZXdfaW5kZXgKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgkJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgl9Cn0KCmNvbnN0IG9ucG9pbnRlcmRvd24gPSAoZSkgPT4gewoJd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCkKCW9sZF94ID0gZS5jbGllbnRYCglvbGRfaW5kZXggPSBjdXJyZW50X2luZGV4Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCmNvbnN0IG9uZGJsY2xpY2sgPSAoZSkgPT4gewoJY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCmNvbnN0IG9ucG9pbnRlcnVwID0gKCkgPT4gewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCgplbC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UKCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKfSkKCnJldHVybiBlbAoKPC9zY3JpcHQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nZ25tcW1xem5ibSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImdubXFtcXpuYm0iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPk5vcm1hbCBTdHJpbmcgRGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncXJ2a3hneGhicCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3Fydmt4Z3hoYnAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJxcnZreGd4aGJwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2QnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2QnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGRgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+VGhpcyBmaWVsZCBpcyA8ZW0+c3BlY2lhbDwvZW0+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZCc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnBtd3RxYWhoaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZwbXd0cWFoaGknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cG13dHFhaGhpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2UnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2UnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGVgIj5lPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2UnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J21kbHFkbm9mZXgnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzYnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdtZGxxZG5vZmV4Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibWRscWRub2ZleCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nbHBhc2tnemtwbic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImxwYXNrZ3prcG4iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgYEFTRGAiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FidXFpZHBxcnAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYnVxaWRwcXJwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3p6d3N1eWVua2MnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCS0tc2l6ZTogMTVweDsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlhcHBlYXJhbmNlOiBub25lOwoJCWJhY2tncm91bmQ6ICNjNmM2YzY7CgkJb3V0bGluZTogbm9uZTsKCQlib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCW1hcmdpbjogMCAxMHB4OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKCQliYWNrZ3JvdW5kOiAjNEJEODY1OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICcnOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlib3JkZXItcmFkaXVzOiA1MCU7CgkJdG9wOiAwcHg7CgkJbGVmdDogMHB4OwoJCWJhY2tncm91bmQ6ICNmZmY7CgkJdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwoJCWJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQl0cmFuc2l0aW9uOiAuMXM7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKCQlsZWZ0OiB2YXIoLS1zaXplKQoJfQo8L3N0eWxlPgoKPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nb2hscWZydWxhbic+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIkN1c3RvbSBEZXNjcmlwdGlvbiIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBB2se0kosHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTe5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4IKG3xtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keYWmcHJlZml4o0FTRKhlbGVtZW50c5WSoWGSoTKqdGV4dC9wbGFpbpKhYpKhNqp0ZXh0L3BsYWlukqFjkqUiQVNEIqp0ZXh0L3BsYWlukqFkkqIiIqp0ZXh0L3BsYWlukqFlkqIyM6p0ZXh0L3BsYWlupHR5cGWmc3RydWN0rHByZWZpeF9zaG9ydKNBU0Sob2JqZWN0aWSwZjRmMjRiNzNlM2Q3ZDg2ZqRtaW1l2SFhcHBsaWNhdGlvbi92bmQucGx1dG8udHJlZStvYmplY3Sscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEIKE2cFSwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDE0NDJhMmViLWIzOGItNDc1Ny1iMDJjLTk2YjU5OTA4NDg4OblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lPrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NIqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaSbs8Ym9uZCBkZWY9Im50IiB1bmlxdWVfaWQ9InpZbzA0Ulk4bnZwZSI+PHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyg6YSwgOmIsIDpjKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5NeSBGYW5jeSBOVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdzbHdobWdtb2hwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdwY2lpdHlmd2JrJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+RGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWJ4Z3VqdWtjcCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhYnhndWp1a2NwJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWJ4Z3VqdWtjcCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdwY2lpdHlmd2JrJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPjxzdHJvbmc+Qm9sZDwvc3Ryb25nPiBmaWVsZDwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2InPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3lzd2tsaWJyZWknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0neXN3a2xpYnJlaSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInlzd2tsaWJyZWkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncGNpaXR5Zndiaycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPmM8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWNteHlodWFvdScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhY214eWh1YW91Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWNteHlodWFvdSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0ncGNpaXR5Zndiayc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInBjaWl0eWZ3YmsiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgYE5hbWVkVHVwbGVgIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3Nsd2htZ21vaHAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJzbHdobWdtb2hwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J2lobG5ndGNwcGwnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCS0tc2l6ZTogMTVweDsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlhcHBlYXJhbmNlOiBub25lOwoJCWJhY2tncm91bmQ6ICNjNmM2YzY7CgkJb3V0bGluZTogbm9uZTsKCQlib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCW1hcmdpbjogMCAxMHB4OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKCQliYWNrZ3JvdW5kOiAjNEJEODY1OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICcnOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlib3JkZXItcmFkaXVzOiA1MCU7CgkJdG9wOiAwcHg7CgkJbGVmdDogMHB4OwoJCWJhY2tncm91bmQ6ICNmZmY7CgkJdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwoJCWJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQl0cmFuc2l0aW9uOiAuMXM7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKCQlsZWZ0OiB2YXIoLS1zaXplKQoJfQo8L3N0eWxlPgoKPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0ndWdjYm54YXVheSc+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIk15IEZhbmN5IE5UdXBsZSIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQlzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9ib25kPqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWWnbnRfYm9uZLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEJtXkW46wcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgYTz8O1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SRjMTgzZTM4Zi04NGUzLTRhMWYtYTYzMS02ZDFkYjM5ZjExNzmKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5g6hlbGVtZW50c5OSoWGSoTiqdGV4dC9wbGFpbpKhYpKhM6p0ZXh0L3BsYWlukqFjkqE1qnRleHQvcGxhaW6kdHlwZapOYW1lZFR1cGxlqG9iamVjdGlksGFmODE4MzExMmFjOWYwN2OkbWltZdkhYXBwbGljYXRpb24vdm5kLnBsdXRvLnRyZWUrb2JqZWN0rHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCbXCKy0sHBlcnNpc3RfanNfc3RhdGXDt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRjMTgzZTM4Zi04NGUzLTRhMWYtYTYzMS02ZDFkYjM5ZjExNzm5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZT21cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDeKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5pjIuMGUxMKRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEJA0vmFKwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDhkOTEyMjk3LTkyNWUtNGM4Yi05OGI4LTE5YjQzYzliMjlkN7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lfrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDhhYjJhZjRjLTkyYTItNDI5Zi1iNjQxLTk1YTAyODgwOGFlNYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnZMDxkaXYgY2xhc3M9Im1hcmtkb3duIj48aDE+QEJvbmRzTGlzdDwvaDE+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQcpsIsiLBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAP07rVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaAdM8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+R2VuZXJhdGluZyBhdXRvbWF0aWMgd2lkZ2V0cyBmb3IgY3VzdG9tIHN0cnVjdHMgaXMgcXVpdGUgc3RyYWlnaHRmb3J3YXJkIHdpdGggdGhlIGFpZCBvZiB0aGUgPGNvZGU+QGZpZWxkZGF0YTwvY29kZT4gbWFjcm8gYW5kIHRoZSA8Y29kZT5TdHJ1Y3RCb25kPC9jb2RlPiB0eXBlLjwvcD4KPHA+VGhlIHRvcC1sZWZ0IGFycm93IGNhbiBiZSB1c2VkIHRvIHNob3ctaGlkZSB0aGUgZmllbGQgZWxlbWVudHMgJiM0MDt1c2VmdWwgaW5zaWRlIGEgPGNvZGU+Qm9uZFRhYmxlPC9jb2RlPiwgc2hvd24gYmVsb3cmIzQxOywgd2hpbGUgdGhlIGdyZWVuIHRvZ2dsZSBvbiB0aGUgdG9wLXJpZ2h0IGNhbiBiZSB1c2VkIHRvIGRpc2FibGUgdGVtcG9yYXJpbHkgdGhlIHN5bmNoIGJldHdlZW4gdGhlIEpTIHdpZGdldHMgYW5kIHRoZSBib25kIHZhbHVlcyBpbiBQbHV0by48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQgScJWo7BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2JhuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAoJYLVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDI5NTkyMTk0LTJmODktNDljYy05YTIwLTdhOGU5Y2Q0NGFlOYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaBBo8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+SW4gc29tZSBjYXNlcywgb25lIGRvZXMgbm90IHdhbnQgdG8gaGF2ZSBhIHNpbmdsZSBib25kIHdyYXBwaW5nIGVpdGhlciBhIFN0cnVjdHVyZSBvciBhIE5hbWVkVHVwbGUsIGFuZCBzaW5nbGUgaW5kZXBlbmRlbnQgYm9uZHMgYXJlIG1vcmUgY29udmVuaWVudC48L3A+CjxwPjxjb2RlPkBCb25kc0xpc3Q8L2NvZGU+IGlzIGEgY29udmVuaWVuY2UgbWFjcm8gdG8gY3JlYXRlIGFuIG9iamVjdCBvZiB0eXBlIDxjb2RlPkJvbmRzTGlzdDwvY29kZT4gd2hpY2ggc2ltcGx5IGFsbG93IHRvIGFkZCBhIGRlc2NyaXB0aW9uIHRvIHNlcGFyYXRlIGJvbmRzIGFuZCBncm91cCB0aGVtIGFsbCB0b2dldGhlciBpbiBhIHRhYmxlLWxpa2UgZm9ybWF0IGVxdWl2YWxlbnQgdG8gdGhvc2Ugb2YgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4uPC9wPgo8ZGl2IGNsYXNzPSJhZG1vbml0aW9uIG5vdGUiPjxwIGNsYXNzPSJhZG1vbml0aW9uLXRpdGxlIj5Ob3RlPC9wPjxwPlVubGlrZSA8Y29kZT5TdHJ1Y3RCb25kPC9jb2RlPiwgYSBCb25kc0xpc3QgaXMgYWxyZWFkeSBjb21wb3NlZCBvZiBib25kIGNyZWF0ZWQgd2l0aCA8Y29kZT5AYmluZDwvY29kZT4gYW5kIGl0IGp1c3QgZ3JvdXBzIHRoZW0gdXAgd2l0aCBhIGRlc2NyaXB0aW9uLiBUaGUgb3V0cHV0IG9mIDxjb2RlPkBCb25kc0xpc3Q8L2NvZGU+IGlzIG5vdCBzdXBwb3NlZCB0byBiZSBib3VuZCB0byBhIHZhcmlhYmxlIHVzaW5nIDxjb2RlPkBiaW5kPC9jb2RlPi48YnIgLz5UaGUgYm9uZHMgZ3JvdXBlZCBpbiBhIEJvbmRzTGlzdCBzdGlsbCBhY3QgYW5kIHVwZGF0ZSBpbmRlcGVuZGVudGx5IGZyb20gb25lIGFub3RoZXIuPC9wPgo8L2Rpdj4KPHA+U2VlIHRoZSBleGFtcGxlIGJlbG93IGZvciB1bmRlcnN0YW5kaW5nIHRoZSBzeW50aGF4LiBUaGUgaGVhZGVyIG9mIGEgQm9uZHNMaXN0IGlzIHNob3duIGluIGFuIG9yYW5nZSBiYWNrZ3JvdW5kIHRvIGVhc2lseSBkaWZmZXJlbnRpYXRlIGl0IGZyb20gPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4uPC9wPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEH/rVEmqwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDI5NTkyMTk0LTJmODktNDljYy05YTIwLTdhOGU5Y2Q0NGFlOblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAJ2sm1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ5YTFiYWEzZC0xNDIwLTQ3M2MtODM4MC1iYjVjMjM4ODFlMDCKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52Sw8ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPlBvcG91dDwvaDE+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQgNgxUULBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAbli7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmgpG1pbWWqdGV4dC9wbGFpbqxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQa2qf5K7BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOABZOe7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDhjOGZkNTQ5LTBhZmMtNDQ1Mi1iZDZhLTY1NjQ4NjJhMWQ2M4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaAew8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+U29tZXRpbWVzIGN1c3RvbSBzdHJ1Y3RzIGFyZSBub3QgbmVlZGVkIGFuZCBpdCB3b3VsZCBiZSB1c2VmdWwgdG8ganVzdCB1c2UgdGhlIHNhbWUgbmljZSBib25kIHN0cnVjdHVyZSBvZiA8Y29kZT5TdHJ1Y3RCb25kPC9jb2RlPiB0byBzaW1wbHkgY3JlYXRlIGFyYml0cmFyeSBOYW1lZFR1cGxlcy4gPC9wPgo8cD5UaGlzIGlzIHBvc3NpYmxlIHdpdGggdGhlIGNvbnZlbmllbmNlIG1hY3JvIDxjb2RlPkBOVEJvbmQ8L2NvZGU+IHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLjwvcD4KPHA+VGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSA8Y29kZT5TdHJ1Y3RCb25kPC9jb2RlPiB3cmFwcGluZyB0aGUgZGVzaXJlZCBOYW1lZFR1cGxlIHR5cGUuPC9wPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEHICwjuuwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDhjOGZkNTQ5LTBhZmMtNDQ1Mi1iZDZhLTY1NjQ4NjJhMWQ2M7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgALbWi1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDGKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gGDPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlRoZSBhYmlsaXR5IHRvIGFsc28gd3JhcCBwcmUtZXhpc3RpbmcgYm9uZHMgYXJvdW5kIFN0cnVjdEJvbmRzIGlzIGNvbnZlbmllbnQgZm9yIG9yZ2FuaXppbmcgdGhlIHZhcmlvdXMgYm9uZHMgb25lIGhhdmUgaW4gYSA8Y29kZT5Cb25kc0xpc3Q8L2NvZGU+IG9yIDxjb2RlPkJvbmRUYWJsZTwvY29kZT48L3A+CjxwPkFzIGFuIGV4YW1wbGUsIG9uZSBjYW4gY3JlYXRlIGEgPGNvZGU+Qm9uZHNMaXN0PC9jb2RlPiBjb250YWluaW5nIHRoZSB0d28gPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4gYm9uZHMgZ2VuZXJhdGVkIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBub3RlYm9vayB3aXRoIHRoZSBmb2xsd2luZyBjb2RlLjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCO9PPvCsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDG5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ABgxutXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQziqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedoDmDxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGUgc3RydWN0dXJlcyBhYm92ZSBjYW4gYWxzbyBiZSB1c2VkIG5lc3RlZCB3aXRoaW4gb25lIGFub3RoZXIuIFRvIGZhY2lsaXRhdGUgYWNjZXNzaW5nIG5lc3RlZCBzdHJ1Y3R1cmVzLCBvbmUgY2FuIHVzZSB0aGUgPGNvZGU+UG9wb3V0PC9jb2RlPiB0eXBlLjwvcD4KPHA+SW4gaXRzIHNpbXBsZSBmb3JtLCB5b3UgY2FuIGdpdmUgYW4gaW5zdGFuY2Ugb2YgYSBTdHJ1Y3RCb25kLCBhIGJvbmQgd3JhcHBpbmcgYSBTdHJ1Y3RCb25kIG9yIGEgQm9uZHNMaXN0IGFzIGlucHV0IHRvIFBvcG91dCB0byBjcmVhdGUgYSB0YWJsZSB0aGF0IGlzIGhpZGRlbiBiZWhpbmQgYSBwb3B1cCB3aW5kb3cuIElmIGFuIGluc3RhbmNlIHByZXNlbnQsIGJ1dCB5b3Ugd2FudCBhIGN1c3RvbSB0eXBlIGZvciB3aGljaCB5b3UgaGF2ZSBkZWZpbmVkIGN1c3RvbSBib25kcyBhbmQgZGVzY3JpcHRpb25zIHdpdGggPGNvZGU+QGZpZWxkZGF0YTwvY29kZT4gdG8gYXBwZWFyIGFzIHBvcG91dCwgeW91IGNhbiB1c2UgdGhlIGZ1bmN0aW9uIDxjb2RlPnBvcG91dHdyYXAmIzQwO1RZUEUmIzQxOzwvY29kZT4gdG8gZ2VuZXJhdGUgYSBzbWFsbCBpY29uIHdoaWNoIGhpZGVzIGEgcG9wdXAgY29udGFpbmluZyB0aGUgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4gb2YgdGhlIHByb3ZpZGVkIHR5cGUgPGNvZGU+VFlQRTwvY29kZT4uPC9wPgo8cD5UaGUgU3RydWN0Qm9uZCB0YWJsZSBhcHBlYXJzIG9uIGhvdmVyIHVwb24gdGhlIGljb24sIGNhbiBiZSBtYWRlIGZpeGVkIGJ5IGNsaWNraW5nIG9uIHRoZSBpY29uIGFuZCBjYW4gdGhlbiBiZSBtb3ZlZCBhcm91bmQgb3IgcmVzaXplZC4gQSBkb3VibGUgY2xpY2sgb24gdGhlIGhlYWRlciBvZiB0aGUgcG9wb3V0IGhpZGVzIGl0IGFnYWluOjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCPPPILksHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDO5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AB/ALtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNmM1NmMyMDUtYWM3Mi00NTU2LWI5NWUtYjI3OGU0YjNmODIyiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedpduzxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwb3BvdXQtY29udGFpbmVyIGtleT0nenF4cWR3YmpodSc+Cgk8cG9wb3V0LWhlYWRlcj48c3BhbiBjbGFzcz0ncG9wb3V0LWljb24gcG9wb3V0Jz48L3NwYW4+PC9wb3BvdXQtaGVhZGVyPgoJPHBvcG91dC1jb250ZW50cz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYXpjemNobXpoJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3RydWN0LWJvbmQgY2xhc3M9J01haW4udmFyJnF1b3Q7d29ya3NwYWNlIzE3MiZxdW90Oy5MT0wnPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5MT0w8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdpamllbXVhdmRjJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtdXpjdGlxdXRoJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPldvbmRlciYjMzM7PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYml2d3dpemJ2cycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdiaXZ3d2l6YnZzJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYml2d3dpemJ2cyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtdXpjdGlxdXRoJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PHNwYW4+RmllbGQgQjwvc3Bhbj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWl0aGJycGN6bycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNjcmlwdD4KLy8gd2VpcmQgaW1wb3J0IHRvIG1ha2UgaXQgZmFzdGVyLiBUaGUgYGF3YWl0IGltcG9ydGAgY2FuIHN0aWxsIGRlbGF5IGV4ZWN1dGlvbiBieSBvbmUgZnJhbWUgaWYgaXQgaXMgYWxyZWFkeSBsb2FkZWQuLi4Kd2luZG93LmQzZm9ybWF0ID0gd2luZG93LmQzZm9ybWF0ID8/IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCmNvbnN0IGFyZ21pbiA9IHhzID0+IHhzLmluZGV4T2YoTWF0aC5taW4oLi4ueHMpKQpjb25zdCBjbG9zZXN0X2luZGV4ID0gKHhzLCB5KSA9PiBhcmdtaW4oeHMubWFwKHggPT4gTWF0aC5hYnMoeC15KSkpCgpjb25zdCB2YWx1ZXMgPSBbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTBdCgpjb25zdCBlbCA9IGh0bWxgCjxzcGFuIHRpdGxlPSJDbGljayBhbmQgZHJhZyB0aGlzIG51bWJlciBsZWZ0IG9yIHJpZ2h0ISIgc3R5bGU9ImN1cnNvcjogY29sLXJlc2l6ZTsKdG91Y2gtYWN0aW9uOiBub25lOwpiYWNrZ3JvdW5kOiByZ2IoMjUyLCAyMDksIDIwNCk7CmNvbG9yOiBibGFjazsKcGFkZGluZzogMGVtIC4yZW07CmJvcmRlci1yYWRpdXM6IC4zZW07CmZvbnQtd2VpZ2h0OiBib2xkOyI+Njwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgNikKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoNikKCmNvbnN0IG9uU2NydWIgPSAoZSkgPT4gewoJY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRYIC0gb2xkX3gKCWNvbnN0IG5ld19pbmRleCA9IE1hdGgubWluKHZhbHVlcy5sZW5ndGgtMSwgTWF0aC5tYXgoMCwgCgkJTWF0aC5yb3VuZChvZmZzZXQvMTApICsgb2xkX2luZGV4CgkpKQoKCWlmKG5ld19pbmRleCAhPT0gY3VycmVudF9pbmRleCkgewoJCWN1cnJlbnRfaW5kZXggPSBuZXdfaW5kZXgKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgkJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgl9Cn0KCmNvbnN0IG9ucG9pbnRlcmRvd24gPSAoZSkgPT4gewoJd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCkKCW9sZF94ID0gZS5jbGllbnRYCglvbGRfaW5kZXggPSBjdXJyZW50X2luZGV4Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCmNvbnN0IG9uZGJsY2xpY2sgPSAoZSkgPT4gewoJY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCmNvbnN0IG9ucG9pbnRlcnVwID0gKCkgPT4gewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCgplbC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UKCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKfSkKCnJldHVybiBlbAoKPC9zY3JpcHQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWl0aGJycGN6byc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFpdGhicnBjem8iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J211emN0aXF1dGgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJtdXpjdGlxdXRoIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIGBMT0xgIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdpamllbXVhdmRjJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiaWppZW11YXZkYyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdzYWJhY3pmZWpvJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCWN1cnNvcjogcG9pbnRlcjsKCQktLXNpemU6IDE1cHg7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYXBwZWFyYW5jZTogbm9uZTsKCQliYWNrZ3JvdW5kOiAjYzZjNmM2OwoJCW91dGxpbmU6IG5vbmU7CgkJYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQltYXJnaW46IDAgMTBweDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CgkJYmFja2dyb3VuZDogIzRCRDg2NTsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKCQljb250ZW50OiAnJzsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYm9yZGVyLXJhZGl1czogNTAlOwoJCXRvcDogMHB4OwoJCWxlZnQ6IDBweDsKCQliYWNrZ3JvdW5kOiAjZmZmOwoJCXRyYW5zZm9ybTogc2NhbGUoMS4xKTsKCQlib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJdHJhbnNpdGlvbjogLjFzOwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CgkJbGVmdDogdmFyKC0tc2l6ZSkKCX0KPC9zdHlsZT4KCjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J2Zhamxib3F3a2MnPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJMT0wiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJYm9uZCA+IHN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J3pxeHFkd2JqaHUnPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQoJLy8gV2UgdXNlIHRoZSBpbnRlcmFjdGpzIGxpYnJhcnkgdG8gcHJvdmlkZSBkcmFnIGFuZCByZXNpemUgaGFuZGxpbmcgYWNyb3NzIGRldmljZXMKCWNvbnN0IHsgZGVmYXVsdDogaW50ZXJhY3QgfSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvaW50ZXJhY3RqcycpCgoJY29udGVudHMub2Zmc2V0ID0gY29udGVudHMub2Zmc2V0ID8/IHsgeDogMCwgeTogMH0KCWNvbnN0IHN0YXJ0UG9zaXRpb24gPSB7eDogMCwgeTogMH0KCWludGVyYWN0KGNvbnRlbnRzLnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAuZGVzY3JpcHRpb24sIGJvbmRzbGlzdC1oZWFkZXIgLmRlc2NyaXB0aW9uJykpLmRyYWdnYWJsZSh7CgkJbGlzdGVuZXJzOiB7CgkJCXN0YXJ0IChldmVudCkgewoJCQkJY29udGVudHMub2Zmc2V0LnkgPSBzdGFydFBvc2l0aW9uLnkgPSBjb250ZW50cy5vZmZzZXRUb3AKCQkJCWNvbnRlbnRzLm9mZnNldC54ID0gc3RhcnRQb3NpdGlvbi54ID0gY29udGVudHMub2Zmc2V0TGVmdAoJCQl9LAoJCQltb3ZlIChldmVudCkgewoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC54ICs9IGV2ZW50LmR4CgkJICAgICAgY29udGVudHMub2Zmc2V0LnkgKz0gZXZlbnQuZHkKCQkKCQkgICAgICBjb250ZW50cy5zdHlsZS50b3AgPSBgbWluKDk1dmgsICR7Y29udGVudHMub2Zmc2V0Lnl9cHhgCgkJICAgICAgY29udGVudHMuc3R5bGUubGVmdCA9IGBtaW4oOTV2dywgJHtjb250ZW50cy5vZmZzZXQueH1weGAKCQkgICAgfSwKCQl9Cgl9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIGhlYWRlciByZXNldCB0aGUgcG9zaXRpb24KCQljb250YWluZXIucG9wb3V0KCkKCX0pCglpbnRlcmFjdChjb250ZW50cykKCSAgLnJlc2l6YWJsZSh7CgkgICAgZWRnZXM6IHsgdG9wOiB0cnVlLCBsZWZ0OiBmYWxzZSwgYm90dG9tOiB0cnVlLCByaWdodDogdHJ1ZSB9LAoJICAgIGxpc3RlbmVyczogewoJICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CQkKCSAgICAgICAgT2JqZWN0LmFzc2lnbihldmVudC50YXJnZXQuc3R5bGUsIHsKCSAgICAgICAgICB3aWR0aDogYCR7ZXZlbnQucmVjdC53aWR0aH1weGAsCgkgICAgICAgICAgaGVpZ2h0OiBgJHtldmVudC5yZWN0LmhlaWdodH1weGAsCgkgICAgICAgIH0pCgkgICAgICB9CgkgICAgfQoJICB9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIHJlc2l6ZSByZXNldCB0aGUgd2lkdGgKCQkJY29udGVudHMuc3R5bGUud2lkdGggPSAnJwoJCSAgCWNvbnRlbnRzLnN0eWxlLmhlaWdodCA9ICcnCgkgIH0pCgoKCWZ1bmN0aW9uIHBvc2l0aW9uQ29udGVudHMoKSB7CgkJY29tcHV0ZVBvc2l0aW9uKGhlYWRlciwgY29udGVudHMsIHsKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJCW1pZGRsZXdhcmU6IFthdXRvUGxhY2VtZW50KCldLAoJCX0pLnRoZW4oKHBvcykgPT4gewoJCQljb250ZW50cy5zdHlsZS5sZWZ0ID0gcG9zLnggKyAicHgiCgkJCWNvbnRlbnRzLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCX0pCgl9CgoJY29udGFpbmVyLnBvcG91dCA9IChmb3JjZSA9IHVuZGVmaW5lZCkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdwb3BwZWQnLCBmb3JjZSkKCQlwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCgloZWFkZXIub25jbGljayA9IChlKSA9PiB7Y29udGFpbmVyLnBvcG91dCgpfQoKCWNvbnRlbnRzLm9ubW91c2VlbnRlciA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCB0cnVlKQoJY29udGVudHMub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIGZhbHNlKQoKCWhlYWRlci5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCB0cnVlKQoJCWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHBlZCcpID8gbnVsbCA6IHBvc2l0aW9uQ29udGVudHMoKQoJfQoJaGVhZGVyLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgZmFsc2UpCjwvc2NyaXB0Pgo8c3R5bGU+Cglwb3BvdXQtaGVhZGVyIHsKCQlkaXNwbGF5OiBmbGV4OwoJCWJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKCQlib3JkZXItcmFkaXVzOiAxMHB4OwoJCWp1c3RpZnktY29udGVudDogY2VudGVyOwoJfQoJcG9wb3V0LWNvbnRlbnRzIHsKCQlkaXNwbGF5OiBub25lOwoJCXdpZHRoOiA0MDBweDsKCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CiAgICAJYm9yZGVyOiAzcHggc29saWQgdmFyKC0tb3ZlcmxheS1idXR0b24tYm9yZGVyKTsKICAgIAlib3JkZXItcmFkaXVzOiAxMHB4OwogICAgCXBhZGRpbmc6IDhweDsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLAogCXBvcG91dC1jb250YWluZXIuaGVhZGVyLWhvdmVyID4gcG9wb3V0LWNvbnRlbnRzIHsKCQlkaXNwbGF5OiBibG9jazsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJei1pbmRleDogNTAwOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5jb250ZW50cy1ob3ZlciA+IHBvcG91dC1oZWFkZXIgewoJCWJvcmRlci1jb2xvcjogdmFyKC0tcGx1dG8tbG9ncy13YXJuLWFjY2VudC1jb2xvcik7Cgl9CgkucG9wb3V0LWljb24gewoJCS0tc2l6ZTogMjBweDsKCSAgICBkaXNwbGF5OiBibG9jazsKCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCW1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwoJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cgl9CgkucG9wb3V0LWljb24ucG9wb3V0IHsJCgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXhwYW5kLnN2Zyk7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKCSAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jb250cmFjdC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQl0b3VjaC1hY3Rpb246IG5vbmU7CgkJdXNlci1zZWxlY3Q6IG5vbmU7Cgl9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J2FhemN6Y2htemgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYXpjemNobXpoIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEJCFnrvuwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDZjNTZjMjA1LWFjNzItNDU1Ni1iOTVlLWIyNzhlNGIzZjgyMrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgQ/ifm1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2WKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52S08ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPkBOVEJvbmQ8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEHCiH6YWwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDY1YTNlZDhlLTYyMDQtNGFlZS1hZGZjLWJlZmU5ZWE1MTUzZblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAD+B+1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjCKpnF1ZXVlZMKkbG9nc5GIpGxpbmX/o21zZ5LZTRtbMzJtG1sxbSAgQWN0aXZhdGluZxtbMjJtG1szOW0gcHJvamVjdCBhdCBgfi9SZXBvcy9naXRodWIvbWluZS9QbHV0b0V4dHJhc2AKqnRleHQvcGxhaW6nY2VsbF9pZNkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwpmt3YXJnc5CiaWS5TWFpbl9QbHV0b1J1bm5lcl8zMDQzZGI4Y6RmaWxl2UQvaG9tZS9hbWVuZ2FsaS8uanVsaWEvcGFja2FnZXMvUGx1dG8vWkJvalIvc3JjL3J1bm5lci9QbHV0b1J1bm5lci5qbKVncm91cKtQbHV0b1J1bm5lcqVsZXZlbK5Mb2dMZXZlbCgtNTU1KadydW5uaW5nwqZvdXRwdXSGpGJvZHmgpG1pbWWqdGV4dC9wbGFpbqxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQa2qbXiLBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAbom9rVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8OnZXJyb3JlZMLZJDVmYmQxNDAxLWM3YTEtNGQ0Zi1iMTZkLWFjOWQ0NWUyZmVkNYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnZLjxkaXYgY2xhc3M9Im1hcmtkb3duIj48aDE+UGFja2FnZXM8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEGttbi/SwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDVmYmQxNDAxLWM3YTEtNGQ0Zi1iMTZkLWFjOWQ0NWUyZmVkNblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAD4Je1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzmKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5oKRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEJCFGNxGwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDk3OGY3MGVhLTM5M2UtNGYzZC05M2ZiLWM1YTgzNDQzZDA3OblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgBfb/G1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDaKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52TA8ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPlN0cnVjdEJvbmQ8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEF6jiP1ewcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgBKMDe1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQzNzNiYzI0NC0xMTBhLTQzZjgtYWFhMS01MWI1Y2I3NTExMjiKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52S88ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPkJvbmRUYWJsZTwvaDE+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQj1AI6o7BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkMzczYmMyNDQtMTEwYS00M2Y4LWFhYTEtNTFiNWNiNzUxMTI4uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAASR9LVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaAmg8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+VGhlIGZpbmFsIGNvbnZlbmllbmNlIHN0cnVjdHVyZSBwcm92aWRlZCBieSB0aGlzIG1vZHVsZSBpcyB0aGUgPGNvZGU+Qm9uZFRhYmxlPC9jb2RlPi4gSXQgY2FuIGJlIGNyZWF0ZWQgdG8gZ3JvdXAgYSBsaXN0IG9mIGJvbmRzIGluIGEgZmxvYXRpbmcgdGFibGUgdGhhdCBzdGF5cyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBub3RlYm9vayAmIzQwO3NpbWlsYXIgdG8gdGhlIFRhYmxlT2ZDb250ZW50cyBvZiBQbHV0b1VJJiM0MTsgYW5kIGNhbiBiZSBtb3ZlZCBhcm91bmQgYW5kIHJlc2l6ZWQgb3IgaGlkZGVuIGZvciBjb252ZW5pZW5jZS48L3A+CjxwPlRoZSBCb25kVGFibGUgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBlaXRoZXIgd2l0aCBib25kcyBjb250YWluaW5nIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IG9yIHdpdGggPGNvZGU+Qm9uZHNMaXN0PC9jb2RlPi4gRnV0dXJlIHR5cGVzIHdpdGggc2ltaWxhciBzdHJ1Y3R1cmUgd2lsbCBhbHNvIGJlIGFkZGVkLjwvcD4KPHA+SGVyZSBpcyBhbiBleGFtcGxlIG9mIGEgYm9uZHRhYmxlIGNvbnRhaW5pbmcgYWxsIHRoZSBleGFtcGxlcyBvZiB0aGlzIG5vdGVib29rLjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCQGnXocsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRiM2ZiMjNiOC04NjUyLTQ2OWItOGQwYy0wYzZjMjcyM2I2MzG5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ABx7NtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOTVhZDk0MjgtNzNmOC00ZjU3LTkxODUtOTY4NWI5YTIxMjNmiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedr0rjxib25kc2xpc3QtY29udGFpbmVyIGNsYXNzPSduby1wb3BvdXQnPgoJPGJvbmRzbGlzdC1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2NvbGxhcHNlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJyB0aXRsZT0iVGhpcyBsaXN0IGNvbnRhaW5zIGluZGVwZW5kZW50IGJvbmRzIj5Qb3BvdXQgQ29udGFpbmVyPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYXNkYCc+CgkJU3RydWN0dXJlIEFTRAoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSd4emRlcmdmY2RkJz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FodW11aHhub3AnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0iYXNkIiB1bmlxdWVfaWQ9Inh1UlZtQmNPaDdIeSI+PHN0cnVjdC1ib25kIGNsYXNzPSdNYWluLnZhciZxdW90O3dvcmtzcGFjZSM3MSZxdW90Oy5BU0QnPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5BU0Q8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYnVxaWRwcXJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgPHNwYW4gY2xhc3M9InRleCI+JExhVGVYJDwvc3Bhbj48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cnB5aWZreGNpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZycHlpZmt4Y2knPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cnB5aWZreGNpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdnbm1xbXF6bmJtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdnbm1xbXF6bmJtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ25tcW1xem5ibSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+Tm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdxcnZreGd4aGJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncXJ2a3hneGhicCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInFydmt4Z3hoYnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZGAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGlzIGZpZWxkIGlzIDxlbT5zcGVjaWFsPC9lbT48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdkJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cG13dHFhaGhpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnBtd3RxYWhoaSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZwbXd0cWFoaGkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZWAiPmU8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbWRscWRub2ZleCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nNicgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J21kbHFkbm9mZXgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJtZGxxZG5vZmV4Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdscGFza2d6a3BuJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHBhc2tnemtwbiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgQVNEYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWJ1cWlkcHFycCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFidXFpZHBxcnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nenp3c3V5ZW5rYyc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdvaGxxZnJ1bGFuJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiQ3VzdG9tIERlc2NyaXB0aW9uIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSd4emRlcmdmY2RkJz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogMTBweDsKCQlqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCX0KCXBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogbm9uZTsKCQl3aWR0aDogNDAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nOiA4cHg7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKIAlwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogYmxvY2s7CgkJcG9zaXRpb246IGZpeGVkOwoJCXotaW5kZXg6IDUwMDsKCX0KCXBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKCQlib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwoJfQoJLnBvcG91dC1pY29uIHsKCQktLXNpemU6IDIwcHg7CgkgICAgZGlzcGxheTogYmxvY2s7CgkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQltaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJfQoJLnBvcG91dC1pY29uLnBvcG91dCB7CQoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCXVzZXItc2VsZWN0OiBub25lOwoJfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSdhaHVtdWh4bm9wJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWh1bXVoeG5vcCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYG50YCc+CgkJTmFtZWRUdXBsZQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSdwY2ZqcGZmdXl0Jz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2Z1dnRmb3lwYWonIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0ibnQiIHVuaXF1ZV9pZD0iellvMDRSWThudnBlIj48c3RydWN0LWJvbmQgY2xhc3M9J05hbWVkVHVwbGV7KDphLCA6YiwgOmMpfSc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk15IEZhbmN5IE5UdXBsZTwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3Nsd2htZ21vaHAnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3BjaWl0eWZ3YmsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj5EZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYnhndWp1a2NwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FieGd1anVrY3AnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYnhndWp1a2NwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3BjaWl0eWZ3YmsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+PHN0cm9uZz5Cb2xkPC9zdHJvbmc+IGZpZWxkPC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0neXN3a2xpYnJlaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd5c3drbGlicmVpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAieXN3a2xpYnJlaSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdwY2lpdHlmd2JrJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+YzwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhY214eWh1YW91JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FjbXh5aHVhb3UnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhY214eWh1YW91Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdwY2lpdHlmd2JrJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAicGNpaXR5ZndiayIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgTmFtZWRUdXBsZWAiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nc2x3aG1nbW9ocCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInNsd2htZ21vaHAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0naWhsbmd0Y3BwbCc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSd1Z2NibnhhdWF5Jz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTXkgRmFuY3kgTlR1cGxlIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSdwY2ZqcGZmdXl0Jz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogMTBweDsKCQlqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCX0KCXBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogbm9uZTsKCQl3aWR0aDogNDAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nOiA4cHg7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKIAlwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogYmxvY2s7CgkJcG9zaXRpb246IGZpeGVkOwoJCXotaW5kZXg6IDUwMDsKCX0KCXBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKCQlib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwoJfQoJLnBvcG91dC1pY29uIHsKCQktLXNpemU6IDIwcHg7CgkgICAgZGlzcGxheTogYmxvY2s7CgkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQltaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJfQoJLnBvcG91dC1pY29uLnBvcG91dCB7CQoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCXVzZXItc2VsZWN0OiBub25lOwoJfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSdmdXZ0Zm95cGFqJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZnV2dGZveXBhaiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCQoJPC9ib25kc2xpc3QtY29udGVudHM+Cgk8c2NyaXB0IGlkPSdqdW1oY2ZqbHpiJz4KCQljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb250YWluZXIuY29sbGFwc2UgPSAoZm9yY2UpID0+IHsKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJCX0KCQljb25zdCBjb2xsYXBzZV9idG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi5jb2xsYXBzZScpCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gY29udGFpbmVyLmNvbGxhcHNlKCkKCTwvc2NyaXB0PgoJPHN0eWxlPgoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQlkaXNwbGF5OiBmbGV4OwoJCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CgkJfQkJCgkJYm9uZHNsaXN0LWhlYWRlcjpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJCXRvcDogMHB4OwoJCQlib3R0b206IDBweDsKCQkJbGVmdDogMHB4OwoJCQlyaWdodDogMHB4OwoJCQl6LWluZGV4OiAtMTsKCQkJYmFja2dyb3VuZDogI2ZmYWM0NTQwOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dCA+IGJvbmRzbGlzdC1oZWFkZXIgewoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCXBhZGRpbmctdG9wOiAxMnB4OwoJCQltYXJnaW4tdG9wOiAtMTJweDsKCQkJei1pbmRleDogMTA7CgkJfQoJCWJvbmRzbGlzdC1jb250ZW50cyB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dDpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWp1c3RpZnktc2VsZjogY2VudGVyOwoJCQlib3JkZXItYm90dG9tOiAycHggc29saWQ7CgkJCXBhZGRpbmctdG9wOiA1cHg7CgkJCXdpZHRoOiAxMDAlOwoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQkJei1pbmRleDogMjA7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuYm9uZHNsaXN0LWljb24gewoJCQktLXNpemU6IDE3cHg7CgkJCWRpc3BsYXk6IGJsb2NrOwoJCQlhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQliYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQliYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkID4gYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQkJd2lkdGg6IDMwcHg7CgkJCW1hcmdpbjogMCAxMHB4OwoJCX0KCQlib25kc2xpc3QtaGVhZGVyIHsKCQkJZGlzcGxheTogZmxleDsKCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCXdpZHRoOiAxMDAlOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQlmbGV4LWdyb3c6IDE7CgkJCWZvbnQtc2l6ZTogMThweDsKCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewoJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgYm9uZHNsaXN0LWhlYWRlciArICogewoJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIgewoJCQlkaXNwbGF5OiBncmlkOwoJCSAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkgICAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCSAgICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJICAgIHJvdy1nYXA6IDVweDsKCQl9CgkJYm9uZHN0YWJsZS1jb250YWluZXIgYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQkKPC9zdHlsZT4KPC9ib25kc2xpc3QtY29udGFpbmVyPgqkbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlo2JsY7JsYXN0X3J1bl90aW1lc3RhbXDLQdkEJtXlVwiwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzRZxtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedsAAd7DPGJvbmR0YWJsZS1jb250YWluZXIga2V5PSdhZWFxZXlpZHVuJz4KCTxib25kdGFibGUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSd0YWJsZS1oZWxwIGljb24nPjwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk15IEJvbmRzPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0YWJsZS1jb2xsYXBzZSBpY29uJz48L3NwYW4+Cgk8L2JvbmR0YWJsZS1oZWFkZXI+Cgk8Ym9uZHRhYmxlLWNvbnRlbnRzPgoJCTxib25kIGRlZj0iYXNkIiB1bmlxdWVfaWQ9Inh1UlZtQmNPaDdIeSI+PHN0cnVjdC1ib25kIGNsYXNzPSdBU0QnPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5BU0Q8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYnVxaWRwcXJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgPHNwYW4gY2xhc3M9InRleCI+JExhVGVYJDwvc3Bhbj48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cnB5aWZreGNpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZycHlpZmt4Y2knPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cnB5aWZreGNpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdnbm1xbXF6bmJtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdnbm1xbXF6bmJtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ25tcW1xem5ibSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+Tm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdxcnZreGd4aGJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncXJ2a3hneGhicCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInFydmt4Z3hoYnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZGAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGlzIGZpZWxkIGlzIDxlbT5zcGVjaWFsPC9lbT48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdkJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cG13dHFhaGhpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnBtd3RxYWhoaSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZwbXd0cWFoaGkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZWAiPmU8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbWRscWRub2ZleCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nNicgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J21kbHFkbm9mZXgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJtZGxxZG5vZmV4Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdscGFza2d6a3BuJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHBhc2tnemtwbiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgQVNEYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWJ1cWlkcHFycCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFidXFpZHBxcnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nenp3c3V5ZW5rYyc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdvaGxxZnJ1bGFuJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiQ3VzdG9tIERlc2NyaXB0aW9uIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PGJvbmQgZGVmPSJudCIgdW5pcXVlX2lkPSJ6WW8wNFJZOG52cGUiPjxzdHJ1Y3QtYm9uZCBjbGFzcz0nTmFtZWRUdXBsZXsoOmEsIDpiLCA6Yyl9Jz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TXkgRmFuY3kgTlR1cGxlPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nc2x3aG1nbW9ocCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncGNpaXR5Zndiaycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPkRlc2NyaXB0aW9uPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FieGd1anVrY3AnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWJ4Z3VqdWtjcCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFieGd1anVrY3AiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncGNpaXR5Zndiaycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYic+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYicgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYmAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD48c3Ryb25nPkJvbGQ8L3N0cm9uZz4gZmllbGQ8L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd5c3drbGlicmVpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3lzd2tsaWJyZWknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ5c3drbGlicmVpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3BjaWl0eWZ3YmsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5jPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FjbXh5aHVhb3UnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWNteHlodWFvdSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFjbXh5aHVhb3UiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J3BjaWl0eWZ3YmsnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJwY2lpdHlmd2JrIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIGBOYW1lZFR1cGxlYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdzbHdobWdtb2hwJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAic2x3aG1nbW9ocCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdpaGxuZ3RjcHBsJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCWN1cnNvcjogcG9pbnRlcjsKCQktLXNpemU6IDE1cHg7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYXBwZWFyYW5jZTogbm9uZTsKCQliYWNrZ3JvdW5kOiAjYzZjNmM2OwoJCW91dGxpbmU6IG5vbmU7CgkJYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQltYXJnaW46IDAgMTBweDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CgkJYmFja2dyb3VuZDogIzRCRDg2NTsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKCQljb250ZW50OiAnJzsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYm9yZGVyLXJhZGl1czogNTAlOwoJCXRvcDogMHB4OwoJCWxlZnQ6IDBweDsKCQliYWNrZ3JvdW5kOiAjZmZmOwoJCXRyYW5zZm9ybTogc2NhbGUoMS4xKTsKCQlib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJdHJhbnNpdGlvbjogLjFzOwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CgkJbGVmdDogdmFyKC0tc2l6ZSkKCX0KPC9zdHlsZT4KCjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J3VnY2JueGF1YXknPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJNeSBGYW5jeSBOVHVwbGUiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48Ym9uZHNsaXN0LWNvbnRhaW5lciBjbGFzcz0nbm8tcG9wb3V0Jz4KCTxib25kc2xpc3QtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdjb2xsYXBzZSBib25kc2xpc3QtaWNvbic+PC9zcGFuPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbicgdGl0bGU9IlRoaXMgbGlzdCBjb250YWlucyBpbmRlcGVuZGVudCBib25kcyI+TXkgR3JvdXAgb2YgQm9uZHM8L3NwYW4+CgkJPHNwYW4gY2xhc3M9J3RvZ2dsZSBib25kc2xpc3QtaWNvbic+PC9zcGFuPgoJPC9ib25kc2xpc3QtaGVhZGVyPgoJPGJvbmRzbGlzdC1jb250ZW50cz4KCTxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBmcmVxYCc+CgkJRnJlcXVlbmN5IFtHSHpdCgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8Ym9uZCBkZWY9ImZyZXEiIHVuaXF1ZV9pZD0iVDZMSUU4ekhBVEhQIj4KPHNjcmlwdD4KCWNvbnN0IGQzZm9ybWF0ID0gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKCWNvbnN0IGVscCA9IGh0bWxgCgk8c3BhbiBjbGFzcz0ibnVtYmVyX0VkaXRhYmxlIiBzdHlsZT0iCgl0b3VjaC1hY3Rpb246IG5vbmU7CglwYWRkaW5nOiAwZW0gLjJlbTsKCWJvcmRlci1yYWRpdXM6IC4zZW07Cglmb250LXdlaWdodDogYm9sZDsiPjxzcGFuIGNvbnRlbnRFZGl0YWJsZT10cnVlPjIwPC9zcGFuPiBHSHo8L3NwYW4+CglgCgoJY29uc3QgZm9ybWF0dGVyID0gcyA9PiBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpCgljb25zdCBlbCA9IGVscC5xdWVyeVNlbGVjdG9yKCJzcGFuIikKCglsZXQgbG9jYWxWYWwgPSBwYXJzZUZsb2F0KDIwKQoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKDIwKQoJCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZWxwLCJ2YWx1ZSIsewoJCWdldDogKCkgPT4gbG9jYWxWYWwsCgkJc2V0OiB4ID0+IHsKCQkJbG9jYWxWYWwgPSBwYXJzZUZsb2F0KHgpCgkJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcih4KQoJCX0KCX0pCgoJLy8gRnVuY3Rpb24gdG8gYmx1ciB0aGUgZWxlbWVudCB3aGVuIHByZXNzaW5nIGVudGVyIGluc3RlYWQgb2YgYWRkaW5nIGEgbmV3bGluZQoJY29uc3Qgb25FbnRlciA9IChlKSA9PiB7CgkJaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJaWYgKGVsLmlubmVyVGV4dCA9PT0gIiIpIHsKCQkJZWxwLnZhbHVlID0gMjAgICAKCQl9IGVsc2UgewoJCQllbHAudmFsdWUgPSAgZWwuaW5uZXJUZXh0CgkJfQoJCWVscC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCQllbC5ibHVyKCkKCQl9Cgl9CgoJZWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLChlKSA9PiB7CgkJY29uc29sZS5sb2coZSkKCQllLnByZXZlbnREZWZhdWx0KCkKCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpCgl9KQoKCWZ1bmN0aW9uIHNlbGVjdFRleHQoZWwpewoJCXZhciBzZWwsIHJhbmdlOwoJCWlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uICYmIGRvY3VtZW50LmNyZWF0ZVJhbmdlKSB7IC8vQnJvd3NlciBjb21wYXRpYmlsaXR5CgkJc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpOwoJCWlmKHNlbC50b1N0cmluZygpID09ICcnKXsgLy9ubyB0ZXh0IHNlbGVjdGlvbgoJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewoJCQkJcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOyAvL3JhbmdlIG9iamVjdAoJCQkJcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGVsKTsgLy9zZXRzIFJhbmdlCgkJCQlzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7IC8vcmVtb3ZlIGFsbCByYW5nZXMgZnJvbSBzZWxlY3Rpb24KCQkJCXNlbC5hZGRSYW5nZShyYW5nZSk7Ly9hZGQgUmFuZ2UgdG8gYSBTZWxlY3Rpb24uCgkJCX0sMSk7CgkJfQoJCX1lbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsgLy9vbGRlciBpZQoJCQlzZWwgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKCQkJaWYoc2VsLnRleHQgPT0gJycpeyAvL25vIHRleHQgc2VsZWN0aW9uCgkJCQlyYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7Ly9DcmVhdGVzIFRleHRSYW5nZSBvYmplY3QKCQkJCXJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KGVsKTsvL3NldHMgUmFuZ2UKCQkJCXJhbmdlLnNlbGVjdCgpOyAvL21ha2Ugc2VsZWN0aW9uLgoJCQl9CgkJfQoJfQoKCWVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLG9uRW50ZXIpCgllbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpID0+IGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkpIC8vIG1vZGlmeSB0ZXh0CgllbHAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKSA9PiBzZWxlY3RUZXh0KGVsKSkgLy8gU2VsZWN0IGFsbCB0ZXh0CgoJcmV0dXJuIGVscAoKPC9zY3JpcHQ+CjxzdHlsZT4KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGxpZ2h0KSB7CgkJc3Bhbi5udW1iZXJfRWRpdGFibGUgewoJCQliYWNrZ3JvdW5kOiBoc2woMjA0LCA5NSUsIDg0JSk7CgkJfQoJfQoJQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewoJCXNwYW4ubnVtYmVyX0VkaXRhYmxlIHsKCQkJYmFja2dyb3VuZDogaHNsKDIwNCwgOTUlLCA0MCUpOwoJCX0KCX0KPC9zdHlsZT4KPC9ib25kPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQl9CgkJYm9uZHRhYmxlLWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiwKCQlib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmQtdmFsdWUgYm9uZCB7CgkJCWRpc3BsYXk6IGZsZXg7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9CgkJYm9uZC12YWx1ZSBpbnB1dCB7CgkJCXdpZHRoOiAxMDAlOyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+Cjxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBhbHRgJz4KCQk8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+QWx0aXR1ZGUgPHNwYW4gY2xhc3M9InRleCI+JGgkPC9zcGFuPiAmIzkxO20mIzkzOzwvcD4KPC9kaXY+Cgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8Ym9uZCBkZWY9ImFsdCIgdW5pcXVlX2lkPSJvbjNkcXVIRlZXWmoiPjxzY3JpcHQ+Ci8vIHdlaXJkIGltcG9ydCB0byBtYWtlIGl0IGZhc3Rlci4gVGhlIGBhd2FpdCBpbXBvcnRgIGNhbiBzdGlsbCBkZWxheSBleGVjdXRpb24gYnkgb25lIGZyYW1lIGlmIGl0IGlzIGFscmVhZHkgbG9hZGVkLi4uCndpbmRvdy5kM2Zvcm1hdCA9IHdpbmRvdy5kM2Zvcm1hdCA/PyBhd2FpdCBpbXBvcnQoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9ybWF0QDIvK2VzbSIpCgpjb25zdCBhcmdtaW4gPSB4cyA9PiB4cy5pbmRleE9mKE1hdGgubWluKC4uLnhzKSkKY29uc3QgY2xvc2VzdF9pbmRleCA9ICh4cywgeSkgPT4gYXJnbWluKHhzLm1hcCh4ID0+IE1hdGguYWJzKHgteSkpKQoKY29uc3QgdmFsdWVzID0gWzEwMCwgMTEwLCAxMjAsIDEzMCwgMTQwLCAxNTAsIDE2MCwgMTcwLCAxODAsIDE5MCwgMjAwXQoKY29uc3QgZWwgPSBodG1sYAo8c3BhbiB0aXRsZT0iQ2xpY2sgYW5kIGRyYWcgdGhpcyBudW1iZXIgbGVmdCBvciByaWdodCEiIHN0eWxlPSJjdXJzb3I6IGNvbC1yZXNpemU7CnRvdWNoLWFjdGlvbjogbm9uZTsKYmFja2dyb3VuZDogcmdiKDI1MiwgMjA5LCAyMDQpOwpjb2xvcjogYmxhY2s7CnBhZGRpbmc6IDBlbSAuMmVtOwpib3JkZXItcmFkaXVzOiAuM2VtOwpmb250LXdlaWdodDogYm9sZDsiPjE1MDwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgMTUwKQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcigxNTApCgpjb25zdCBvblNjcnViID0gKGUpID0+IHsKCWNvbnN0IG9mZnNldCA9IGUuY2xpZW50WCAtIG9sZF94Cgljb25zdCBuZXdfaW5kZXggPSBNYXRoLm1pbih2YWx1ZXMubGVuZ3RoLTEsIE1hdGgubWF4KDAsIAoJCU1hdGgucm91bmQob2Zmc2V0LzEwKSArIG9sZF9pbmRleAoJKSkKCglpZihuZXdfaW5kZXggIT09IGN1cnJlbnRfaW5kZXgpIHsKCQljdXJyZW50X2luZGV4ID0gbmV3X2luZGV4CgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQoJfQp9Cgpjb25zdCBvbnBvaW50ZXJkb3duID0gKGUpID0+IHsKCXdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpCglvbGRfeCA9IGUuY2xpZW50WAoJb2xkX2luZGV4ID0gY3VycmVudF9pbmRleAoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQplbC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgpjb25zdCBvbmRibGNsaWNrID0gKGUpID0+IHsKCWN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4CgllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKfQplbC5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgpjb25zdCBvbnBvaW50ZXJ1cCA9ICgpID0+IHsKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0Kd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQoKZWwub25zZWxlY3RzdGFydCA9ICgpID0+IGZhbHNlCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCn0pCgpyZXR1cm4gZWwKCjwvc2NyaXB0PjwvYm9uZD4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBncmlkOwoJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJfQoJCWJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCgkJYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kLXZhbHVlIGJvbmQgewoJCQlkaXNwbGF5OiBmbGV4OyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJCWJvbmQtdmFsdWUgaW5wdXQgewoJCQl3aWR0aDogMTAwJTsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgoJCgk8L2JvbmRzbGlzdC1jb250ZW50cz4KCTxzY3JpcHQgaWQ9J2FjZ3Zkb3NvZXknPgoJCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnRhaW5lci5jb2xsYXBzZSA9IChmb3JjZSkgPT4gewoJCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJywgZm9yY2UpCgkJfQoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdzcGFuLmNvbGxhcHNlJykKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiBjb250YWluZXIuY29sbGFwc2UoKQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJYm9uZHNsaXN0LWhlYWRlciB7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWRpc3BsYXk6IGZsZXg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQl9CQkKCQlib25kc2xpc3QtaGVhZGVyOmJlZm9yZSB7CgkJCWNvbnRlbnQ6ICcnOwoJCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJdG9wOiAwcHg7CgkJCWJvdHRvbTogMHB4OwoJCQlsZWZ0OiAwcHg7CgkJCXJpZ2h0OiAwcHg7CgkJCXotaW5kZXg6IC0xOwoJCQliYWNrZ3JvdW5kOiAjZmZhYzQ1NDA7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0ID4gYm9uZHNsaXN0LWhlYWRlciB7CgkJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCQlwb3NpdGlvbjogc3RpY2t5OwoJCQl0b3A6IDBweDsKCQkJcGFkZGluZy10b3A6IDEycHg7CgkJCW1hcmdpbi10b3A6IC0xMnB4OwoJCQl6LWluZGV4OiAxMDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRlbnRzIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0OmJlZm9yZSB7CgkJCWNvbnRlbnQ6ICcnOwoJCQlkaXNwbGF5OiBibG9jazsKCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJanVzdGlmeS1zZWxmOiBjZW50ZXI7CgkJCWJvcmRlci1ib3R0b206IDJweCBzb2xpZDsKCQkJcGFkZGluZy10b3A6IDVweDsKCQkJd2lkdGg6IDEwMCU7CgkJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCQlwb3NpdGlvbjogc3RpY2t5OwoJCQl0b3A6IDBweDsKCQkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwoJCQl6LWluZGV4OiAyMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5ib25kc2xpc3QtaWNvbiB7CgkJCS0tc2l6ZTogMTdweDsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCWJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCWJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCWJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJd2lkdGg6IHZhcigtLXNpemUpOwoJCQlmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCWN1cnNvcjogcG9pbnRlcjsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgPiBib25kc2xpc3QtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQl3aWR0aDogMzBweDsKCQkJbWFyZ2luOiAwIDEwcHg7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlkaXNwbGF5OiBmbGV4OwoJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJd2lkdGg6IDEwMCU7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCWZsZXgtZ3JvdzogMTsKCQkJZm9udC1zaXplOiAxOHB4OwoJCQlmb250LXdlaWdodDogNjAwOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCBib25kc2xpc3QtaGVhZGVyICsgKiB7CgkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCSAgICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJICAgIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkgICAgcm93LWdhcDogNXB4OwoJCX0KCQlib25kc3RhYmxlLWNvbnRhaW5lciBib25kc2xpc3QtY29udGFpbmVyIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCQo8L3N0eWxlPgo8L2JvbmRzbGlzdC1jb250YWluZXI+Cjxib25kc2xpc3QtY29udGFpbmVyIGNsYXNzPSduby1wb3BvdXQnPgoJPGJvbmRzbGlzdC1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2NvbGxhcHNlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJyB0aXRsZT0iVGhpcyBsaXN0IGNvbnRhaW5zIGluZGVwZW5kZW50IGJvbmRzIj5Qb3BvdXQgQ29udGFpbmVyPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYXNkYCc+CgkJU3RydWN0dXJlIEFTRAoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSd4emRlcmdmY2RkJz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2Vhb3NwbHh6bmcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0iYXNkIiB1bmlxdWVfaWQ9Inh1UlZtQmNPaDdIeSI+PHN0cnVjdC1ib25kIGNsYXNzPSdNYWluLnZhciZxdW90O3dvcmtzcGFjZSM3MSZxdW90Oy5BU0QnPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5BU0Q8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYnVxaWRwcXJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgPHNwYW4gY2xhc3M9InRleCI+JExhVGVYJDwvc3Bhbj48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cnB5aWZreGNpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZycHlpZmt4Y2knPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cnB5aWZreGNpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdnbm1xbXF6bmJtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdnbm1xbXF6bmJtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ25tcW1xem5ibSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+Tm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdxcnZreGd4aGJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncXJ2a3hneGhicCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInFydmt4Z3hoYnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZGAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGlzIGZpZWxkIGlzIDxlbT5zcGVjaWFsPC9lbT48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdkJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cG13dHFhaGhpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnBtd3RxYWhoaSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZwbXd0cWFoaGkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZWAiPmU8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbWRscWRub2ZleCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nNicgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J21kbHFkbm9mZXgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJtZGxxZG5vZmV4Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdscGFza2d6a3BuJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHBhc2tnemtwbiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgQVNEYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWJ1cWlkcHFycCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFidXFpZHBxcnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nenp3c3V5ZW5rYyc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdvaGxxZnJ1bGFuJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiQ3VzdG9tIERlc2NyaXB0aW9uIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSd4emRlcmdmY2RkJz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogMTBweDsKCQlqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCX0KCXBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogbm9uZTsKCQl3aWR0aDogNDAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nOiA4cHg7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKIAlwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogYmxvY2s7CgkJcG9zaXRpb246IGZpeGVkOwoJCXotaW5kZXg6IDUwMDsKCX0KCXBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKCQlib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwoJfQoJLnBvcG91dC1pY29uIHsKCQktLXNpemU6IDIwcHg7CgkgICAgZGlzcGxheTogYmxvY2s7CgkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQltaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJfQoJLnBvcG91dC1pY29uLnBvcG91dCB7CQoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCXVzZXItc2VsZWN0OiBub25lOwoJfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSdlYW9zcGx4em5nJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZWFvc3BseHpuZyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYG50YCc+CgkJTmFtZWRUdXBsZQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSdwY2ZqcGZmdXl0Jz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J25wZHd1dGRtZXYnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0ibnQiIHVuaXF1ZV9pZD0iellvMDRSWThudnBlIj48c3RydWN0LWJvbmQgY2xhc3M9J05hbWVkVHVwbGV7KDphLCA6YiwgOmMpfSc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk15IEZhbmN5IE5UdXBsZTwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3Nsd2htZ21vaHAnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3BjaWl0eWZ3YmsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj5EZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYnhndWp1a2NwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FieGd1anVrY3AnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYnhndWp1a2NwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3BjaWl0eWZ3YmsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+PHN0cm9uZz5Cb2xkPC9zdHJvbmc+IGZpZWxkPC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0neXN3a2xpYnJlaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd5c3drbGlicmVpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAieXN3a2xpYnJlaSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdwY2lpdHlmd2JrJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+YzwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhY214eWh1YW91JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FjbXh5aHVhb3UnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhY214eWh1YW91Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdwY2lpdHlmd2JrJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAicGNpaXR5ZndiayIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgTmFtZWRUdXBsZWAiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nc2x3aG1nbW9ocCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInNsd2htZ21vaHAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0naWhsbmd0Y3BwbCc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSd1Z2NibnhhdWF5Jz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTXkgRmFuY3kgTlR1cGxlIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSdwY2ZqcGZmdXl0Jz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogMTBweDsKCQlqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCX0KCXBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogbm9uZTsKCQl3aWR0aDogNDAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nOiA4cHg7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKIAlwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogYmxvY2s7CgkJcG9zaXRpb246IGZpeGVkOwoJCXotaW5kZXg6IDUwMDsKCX0KCXBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKCQlib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwoJfQoJLnBvcG91dC1pY29uIHsKCQktLXNpemU6IDIwcHg7CgkgICAgZGlzcGxheTogYmxvY2s7CgkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQltaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJfQoJLnBvcG91dC1pY29uLnBvcG91dCB7CQoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCXVzZXItc2VsZWN0OiBub25lOwoJfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSducGR3dXRkbWV2Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibnBkd3V0ZG1ldiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCQoJPC9ib25kc2xpc3QtY29udGVudHM+Cgk8c2NyaXB0IGlkPSdqdW1oY2ZqbHpiJz4KCQljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb250YWluZXIuY29sbGFwc2UgPSAoZm9yY2UpID0+IHsKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJCX0KCQljb25zdCBjb2xsYXBzZV9idG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi5jb2xsYXBzZScpCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gY29udGFpbmVyLmNvbGxhcHNlKCkKCTwvc2NyaXB0PgoJPHN0eWxlPgoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQlkaXNwbGF5OiBmbGV4OwoJCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CgkJfQkJCgkJYm9uZHNsaXN0LWhlYWRlcjpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJCXRvcDogMHB4OwoJCQlib3R0b206IDBweDsKCQkJbGVmdDogMHB4OwoJCQlyaWdodDogMHB4OwoJCQl6LWluZGV4OiAtMTsKCQkJYmFja2dyb3VuZDogI2ZmYWM0NTQwOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dCA+IGJvbmRzbGlzdC1oZWFkZXIgewoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCXBhZGRpbmctdG9wOiAxMnB4OwoJCQltYXJnaW4tdG9wOiAtMTJweDsKCQkJei1pbmRleDogMTA7CgkJfQoJCWJvbmRzbGlzdC1jb250ZW50cyB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dDpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWp1c3RpZnktc2VsZjogY2VudGVyOwoJCQlib3JkZXItYm90dG9tOiAycHggc29saWQ7CgkJCXBhZGRpbmctdG9wOiA1cHg7CgkJCXdpZHRoOiAxMDAlOwoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQkJei1pbmRleDogMjA7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuYm9uZHNsaXN0LWljb24gewoJCQktLXNpemU6IDE3cHg7CgkJCWRpc3BsYXk6IGJsb2NrOwoJCQlhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQliYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQliYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkID4gYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQkJd2lkdGg6IDMwcHg7CgkJCW1hcmdpbjogMCAxMHB4OwoJCX0KCQlib25kc2xpc3QtaGVhZGVyIHsKCQkJZGlzcGxheTogZmxleDsKCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCXdpZHRoOiAxMDAlOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQlmbGV4LWdyb3c6IDE7CgkJCWZvbnQtc2l6ZTogMThweDsKCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewoJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgYm9uZHNsaXN0LWhlYWRlciArICogewoJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIgewoJCQlkaXNwbGF5OiBncmlkOwoJCSAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkgICAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCSAgICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJICAgIHJvdy1nYXA6IDVweDsKCQl9CgkJYm9uZHN0YWJsZS1jb250YWluZXIgYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQkKPC9zdHlsZT4KPC9ib25kc2xpc3QtY29udGFpbmVyPgoKCTwvYm9uZHRhYmxlLWNvbnRlbnRzPgo8L2JvbmR0YWJsZS1jb250YWluZXI+CjxzY3JpcHQgaWQ9J2FlYXFleWlkdW4nPgoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgljb25zdCBjZWxsID0gY29udGFpbmVyLmNsb3Nlc3QoJ3BsdXRvLWNlbGwnKQoKCQoJY29uc3QgaGVscF9idG4gPSBoZWFkZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbGxhcHNlX2J0biA9IGhlYWRlci5sYXN0RWxlbWVudENoaWxkCgoJY29udGFpbmVyLmNvbGxhcHNlID0gKGZvcmNlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJfQoJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSBlID0+IGNvbnRhaW5lci5jb2xsYXBzZSgpCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3Qgc2NyaXB0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRhaW5lci5vZmZzZXQgPSBjb250YWluZXIub2Zmc2V0ID8/IHsgeDogMCwgeTogMH0KCWNvbnN0IHN0YXJ0UG9zaXRpb24gPSB7eDogMCwgeTogMH0KCWludGVyYWN0KGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdib25kdGFibGUtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRhaW5lci5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRhaW5lci5vZmZzZXRUb3AKCQkJCWNvbnRhaW5lci5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRhaW5lci5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGFpbmVyLm9mZnNldC54ICs9IGV2ZW50LmR4CgkJICAgICAgY29udGFpbmVyLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250YWluZXIub2Zmc2V0Lnl9cHhgCgkJICAgICAgY29udGFpbmVyLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGFpbmVyLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5zdHlsZS50b3AgPSAnJwoJCWNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gJycKCX0pCglpbnRlcmFjdChjb250YWluZXIpCgkgIC5yZXNpemFibGUoewoJCWlnbm9yZUZyb206ICdwb3BvdXQtY29udGFpbmVyJywKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCQkJICBtYXhIZWlnaHQ6ICdub25lJywKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250YWluZXIuc3R5bGUud2lkdGggPSAnJwoJCSAgCWNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAnJwoJCSAgCWNvbnRhaW5lci5zdHlsZS5tYXhIZWlnaHQgPSAnJwoJICB9KQoKCgkvLyBOb3cgd2UgYXNzaWduIGEgc3BlY2lmaWMgY2xhc3MgdG8gYWxsIHRvZ2dsZS1jb250YWluZXIgdGhhdCBhcmUgZGlyZWN0IGNoaWxkcmVuCglmb3IgKGNvbnN0IHRyIG9mIGNvbnRlbnRzLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpKSB7CgkJdHIuY2xvc2VzdCgncG9wb3V0LWNvbnRhaW5lcicpID8/IHRyLmNsYXNzTGlzdC50b2dnbGUoJ25vLXBvcG91dCcsIHRydWUpCgl9CgkvLyBXZSBhbHNvIGZsYWcgdGhlIGZpcnN0IHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBpbiB0aGUgdGFibGUKCWNvbnRlbnRzLmZpcnN0RWxlbWVudENoaWxkLnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5uby1wb3BvdXQnKT8uY2xhc3NMaXN0LnRvZ2dsZSgnZmlyc3QnLHRydWUpCgoJLy8gQ2xpY2sgdG8gZ28gdG8gZGVmaW5pdGlvbgoJY29udGFpbmVyLmp1bXBUb0NlbGwgPSAoKSA9PiB7CgkJY2VsbC5zY3JvbGxJbnRvVmlldygpCgl9CgloZWxwX2J0bi5vbmNsaWNrID0gY29udGFpbmVyLmp1bXBUb0NlbGwKPC9zY3JpcHQ+CjxzdHlsZT4KCWJvbmR0YWJsZS1jb250YWluZXIgewoJCWRpc3BsYXk6IGZsZXg7CgkJZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJdG9wOiA1MHB4OwoJCWxlZnQ6IDEwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkICNlN2U3ZTc7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nLWxlZnQ6IDhweDsKICAgIAlwYWRkaW5nLXRvcDogOHB4OwoJCXotaW5kZXg6IDYwMDsKCQl3aWR0aDogNDAwcHg7CgkJbWF4LWhlaWdodDogNjAwcHg7CgkJdHJhbnNpdGlvbjogdHJhbnNmb3JtIDMwMG1zIGN1YmljLWJlemllcigwLjE4LCAwLjg5LCAwLjQ1LCAxLjEyKTsKCX0KCWJvbmR0YWJsZS1jb250YWluZXI6bm90KC5jb2xsYXBzZWQpID4gKiB7CgkJcGFkZGluZy1yaWdodDogOHB4OwoJfQoJYm9uZHRhYmxlLWNvbnRlbnRzIHsKCQlkaXNwbGF5OiBncmlkOwoJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJcGFkZGluZy1ib3R0b206IDhweDsKCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCXJvdy1nYXA6IDVweDsKCQlvdmVyZmxvdzogYXV0bzsKCX0KCWJvbmR0YWJsZS1jb250ZW50cyB0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIubm8tcG9wb3V0LAoJYm9uZHRhYmxlLWNvbnRlbnRzID4gKiwgCglib25kdGFibGUtY29udGVudHMgc3RydWN0LWJvbmQgewoJCWRpc3BsYXk6IGNvbnRlbnRzCgl9Cgl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIubm8tcG9wb3V0OmJlZm9yZSB7CgkJY29udGVudDogJyc7CiAgCQlkaXNwbGF5OiBibG9jazsKCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCWp1c3RpZnktc2VsZjogY2VudGVyOwoJCWJvcmRlci1ib3R0b206IDJweCBzb2xpZDsKCQlwYWRkaW5nLXRvcDogNXB4OwoJCXdpZHRoOiAxMDAlOwoJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCXBvc2l0aW9uOiBzdGlja3k7CgkJdG9wOiAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwoJCXotaW5kZXg6IDIwOwoJfQoJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLm5vLXBvcG91dCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJYWxpZ24tc2VsZjogc3RhcnQ7CgkJcG9zaXRpb246IHN0aWNreTsKCQl0b3A6IDBweDsKCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CgkJcGFkZGluZy10b3A6IDEycHg7CgkJbWFyZ2luLXRvcDogLTEycHg7CgkJei1pbmRleDogMTA7Cgl9Cglib25kdGFibGUtaGVhZGVyIHsKCQlkaXNwbGF5OiBmbGV4OwoJCWp1c3RpZnktaXRlbXM6IHN0cmV0Y2g7Cgl9Cglib25kdGFibGUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQlmbGV4LWdyb3c6IDE7CgkJdGV4dC1hbGlnbjogY2VudGVyOwoJCWZvbnQtc2l6ZTogMjBweDsKCQlmb250LXdlaWdodDogODAwOwoJCXRvdWNoLWFjdGlvbjogbm9uZTsKCQl1c2VyLXNlbGVjdDogbm9uZTsKCX0KCWJvbmR0YWJsZS1oZWFkZXIgPiAuaWNvbiB7CgkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQljdXJzb3I6IHBvaW50ZXI7Cgl9Cglib25kdGFibGUtaGVhZGVyIC50YWJsZS1jb2xsYXBzZSB7CgkJLS1zaXplOiAyM3B4OwoJCWJhY2tncm91bmQtaW1hZ2U6IHVybCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9hcnJvdy1iYWNrLnN2ZyIpOwoJfQoJYm9uZHRhYmxlLWNvbnRhaW5lci5jb2xsYXBzZWQgLnRhYmxlLWNvbGxhcHNlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvb3B0aW9ucy1vdXRsaW5lLnN2ZyIpOwoJCW1hcmdpbi1yaWdodDogMHB4OwoJfQoJYm9uZHRhYmxlLWNvbnRhaW5lci5jb2xsYXBzZWQgLnRhYmxlLWNvbGxhcHNlOmhvdmVyIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvYXJyb3ctZm9yd2FyZC5zdmciKTsKCX0KCWJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIHsKCQl0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoY2FsYygtMTAwJSArIDM1cHgpKTsKCQloZWlnaHQ6IGF1dG8gIWltcG9ydGFudDsKCQlsZWZ0OiAwcHggIWltcG9ydGFudDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCXBhZGRpbmc6IDVweDsKCX0KCWJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIGJvbmR0YWJsZS1jb250ZW50cywKCWJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIHNlcGFyYXRvciB7CgkJZGlzcGxheTogbm9uZTsKCX0KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKCQlib25kdGFibGUtY29udGFpbmVyIHsKCQkJYm9yZGVyLWNvbG9yOiAjN2Q3ZDdkOwoJCX0KCX0KPC9zdHlsZT4KCqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQm1eWjh7BwZXJzaXN0X2pzX3N0YXRlw7doYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXNDV61cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SRjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDOKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52r0dPHNjcmlwdD4KCQpjb25zdCBpbmRlbnQgPSB0cnVlCmNvbnN0IGFzaWRlID0gdHJ1ZQpjb25zdCB0aXRsZV90ZXh0ID0gIlRhYmxlIG9mIENvbnRlbnRzIgpjb25zdCBpbmNsdWRlX2RlZmluaXRpb25zID0gZmFsc2UKCgpjb25zdCB0b2NOb2RlID0gaHRtbGA8bmF2IGNsYXNzPSJwbHV0b3VpLXRvYyI+Cgk8aGVhZGVyPgoJIDxzcGFuIGNsYXNzPSJ0b2MtdG9nZ2xlIG9wZW4tdG9jIj48L3NwYW4+CgkgPHNwYW4gY2xhc3M9InRvYy10b2dnbGUgY2xvc2VkLXRvYyI+PC9zcGFuPgoJICR7dGl0bGVfdGV4dH0KCTwvaGVhZGVyPgoJPHNlY3Rpb24+PC9zZWN0aW9uPgo8L25hdj5gCgp0b2NOb2RlLmNsYXNzTGlzdC50b2dnbGUoImFzaWRlIiwgYXNpZGUpCnRvY05vZGUuY2xhc3NMaXN0LnRvZ2dsZSgiaW5kZW50IiwgaW5kZW50KQoKCmNvbnN0IGdldFBhcmVudENlbGwgPSBlbCA9PiBlbC5jbG9zZXN0KCJwbHV0by1jZWxsIikKCmNvbnN0IGdldEhlYWRlcnMgPSAoKSA9PiB7Cgljb25zdCBkZXB0aCA9IE1hdGgubWF4KDEsIE1hdGgubWluKDYsIDMpKSAvLyBzaG91bGQgYmUgaW4gcmFuZ2UgMTo2Cgljb25zdCByYW5nZSA9IEFycmF5LmZyb20oe2xlbmd0aDogZGVwdGh9LCAoeCwgaSkgPT4gaSsxKSAvLyBbMSwgLi4uLCBkZXB0aF0KCQoJY29uc3Qgc2VsZWN0b3IgPSBbCgkJLi4uKGluY2x1ZGVfZGVmaW5pdGlvbnMgPyBbCgkJCWBwbHV0by1ub3RlYm9vayBwbHV0by1jZWxsIC5wbHV0by1kb2NzLWJpbmRpbmdgLCAKCQkJYHBsdXRvLW5vdGVib29rIHBsdXRvLWNlbGwgYXNzaWduZWU6bm90KDplbXB0eSlgLCAKCQldIDogW10pLAoJCS4uLnJhbmdlLm1hcChpID0+IGBwbHV0by1ub3RlYm9vayBwbHV0by1jZWxsIGgke2l9YCkKCV0uam9pbigiLCIpCglyZXR1cm4gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSkuZmlsdGVyKGVsID0+IAoJCS8vIGV4Y2x1ZGUgaGVhZGVycyBpbnNpZGUgb2YgYSBwbHV0by1kb2NzLWJpbmRpbmcgYmxvY2sKCQkhKGVsLm5vZGVOYW1lLnN0YXJ0c1dpdGgoIkgiKSAmJiBlbC5jbG9zZXN0KCIucGx1dG8tZG9jcy1iaW5kaW5nIikpCgkpCn0KCgpjb25zdCBkb2N1bWVudF9jbGlja19oYW5kbGVyID0gKGV2ZW50KSA9PiB7Cgljb25zdCBwYXRoID0gKGV2ZW50LnBhdGggfHwgZXZlbnQuY29tcG9zZWRQYXRoKCkpCgljb25zdCB0b2MgPSBwYXRoLmZpbmQoZWxlbSA9PiBlbGVtPy5jbGFzc0xpc3Q/LmNvbnRhaW5zPy4oInRvYy10b2dnbGUiKSkKCWlmICh0b2MpIHsKCQlldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKQoJCXRvYy5jbG9zZXN0KCIucGx1dG91aS10b2MiKS5jbGFzc0xpc3QudG9nZ2xlKCJoaWRlIikKCX0KfQoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkb2N1bWVudF9jbGlja19oYW5kbGVyKQoKCmNvbnN0IGhlYWRlcl90b19pbmRleF9lbnRyeV9tYXAgPSBuZXcgTWFwKCkKY29uc3QgY3VycmVudGx5X2hpZ2hsaWdodGVkX3NldCA9IG5ldyBTZXQoKQoKY29uc3QgbGFzdF90b2NfZWxlbWVudF9jbGlja190aW1lID0geyBjdXJyZW50OiAwIH0KCmNvbnN0IGludGVyc2VjdGlvbl9jYWxsYmFjayA9IChpeHMpID0+IHsKCWxldCBvbl90b3AgPSBpeHMuZmlsdGVyKGl4ID0+IGl4LmludGVyc2VjdGlvblJhdGlvID4gMCAmJiBpeC5pbnRlcnNlY3Rpb25SZWN0LnkgPCBpeC5yb290Qm91bmRzLmhlaWdodCAvIDIpCglpZihvbl90b3AubGVuZ3RoID4gMCl7CgkJY3VycmVudGx5X2hpZ2hsaWdodGVkX3NldC5mb3JFYWNoKGEgPT4gYS5jbGFzc0xpc3QucmVtb3ZlKCJpbi12aWV3IikpCgkJY3VycmVudGx5X2hpZ2hsaWdodGVkX3NldC5jbGVhcigpCgkJb25fdG9wLnNsaWNlKDAsMSkuZm9yRWFjaChpID0+IHsKCQkJbGV0IGRpdiA9IGhlYWRlcl90b19pbmRleF9lbnRyeV9tYXAuZ2V0KGkudGFyZ2V0KQoJCQlkaXYuY2xhc3NMaXN0LmFkZCgiaW4tdmlldyIpCgkJCWN1cnJlbnRseV9oaWdobGlnaHRlZF9zZXQuYWRkKGRpdikKCQkJCgkJCS8vLyBzY3JvbGwgaW50byB2aWV3CgkJCS8qCgkJCWNvbnN0IHRvY19oZWlnaHQgPSB0b2NOb2RlLm9mZnNldEhlaWdodAoJCQljb25zdCBkaXZfcG9zID0gZGl2Lm9mZnNldFRvcAoJCQljb25zdCBkaXZfaGVpZ2h0ID0gZGl2Lm9mZnNldEhlaWdodAoJCQljb25zdCBjdXJyZW50X3Njcm9sbCA9IHRvY05vZGUuc2Nyb2xsVG9wCgkJCWNvbnN0IGhlYWRlcl9oZWlnaHQgPSB0b2NOb2RlLnF1ZXJ5U2VsZWN0b3IoImhlYWRlciIpLm9mZnNldEhlaWdodAoJCQkKCQkJY29uc3Qgc2Nyb2xsX3RvX3RvcCA9IGRpdl9wb3MgLSBoZWFkZXJfaGVpZ2h0CgkJCWNvbnN0IHNjcm9sbF90b19ib3R0b20gPSBkaXZfcG9zICsgZGl2X2hlaWdodCAtIHRvY19oZWlnaHQKCQkJCgkJCS8vIGlmIHdlIHNldCBhIHNjcm9sbFRvcCwgdGhlbiB0aGUgYnJvd3NlciB3aWxsIHN0b3AgYW55IGN1cnJlbnRseSBvbmdvaW5nIHNtb290aHNjcm9sbCBhbmltYXRpb24uIFNvIGxldCdzIG9ubHkgZG8gdGhpcyBpZiB5b3UgYXJlIG5vdCBjdXJyZW50bHkgaW4gYSBzbW9vdGhzY3JvbGwuCgkJCWlmKERhdGUubm93KCkgLSBsYXN0X3RvY19lbGVtZW50X2NsaWNrX3RpbWUuY3VycmVudCA+PSAyMDAwKQoJCQkJaWYoY3VycmVudF9zY3JvbGwgPCBzY3JvbGxfdG9fYm90dG9tKXsKCQkJCQl0b2NOb2RlLnNjcm9sbFRvcCA9IHNjcm9sbF90b19ib3R0b20KCQkJCX0gZWxzZSBpZihjdXJyZW50X3Njcm9sbCA+IHNjcm9sbF90b190b3ApewoJCQkJCXRvY05vZGUuc2Nyb2xsVG9wID0gc2Nyb2xsX3RvX3RvcAoJCQkJfQoJCQkqLwoJCX0pCgl9Cn0KbGV0IGludGVyc2VjdGlvbl9vYnNlcnZlcl8xID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGludGVyc2VjdGlvbl9jYWxsYmFjaywgewoJcm9vdDogbnVsbCwgLy8gaS5lLiB0aGUgdmlld3BvcnQKICAJdGhyZXNob2xkOiAxLAoJcm9vdE1hcmdpbjogIi0xNXB4IiwgLy8gc2xpZ2h0bHkgc21hbGxlciB0aGFuIHRoZSB2aWV3cG9ydAoJLy8gZGVsYXk6IDEwMCwKfSkKbGV0IGludGVyc2VjdGlvbl9vYnNlcnZlcl8yID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGludGVyc2VjdGlvbl9jYWxsYmFjaywgewoJcm9vdDogbnVsbCwgLy8gaS5lLiB0aGUgdmlld3BvcnQKICAJdGhyZXNob2xkOiAxLAoJcm9vdE1hcmdpbjogIjE1cHgiLCAvLyBzbGlnaHRseSBsYXJnZXIgdGhhbiB0aGUgdmlld3BvcnQKCS8vIGRlbGF5OiAxMDAsCn0pCgpjb25zdCByZW5kZXIgPSAoZWxlbWVudHMpID0+IHsKCWhlYWRlcl90b19pbmRleF9lbnRyeV9tYXAuY2xlYXIoKQoJY3VycmVudGx5X2hpZ2hsaWdodGVkX3NldC5jbGVhcigpCglpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMS5kaXNjb25uZWN0KCkKCWludGVyc2VjdGlvbl9vYnNlcnZlcl8yLmRpc2Nvbm5lY3QoKQoKCQlsZXQgbGFzdF9sZXZlbCA9IGBIMWAKCXJldHVybiBodG1sYCR7ZWxlbWVudHMubWFwKGggPT4gewoJY29uc3QgcGFyZW50X2NlbGwgPSBnZXRQYXJlbnRDZWxsKGgpCgoJCWxldCBbY2xhc3NOYW1lLCB0aXRsZV9lbF0gPSBoLm1hdGNoZXMoYC5wbHV0by1kb2NzLWJpbmRpbmdgKSA/IFsicGx1dG8tZG9jcy1iaW5kaW5nLWVsIiwgaC5maXJzdEVsZW1lbnRDaGlsZF0gOiBbaC5ub2RlTmFtZSwgaF0KCgljb25zdCBhID0gaHRtbGA8YSAKCQljbGFzcz0iJHtjbGFzc05hbWV9IiAKCQl0aXRsZT0iJHt0aXRsZV9lbC5pbm5lclRleHR9IgoJCWhyZWY9IiMke3BhcmVudF9jZWxsLmlkfSIKCT4ke3RpdGxlX2VsLmlubmVySFRNTH08L2E+YAoJLyogYS5vbm1vdXNlb3Zlcj0oKT0+ewoJCXBhcmVudF9jZWxsLmZpcnN0RWxlbWVudENoaWxkLmNsYXNzTGlzdC5hZGQoCgkJCSdoaWdobGlnaHQtcGx1dG8tY2VsbC1zaG91bGRlcicKCQkpCgl9CglhLm9ubW91c2VvdXQ9KCkgPT4gewoJCXBhcmVudF9jZWxsLmZpcnN0RWxlbWVudENoaWxkLmNsYXNzTGlzdC5yZW1vdmUoCgkJCSdoaWdobGlnaHQtcGx1dG8tY2VsbC1zaG91bGRlcicKCQkpCgl9ICovCgkJCgkJCglhLm9uY2xpY2s9KGUpID0+IHsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJbGFzdF90b2NfZWxlbWVudF9jbGlja190aW1lLmN1cnJlbnQgPSBEYXRlLm5vdygpCgkJaC5zY3JvbGxJbnRvVmlldyh7CgkJCWJlaGF2aW9yOiAnc21vb3RoJywgCgkJCWJsb2NrOiAnc3RhcnQnCgkJfSkKCX0KCgljb25zdCByb3cgPSAgaHRtbGA8ZGl2IGNsYXNzPSJ0b2Mtcm93ICR7Y2xhc3NOYW1lfSBhZnRlci0ke2xhc3RfbGV2ZWx9Ij4ke2F9PC9kaXY+YAoJCWludGVyc2VjdGlvbl9vYnNlcnZlcl8xLm9ic2VydmUodGl0bGVfZWwpCgkJaW50ZXJzZWN0aW9uX29ic2VydmVyXzIub2JzZXJ2ZSh0aXRsZV9lbCkKCQloZWFkZXJfdG9faW5kZXhfZW50cnlfbWFwLnNldCh0aXRsZV9lbCwgcm93KQoKCWlmKGNsYXNzTmFtZS5zdGFydHNXaXRoKCJIIikpCgkJbGFzdF9sZXZlbCA9IGNsYXNzTmFtZQoJCQoJcmV0dXJuIHJvdwp9KX1gCn0KCmNvbnN0IGludmFsaWRhdGVkID0geyBjdXJyZW50OiBmYWxzZSB9Cgpjb25zdCB1cGRhdGVDYWxsYmFjayA9ICgpID0+IHsKCWlmICghaW52YWxpZGF0ZWQuY3VycmVudCkgewoJCXRvY05vZGUucXVlcnlTZWxlY3Rvcigic2VjdGlvbiIpLnJlcGxhY2VXaXRoKAoJCQlodG1sYDxzZWN0aW9uPiR7cmVuZGVyKGdldEhlYWRlcnMoKSl9PC9zZWN0aW9uPmAKCQkpCgl9Cn0KdXBkYXRlQ2FsbGJhY2soKQpzZXRUaW1lb3V0KHVwZGF0ZUNhbGxiYWNrLCAxMDApCnNldFRpbWVvdXQodXBkYXRlQ2FsbGJhY2ssIDEwMDApCnNldFRpbWVvdXQodXBkYXRlQ2FsbGJhY2ssIDUwMDApCgpjb25zdCBub3RlYm9vayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInBsdXRvLW5vdGVib29rIikKCgovLyBXZSBoYXZlIGEgbXV0YXRpb25vYnNlcnZlciBmb3IgZWFjaCBjZWxsOgpjb25zdCBtdXRfb2JzZXJ2ZXJzID0gewoJY3VycmVudDogW10sCn0KCmNvbnN0IGNyZWF0ZUNlbGxPYnNlcnZlcnMgPSAoKSA9PiB7CgltdXRfb2JzZXJ2ZXJzLmN1cnJlbnQuZm9yRWFjaCgobykgPT4gby5kaXNjb25uZWN0KCkpCgltdXRfb2JzZXJ2ZXJzLmN1cnJlbnQgPSBBcnJheS5mcm9tKG5vdGVib29rLnF1ZXJ5U2VsZWN0b3JBbGwoInBsdXRvLWNlbGwiKSkubWFwKGVsID0+IHsKCQljb25zdCBvID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodXBkYXRlQ2FsbGJhY2spCgkJby5vYnNlcnZlKGVsLCB7YXR0cmlidXRlRmlsdGVyOiBbImNsYXNzIl19KQoJCXJldHVybiBvCgl9KQp9CmNyZWF0ZUNlbGxPYnNlcnZlcnMoKQoKLy8gQW5kIG9uZSBmb3IgdGhlIG5vdGVib29rJ3MgY2hpbGQgbGlzdCwgd2hpY2ggdXBkYXRlcyBvdXIgY2VsbCBvYnNlcnZlcnM6CmNvbnN0IG5vdGVib29rT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7Cgl1cGRhdGVDYWxsYmFjaygpCgljcmVhdGVDZWxsT2JzZXJ2ZXJzKCkKfSkKbm90ZWJvb2tPYnNlcnZlci5vYnNlcnZlKG5vdGVib29rLCB7Y2hpbGRMaXN0OiB0cnVlfSkKCi8vIEFuZCBmaW5hbGx5LCBhbiBvYnNlcnZlciBmb3IgdGhlIGRvY3VtZW50LmJvZHkgY2xhc3NMaXN0LCB0byBtYWtlIHN1cmUgdGhhdCB0aGUgdG9jIGFsc28gd29ya3Mgd2hlbiBpdCBpcyBsb2FkZWQgZHVyaW5nIG5vdGVib29rIGluaXRpYWxpemF0aW9uCmNvbnN0IGJvZHlDbGFzc09ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodXBkYXRlQ2FsbGJhY2spCmJvZHlDbGFzc09ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuYm9keSwge2F0dHJpYnV0ZUZpbHRlcjogWyJjbGFzcyJdfSkKCi8vIEhpZGUvc2hvdyB0aGUgVG9DIHdoZW4gdGhlIHNjcmVlbiBnZXRzIHNtYWxsCmxldCBtID0gbWF0Y2hNZWRpYSgiKG1heC13aWR0aDogMTAwMHB4KSIpCmxldCBtYXRjaF9saXN0ZW5lciA9ICgpID0+IAoJdG9jTm9kZS5jbGFzc0xpc3QudG9nZ2xlKCJoaWRlIiwgbS5tYXRjaGVzKQptYXRjaF9saXN0ZW5lcigpCm0uYWRkTGlzdGVuZXIobWF0Y2hfbGlzdGVuZXIpCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CglpbnZhbGlkYXRlZC5jdXJyZW50ID0gdHJ1ZQoJaW50ZXJzZWN0aW9uX29ic2VydmVyXzEuZGlzY29ubmVjdCgpCglpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMi5kaXNjb25uZWN0KCkKCW5vdGVib29rT2JzZXJ2ZXIuZGlzY29ubmVjdCgpCglib2R5Q2xhc3NPYnNlcnZlci5kaXNjb25uZWN0KCkKCW11dF9vYnNlcnZlcnMuY3VycmVudC5mb3JFYWNoKChvKSA9PiBvLmRpc2Nvbm5lY3QoKSkKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZG9jdW1lbnRfY2xpY2tfaGFuZGxlcikKCW0ucmVtb3ZlTGlzdGVuZXIobWF0Y2hfbGlzdGVuZXIpCn0pCgpyZXR1cm4gdG9jTm9kZQo8L3NjcmlwdD4KPHN0eWxlPgpAbWVkaWEgbm90IHByaW50IHsKCi5wbHV0b3VpLXRvYyB7Cglmb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAiU2Vnb2UgVUkiLCBSb2JvdG8sIE94eWdlbi1TYW5zLCBDYW50YXJlbGwsIEhlbHZldGljYSwgQXJpYWwsICJBcHBsZSBDb2xvciBFbW9qaSIsCgkJIlNlZ29lIFVJIEVtb2ppIiwgIlNlZ29lIFVJIFN5bWJvbCIsIHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKCS0tbWFpbi1iZy1jb2xvcjogI2ZhZmFmYTsKCS0tcGx1dG8tb3V0cHV0LWNvbG9yOiBoc2woMCwgMCUsIDM2JSk7CgktLXBsdXRvLW91dHB1dC1oLWNvbG9yOiBoc2woMCwgMCUsIDIxJSk7CgktLXNpZGViYXItbGktYWN0aXZlLWJnOiByZ2IoMjM1LCAyMzUsIDIzNSk7CgktLWljb24tZmlsdGVyOiB1bnNldDsKfQoKQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewoJLnBsdXRvdWktdG9jIHsKCQktLW1haW4tYmctY29sb3I6ICMzMDMwMzA7CgkJLS1wbHV0by1vdXRwdXQtY29sb3I6IGhzbCgwLCAwJSwgOTAlKTsKCQktLXBsdXRvLW91dHB1dC1oLWNvbG9yOiBoc2woMCwgMCUsIDk3JSk7CgkJLS1zaWRlYmFyLWxpLWFjdGl2ZS1iZzogcmdiKDgyLCA4MiwgODIpOwoJCS0taWNvbi1maWx0ZXI6IGludmVydCgxKTsKCX0KfQoKLnBsdXRvdWktdG9jLmFzaWRlIHsKCWNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IpOwoJcG9zaXRpb246IGZpeGVkOwoJcmlnaHQ6IDFyZW07Cgl0b3A6IDVyZW07Cgl3aWR0aDogbWluKDgwdncsIDMwMHB4KTsKCXBhZGRpbmc6IDAuNXJlbTsKCXBhZGRpbmctdG9wOiAwZW07CgkvKiBib3JkZXI6IDNweCBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuMTUpOyAqLwoJYm9yZGVyLXJhZGl1czogMTBweDsKCS8qIGJveC1zaGFkb3c6IDAgMCAxMXB4IDBweCAjMDAwMDAwMTA7ICovCgltYXgtaGVpZ2h0OiBjYWxjKDEwMHZoIC0gNXJlbSAtIDkwcHgpOwoJb3ZlcmZsb3c6IGF1dG87Cgl6LWluZGV4OiA0MDsKCWJhY2tncm91bmQtY29sb3I6IHZhcigtLW1haW4tYmctY29sb3IpOwoJdHJhbnNpdGlvbjogdHJhbnNmb3JtIDMwMG1zIGN1YmljLWJlemllcigwLjE4LCAwLjg5LCAwLjQ1LCAxLjEyKTsKfQoKLnBsdXRvdWktdG9jLmFzaWRlLmhpZGUgewoJdHJhbnNmb3JtOiB0cmFuc2xhdGVYKGNhbGMoMTAwJSAtIDI4cHgpKTsKfQoucGx1dG91aS10b2MuYXNpZGUuaGlkZSBzZWN0aW9uIHsKCWRpc3BsYXk6IG5vbmU7Cn0KLnBsdXRvdWktdG9jLmFzaWRlLmhpZGUgaGVhZGVyIHsKCW1hcmdpbi1ib3R0b206IDBlbTsKCXBhZGRpbmctYm90dG9tOiAwZW07Cglib3JkZXItYm90dG9tOiBub25lOwp9Cn0gIC8qIEVuZCBvZiBNZWRpYSBwcmludCBxdWVyeSAqLwoucGx1dG91aS10b2MuYXNpZGUuaGlkZSAub3Blbi10b2MsCi5wbHV0b3VpLXRvYy5hc2lkZTpub3QoLmhpZGUpIC5jbG9zZWQtdG9jLAoucGx1dG91aS10b2M6bm90KC5hc2lkZSkgLmNsb3NlZC10b2MgewoJZGlzcGxheTogbm9uZTsKfQoKQG1lZGlhIChwcmVmZXJzLXJlZHVjZWQtbW90aW9uKSB7CiAgLnBsdXRvdWktdG9jLmFzaWRlIHsKCXRyYW5zaXRpb24tZHVyYXRpb246IDBzOwogIH0KfQoKLnRvYy10b2dnbGUgewoJY3Vyc29yOiBwb2ludGVyOwogICAgcGFkZGluZzogMWVtOwogICAgbWFyZ2luOiAtMWVtOwogICAgbWFyZ2luLXJpZ2h0OiAtMC43ZW07CiAgICBsaW5lLWhlaWdodDogMWVtOwogICAgZGlzcGxheTogZmxleDsKfQoKLnRvYy10b2dnbGU6OmJlZm9yZSB7CiAgICBjb250ZW50OiAiIjsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIGhlaWdodDogMWVtOwogICAgd2lkdGg6IDFlbTsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9saXN0LW91dGxpbmUuc3ZnIik7CgkvKiBnZW5lcmF0ZWQgdXNpbmcgaHR0cHM6Ly9kb3BpYXphLm9yZy90b29scy9kYXRhdXJpL2luZGV4LnBocCAqLwogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlpQjJhV1YzUW05NFBTSXdJREFnTlRFeUlEVXhNaUkrUEhScGRHeGxQbWx2Ym1samIyNXpMWFkxTFc4OEwzUnBkR3hsUGp4c2FXNWxJSGd4UFNJeE5qQWlJSGt4UFNJeE5EUWlJSGd5UFNJME5EZ2lJSGt5UFNJeE5EUWlJSE4wZVd4bFBTSm1hV3hzT201dmJtVTdjM1J5YjJ0bE9pTXdNREE3YzNSeWIydGxMV3hwYm1WallYQTZjbTkxYm1RN2MzUnliMnRsTFd4cGJtVnFiMmx1T25KdmRXNWtPM04wY205clpTMTNhV1IwYURvek1uQjRJaTgrUEd4cGJtVWdlREU5SWpFMk1DSWdlVEU5SWpJMU5pSWdlREk5SWpRME9DSWdlVEk5SWpJMU5pSWdjM1I1YkdVOUltWnBiR3c2Ym05dVpUdHpkSEp2YTJVNkl6QXdNRHR6ZEhKdmEyVXRiR2x1WldOaGNEcHliM1Z1WkR0emRISnZhMlV0YkdsdVpXcHZhVzQ2Y205MWJtUTdjM1J5YjJ0bExYZHBaSFJvT2pNeWNIZ2lMejQ4YkdsdVpTQjRNVDBpTVRZd0lpQjVNVDBpTXpZNElpQjRNajBpTkRRNElpQjVNajBpTXpZNElpQnpkSGxzWlQwaVptbHNiRHB1YjI1bE8zTjBjbTlyWlRvak1EQXdPM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpEdHpkSEp2YTJVdGQybGtkR2c2TXpKd2VDSXZQanhqYVhKamJHVWdZM2c5SWpnd0lpQmplVDBpTVRRMElpQnlQU0l4TmlJZ2MzUjViR1U5SW1acGJHdzZibTl1WlR0emRISnZhMlU2SXpBd01EdHpkSEp2YTJVdGJHbHVaV05oY0RweWIzVnVaRHR6ZEhKdmEyVXRiR2x1WldwdmFXNDZjbTkxYm1RN2MzUnliMnRsTFhkcFpIUm9Pak15Y0hnaUx6NDhZMmx5WTJ4bElHTjRQU0k0TUNJZ1kzazlJakkxTmlJZ2NqMGlNVFlpSUhOMGVXeGxQU0ptYVd4c09tNXZibVU3YzNSeWIydGxPaU13TURBN2MzUnliMnRsTFd4cGJtVmpZWEE2Y205MWJtUTdjM1J5YjJ0bExXeHBibVZxYjJsdU9uSnZkVzVrTzNOMGNtOXJaUzEzYVdSMGFEb3pNbkI0SWk4K1BHTnBjbU5zWlNCamVEMGlPREFpSUdONVBTSXpOamdpSUhJOUlqRTJJaUJ6ZEhsc1pUMGlabWxzYkRwdWIyNWxPM04wY205clpUb2pNREF3TzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaRHR6ZEhKdmEyVXRkMmxrZEdnNk16SndlQ0l2UGp3dmMzWm5QZz09Iik7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDFlbTsKCWZpbHRlcjogdmFyKC0taWNvbi1maWx0ZXIpOwp9CgouYXNpZGUgLnRvYy10b2dnbGUub3Blbi10b2M6aG92ZXI6OmJlZm9yZSB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvYXJyb3ctZm9yd2FyZC1vdXRsaW5lLnN2ZyIpOwoJLyogZ2VuZXJhdGVkIHVzaW5nIGh0dHBzOi8vZG9waWF6YS5vcmcvdG9vbHMvZGF0YXVyaS9pbmRleC5waHAgKi8KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kxTVRJaUlHaGxhV2RvZEQwaU5URXlJaUIyYVdWM1FtOTRQU0l3SURBZ05URXlJRFV4TWlJK1BIUnBkR3hsUG1sdmJtbGpiMjV6TFhZMUxXRThMM1JwZEd4bFBqeHdiMng1YkdsdVpTQndiMmx1ZEhNOUlqSTJPQ0F4TVRJZ05ERXlJREkxTmlBeU5qZ2dOREF3SWlCemRIbHNaVDBpWm1sc2JEcHViMjVsTzNOMGNtOXJaVG9qTURBd08zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkR0emRISnZhMlV0ZDJsa2RHZzZORGh3ZUNJdlBqeHNhVzVsSUhneFBTSXpPVElpSUhreFBTSXlOVFlpSUhneVBTSXhNREFpSUhreVBTSXlOVFlpSUhOMGVXeGxQU0ptYVd4c09tNXZibVU3YzNSeWIydGxPaU13TURBN2MzUnliMnRsTFd4cGJtVmpZWEE2Y205MWJtUTdjM1J5YjJ0bExXeHBibVZxYjJsdU9uSnZkVzVrTzNOMGNtOXJaUzEzYVdSMGFEbzBPSEI0SWk4K1BDOXpkbWMrIik7Cn0KLmFzaWRlIC50b2MtdG9nZ2xlLmNsb3NlZC10b2M6aG92ZXI6OmJlZm9yZSB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvYXJyb3ctYmFjay1vdXRsaW5lLnN2ZyIpOwoJLyogZ2VuZXJhdGVkIHVzaW5nIGh0dHBzOi8vZG9waWF6YS5vcmcvdG9vbHMvZGF0YXVyaS9pbmRleC5waHAgKi8KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kxTVRJaUlHaGxhV2RvZEQwaU5URXlJaUIyYVdWM1FtOTRQU0l3SURBZ05URXlJRFV4TWlJK1BIUnBkR3hsUG1sdmJtbGpiMjV6TFhZMUxXRThMM1JwZEd4bFBqeHdiMng1YkdsdVpTQndiMmx1ZEhNOUlqSTBOQ0EwTURBZ01UQXdJREkxTmlBeU5EUWdNVEV5SWlCemRIbHNaVDBpWm1sc2JEcHViMjVsTzNOMGNtOXJaVG9qTURBd08zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkR0emRISnZhMlV0ZDJsa2RHZzZORGh3ZUNJdlBqeHNhVzVsSUhneFBTSXhNakFpSUhreFBTSXlOVFlpSUhneVBTSTBNVElpSUhreVBTSXlOVFlpSUhOMGVXeGxQU0ptYVd4c09tNXZibVU3YzNSeWIydGxPaU13TURBN2MzUnliMnRsTFd4cGJtVmpZWEE2Y205MWJtUTdjM1J5YjJ0bExXeHBibVZxYjJsdU9uSnZkVzVrTzNOMGNtOXJaUzEzYVdSMGFEbzBPSEI0SWk4K1BDOXpkbWMrIik7Cn0KCgoKLnBsdXRvdWktdG9jIGhlYWRlciB7CglkaXNwbGF5OiBmbGV4OwoJYWxpZ24taXRlbXM6IGNlbnRlcjsKCWdhcDogLjNlbTsKCWZvbnQtc2l6ZTogMS41ZW07CgkvKiBtYXJnaW4tdG9wOiAtMC4xZW07ICovCgltYXJnaW4tYm90dG9tOiAwLjRlbTsKCXBhZGRpbmc6IDAuNXJlbTsKCW1hcmdpbi1sZWZ0OiAwOwoJbWFyZ2luLXJpZ2h0OiAwOwoJZm9udC13ZWlnaHQ6IGJvbGQ7CgkvKiBib3JkZXItYm90dG9tOiAycHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjE1KTsgKi8KCXBvc2l0aW9uOiBzdGlja3k7Cgl0b3A6IDBweDsKCWJhY2tncm91bmQ6IHZhcigtLW1haW4tYmctY29sb3IpOwoJei1pbmRleDogNDE7Cn0KLnBsdXRvdWktdG9jLmFzaWRlIGhlYWRlciB7CglwYWRkaW5nLWxlZnQ6IDA7CglwYWRkaW5nLXJpZ2h0OiAwOwp9CgoucGx1dG91aS10b2Mgc2VjdGlvbiAudG9jLXJvdyB7Cgl3aGl0ZS1zcGFjZTogbm93cmFwOwoJb3ZlcmZsb3c6IGhpZGRlbjsKCXRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwoJcGFkZGluZzogLjFlbTsKCWJvcmRlci1yYWRpdXM6IC4yZW07Cn0KCi5wbHV0b3VpLXRvYyBzZWN0aW9uIC50b2Mtcm93LkgxIHsKCW1hcmdpbi10b3A6IDFlbTsKfQoKCi5wbHV0b3VpLXRvYy5hc2lkZSBzZWN0aW9uIC50b2Mtcm93LmluLXZpZXcgewoJYmFja2dyb3VuZDogdmFyKC0tc2lkZWJhci1saS1hY3RpdmUtYmcpOwp9CgoKCQouaGlnaGxpZ2h0LXBsdXRvLWNlbGwtc2hvdWxkZXIgewoJYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjA1KTsKCWJhY2tncm91bmQtY2xpcDogcGFkZGluZy1ib3g7Cn0KCi5wbHV0b3VpLXRvYyBzZWN0aW9uIGEgewoJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCWNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IpOwp9Ci5wbHV0b3VpLXRvYyBzZWN0aW9uIGE6aG92ZXIgewoJY29sb3I6IHZhcigtLXBsdXRvLW91dHB1dC1oLWNvbG9yKTsKfQoKLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDEgewoJZm9udC13ZWlnaHQ6IDcwMDsKCWxpbmUtaGVpZ2h0OiAxZW07Cn0KCi5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiAuYWZ0ZXItSDIgYSB7IHBhZGRpbmctbGVmdDogMTBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gLmFmdGVyLUgzIGEgeyBwYWRkaW5nLWxlZnQ6IDIwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIC5hZnRlci1INCBhIHsgcGFkZGluZy1sZWZ0OiAzMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiAuYWZ0ZXItSDUgYSB7IHBhZGRpbmctbGVmdDogNDBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gLmFmdGVyLUg2IGEgeyBwYWRkaW5nLWxlZnQ6IDUwcHg7IH0KCi5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkgxIHsgcGFkZGluZy1sZWZ0OiAwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDIgeyBwYWRkaW5nLWxlZnQ6IDEwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDMgeyBwYWRkaW5nLWxlZnQ6IDIwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDQgeyBwYWRkaW5nLWxlZnQ6IDMwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDUgeyBwYWRkaW5nLWxlZnQ6IDQwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDYgeyBwYWRkaW5nLWxlZnQ6IDUwcHg7IH0KCgoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5wbHV0by1kb2NzLWJpbmRpbmctZWwsCi5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkFTU0lHTkVFCgl7Cglmb250LWZhbWlseTogSnVsaWFNb25vLCBtb25vc3BhY2U7Cglmb250LXNpemU6IC44ZW07CgkvKiBiYWNrZ3JvdW5kOiBibGFjazsgKi8KCWZvbnQtd2VpZ2h0OiA3MDA7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7Cgljb2xvcjogdmFyKC0tY20tdmFyLWNvbG9yKTsgLyogdGhpcyBpcyBzdGVhbGluZyBhIHZhcmlhYmxlIGZyb20gUGx1dG8sIGJ1dCBpdCdzIGZpbmUgaWYgdGhhdCBkb2VzbnQgd29yayAqLwp9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLnBsdXRvLWRvY3MtYmluZGluZy1lbDo6YmVmb3JlLAoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5BU1NJR05FRTo6YmVmb3JlCgl7Cgljb250ZW50OiAiPiAiOwoJb3BhY2l0eTogLjM7Cn0KPC9zdHlsZT4KCjxzY3JpcHQgaWQ9J3VOMUp4Uic+CgkKCS8qICMjIyMgQkVHSU5OSU5HIE9GIFBBUlQgQVVUT01BVElDQUxMWSBBRERFRCBCWSBIVExTQ1JJUFQgIyMjIyAqLwoJLy8gQXJyYXkgd2hlcmUgYWxsIHRoZSBldmVudCBsaXN0ZW5lcnMgYXJlIHN0b3JlZAoJY29uc3QgX2V2ZW50c19saXN0ZW5lcnNfID0gW10KCgkvLyBGdW5jdGlvbiB0aGF0IGNhbiBiZSBjYWxsZWQgdG8gYWRkIGV2ZW50cyBsaXN0ZW5lcnMgd2l0aGluIHRoZSBzY3JpcHQKCWZ1bmN0aW9uIGFkZFNjcmlwdEV2ZW50TGlzdGVuZXJzKGVsZW1lbnQsIGxpc3RlbmVycykgewoJCWlmIChsaXN0ZW5lcnMuY29uc3RydWN0b3IgIT0gT2JqZWN0KSB7ZXJyb3IoJ09ubHkgb2JqZWN0cyB3aXRoIGtleXMgYXMgZXZlbnQgbmFtZXMgYW5kIHZhbHVlcyBhcyBsaXN0ZW5lciBmdW5jdGlvbnMgYXJlIHN1cHBvcnRlZCcpfQoJCV9ldmVudHNfbGlzdGVuZXJzXy5wdXNoKHtlbGVtZW50LCBsaXN0ZW5lcnN9KQoJfQoJLyogIyMjIyBFTkQgT0YgUEFSVCBBVVRPTUFUSUNBTExZIEFEREVEIEJZIEhUTFNDUklQVCAjIyMjICovCgoJY29uc3QgdXNlX3Ntb290aHNjcm9sbCA9IHRydWUKY29uc3QgaGlkZV9wcmVhbWJsZSA9IHRydWUKY29uc3QgZm9yY2VfaGlkZV9lbmFibGVkID0gdHJ1ZQoKCSFmdW5jdGlvbih0KXt2YXIgZSxuPXQucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx0LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZXx8dC5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHQub1JlcXVlc3RBbmltYXRpb25GcmFtZXx8dC5tc1JlcXVlc3RBbmltYXRpb25GcmFtZXx8ZnVuY3Rpb24oZSl7dC5zZXRUaW1lb3V0KGUsMWUzLzYwKX0sbz1bXSxyPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJodG1sIilbMF07ZnVuY3Rpb24gaShuKXt2YXIgbz1uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGk9dC5wYWdlWU9mZnNldHx8ci5zY3JvbGxUb3B8fGUuc2Nyb2xsVG9wLGw9dC5wYWdlWE9mZnNldHx8ci5zY3JvbGxMZWZ0fHxlLnNjcm9sbExlZnQscz1yLmNsaWVudFRvcHx8ZS5jbGllbnRUb3B8fDAsYT1yLmNsaWVudExlZnR8fGUuY2xpZW50TGVmdHx8MDtyZXR1cm57dG9wOm8udG9wK2ktcyxsZWZ0Om8ubGVmdCtsLWF9fWZ1bmN0aW9uIGwodCl7cmV0dXJuL0VsZW1lbnQvLnRlc3Qoe30udG9TdHJpbmcuY2FsbCh0KSl9ZnVuY3Rpb24gcyh0LGUsbil7dmFyIG87aWYoIm51bWJlciI9PXR5cGVvZiB0KXJldHVybiB0O3N3aXRjaCh0KXtjYXNlInN0YXJ0IjpvPTA7YnJlYWs7Y2FzZSJlbmQiOm89bisxMDticmVhaztjYXNlImNlbnRlciI6bz1uLzI7YnJlYWs7ZGVmYXVsdDp2YXIgcixpPXQuc3BsaXQoIisiKSxsPXQuc3BsaXQoIi0iKTtpZih0LmluZGV4T2YoIisiKT4wKXRocm93IG5ldyBFcnJvcigiUG9zaXRpb24gY2FuIG9ubHkgY29udGFpbiBhICsgc2lnbiBhdCB0aGUgc3RhcnQiKTtpZih0LmluZGV4T2YoIi0iKT4wKXRocm93IG5ldyBFcnJvcigiUG9zaXRpb24gY2FuIG9ubHkgY29udGFpbiBhIC0gc2lnbiBhdCB0aGUgc3RhcnQiKTtpZih0LmluZGV4T2YoIisiKT4tMSYmdC5pbmRleE9mKCItIik+LTEpdGhyb3cgbmV3IEVycm9yKCJQb3NpdGlvbiBjYW5ub3QgY29udGFpbiBib3RoICsgYW5kIC0gc2lnbnMuIik7aWYodC5pbmRleE9mKCIlIik+LTEmJnQuaW5kZXhPZigiJSIpIT09dC5sZW5ndGgtMSl0aHJvdyBuZXcgRXJyb3IoIlBvc2l0aW9uIGNhbiBvbmx5IGNvbnRhaW4gYSAlIHN5bWJvbCBhdCB0aGUgZW5kLiIpO289aVsxXT8ocj1pWzFdKS5pbmRleE9mKCIlIik+LTE/ZStuKihyPXIuc3BsaXQoIiUiKVswXSkvMTAwOmUrICtyOmxbMV0/KHI9bFsxXSkuaW5kZXhPZigiJSIpPi0xP2Utbioocj1yLnNwbGl0KCIlIilbMF0pLzEwMDplLStyOnQuaW5kZXhPZigiJSIpPi0xP24qKHI9dC5zcGxpdCgiJSIpWzBdKS8xMDA6K3R9cmV0dXJuIG99ZnVuY3Rpb24gYSh0LGUsbil7dC5hZGRFdmVudExpc3RlbmVyP3QuYWRkRXZlbnRMaXN0ZW5lcihlLG4sITEpOnQuYXR0YWNoRXZlbnQmJnQuYXR0YWNoRXZlbnQoIm9uIitlLG4pfWZ1bmN0aW9uIGModCxlLG4pe3QucmVtb3ZlRXZlbnRMaXN0ZW5lcj90LnJlbW92ZUV2ZW50TGlzdGVuZXIoZSxuLCExKTp0LmRldGFjaEV2ZW50JiZ0LmRldGFjaEV2ZW50KCJvbiIrZSxuKX12YXIgdT17ZHVyYXRpb246NTAwLHByZXZlbnRVc2VyU2Nyb2xsOiEwLHNjcm9sbEV2ZW50czpbInNjcm9sbCIsIm1vdXNlZG93biIsIndoZWVsIiwiRE9NTW91c2VTY3JvbGwiLCJtb3VzZXdoZWVsIiwidG91Y2htb3ZlIl0sc2Nyb2xsS2V5czpbMzcsMzgsMzksNDAsMzJdLGFsbG93QW5pbWF0aW9uT3ZlcmxhcDohMSxlYXNpbmc6ImxpbmVhciJ9O2Z1bmN0aW9uIGYoKXtmb3IodmFyIHQ9MDt0PGFyZ3VtZW50cy5sZW5ndGg7dCsrKWlmKG51bGwhPWFyZ3VtZW50c1t0XSlyZXR1cm4gYXJndW1lbnRzW3RdfWZ1bmN0aW9uIGQodCxlLG4sbyl7aWYoInN0cmluZyIhPXR5cGVvZiB0KXRocm93IG5ldyBFcnJvcigiQmxvY2sgYW5kIGlubGluZSB2YWx1ZXMgbXVzdCBiZSBzdHJpbmdzIik7ZnVuY3Rpb24gcih0KXtyZXR1cm4gZS0obi1vKSp0fXN3aXRjaCh0KXtjYXNlInN0YXJ0IjpyZXR1cm4gZTtjYXNlImNlbnRlciI6cmV0dXJuIHIoLjUpO2Nhc2UiZW5kIjpyZXR1cm4gcigxKTtkZWZhdWx0OmlmKHQuaW5kZXhPZigiJSIpPi0xJiZ0LnNwbGl0KCIlIikubGVuZ3RoPDMpcmV0dXJuIHIoK3Quc3BsaXQoIiUiKVswXS8xMDApO3Rocm93IG5ldyBFcnJvcigiSW52YWxpZCBibG9jayBvciBpbmxpbmUgc3RyaW5nIHZhbHVlIil9fWZ1bmN0aW9uIGgoZSxuKXtpZih0LmdldENvbXB1dGVkU3R5bGUpe3ZhciBvPWdldENvbXB1dGVkU3R5bGUoZSxudWxsKTtpZihvLmdldFByb3BlcnR5VmFsdWUpcmV0dXJuIG8uZ2V0UHJvcGVydHlWYWx1ZShuKTtpZihvLmdldEF0dHJpYnV0ZSlyZXR1cm4gby5nZXRBdHRyaWJ1dGUobik7aWYob1tuXSlyZXR1cm4gb1tuXX1lbHNlIGlmKGUuY3VycmVudFN0eWxlKXJldHVybiBlLmN1cnJlbnRTdHlsZVtuXX1mdW5jdGlvbiBtKGUpe3JldHVybiBlP3t4OmUuc2Nyb2xsTGVmdCx5OmUuc2Nyb2xsVG9wfTp7eDp2b2lkIDAhPT10LnBhZ2VYT2Zmc2V0P3QucGFnZVhPZmZzZXQ6KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudHx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlfHxkb2N1bWVudC5ib2R5KS5zY3JvbGxMZWZ0LHk6dm9pZCAwIT09dC5wYWdlWU9mZnNldD90LnBhZ2VZT2Zmc2V0Oihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnR8fGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZXx8ZG9jdW1lbnQuYm9keSkuc2Nyb2xsVG9wfX1mdW5jdGlvbiBwKHQsZSxuKXtyZXR1cm4gdD5lP2UtKGUtdCkqbjoodC1lKSpuK2V9ZnVuY3Rpb24gZyh0KXtmb3IodmFyIGU9by5sZW5ndGgsbj1lLTE7bj49MDtuLS0paWYodCl7dmFyIHI9b1tuXTt0KHIpJiZyLmRlc3Ryb3koITApfWVsc2Ugb1tuXS5kZXN0cm95KCEwKTtyZXR1cm4hIWV9dC5zbW9vdGhTY3JvbGw9ZnVuY3Rpb24gdih3KXtpZihlfHwoZT1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdKSx3PXd8fHt9LHRoaXMgaW5zdGFuY2VvZiB2KXJldHVybntzbW9vdGhTY3JvbGw6ZnVuY3Rpb24oZSl7ZT1lfHx7fTtmb3IodmFyIG49MDtuPGIubGVuZ3RoO24rKyl7dmFyIG89YltuXTtvIGluIGV8fChlW29dPXdbb10pfXQuc21vb3RoU2Nyb2xsKGUpfX07dmFyIHksRSx4LE09Zih3LnlQb3MsdS55UG9zKSxPPStmKHcuZHVyYXRpb24sdS5kdXJhdGlvbiksUz1mKHcueFBvcyx1LnhQb3MpLFA9bSgpLFQ9UC54LEw9UC55LEE9TWF0aC5tYXgoZS5zY3JvbGxIZWlnaHQsZS5vZmZzZXRIZWlnaHQsci5jbGllbnRIZWlnaHQsci5zY3JvbGxIZWlnaHQsci5vZmZzZXRIZWlnaHQpLGs9TWF0aC5tYXgoci5jbGllbnRXaWR0aCxlLnNjcm9sbFdpZHRoLHIuc2Nyb2xsV2lkdGgsZS5vZmZzZXRXaWR0aCxyLm9mZnNldFdpZHRoKSxJPUEtdC5pbm5lckhlaWdodCxIPWstdC5pbm5lcldpZHRoLE49Zih3LmNvbXBsZXRlLHUuY29tcGxldGUpLFc9Zih3LnNjcm9sbGluZ0VsZW1lbnQsdS5zY3JvbGxpbmdFbGVtZW50KSxCPWYody50b0VsZW1lbnQsdS50b0VsZW1lbnQpLHE9Zih3LmZpcnN0QXhpcyx1LmZpcnN0QXhpcyksQz1mKHcucHJldmVudFVzZXJTY3JvbGwsdS5wcmV2ZW50VXNlclNjcm9sbCksRj1mKHcuZWFzaW5nLHUuZWFzaW5nKSxSPWYody5ibG9jayx1LmJsb2NrKSxLPWYody5pbmxpbmUsdS5pbmxpbmUpLFU9dC5pbm5lckhlaWdodCxYPXQuaW5uZXJXaWR0aCxZPTAsUT1mKHcuc2Nyb2xsRXZlbnRzLHUuc2Nyb2xsRXZlbnRzKSxEPWYody5zY3JvbGxLZXlzLHUuc2Nyb2xsS2V5cyksVj1mKHcucGFkZGluZ1RvcCx1LnBhZGRpbmdUb3ApLHo9Zih3LnBhZGRpbmdMZWZ0LHUucGFkZGluZ0xlZnQpO2lmKCJzdHJpbmciPT10eXBlb2YgRil7dmFyIGo9RjtpZighKEY9di5lYXNpbmdbRl0pKXRocm93IG5ldyBFcnJvcigiRWFzaW5nIGZ1bmN0aW9uICIraisiIGRvZXMgbm90IGV4aXN0LiIpfWVsc2UgaWYoImZ1bmN0aW9uIiE9dHlwZW9mIEYpdGhyb3cgbmV3IEVycm9yKCJFYXNpbmcgbXVzdCBiZSB0aGUgbmFtZSBvZiBhbiBlYXNpbmcgZnVuY3Rpb24gb3IgYW4gZWFzaW5nIGZ1bmN0aW9uIik7aWYoVyl7aWYoIWwoVykpdGhyb3cgbmV3IEVycm9yKCJTY3JvbGxpbmcgZWxlbWVudCBtdXN0IGJlIGEgSFRNTCBlbGVtZW50Iik7VyE9ZSYmVyE9cj8oQT1XLnNjcm9sbEhlaWdodCxrPVcuc2Nyb2xsV2lkdGgsST1BLVcuY2xpZW50SGVpZ2h0LEg9ay1XLmNsaWVudFdpZHRoLFQ9Vy5zY3JvbGxMZWZ0LEw9Vy5zY3JvbGxUb3AsVT1wYXJzZUludChoKFcsImhlaWdodCIpLDEwKSxYPXBhcnNlSW50KGgoVywid2lkdGgiKSwxMCkseT1mdW5jdGlvbih0LGUpe1cuc2Nyb2xsVG9wPWUsVy5zY3JvbGxMZWZ0PXR9KTooVz12b2lkIDAseT10LnNjcm9sbFRvKX1lbHNlIHk9dC5zY3JvbGxUbztpZihNPW51bGwhPU0/cyhNLEwsSSk6TCxTPW51bGwhPVM/cyhTLFQsSCk6VCxpc05hTihNKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgeVBvcyIpO2lmKGlzTmFOKFMpKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB4UG9zIik7aWYoaXNOYU4oTykpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGR1cmF0aW9uIik7aWYoTz1NYXRoLm1heChPLDApLFM9TWF0aC5tYXgoUywwKSxNPU1hdGgubWF4KE0sMCksQil7aWYoIWwoQikpdGhyb3cgbmV3IEVycm9yKCJFbGVtZW50IHRvIHNjcm9sbCB0byBtdXN0IGJlIGEgSFRNTCBlbGVtZW50Iik7dmFyIEc9aShCKTtpZihXKXt2YXIgSj1pKFcpO009Vy5zY3JvbGxUb3ArKEcudG9wLUoudG9wKS1wYXJzZUludChoKFcsImJvcmRlci10b3Atd2lkdGgiKSwxMCksUz1XLnNjcm9sbExlZnQrKEcubGVmdC1KLmxlZnQpLXBhcnNlSW50KGgoVywiYm9yZGVyLWxlZnQtd2lkdGgiKSwxMCl9ZWxzZSBNPUcudG9wLFM9Ry5sZWZ0O251bGwhPVImJihNPWQoUixNLFUsQi5vZmZzZXRIZWlnaHQpKSxudWxsIT1LJiYoUz1kKEssUyxYLEIub2Zmc2V0V2lkdGgpKX1pZihudWxsIT1WJiYoTSs9ViksbnVsbCE9eiYmKFMrPXopLE09TWF0aC5taW4oTWF0aC5yb3VuZChNKSxBKSwoUz1NYXRoLm1pbihNYXRoLnJvdW5kKFMpLGspKSE9PVR8fE0hPT1MKXtpZihTIT09VCYmTSE9PUx8fChxPW51bGwpLG51bGwhPXEmJihPLz0yKSwhQyl7Zm9yKHZhciBaPTA7WjxRLmxlbmd0aDtaKyspe3ZhciAkPVFbWl07Vz9hKFcsJCxfKTooYShlLCQsXyksYShyLCQsXykpfWEoV3x8ZG9jdW1lbnQsImtleWRvd24iLHR0KX1yZXR1cm4geD1mdW5jdGlvbih0LGUscixpKXtyJiZnKGZ1bmN0aW9uKHQpe3JldHVybiB0LnNjcm9sbGluZ0VsZW09PWl9KTt2YXIgbCxzPSExLGE9ZnVuY3Rpb24oKXtzfHwodCgpLG4oYSkpfSxjPWZ1bmN0aW9uKHQpe2lmKCFzKXtzPSEwO3ZhciBuPWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wO2U8by5sZW5ndGg7ZSsrKWlmKG9bZV0uZGVzdHJveT09PXQpcmV0dXJuIGV9KGMpO251bGwhPW4mJm8uc3BsaWNlKG4sMSksdCYmZSghMSwhMCl9fTtyZXR1cm4gbD17ZGVzdHJveTpjLHNjcm9sbGluZ0VsZW06aX0sby5wdXNoKGwpLG4oYSkse2Rlc3Ryb3k6ZnVuY3Rpb24oKXtjKCl9fX0oZnVuY3Rpb24oKXt2YXIgZT10LnBlcmZvcm1hbmNlJiZwZXJmb3JtYW5jZS5ub3c/cGVyZm9ybWFuY2Uubm93KCk6K25ldyBEYXRlO0V8fChFPWUpO3ZhciBuPWUtRTtpZih5KCJ5IiE9cT9wKFMsVCxGKG4vTykpOlQsIngiIT1xP3AoTSxMLEYobi9PKSk6TCksbj49TylpZih5KCJ5IiE9cT9TOlQsIngiIT1xP006TCksbnVsbCE9cSYmKytZPDIpe3N3aXRjaChxKXtjYXNlIngiOnE9InkiLFQ9UzticmVhaztjYXNlInkiOnE9IngiLEw9TX1FPW51bGx9ZWxzZSBudCghMSwhMSl9LG50LCFmKHcuYWxsb3dBbmltYXRpb25PdmVybGFwLHUuYWxsb3dBbmltYXRpb25PdmVybGFwKSxXKX1mdW5jdGlvbiBfKCl7ZXQoKSxudCghMCwhMSl9ZnVuY3Rpb24gdHQodCl7RC5pbmRleE9mKHQua2V5Q29kZSk+LTEmJihldCgpLG50KCEwLCExKSl9ZnVuY3Rpb24gZXQoKXtmb3IodmFyIHQ9MDt0PFEubGVuZ3RoO3QrKyl7dmFyIG49UVt0XTtXP2MoVyxuLF8pOihjKGUsbixfKSxjKHIsbixfKSl9YyhXfHxkb2N1bWVudCwia2V5ZG93biIsdHQpfWZ1bmN0aW9uIG50KHQsZSl7dmFyIG49bShXKTt4LmRlc3Ryb3koKSxDfHxldCgpLE4mJk4oe3hQb3M6Uyx5UG9zOk0sc2Nyb2xsaW5nRWxlbWVudDpXLGR1cmF0aW9uOk8sY3VycmVudFhQb3M6bi54LGN1cnJlbnRZUG9zOm4ueSxpbnRlcnJ1cHRlZDp0LGNhbmNlbGVkOmV9KX19LHNtb290aFNjcm9sbC5zdG9wQWxsPWZ1bmN0aW9uKCl7cmV0dXJuIGcoKX0sc21vb3RoU2Nyb2xsLmVhc2luZz17bGluZWFyOmZ1bmN0aW9uKHQpe3JldHVybiB0fSxzd2luZzpmdW5jdGlvbih0KXtyZXR1cm4uNS1NYXRoLmNvcyh0Kk1hdGguUEkpLzJ9fTtmb3IodmFyIHY9e1NpbmU6ZnVuY3Rpb24odCl7cmV0dXJuIDEtTWF0aC5jb3ModCpNYXRoLlBJLzIpfSxDaXJjOmZ1bmN0aW9uKHQpe3JldHVybiAxLU1hdGguc3FydCgxLXQqdCl9LEVsYXN0aWM6ZnVuY3Rpb24odCl7cmV0dXJuIDA9PT10fHwxPT09dD90Oi1NYXRoLnBvdygyLDgqKHQtMSkpKk1hdGguc2luKCg4MCoodC0xKS03LjUpKk1hdGguUEkvMTUpfSxCYWNrOmZ1bmN0aW9uKHQpe3JldHVybiB0KnQqKDMqdC0yKX0sQm91bmNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxuPTQ7dDwoKGU9TWF0aC5wb3coMiwtLW4pKS0xKS8xMTspO3JldHVybiAxL01hdGgucG93KDQsMy1uKS03LjU2MjUqTWF0aC5wb3coKDMqZS0yKS8yMi10LDIpfX0sdz1bIlF1YWQiLCJDdWJpYyIsIlF1YXJ0IiwiUXVpbnQiLCJFeHBvIl0seT0wO3k8dy5sZW5ndGg7eSsrKXZbd1t5XV09ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgucG93KHQseSsyKX07Zm9yKHZhciBFIGluIHYpaWYobnVsbCE9RSYmbnVsbCE9dltFXSl7dmFyIHg9dltFXTtzbW9vdGhTY3JvbGwuZWFzaW5nWyJlYXNlSW4iK0VdPXgsc21vb3RoU2Nyb2xsLmVhc2luZ1siZWFzZU91dCIrRV09ZnVuY3Rpb24odCl7cmV0dXJuIDEteCgxLXQpfSxzbW9vdGhTY3JvbGwuZWFzaW5nWyJlYXNlSW5PdXQiK0VdPWZ1bmN0aW9uKHQpe3JldHVybiB0PC41P3goMip0KS8yOjEteCgtMip0KzIpLzJ9fXNtb290aFNjcm9sbC5zY3JvbGxpbmc9ZnVuY3Rpb24oKXtyZXR1cm4hIW8ubGVuZ3RofTt2YXIgYj1bInhQb3MiLCJ5UG9zIiwiZHVyYXRpb24iLCJzY3JvbGxpbmdFbGVtZW50IiwidG9FbGVtZW50IiwicHJldmVudFVzZXJTY3JvbGwiLCJlYXNpbmciLCJjb21wbGV0ZSIsImZpcnN0QXhpcyIsInNjcm9sbEV2ZW50cyIsInNjcm9sbEtleXMiLCJibG9jayIsImlubGluZSIsImFsbG93QW5pbWF0aW9uT3ZlcmxhcCIsInBhZGRpbmdUb3AiLCJwYWRkaW5nTGVmdCJdO3Ntb290aFNjcm9sbC5kZWZhdWx0cz1mdW5jdGlvbih0KXtpZihudWxsIT10KWZvcih2YXIgZT0wO2U8Yi5sZW5ndGg7ZSsrKXt2YXIgbj1iW2VdO251bGwhPXRbbl0mJih1W25dPXRbbl0pfXJldHVybiB1fSxzbW9vdGhTY3JvbGwubmF0aXZlU3VwcG9ydGVkPSJzY3JvbGxCZWhhdmlvciJpbiByLnN0eWxlfSh3aW5kb3cpOwoKCmxldCBjZWxsID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCdwbHV0by1jZWxsJykKbGV0IHBsdXRvX2FjdGlvbnMgPSBjZWxsLl9pbnRlcm5hbF9wbHV0b19hY3Rpb25zCmxldCB0b2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCduYXYucGx1dG91aS10b2MnKQoKZnVuY3Rpb24gZ2V0Um93KGVsKSB7Cgljb25zdCByb3cgPSBlbD8uY2xvc2VzdCgnLnRvYy1yb3cnKQoJcmV0dXJuIHJvdwp9CgkKZnVuY3Rpb24gZ2V0X2xpbmtfaWQoZWwpIHsKCWNvbnN0IHJvdyA9IGdldFJvdyhlbCkKCWlmIChfLmlzTmlsKHJvdykpIHsgcmV0dXJuIG51bGwgfQoJY29uc3QgYSA9IHJvdy5xdWVyeVNlbGVjdG9yKCdhJykKCXJldHVybiBhLmhyZWYuc2xpY2UoLTM2KSAvLyBleHRyYWN0IHRoZSBsYXN0IDM2IGNoYXJhY3RlcnMsIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGNlbGwgaWQKfQoKZnVuY3Rpb24gZ2V0SGVhZGluZ0xldmVsKHJvdykgewoJY29uc3QgYSA9IHJvdy5xdWVyeVNlbGVjdG9yKCdhJykKCS8vIFdlIHJldHVybiB0aGUgbGluayBjbGFzcyB3aXRob3V0IHRoZSBmaXJzdCBICglyZXR1cm4gTnVtYmVyKGEuY2xhc3NMaXN0WzBdLnNsaWNlKDEpKQp9CgpmdW5jdGlvbiBnZW5lcmF0ZUNoZWNrZXIoc2VsZWN0b3IpIHsKCXN3aXRjaCAodHlwZW9mIHNlbGVjdG9yKSB7CgkJY2FzZSAnc3RyaW5nJzoKCQkJY29uc3QgZnVuYyA9IGVsID0+IHsKCQkJCXJldHVybiBlbC5tYXRjaGVzKHNlbGVjdG9yKQoJCQl9CgkJCXJldHVybiBmdW5jCgkJY2FzZSAnZnVuY3Rpb24nOgoJCQlyZXR1cm4gc2VsZWN0b3IKCQlkZWZhdWx0OgoJCQljb25zb2xlLmVycm9yKGBUaGUgdHlwZSAoJHt0eXBlb2Ygc2VsZWN0b3J9KSBvZiB0aGUgcHJvdmlkZWQgYXJndW1lbnQgaXMgbm90IHZhbGlkYCkKCX0KfQoKLy8gR2V0IG5leHQgYW5kIHByZXZpb3VzIHNpYmxpbmcsIGFkYXB0ZWQgZnJvbToKLy8gaHR0cHM6Ly9nb21ha2V0aGluZ3MuY29tL2ZpbmRpbmctdGhlLW5leHQtYW5kLXByZXZpb3VzLXNpYmxpbmctZWxlbWVudHMtdGhhdC1tYXRjaC1hLXNlbGVjdG9yLXdpdGgtdmFuaWxsYS1qcy8KdmFyIGdldE5leHRTaWJsaW5nID0gZnVuY3Rpb24gKGVsZW0sIHNlbGVjdG9yKSB7CgoJLy8gQWRkZWQgdG8gcmV0dXJuIHVuZGVmaW5lZCBpcyBjYWxsZWQgd2l0aCB1bmRlZmluZWQKCWlmIChfLmlzTmlsKGVsZW0pKSB7cmV0dXJuIHVuZGVmaW5lZH0KCgkvLyBHZXQgdGhlIG5leHQgc2libGluZyBlbGVtZW50Cgl2YXIgc2libGluZyA9IGVsZW0ubmV4dEVsZW1lbnRTaWJsaW5nOwoKCS8vIElmIHRoZXJlJ3Mgbm8gc2VsZWN0b3IsIHJldHVybiB0aGUgZmlyc3Qgc2libGluZwoJaWYgKCFzZWxlY3RvcikgcmV0dXJuIHNpYmxpbmc7CgoJY29uc3QgY2hlY2tlciA9IGdlbmVyYXRlQ2hlY2tlcihzZWxlY3RvcikKCgkvLyBJZiB0aGUgc2libGluZyBtYXRjaGVzIG91ciBzZWxlY3RvciwgdXNlIGl0CgkvLyBJZiBub3QsIGp1bXAgdG8gdGhlIG5leHQgc2libGluZyBhbmQgY29udGludWUgdGhlIGxvb3AKCXdoaWxlIChzaWJsaW5nKSB7CgkJaWYgKGNoZWNrZXIoc2libGluZykpIHJldHVybiBzaWJsaW5nOwoJCXNpYmxpbmcgPSBzaWJsaW5nLm5leHRFbGVtZW50U2libGluZwoJfQoKfTsKdmFyIGdldFByZXZpb3VzU2libGluZyA9IGZ1bmN0aW9uIChlbGVtLCBzZWxlY3RvcikgewoKCS8vIEFkZGVkIHRvIHJldHVybiB1bmRlZmluZWQgaXMgY2FsbGVkIHdpdGggdW5kZWZpbmVkCglpZiAoXy5pc05pbChlbGVtKSkge3JldHVybiB1bmRlZmluZWR9CgkKCS8vIEdldCB0aGUgbmV4dCBzaWJsaW5nIGVsZW1lbnQKCXZhciBzaWJsaW5nID0gZWxlbS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwoKCS8vIElmIHRoZXJlJ3Mgbm8gc2VsZWN0b3IsIHJldHVybiB0aGUgZmlyc3Qgc2libGluZwoJaWYgKCFzZWxlY3RvcikgcmV0dXJuIHNpYmxpbmc7CgoJY29uc3QgY2hlY2tlciA9IGdlbmVyYXRlQ2hlY2tlcihzZWxlY3RvcikKCgkvLyBJZiB0aGUgc2libGluZyBtYXRjaGVzIG91ciBzZWxlY3RvciwgdXNlIGl0CgkvLyBJZiBub3QsIGp1bXAgdG8gdGhlIG5leHQgc2libGluZyBhbmQgY29udGludWUgdGhlIGxvb3AKCXdoaWxlIChzaWJsaW5nKSB7CgkJaWYgKGNoZWNrZXIoc2libGluZykpIHJldHVybiBzaWJsaW5nOwoJCXNpYmxpbmcgPSBzaWJsaW5nLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7Cgl9Cgp9OwoKCi8vIEdldCB0aGUgbGFzdCB0b2MgZW50cnkgZGVzY2VuZGFudCBmcm9tIHRoZSBwcm92aWRlZCBvbmUKZnVuY3Rpb24gZ2V0TGFzdERlc2NlbmRhbnQoZWwpIHsKCWNvbnN0IHJvdyA9IGdldFJvdyhlbCkKCWlmIChfLmlzTmlsKHJvdykpIHtyZXR1cm59Cgljb25zdCBjaGlsZHJlbiA9IHJvdy5kaXJlY3RDaGlsZHJlbgoJaWYgKF8uaXNFbXB0eShjaGlsZHJlbikpIHsKCQlyZXR1cm4gcm93Cgl9IGVsc2UgewoJCXJldHVybiBnZXRMYXN0RGVzY2VuZGFudChfLmxhc3QoY2hpbGRyZW4pKQoJfQp9CgovLyBGaW5kIGFsbCB0aGUgY2VsbCBpZHMgY29udGFpbmVkIHdpdGhpbiB0aGUgdGFyZ2V0IHRvYyByb3dzIGFuZCBhbGwgaXRzIGRlc2NlbmRhbnRzCmZ1bmN0aW9uIGdldEJsb2NrSWRzKGVsKSB7Cgljb25zdCByb3cgPSBnZXRSb3coZWwpCglpZiAoXy5pc05pbChyb3cpKSB7cmV0dXJufQoJZnVuY3Rpb24gZ2V0SW5kZXgocm93KSB7CgkJcmV0dXJuIGVkaXRvcl9zdGF0ZS5ub3RlYm9vay5jZWxsX29yZGVyLmluZGV4T2YoZ2V0X2xpbmtfaWQocm93KSkKCX0KCWNvbnN0IHN0YXJ0ID0gZ2V0SW5kZXgocm93KQoKCWNvbnN0IGxhc3RDaGlsZCA9IGdldExhc3REZXNjZW5kYW50KHJvdykKCWNvbnN0IGVuZCA9IGdldEluZGV4KGdldE5leHRTaWJsaW5nKGxhc3RDaGlsZCwgJy50b2Mtcm93JykpCgoJcmV0dXJuIGVkaXRvcl9zdGF0ZS5ub3RlYm9vay5jZWxsX29yZGVyLnNsaWNlKHN0YXJ0LCBlbmQgPCAwID8gSW5maW5pdHkgOiBlbmQpCn0KCQp3aW5kb3cudG9jX3V0aWxzID0gewoJZ2V0TmV4dFNpYmxpbmcsCglnZXRQcmV2aW91c1NpYmxpbmcsCglnZXRMYXN0RGVzY2VuZGFudCwKCWdldEJsb2NrSWRzLAp9CgovLyBGdW5jdGlvbnMgdG8gc2V0IGFuZCBwcm9wYWdhdGUgaGlkZGVuIGFuZCBjb2xsYXBzZWQgc3RhdGVzCgpmdW5jdGlvbiBwcm9wYWdhdGVfcGFyZW50KGRpdiwgcGFyZW50PW51bGwpIHsKCWlmIChwYXJlbnQgIT0gbnVsbCkgewoJCWRpdi5hbGxQYXJlbnRzID0gXy51bmlvbihkaXYuYWxsUGFyZW50cywgW3BhcmVudF0pCQoJfQoJaWYgKF8uaXNFbXB0eShkaXYuZGlyZWN0Q2hpbGRyZW4pKSB7cmV0dXJufQoJZm9yIChjb25zdCBjaGlsZCBvZiBkaXYuZGlyZWN0Q2hpbGRyZW4pIHsKCQlwcm9wYWdhdGVfcGFyZW50KGNoaWxkLCBwYXJlbnQgPz8gZGl2KQoJfQp9CgovLyBSZXR1cm5zIHRydWUgaWYgdGhlIGN1cnJlbnQgaGlkZGVuL2NvbGxhcHNlZCB0b2Mgc3RhdGUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSBzYXZlZCBpbiB0aGUgZmlsZSB3aXRoaW4gY2VsbCBtZXRhZGF0YQpmdW5jdGlvbiBzdGF0ZURpZmZlcnNGaWxlKHN0YXRlKSB7Cglmb3IgKGNvbnN0IFtpZCwgc3RdIG9mIF8uZW50cmllcyhzdGF0ZSkpIHsKCQlpZiAoaGFzX2NlbGxfYXR0cmlidXRlKGlkLCAndG9jLWhpZGRlbicpICE9IHN0LmhpZGRlbikgeyByZXR1cm4gdHJ1ZSB9CgkJaWYgKGhhc19jZWxsX2F0dHJpYnV0ZShpZCwgJ3RvYy1jb2xsYXBzZWQnKSAhPSBzdC5jb2xsYXBzZWQpIHsgcmV0dXJuIHRydWUgfQoJfQoJcmV0dXJuIGZhbHNlCn0KCmZ1bmN0aW9uIHNldF9zdGF0ZShkaXYsIHN0YXRlLCB2YWx1ZSwgaW5pdCA9IGZhbHNlKSB7CglkaXYuY2xhc3NMaXN0LnRvZ2dsZShzdGF0ZSwgdmFsdWUpCglpZiAoIWluaXQpIHsKCQl3aW5kb3cudG9jX3N0YXRlW2dldF9saW5rX2lkKGRpdildW3N0YXRlXSA9IHZhbHVlCgkJdG9jLmNsYXNzTGlzdC50b2dnbGUoJ2ZpbGUtc3RhdGUtZGlmZmVycycsIHN0YXRlRGlmZmVyc0ZpbGUod2luZG93LnRvY19zdGF0ZSkpCgl9CglpZiAoXy5pc0VtcHR5KGRpdi5kaXJlY3RDaGlsZHJlbikpIHtyZXR1cm59Cglmb3IgKGNvbnN0IGNoaWxkIG9mIGRpdi5kaXJlY3RDaGlsZHJlbikgewoJCXByb3BhZ2F0ZV9zdGF0ZShjaGlsZCwgc3RhdGUpCgl9Cn0KZnVuY3Rpb24gcHJvcGFnYXRlX3N0YXRlKGRpdiwgc3RhdGUpIHsKCWxldCBuZXdfc3RhdGUgPSBgcGFyZW50LSR7c3RhdGV9YAoJZGl2LmNsYXNzTGlzdC50b2dnbGUobmV3X3N0YXRlLCBmYWxzZSkKCS8vIENoZWNrIHRoZSBwYXJlbnRzIGZvciB0aGUgc3RhdGUKCWZvciAoY29uc3QgcGFyZW50IG9mIGRpdi5hbGxQYXJlbnRzKSB7CgkJaWYgKHBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoc3RhdGUpKSB7CgkJCWRpdi5jbGFzc0xpc3QudG9nZ2xlKG5ld19zdGF0ZSwgdHJ1ZSkKCQkJYnJlYWsKCQl9Cgl9CglpZiAoXy5pc0VtcHR5KGRpdi5kaXJlY3RDaGlsZHJlbikpIHtyZXR1cm59Cglmb3IgKGNvbnN0IGNoaWxkIG9mIGRpdi5kaXJlY3RDaGlsZHJlbikgewoJCXByb3BhZ2F0ZV9zdGF0ZShjaGlsZCwgc3RhdGUpCgl9Cn0KCgoJY29uc3QgZmxvYXRpbmdfdWkgPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL0BmbG9hdGluZy11aS9kb20nKQoJLy8gd2luZG93LmZsb2F0aW5nX3VpID0gZmxvYXRpbmdfdWkKCgoJCWZ1bmN0aW9uIGFkZF9ub3RlYm9va19hdHRyaWJ1dGVzKGF0dHJzKSB7CgkJcGx1dG9fYWN0aW9ucy51cGRhdGVfbm90ZWJvb2soKG5vdGVib29rKSA9PiB7CgkJCWxldCBtZCA9IG5vdGVib29rLm1ldGFkYXRhCgkJCW1kWyJjdXN0b21fYXR0cnMiXSA9IF8udW5pb24obWRbImN1c3RvbV9hdHRycyJdLCBhdHRycykKCQl9KQoJCWxldCBub3RlYm9vayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3BsdXRvLW5vdGVib29rJykKCQlmb3IgKGxldCBhdHRyIG9mIGF0dHJzKSB7CgkJCW5vdGVib29rLnRvZ2dsZUF0dHJpYnV0ZShhdHRyLCB0cnVlKQoJCX0KCX0KCglmdW5jdGlvbiByZW1vdmVfbm90ZWJvb2tfYXR0cmlidXRlcyhhdHRycykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5tZXRhZGF0YQoJCQlsZXQgYWZ0ZXIgPSBfLmRpZmZlcmVuY2UobWRbImN1c3RvbV9hdHRycyJdLCBhdHRycykKCQkJaWYgKF8uaXNFbXB0eShhZnRlcikpIHsKCQkJCWRlbGV0ZSBtZFsiY3VzdG9tX2F0dHJzIl0KCQkJfSBlbHNlIHsKCQkJCW1kWyJjdXN0b21fYXR0cnMiXSA9IGFmdGVyCgkJCX0KCQl9KQoJCWxldCBub3RlYm9vayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3BsdXRvLW5vdGVib29rJykKCQlmb3IgKGxldCBhdHRyIG9mIGF0dHJzKSB7CgkJCW5vdGVib29rLnRvZ2dsZUF0dHJpYnV0ZShhdHRyLCBmYWxzZSkKCQl9Cgl9CgoJZnVuY3Rpb24gdG9nZ2xlX25vdGVib29rX2F0dHJpYnV0ZShhdHRyLCBmb3JjZT0ndG9nZ2xlJykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5tZXRhZGF0YQoJCQlsZXQgZiA9IGZvcmNlID09ICd0b2dnbGUnID8gXy54b3IgOiBmb3JjZSA/IF8udW5pb24gOiBfLmRpZmZlcmVuY2UKCQkJbGV0IGFmdGVyID0gZihtZFsiY3VzdG9tX2F0dHJzIl0sIFthdHRyXSkKCQkJaWYgKF8uaXNFbXB0eShhZnRlcikpIHsKCQkJCWRlbGV0ZSBtZFsiY3VzdG9tX2F0dHJzIl0KCQkJfSBlbHNlIHsKCQkJCW1kWyJjdXN0b21fYXR0cnMiXSA9IGFmdGVyCgkJCX0KCQl9KQoJCWxldCBub3RlYm9vayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3BsdXRvLW5vdGVib29rJykKCQlmb3JjZSA9PSAndG9nZ2xlJyA/IG5vdGVib29rLnRvZ2dsZUF0dHJpYnV0ZShhdHRyKSA6IG5vdGVib29rLnRvZ2dsZUF0dHJpYnV0ZShhdHRyLCBmb3JjZSkKCX0KCglpZiAoZm9yY2VfaGlkZV9lbmFibGVkKSB7CgkgCXRvZ2dsZV9ub3RlYm9va19hdHRyaWJ1dGUoJ2hpZGUtZW5hYmxlZCcsdHJ1ZSkKCX0KCgoJZnVuY3Rpb24gaGFzX2NlbGxfYXR0cmlidXRlKGNlbGxfaWQsIGF0dHIpIHsKCQljb25zdCBtZCA9IGVkaXRvcl9zdGF0ZS5ub3RlYm9vay5jZWxsX2lucHV0c1tjZWxsX2lkXS5tZXRhZGF0YQoJCXJldHVybiBfLmluY2x1ZGVzKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cikKCX0KCQoJZnVuY3Rpb24gYWRkX2NlbGxfYXR0cmlidXRlcyhjZWxsX2lkLCBhdHRycykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5jZWxsX2lucHV0c1tjZWxsX2lkXS5tZXRhZGF0YQoJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBfLnVuaW9uKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cnMpCgkJfSkKCQlsZXQgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNlbGxfaWQpCgkJZm9yIChsZXQgYXR0ciBvZiBhdHRycykgewoJCQljZWxsLnRvZ2dsZUF0dHJpYnV0ZShhdHRyLCB0cnVlKQoJCX0KCX0KCglmdW5jdGlvbiByZW1vdmVfY2VsbF9hdHRyaWJ1dGVzKGNlbGxfaWQsIGF0dHJzKSB7CgkJcGx1dG9fYWN0aW9ucy51cGRhdGVfbm90ZWJvb2soKG5vdGVib29rKSA9PiB7CgkJCWxldCBtZCA9IG5vdGVib29rLmNlbGxfaW5wdXRzW2NlbGxfaWRdLm1ldGFkYXRhCgkJCWxldCBhZnRlciA9IF8uZGlmZmVyZW5jZShtZFsiY3VzdG9tX2F0dHJzIl0sIGF0dHJzKQoJCQlpZiAoXy5pc0VtcHR5KGFmdGVyKSkgewoJCQkJZGVsZXRlIG1kWyJjdXN0b21fYXR0cnMiXQoJCQl9IGVsc2UgewoJCQkJbWRbImN1c3RvbV9hdHRycyJdID0gYWZ0ZXIKCQkJfQoJCX0pCgkJbGV0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjZWxsX2lkKQoJCWZvciAobGV0IGF0dHIgb2YgYXR0cnMpIHsKCQkJY2VsbC50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgZmFsc2UpCgkJfQoJfQoKCWZ1bmN0aW9uIHRvZ2dsZV9jZWxsX2F0dHJpYnV0ZShjZWxsX2lkLCBhdHRyLCBmb3JjZT0ndG9nZ2xlJykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5jZWxsX2lucHV0c1tjZWxsX2lkXS5tZXRhZGF0YQoJCQlsZXQgZiA9IGZvcmNlID09ICd0b2dnbGUnID8gXy54b3IgOiBmb3JjZSA/IF8udW5pb24gOiBfLmRpZmZlcmVuY2UKCQkJbGV0IGFmdGVyID0gZihtZFsiY3VzdG9tX2F0dHJzIl0sIFthdHRyXSkKCQkJaWYgKF8uaXNFbXB0eShhZnRlcikpIHsKCQkJCWRlbGV0ZSBtZFsiY3VzdG9tX2F0dHJzIl0KCQkJfSBlbHNlIHsKCQkJCW1kWyJjdXN0b21fYXR0cnMiXSA9IGFmdGVyCgkJCX0KCQl9KQoJCWxldCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2VsbF9pZCkKCQlmb3JjZSA9PSAndG9nZ2xlJyA/IGNlbGwudG9nZ2xlQXR0cmlidXRlKGF0dHIpIDogY2VsbC50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgZm9yY2UpCgl9CgoKCS8vIEZvciBlYWNoIGZyb20gYW5kIHRvLCB3ZSBoYXZlIHRvIHNwZWNpZnkgYHBsdXRvLWNlbGxbaWRdYCBpbiB0aGUgcGFydCBiZWZvcmUgdGhlIGNvbW0gYW5kIGp1c3QgYFtpZF1gIGluIHRoZSBwYXJ0IGFmdGVyIHRoZSBjb21tYSB0byBlbnN1cmUgdGhlIHNwZWNpZmljaXR5IG9mIHRoZSB0d28gY29tbWEtc2VwYXJhdGVkIHNlbGVjdG9ycyBpcyB0aGUgc2FtZSAodGhlIHBhcnQgYWZ0ZXIgdGhlIGNvbW1hIGhhcyB0aGUgYWRkaXRpb24gb2YgYH4gcGx1dG8tY2VsbGAsIHNvIGl0IGhhcyBpbmhlcmVudGx5ICsxIGVsZW1lbnQgc3BlY2lmaWNpdHkpCglmdW5jdGlvbiBoaWRlX2Zyb21fdG9fc3RyaW5nKGZyb21faWQsIHRvX2lkKSB7CgkJaWYgKF8uaXNFbXB0eShmcm9tX2lkKSAmJiBfLmlzRW1wdHkodG9faWQpKSB7cmV0dXJuICcnfQoJCQoJCWNvbnN0IGZyb21fcHJlc2VsZWN0b3IgPSBfLmlzRW1wdHkoZnJvbV9pZCkgPyAnJyA6IGBwbHV0by1jZWxsW2lkPScke2Zyb21faWR9J10sIHBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gW2lkPScke2Zyb21faWR9J10gfiBgCgkJY29uc3QgdG9fc3R5bGUgPSBfLmlzRW1wdHkodG9faWQpID8gJycgOiBgcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBwbHV0by1jZWxsW2lkPScke3RvX2lkfSddLCBwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIFtpZD0nJHt0b19pZH0nXSB+IHBsdXRvLWNlbGwgewoJCWRpc3BsYXk6IGJsb2NrOwoJfQoJIGAKCQljb25zdCBzdHlsZV9zdHJpbmcgPSAJYHBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gJHtmcm9tX3ByZXNlbGVjdG9yfXBsdXRvLWNlbGwgewoJCWRpc3BsYXk6IG5vbmU7Cgl9Cgkke3RvX3N0eWxlfQogYAoJCXJldHVybiBzdHlsZV9zdHJpbmcKCQkvL3JldHVybiBodG1sYDxzdHlsZT4ke3N0eWxlX3N0cmluZ308L3N0eWxlPmAKCX0KCglmdW5jdGlvbiBoaWRlX2Zyb21fdG9fbGlzdF9zdHJpbmcodmVjdG9yKSB7CgkJbGV0IG91dCA9IGBgCgkJZm9yIChjb25zdCBsaW1zIG9mIHZlY3RvcikgewoJCQljb25zdCBmcm9tID0gbGltc1swXQoJCQljb25zdCB0byA9IGxpbXNbMV0KCQkJCgkJCW91dCA9IGAke291dH0JJHtoaWRlX2Zyb21fdG9fc3RyaW5nKGZyb20sdG8pfWAKCQl9CgkJb3V0ID0gYCR7b3V0fQlwbHV0by1jZWxsW2Fsd2F5cy1zaG93XSB7CiAgCQkJZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsKICAJCX0KICBgCgkJcmV0dXJuIG91dAoJfQoJZnVuY3Rpb24gaGlkZV9mcm9tX3RvX2xpc3QodmVjdG9yKSB7CgkJY29uc3Qgc3RyID0gaGlkZV9mcm9tX3RvX2xpc3Rfc3RyaW5nKHZlY3RvcikKCQlyZXR1cm4gaHRtbGA8c3R5bGU+JHtzdHJ9PC9zdHlsZT5gCgl9CglmdW5jdGlvbiBoaWRlX2xpc3Rfc3R5bGUodmVjdG9yKSB7CgkJbGV0IHN0eWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpZGUtY2VsbHMtc3R5bGUnKQoJCWlmIChzdHlsZSA9PSBudWxsKSB7CiAgCQkJc3R5bGUgPSBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGh0bWxgPHN0eWxlIGlkPSdoaWRlLWNlbGxzLXN0eWxlJz48L3N0eWxlPmApCgkJfQoJCXN0eWxlLmlubmVySFRNTCA9IGhpZGVfZnJvbV90b19saXN0X3N0cmluZyh2ZWN0b3IpCgl9CgoKCWZ1bmN0aW9uIHNhdmVfdG9fZmlsZSgpIHsKCQljb25zdCBzdGF0ZSA9IHdpbmRvdy50b2Nfc3RhdGUKCQlmb3IgKGNvbnN0IFtrLHZdIG9mIE9iamVjdC5lbnRyaWVzKHN0YXRlKSkgewoJCQl0b2dnbGVfY2VsbF9hdHRyaWJ1dGUoaywgJ3RvYy1oaWRkZW4nLCB2LmhpZGRlbikJCgkJCXRvZ2dsZV9jZWxsX2F0dHJpYnV0ZShrLCAndG9jLWNvbGxhcHNlZCcsIHYuY29sbGFwc2VkKQkKCQl9CgkJc2V0VGltZW91dCgoKSA9PiB7CgkJCXRvYy5jbGFzc0xpc3QudG9nZ2xlKCdmaWxlLXN0YXRlLWRpZmZlcnMnLCBzdGF0ZURpZmZlcnNGaWxlKHN0YXRlKSkKCQl9LCA1MDApCgl9CgoKCWNvbnN0IGhlYWRlciA9IHRvYy5xdWVyeVNlbGVjdG9yKCdoZWFkZXInKQoJY29uc3QgaGVhZGVyX2NvbnRhaW5lciA9IGhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBodG1sYDxzcGFuIGNsYXNzPSd0b2MtaGVhZGVyLWNvbnRhaW5lcic+YCkKCQoJCgljb25zdCBub3RlYm9va19oaWRlX2ljb24gPSBoZWFkZXJfY29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgaHRtbGA8c3BhbiBjbGFzcz0ndG9jLWhlYWRlci1pY29uIHRvYy1oZWFkZXItaGlkZSc+YCkKCQoJY29uc3Qgc2F2ZV9maWxlX2ljb24gPSBoZWFkZXJfY29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgaHRtbGA8c3BhbiBjbGFzcz0ndG9jLWhlYWRlci1pY29uIHRvYy1oZWFkZXItc2F2ZSc+YCkKCXNhdmVfZmlsZV9pY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZV90b19maWxlKQoKCWhlYWRlcl9jb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBodG1sYDxzcGFuIGNsYXNzPSd0b2MtaGVhZGVyLWZpbGxlcic+YCkKCQoJaGVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7CgkJaWYgKGUudGFyZ2V0ICE9IGhlYWRlcikge3JldHVybn0KCQlpZiAodXNlX3Ntb290aHNjcm9sbCkgewoJCQlzbW9vdGhTY3JvbGwoe3RvRWxlbWVudDogY2VsbCwgYmxvY2s6ICdzdGFydCd9KQoJCX0gZWxzZSB7CgkJCWNlbGwuc2Nyb2xsSW50b1ZpZXcoe2Jsb2NrOiAnY2VudGVyJywgYmVoYXZpb3I6ICdzbW9vdGgnfSkKCQl9Cgl9KQoKCWhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGUpID0+IHsKCQlmbG9hdGluZ191aS5jb21wdXRlUG9zaXRpb24oaGVhZGVyLCBoZWFkZXJfY29udGFpbmVyLCB7CgkJCXBsYWNlbWVudDogImxlZnQiLAoJCQlzdHJhdGVneTogImZpeGVkIiwKCQl9KS50aGVuKHBvcyA9PiB7CgkJCWhlYWRlcl9jb250YWluZXIuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJCS8vIGhlYWRlcl9jb250YWluZXIuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQkvLyBoZWFkZXJfY29udGFpbmVyLnN0eWxlLnJpZ2h0ID0gYGNhbGMoMXJlbSArIG1pbig4MHZ3LCAzMDBweCkpYAoJCX0pCgl9KQoKCW5vdGVib29rX2hpZGVfaWNvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CgkJCS8vIFdlIGZpbmQgdGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgcGx1dG8tbm90ZWJvb2sgZWxlbWVudCwgdG8gYXZvaWQgbWlzc2luZyB0aGUgY2VsbCB3aGVuIFVJIGlzIGRpc2FibGVkCgkJCWNvbnN0IHsgeCB9ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigncGx1dG8tbm90ZWJvb2snKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQoJCQljb25zdCByZWYgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KHgrMSwxMDApLmNsb3Nlc3QoJ3BsdXRvLWNlbGwnKQoJCQljb25zdCB7IHkgfSA9IHJlZi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQoJCQl0b2dnbGVfbm90ZWJvb2tfYXR0cmlidXRlKCdoaWRlLWVuYWJsZWQnKQoJCQljb25zdCBkeSA9IHJlZi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS55IC0geQoJCQl3aW5kb3cuc2Nyb2xsQnkoMCwgZHkpCgl9KQoKY2VsbC50b2dnbGVBdHRyaWJ1dGUoJ2Fsd2F5cy1zaG93JywgdHJ1ZSkKCglmdW5jdGlvbiB0b2dnbGVfc3RhdGUobmFtZSkgewoJCXJldHVybiAoZSkgPT4gewoJCQllLnByZXZlbnREZWZhdWx0KCkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlsZXQgZGl2ID0gZS50YXJnZXQuY2xvc2VzdCgnZGl2JykKCQkJY29uc3QgbmV3X3ZhbCA9ICFkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKG5hbWUpCgkJCXNldF9zdGF0ZShkaXYsIG5hbWUsIG5ld192YWwpCgkJfQoJfQoKCWZ1bmN0aW9uIHVwZGF0ZV9oaWRkZW4oZSkgewoJCWxldCBuZXdfaGlkZSA9IFtdCgkJaWYgKGhpZGVfcHJlYW1ibGUpIHsKCQkJbmV3X2hpZGUucHVzaChbJycsIGdldF9saW5rX2lkKHRvYy5xdWVyeVNlbGVjdG9yKCdkaXYudG9jLXJvdycpKV0pCgkJfQoJCWxldCB0cmFja2luZ19oaWRkZW4gPSBudWxsCgkJbGV0IGRpdnMgPSB0b2MucXVlcnlTZWxlY3RvckFsbCgnZGl2LnRvYy1yb3cnKQoJCWZvciAoY29uc3QgZGl2IG9mIGRpdnMpIHsKCQkJaWYgKHRyYWNraW5nX2hpZGRlbiAhPSBudWxsKSB7CgkJCQljb25zdCBoaWRkZW4gPSBkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSB8fCBkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdwYXJlbnQtaGlkZGVuJykKCQkJCWlmICghaGlkZGVuKSB7CgkJCQkJbmV3X2hpZGUucHVzaChbdHJhY2tpbmdfaGlkZGVuLCBnZXRfbGlua19pZChkaXYpXSkJCgkJCQkJdHJhY2tpbmdfaGlkZGVuID0gbnVsbAoJCQkJfQoJCQl9IGVsc2UgewoJCQkJY29uc3QgaGlkZGVuID0gZGl2LmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykKCQkJCWlmIChoaWRkZW4pIHsKCQkJCQl0cmFja2luZ19oaWRkZW4gPSBnZXRfbGlua19pZChkaXYpCgkJCQl9CgkJCX0KCQl9CgkJaWYgKHRyYWNraW5nX2hpZGRlbiAhPSBudWxsKSB7CgkJCQluZXdfaGlkZS5wdXNoKFt0cmFja2luZ19oaWRkZW4sICIiXSkJCgkJfQoJCWhpZGVfbGlzdF9zdHlsZShuZXdfaGlkZSkKCX0KCgkvLyBSZXBvc2l0aW9uIHRoZSBoaWRlX2NvbnRhaW5lciB1c2luZyB0aGUgZmxvYXRpbmctdWkgbGlicmFyeQoJZnVuY3Rpb24gcmVwb3NpdGlvblRvb2x0aXAoZSkgewoJCWNvbnN0IHsgY29tcHV0ZVBvc2l0aW9uIH0gPSBmbG9hdGluZ191aQoJCWNvbnN0IHJlZiA9IGUudGFyZ2V0CgkJY29uc3QgdG9vbHRpcCA9IHJlZi5xdWVyeVNlbGVjdG9yKCcudG9jLWhpZGUtY29udGFpbmVyJykKCQlpZiAoXy5pc05pbCh0b29sdGlwKSkgewoJCQljb25zb2xlLndhcm4oIlNvbWV0aGluZyB3ZW50IHdyb25nLCBubyB0b29sdGlwIGZvdW5kIikKCQkJcmV0dXJuCgkJfQoJCWNvbXB1dGVQb3NpdGlvbihyZWYsIHRvb2x0aXAsIHsKCQkJcGxhY2VtZW50OiAibGVmdCIsCgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCX0pLnRoZW4ocG9zID0+IHsKCQkJdG9vbHRpcC5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoJCglmdW5jdGlvbiBwcm9jZXNzX3JvdyhkaXYsIGhpc3RvcnksIG9sZF9zdGF0ZSwgbmV3X3N0YXRlKSB7CgoJCS8vIFdlIGFkZCB0aGUgc2VwYXJhdG9yCgkJZGl2Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlYmVnaW4nLCBodG1sYDxkaXYgY2xhc3M9J3RvYy1yb3ctc2VwYXJhdG9yJz48L2Rpdj5gKQoJCS8vIElmIHdlIGFyZSBqdXN0IHByb2Nlc3NpbmcgdGhlIGZpcnN0IGVsZW1lbnQgKHNvIHRoZSBsYXN0IHJvdykgd2UgYWxzbyBhZGQgYSBzZXBhcmF0b3IgYXQgdGhlIGJvdHRvbQoJCWlmIChfLmlzRW1wdHkobmV3X3N0YXRlKSAmJiBfLmV2ZXJ5KGhpc3RvcnksIF8uaXNFbXB0eSkpIHsKCQkJZGl2Lmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJlbmQnLCBodG1sYDxkaXYgY2xhc3M9J3RvYy1yb3ctc2VwYXJhdG9yJz48L2Rpdj5gKQoJCX0KCgkJLy8gV2UgYWRkIHRoZSByZXBvc2l0aW9uIGV2ZW50IHRvIHRoZSByb3cKCQlkaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIHJlcG9zaXRpb25Ub29sdGlwKQoJCQoJCWxldCBpZCA9IGdldF9saW5rX2lkKGRpdikKCQljb25zdCBhID0gZGl2LnF1ZXJ5U2VsZWN0b3IoJ2EnKQoJCWlmICh1c2Vfc21vb3Roc2Nyb2xsKSB7CgkJCWNvbnN0IHRoaXNfY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKQoJCQlhLm9uY2xpY2sgPSAoZSkgPT4gewoJCQkJLy8gV2UgYXZvaWQgdHJpZ2dlcmluZyB0aGUgY2xpY2sgaWYgY29taW5nIG91dCBvZiBhIGRyYWcKCQkJCWUucHJldmVudERlZmF1bHQoKQoJCQkJaWYgKHRvYy5jbGFzc0xpc3QuY29udGFpbnMoJ3JlY2VudC1kcmFnJykpIHsgcmV0dXJuIH0KCQkJCXNtb290aFNjcm9sbCh7dG9FbGVtZW50OiB0aGlzX2NlbGwsIGJsb2NrOiAnc3RhcnQnfSkKCQkJfQoJCX0gZWxzZSB7CgkJCWxldCBvbGRfZiA9IGEub25jbGljazsKCQkJYS5vbmNsaWNrID0gKGUpID0+IHsKCQkJCWUucHJldmVudERlZmF1bHQoKQoJCQkJLy8gV2UgYXZvaWQgdHJpZ2dlcmluZyB0aGUgY2xpY2sgaWYgY29taW5nIG91dCBvZiBhIGRyYWcKCQkJCWlmICh0b2MuY2xhc3NMaXN0LmNvbnRhaW5zKCdyZWNlbnQtZHJhZycpKSB7IHJldHVybiB9CgkJCQlvbGRfZihlKQoJCQl9CQkJCgkJfQoJCWNvbnN0IGxldmVsID0gZ2V0SGVhZGluZ0xldmVsKGRpdikKCQlpZiAobGV2ZWwgPiAxKSB7CgkJCWhpc3RvcnlbbGV2ZWxdLnVuc2hpZnQoZGl2KQoJCX0KCQkvLyBXZSBpdGVyYXRlIHRocm91Z2ggdGhlIGhpc3RvcnkgYW5kIGFzc2lnbiB0aGUgZGlyZWN0IGNoaWxkcmVuIGlmIHRoZXkgZXhpc3QsIHdoaWxlIGNsZWFyaW5nIGxvd2VyIGxldmVscyBoaXN0b3J5CgkJZm9yIChsZXQgaSA9IDY7IGkgPiBsZXZlbDsgaS0tKSB7CgkJCWlmIChfLmlzRW1wdHkoaGlzdG9yeVtpXSkpIHtjb250aW51ZX0KCQkJaWYgKGRpdi5kaXJlY3RDaGlsZHJlbiAhPSB1bmRlZmluZWQpIHt0aHJvdygnbXVsdGlwbGUgbGV2ZWwgd2l0aCBjaGlsZHJlbiwgdW5leHBlY3RlZCEnKX0KCQkJZGl2LmRpcmVjdENoaWxkcmVuID0gaGlzdG9yeVtpXQoJCQloaXN0b3J5W2ldID0gW10gLy8gZW1wdHkgYXJyYXkKCQl9CgkJY29uc3QgY29sbGFwc2Vfc3BhbiA9IGEuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgaHRtbGA8c3BhbiBjbGFzcz0ndG9jLWljb24gdG9jLWNvbGxhcHNlJz5gKQoJCWxldCBoaWRlX3N0eWxlID0gYC0taGVpZ2h0OiAke2EuY2xpZW50SGVpZ2h0fXB4YAoJCWNvbnN0IGhpZGVfY29udGFpbmVyID0gZGl2Lmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1oaWRlLWNvbnRhaW5lcicgc3R5bGU9JyR7aGlkZV9zdHlsZX0nPmApCgkJY29uc3QgaGlkZV9zcGFuID0gaGlkZV9jb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgaHRtbGA8c3BhbiBjbGFzcz0ndG9jLWljb24gdG9jLWhpZGUnPmApCgkJaGlkZV9zcGFuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKCQkJdG9nZ2xlX3N0YXRlKCdoaWRkZW4nKShlKQoJCQl1cGRhdGVfaGlkZGVuKGUpCgkJfSkKCQlpZiAoZGl2LmRpcmVjdENoaWxkcmVuID09IHVuZGVmaW5lZCkgewoJCQljb2xsYXBzZV9zcGFuLmNsYXNzTGlzdC50b2dnbGUoJ25vLWNoaWxkcmVuJywgdHJ1ZSkKCQl9IGVsc2UgewoJCQlwcm9wYWdhdGVfcGFyZW50KGRpdikKCQkJY29sbGFwc2Vfc3Bhbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZV9zdGF0ZSgnY29sbGFwc2VkJykpCgkJfQoJCWxldCBtZCA9IGVkaXRvcl9zdGF0ZS5ub3RlYm9vay5jZWxsX2lucHV0c1tpZF0ubWV0YWRhdGEKCQlsZXQgY29sbGFwc2VkID0gb2xkX3N0YXRlW2lkXT8uY29sbGFwc2VkID8/ICBfLmluY2x1ZGVzKG1kWydjdXN0b21fYXR0cnMnXSwgJ3RvYy1jb2xsYXBzZWQnKQoJCWxldCBoaWRkZW4gPSBvbGRfc3RhdGVbaWRdPy5oaWRkZW4gPz8gXy5pbmNsdWRlcyhtZFsnY3VzdG9tX2F0dHJzJ10sICd0b2MtaGlkZGVuJykKCQlzZXRfc3RhdGUoZGl2LCAnY29sbGFwc2VkJywgY29sbGFwc2VkLCB0cnVlKQoJCXNldF9zdGF0ZShkaXYsICdoaWRkZW4nLCBoaWRkZW4sIHRydWUpCgkJbmV3X3N0YXRlW2lkXSA9IHsgY29sbGFwc2VkLCBoaWRkZW4gfQoJCQoJfQoKCWNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4gewoJCWNvbnN0IHJvd3MgPSB0b2MucXVlcnlTZWxlY3RvckFsbCgnc2VjdGlvbiBkaXYudG9jLXJvdycpCgkJbGV0IG9sZF9zdGF0ZSA9IHdpbmRvdy50b2Nfc3RhdGUgPz8ge30KCQlsZXQgbmV3X3N0YXRlID0ge30KCQlsZXQgaGlzdG9yeSA9IHsKCQkJMjogW10sCgkJCTM6IFtdLAoJCQk0OiBbXSwKCQkJNTogW10sCgkJCTY6IFtdLAoJCX0KCQlmb3IgKGNvbnN0IHJvdyBvZiBbLi4ucm93c10ucmV2ZXJzZSgpKSB7CgkJCXByb2Nlc3Nfcm93KHJvdywgaGlzdG9yeSwgb2xkX3N0YXRlLCBuZXdfc3RhdGUpCgkJfQoJCXdpbmRvdy50b2Nfc3RhdGUgPSBuZXdfc3RhdGUKCQl0b2MuY2xhc3NMaXN0LnRvZ2dsZSgnZmlsZS1zdGF0ZS1kaWZmZXJzJywgc3RhdGVEaWZmZXJzRmlsZShuZXdfc3RhdGUpKQoJCXVwZGF0ZV9oaWRkZW4oKQoJfSkKCglvYnNlcnZlci5vYnNlcnZlKHRvYywge2NoaWxkTGlzdDogdHJ1ZX0pCgoKCWNvbnN0IHsgZGVmYXVsdDogaW50ZXJhY3QgfSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvaW50ZXJhY3RqcycpCgoJLy8gV2UgaGF2ZSB0byBlbmFibGUgZHluYW1pY0Ryb3AgdG8gaGF2ZSBkcm9wem9uZSByZWNvbXB1dGVkIG9uIGRyYWdtb3ZlCglpbnRlcmFjdC5keW5hbWljRHJvcCh0cnVlKQoKCWZ1bmN0aW9uIGRyYWdFbmFibGVyKGUpIHsKCQlpZiAoIXRvYy5jbGFzc0xpc3QuY29udGFpbnMoJ2RyYWdfZW5hYmxlZCcpIHx8IGUua2V5ICE9PSAnU2hpZnQnKSB7IHJldHVybiB0cnVlIH0KCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICJrZXlkb3duIjoKCQkJCXRvYy5jbGFzc0xpc3QuYWRkKCdhbGxvd19hbGxfZHJvcCcpCgkJCQlicmVhazsKCQkJY2FzZSAia2V5dXAiOgoJCQkJdG9jLmNsYXNzTGlzdC5yZW1vdmUoJ2FsbG93X2FsbF9kcm9wJykKCQkJCWJyZWFrOwoJCX0KCQl1cGRhdGVBY3RpdmVTZXBhcmF0b3IoKQoJfQoKCWNvbnN0IHdpbmRvd19ldmVudHMgPSB7CgkJa2V5ZG93bjogZHJhZ0VuYWJsZXIsCgkJa2V5dXA6IGRyYWdFbmFibGVyLAoJfQoKCWFkZFNjcmlwdEV2ZW50TGlzdGVuZXJzKHdpbmRvdywgd2luZG93X2V2ZW50cykKCgkvLyBJbnRlcmFjdC5qcyBwYXJ0CgoJbGV0IGFjdGl2ZURyb3AgPSB1bmRlZmluZWQKCglmdW5jdGlvbiB0YWdBZGphY2VudFNlcGFyYXRvcnMoZWwsIGFjdGl2ZSkgewoJCWNvbnN0IG5leHQgPSBnZXROZXh0U2libGluZyhlbCwgJy50b2Mtcm93LXNlcGFyYXRvcicpCgkJY29uc3QgcHJldiA9IGdldFByZXZpb3VzU2libGluZyhlbCwgJy50b2Mtcm93LXNlcGFyYXRvcicpCgkJaWYgKGFjdGl2ZSkgewogIAkJCW5leHQ/LmNsYXNzTGlzdC5hZGQoJ25vc2hvdycpCiAgCQkJcHJldj8uY2xhc3NMaXN0LmFkZCgnbm9zaG93JykKCQl9IGVsc2UgewogIAkJCW5leHQ/LmNsYXNzTGlzdC5yZW1vdmUoJ25vc2hvdycpCiAgCQkJcHJldj8uY2xhc3NMaXN0LnJlbW92ZSgnbm9zaG93JykJCQkJCgkJfQoJfQoKCWZ1bmN0aW9uIGdldFNlcGFyYXRvcihzdGFydEVsZW1lbnQsIGJlbG93LCBhbGxvd0FsbCwgaGVhZGluZ0xldmVsID0gOCkgewoJCWxldCBzZXBhcmF0b3IKCQlpZiAoYmVsb3cpIHsKCQkJY29uc3Qgc2VsZWN0b3IgPSAnLnRvYy1yb3c6bm90KC5wYXJlbnQtY29sbGFwc2VkKScKCQkJY29uc3QgY2hlY2tlckZ1bmMgPSBhbGxvd0FsbCA/IGdlbmVyYXRlQ2hlY2tlcihzZWxlY3RvcikgOiAoZWwpID0+IHsKCQkJCWlmICghZWwubWF0Y2hlcyhzZWxlY3RvcikpIHsgcmV0dXJuIGZhbHNlIH0KCQkJCS8vIENoZWNrIGZvciB0aGUgcmlnaHQgaGVhZGluZyBsZXZlbAoJCQkJZm9yIChsZXQgaSA9IGhlYWRpbmdMZXZlbDsgaSA+IDA7IGktLSkgewoJCQkJCWNvbnN0IGNsID0gIkgiICsgaQoJCQkJCWlmIChlbC5jbGFzc0xpc3QuY29udGFpbnMoY2wpKSB7IHJldHVybiB0cnVlIH0KCQkJCX0KCQkJCXJldHVybiBmYWxzZQoJCQl9CgkJCWNvbnN0IHZhbGlkUm93ID0gZ2V0TmV4dFNpYmxpbmcoc3RhcnRFbGVtZW50LCBjaGVja2VyRnVuYykKCQkJLy8gSWYgdGhlIGFjdGl2ZURyb3AgaXMgdGhlIGxhc3Qgcm93IG9yIHRoZSB0aGUgbGFzdCBub24tY29sbGFwc2VkIG9uZSwgdGhlIHZhbGlkUm93IHdpbGwgYmUgYHVuZGVmaW5lZGAsIHNvIGluIHRoYXQgY2FzZSB3ZSB0YWtlIHRoZSBsYXN0IHNlcGFyYXRvcgoJCQlzZXBhcmF0b3IgPSBnZXRQcmV2aW91c1NpYmxpbmcodmFsaWRSb3csICcudG9jLXJvdy1zZXBhcmF0b3InKSA/PyBfLmxhc3QodG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2Mtcm93LXNlcGFyYXRvcicpKQoJCX0gZWxzZSB7CgkJCXNlcGFyYXRvciA9IGdldFByZXZpb3VzU2libGluZyhzdGFydEVsZW1lbnQsICcudG9jLXJvdy1zZXBhcmF0b3InKQoJCX0KCQlyZXR1cm4gc2VwYXJhdG9yCgl9CgoJZnVuY3Rpb24gZ2V0SGlnaGVyUGFyZW50KHJvdywgbGV2ZWwpIHsKCQljb25zdCBjdXJyZW50TGV2ZWwgPSBnZXRIZWFkaW5nTGV2ZWwocm93KQoJCWlmIChjdXJyZW50TGV2ZWwgPD0gbGV2ZWwpIHtyZXR1cm4gcm93fQoJCWZvciAoY29uc3QgcGFyIG9mIHJvdy5hbGxQYXJlbnRzKSB7CgkJCS8vIFBhcmVudHMgY3ljbGUgZnJvbSBoaWdoZXIgbGV2ZWwgdG8gbG93ZXIgbGV2ZWxzCgkJCWlmIChnZXRIZWFkaW5nTGV2ZWwocGFyKSA8PSBsZXZlbCkge3JldHVybiBwYXJ9CgkJfQoJCXJldHVybiByb3cKCX0KCQkKCWxldCB1bmNvbGxhcHNlZCA9IFtdCgoJZnVuY3Rpb24gcmVDb2xsYXBzZShyb3cpIHsKCQljb25zdCBwYXJlbnRzID0gcm93Py5hbGxQYXJlbnRzID8/IFtdCgkJY29uc3QgdG9SZW1vdmUgPSBfLmRpZmZlcmVuY2UodW5jb2xsYXBzZWQsIFsuLi5wYXJlbnRzLCByb3ddKQoJCWZvciAoY29uc3QgZWwgb2YgdG9SZW1vdmUpIHsKCQkJLy8gZGVidWdnZXIKCQkJc2V0X3N0YXRlKGVsLCAiY29sbGFwc2VkIiwgdHJ1ZSkKCQkJXy5yZW1vdmUodW5jb2xsYXBzZWQsIHggPT4geCA9PT0gZWwpCgkJfQoJfQoKCglmdW5jdGlvbiB1cGRhdGVEcm9wWm9uZShyb3cpIHsKCQljb25zdCBwcmV2ID0gdG9jLnF1ZXJ5U2VsZWN0b3IoJy50b2Mtcm93LmFjdGl2ZV9kcm9wJykKCQlpZiAoXy5pc05pbChyb3cpIHx8IHByZXYgPT09IHJvdykge3JldHVybn0KCQlpZiAocHJldj8udGltZW91dElkKSB7CgkJCWNsZWFyVGltZW91dChwcmV2LnRpbWVvdXRJZCkKCQkJcHJldi50aW1lb3V0SWQgPSB1bmRlZmluZWQKCQl9CgkJcHJldj8uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlX2Ryb3AnKQoJCXJvdy5jbGFzc0xpc3QuYWRkKCdhY3RpdmVfZHJvcCcpCgkJcmVDb2xsYXBzZShyb3cpCgkJaWYgKHJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbGxhcHNlZCcpKSB7CgkJCXJvdy50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKCQkJCXVuY29sbGFwc2VkLnB1c2gocm93KQoJCQkJc2V0X3N0YXRlKHJvdywgImNvbGxhcHNlZCIsIGZhbHNlKQoJCQkJdXBkYXRlQWN0aXZlU2VwYXJhdG9yKCkKCQkJfSwgNTAwKQoJCX0KCQlhY3RpdmVEcm9wID0gcm93Cgl9CgoJZnVuY3Rpb24gdXBkYXRlQWN0aXZlU2VwYXJhdG9yKCkgewoJCWNvbnN0IGUgPSB0b2MubGFzdERyYWdFdmVudAoJCWlmIChfLmlzTmlsKGUpKSB7IHJldHVybiB9CgkJY29uc3QgZWxCZWxvdyA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoZS5jbGllbnQueCwgZS5jbGllbnQueSkKCQlpZiAoIWVsQmVsb3cubWF0Y2hlcygnLnBsdXRvdWktdG9jIDpzY29wZScpKSB7CgkJCS8vIFdlIGFyZSBvdXQgb2YgdGhlIFRvQywgcmVjb2xsYXBzZSBhbmQgcmVtb3ZlIGFjdGl2ZSBzZXBhcmF0b3IKCQkJcmVDb2xsYXBzZSh1bmRlZmluZWQpCgkJCXRvYy5xdWVyeVNlbGVjdG9yKCcudG9jLXJvdy1zZXBhcmF0b3IuYWN0aXZlJyk/LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCgkJCXJldHVybgoJCX0KCQljb25zdCByb3dCZWxvdyA9IGdldFJvdyhlbEJlbG93KQoJCXVwZGF0ZURyb3Bab25lKHJvd0JlbG93KQoJCWlmIChfLmlzTmlsKGFjdGl2ZURyb3ApKSB7cmV0dXJufQoJCWNvbnN0IGFsbG93QWxsID0gdG9jLmNsYXNzTGlzdC5jb250YWlucygnYWxsb3dfYWxsX2Ryb3AnKQoJCWNvbnN0IGhlYWRpbmdMZXZlbCA9IGdldEhlYWRpbmdMZXZlbCh0b2MuZHJhZ2dlZEVsZW1lbnQpCgkJY29uc3QgeyB5LCBoZWlnaHQgfSA9IGFjdGl2ZURyb3AuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKCQlsZXQgdGhyZXNob2xkWSA9IHkgKyBoZWlnaHQvMgoJCWlmICghYWxsb3dBbGwpIHsKCQkJLy8gV2Ugb25seSBhbGxvdyBwdXR0aW5nIHRoZSBkcmFnZ2VkIGVsZW1lbnQgYWJvdmUvYmVsb3cgcm93cyB3aXRoIGVxdWFsIG9yIGhpZ2hlciBoZWFkaW5nIGxldmVsCgkJCWNvbnN0IGN1cnJlbnRIZWFkaW5nTGV2ZWwgPSBnZXRIZWFkaW5nTGV2ZWwoYWN0aXZlRHJvcCkKCQkJaWYgKGN1cnJlbnRIZWFkaW5nTGV2ZWwgPiBoZWFkaW5nTGV2ZWwpIHsKCQkJCS8vIFdlIHVwZGF0ZSB0aGUgdGhyZXNob2xkIGJhc2VkIG9uIHRoZSByZWxldmFudCBwYXJlbnQKCQkJCWNvbnN0IHBhciA9IGdldEhpZ2hlclBhcmVudChhY3RpdmVEcm9wLCBoZWFkaW5nTGV2ZWwpCgkJCQljb25zdCB7IHksIGhlaWdodCB9ID0gcGFyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpCgkJCQl0aHJlc2hvbGRZID0geSArIGhlaWdodC8yCQkJCQkJCgkJCX0KCQl9CgkJLy8gQ2hlY2sgaWYgdGhlIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIG1vdXNlIGlzIGJlbG93IG9yIGFib3ZlIHRoZSBtaWRkbGUgb2YgdGhlIGFjdGl2ZSBkcm9wIHpvbmUKCQljb25zdCBpc0JlbG93ID0gZS5jbGllbnQueSA+IHRocmVzaG9sZFkKCQljb25zdCBuZXdTZXAgPSBnZXRTZXBhcmF0b3IoYWN0aXZlRHJvcCwgaXNCZWxvdywgYWxsb3dBbGwsIGhlYWRpbmdMZXZlbCkKCQljb25zdCBjdXJyZW50U2VwID0gdG9jLnF1ZXJ5U2VsZWN0b3IoJy50b2Mtcm93LXNlcGFyYXRvci5hY3RpdmUnKSA/PyBuZXdTZXAKCQlpZiAoY3VycmVudFNlcCAhPT0gbmV3U2VwKSB7CgkJCWN1cnJlbnRTZXAuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykKCQl9CgkJbmV3U2VwLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpCgl9CgoJY29uc3QgZHJhZ0hhbmRsZXMgPSBpbnRlcmFjdCgnLnRvYy1yb3cnKS5kcmFnZ2FibGUoewoJCWN1cnNvckNoZWNrZXIgKGFjdGlvbiwgaW50ZXJhY3RhYmxlLCBlbGVtZW50LCBpbnRlcmFjdGluZykgewoJCQkvLyBjb25zb2xlLmxvZyh7YWN0aW9uLCBpbnRlcmFjdGFibGUsIGVsZW1lbnQsIGludGVyYWN0aW5nfSkKCQkJcmV0dXJuIG51bGwKCQl9LAoJCW1hbnVhbFN0YXJ0OiB0cnVlLCAvLyBuZWVkZWQgZm9yIGNvbnNpc3RlbnQgc3RhcnQgYWZ0ZXIgaG9sZAoJCWxpc3RlbmVyczogewoJCQlzdGFydDogZnVuY3Rpb24gKGUpIHsKCQkJCXRvYy5jbGFzc0xpc3QuYWRkKCdkcmFnX2VuYWJsZWQnKQoJCQkJY29uc3Qgcm93ID0gZS50YXJnZXQKCQkJCS8vIGNvbnNvbGUubG9nKCdzdGFydDogJywgZSkKCQkJCXRvYy5sYXN0RHJhZ0V2ZW50ID0gZQoJCQkJcm93LmNsYXNzTGlzdC5hZGQoJ2RyYWdnZWQnKQoJCQkJdG9jLmRyYWdnZWRFbGVtZW50ID0gcm93CgkJCQl0YWdBZGphY2VudFNlcGFyYXRvcnMocm93LCB0cnVlKQoJCQl9LAoJCQltb3ZlOiBmdW5jdGlvbiAoZSkgewoJCQkJdG9jLmxhc3REcmFnRXZlbnQgPSBlCgkJCQl1cGRhdGVBY3RpdmVTZXBhcmF0b3IoKQoJCQl9LAoJCQkvLyBtb3ZlOiBmdW5jdGlvbiAoZSkge2NvbnNvbGUubG9nKCdtb3ZlOiAnLGUpfSwKCQkJZW5kOiBmdW5jdGlvbiAoZSkgewoJCQkJYWN0aXZlRHJvcCA9IHVuZGVmaW5lZAoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJCQl0b2MubGFzdERyYWdFdmVudCA9IGUKCQkJCS8vIGNvbnNvbGUubG9nKCdlbmQ6ICcsIGUpCgkJCQljb25zdCByb3cgPSBlLnRhcmdldAoJCQkJLy8gQ2xlYW51cAoJCQkJcm93LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnZWQnKQoJCQkJdG9jLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdfZW5hYmxlZCcpCQoJCQkJZm9yIChjb25zdCBlbCBvZiB0b2MucXVlcnlTZWxlY3RvckFsbCgnLmFjdGl2ZV9kcm9wJykpIHsKCQkJCQllbC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmVfZHJvcCcpCgkJCQl9CgkJCQlyZUNvbGxhcHNlKCkJCQkJCgkJCQl0YWdBZGphY2VudFNlcGFyYXRvcnMocm93LCBmYWxzZSkJCQkJCgkJCQl0b2MuY2xhc3NMaXN0LnJlbW92ZSgnYWxsb3dfYWxsX2Ryb3AnKQoJCQkJLy8gV2UgdGVtcG9yYXJ5IHNldCB0aGUgcmVjZW50RHJhZyBmbGFnCgkJCQl0b2MuY2xhc3NMaXN0LmFkZCgncmVjZW50LWRyYWcnKQoJCQkJc2V0VGltZW91dCgoKSA9PiB7CgkJCQkJdG9jLmNsYXNzTGlzdC5yZW1vdmUoJ3JlY2VudC1kcmFnJykKCQkJCX0sIDMwMCkKCQkJCS8vIENoZWNrIGlmIHRoZXJlIGlzIGFuIGFjdGl2ZSBkcm9wem9uZQoJCQkJY29uc3QgZHJvcFpvbmUgPSB0b2MucXVlcnlTZWxlY3RvcignLnRvYy1yb3ctc2VwYXJhdG9yLmFjdGl2ZScpCgkJCQlpZiAoXy5pc05pbChkcm9wWm9uZSkgfHwgZHJvcFpvbmUuY2xhc3NMaXN0LmNvbnRhaW5zKCdub3Nob3cnKSkge3JldHVybn0KCQkJCWRyb3Bab25lLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCgkJCQkvLyBXZSBmaW5kIHRoZSBjZWxsIGFmdGVyIHRoZSBhY3RpdmUgc2VwYXJhdG9yIGFuZCBtb3ZlIHRoZSBkcmFnZ2VkIHJvdyBiZWZvcmUgdGhhdAoJCQkJY29uc3Qgcm93QWZ0ZXIgPSBnZXROZXh0U2libGluZyhkcm9wWm9uZSkKCQkJCWNvbnN0IGNlbGxJZHNUb01vdmUgPSBnZXRCbG9ja0lkcyhyb3cpCgkJCQkvLyBGaW5kIHRoZSBpbmRleCBvZiB0aGUgY2VsbCB0aGF0IHdpbGwgc3RheSBhZnRlciBvdXIgbW92ZWQgYmxvY2sKCQkJCWNvbnN0IGVuZCA9IGVkaXRvcl9zdGF0ZS5ub3RlYm9vay5jZWxsX29yZGVyLmluZGV4T2YoZ2V0X2xpbmtfaWQocm93QWZ0ZXIpKQoJCQkJLy8gSWYgd2UgZ290IC0xLCBpdCBtZWFucyB3ZSBoYXZlIHRvIHB1dCB0aGUgY2VsbHMgYXQgdGhlIGVuZAoJCQkJcGx1dG9fYWN0aW9ucy5tb3ZlX3JlbW90ZV9jZWxscyhjZWxsSWRzVG9Nb3ZlLCBlbmQgPCAwID8gSW5maW5pdHkgOiBlbmQpCgkJCQl0b2MuZHJhZ2dlZEVsZW1lbnQgPSB1bmRlZmluZWQJCQoJCQl9LAoJCX0KCX0pLm9uKCdob2xkJyxmdW5jdGlvbiAoZSkgewoJCWlmIChkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZV91aScpKSB7IGNvbnNvbGUubG9nKCdVSSBkaXNhYmxlZCwgbm8gaW50ZXJhY3Rpb24hJyk7IHJldHVybiB9CgkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKQoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkvLyBjb25zb2xlLmxvZygndGhpcyBpcyBob2xkJywgZSkKCQl2YXIgaW50ZXJhY3Rpb24gPSBlLmludGVyYWN0aW9uCgoJICAgIGlmICghaW50ZXJhY3Rpb24uaW50ZXJhY3RpbmcoKSkgewoJICAgICAgaW50ZXJhY3Rpb24uc3RhcnQoCgkgICAgICAgIHsgbmFtZTogJ2RyYWcnIH0sCgkgICAgICAgIGUuaW50ZXJhY3RhYmxlLAoJICAgICAgICBlLmN1cnJlbnRUYXJnZXQsCgkgICAgICApCgkgICAgfQoJfSkKCgoKCQoJLyogIyMjIyBCRUdJTk5JTkcgT0YgUEFSVCBBVVRPTUFUSUNBTExZIEFEREVEIEJZIEhUTFNDUklQVCAjIyMjICovCgkvLyBBc3NpZ24gdGhlIHZhcmlvdXMgZXZlbnRzIGxpc3RlbmVycyBkZWZpbmVkIHdpdGhpbiB0aGUgc2NyaXB0Cglmb3IgKGNvbnN0IGl0ZW0gb2YgX2V2ZW50c19saXN0ZW5lcnNfKSB7CgkJY29uc3QgeyBlbGVtZW50LCBsaXN0ZW5lcnMgfSA9IGl0ZW0KCQlmb3IgKGNvbnN0IFtuYW1lLCBmdW5jXSBvZiBfLmVudHJpZXMobGlzdGVuZXJzKSkgewogIAkJCWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBmdW5jKQoJCX0KCX0KCS8qICMjIyMgRU5EIE9GIFBBUlQgQVVUT01BVElDQUxMWSBBRERFRCBCWSBIVExTQ1JJUFQgIyMjIyAqLwoKCQoJaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJCQkKCQkvKiAjIyMjIEJFR0lOTklORyBPRiBQQVJUIEFVVE9NQVRJQ0FMTFkgQURERUQgQlkgSFRMU0NSSVBUICMjIyMgKi8KCQkvLyBSZW1vdmUgdGhlIGV2ZW50cyBsaXN0ZW5lcnMgZHVyaW5nIGludmFsaWRhdGlvbgoJCWZvciAoY29uc3QgaXRlbSBvZiBfZXZlbnRzX2xpc3RlbmVyc18pIHsKCQkJY29uc3QgeyBlbGVtZW50LCBsaXN0ZW5lcnMgfSA9IGl0ZW0KCQkJZm9yIChjb25zdCBbbmFtZSwgZnVuY10gb2YgXy5lbnRyaWVzKGxpc3RlbmVycykpIHsKCSAgCQkJZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIGZ1bmMpCgkJCX0KCQl9CgkJLyogIyMjIyBFTkQgT0YgUEFSVCBBVVRPTUFUSUNBTExZIEFEREVEIEJZIEhUTFNDUklQVCAjIyMjICovCgoJCW9ic2VydmVyLmRpc2Nvbm5lY3QoKQpkcmFnSGFuZGxlcy51bnNldCgpCgoKCX0pCgo8L3NjcmlwdD4KCjxzdHlsZT4JCgkucGx1dG91aS10b2MgaGVhZGVyIHsKCQljdXJzb3I6IHBvaW50ZXI7Cgl9CglzcGFuLnRvYy1oZWFkZXItY29udGFpbmVyIHsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJZGlzcGxheTogbm9uZTsKCQktLXNpemU6IDI1cHg7CgkJaGVpZ2h0OiBjYWxjKDUxcHggLSAxcmVtKTsKCQlmbGV4LWRpcmVjdGlvbjogcm93LXJldmVyc2U7CgkJcmlnaHQ6IGNhbGMoMXJlbSArIG1pbig4MHZoLCAzMDBweCkpOwoJfQoJLnRvYy1oZWFkZXItaWNvbiB7CgkJbWFyZ2luLXJpZ2h0OiAwLjNyZW07CgkJYWxpZ24tc2VsZjogc3RyZXRjaDsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQljdXJzb3I6IHBvaW50ZXI7Cgl9CgkudG9jLWhlYWRlci1maWxsZXIgewoJCW1hcmdpbjogLjI1cmVtOwoJfQoJaGVhZGVyOmhvdmVyIHNwYW4udG9jLWhlYWRlci1jb250YWluZXIsCglzcGFuLnRvYy1oZWFkZXItY29udGFpbmVyOmhvdmVyIHsKCQlkaXNwbGF5OiBmbGV4OwoJfQoJLnRvYy1oZWFkZXItaGlkZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXllLW91dGxpbmUuc3ZnKTsKCQlvcGFjaXR5OiA1MCU7CgkJLS1zaXplOiAxZW07Cgl9CgkudG9jLWhlYWRlci1zYXZlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9zYXZlLW91dGxpbmUuc3ZnKTsKCQlvcGFjaXR5OiA1MCU7Cgl9CgluYXY6bm90KC5maWxlLXN0YXRlLWRpZmZlcnMpIC50b2MtaGVhZGVyLXNhdmUgewoJCWRpc3BsYXk6IG5vbmU7Cgl9CglwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIHNwYW4udG9jLWhlYWRlci1oaWRlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leWUtb2ZmLW91dGxpbmUuc3ZnKTsKCX0KPC9zdHlsZT4KCjxzdHlsZT4KCXNwYW4udG9jLWhpZGUtY29udGFpbmVyIHsKCQktLXdpZHRoOiBtaW4oODB2dywgMzAwcHgpOwoJCXBvc2l0aW9uOiBmaXhlZDsKCQlkaXNwbGF5OiBmbGV4OwoJCXJpZ2h0OiBjYWxjKHZhcigtLXdpZHRoKSArIDFyZW0gKyAyMnB4IC0gMTAwcHgpOwoJCWhlaWdodDogdmFyKC0taGVpZ2h0KTsKCQl3aWR0aDogMTAwcHg7CgkJei1pbmRleDogLTE7Cgl9CglzcGFuLnRvYy1oaWRlIHsKCQl2aXNpYmlsaXR5OiBoaWRkZW47CgkJb3BhY2l0eTogNTAlOwoJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V5ZS1vdXRsaW5lLnN2Zyk7CgkJY3Vyc29yOiBwb2ludGVyOwoJfQoJZGl2LnRvYy1yb3cuaGlkZGVuIHNwYW4udG9jLWhpZGUgewoJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V5ZS1vZmYtb3V0bGluZS5zdmcpOwoJfQoJc3Bhbi50b2MtaGlkZS1jb250YWluZXI6aG92ZXIgPiAudG9jLWhpZGUsCglkaXYudG9jLXJvdzpob3ZlciAudG9jLWhpZGUgewoJCXZpc2liaWxpdHk6IHZpc2libGU7Cgl9CglkaXYudG9jLXJvdyBhIHsKCQlkaXNwbGF5OiBmbGV4OwoJfQoJc3Bhbi50b2MtaWNvbiB7CgkJLS1zaXplOiAxN3B4OwoJCWRpc3BsYXk6IGJsb2NrOwoJCWFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCX0KCXNwYW4udG9jLWNvbGxhcHNlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQltYXJnaW4tcmlnaHQ6IDNweDsKCQltaW4td2lkdGg6IHZhcigtLXNpemUpOwoJfQoJLnBsdXRvdWktdG9jIHNlY3Rpb24gZGl2LnRvYy1yb3cuY29sbGFwc2VkIHNwYW4udG9jLWNvbGxhcHNlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCX0KCS5wbHV0b3VpLXRvYyBzZWN0aW9uIGRpdi50b2Mtcm93IGEgc3Bhbi50b2MtY29sbGFwc2Uubm8tY2hpbGRyZW4gewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmU7Cgl9CglkaXYudG9jLXJvdy5wYXJlbnQtaGlkZGVuIHsKCQl0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZSBkb3R0ZWQgLjVweDsKCQl0ZXh0LXVuZGVybGluZS1vZmZzZXQ6IDJweDsKCX0KCWRpdi50b2Mtcm93LmhpZGRlbiB7CgkJdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmUgZGFzaGVkIDFweDsKCQl0ZXh0LXVuZGVybGluZS1vZmZzZXQ6IDJweDsKCX0KCS5wbHV0b3VpLXRvYyBkaXYucGFyZW50LWNvbGxhcHNlZCB7CgkJZGlzcGxheTogbm9uZTsKCX0KCXBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gZGl2LnRvYy1yb3cuaGlkZGVuLAoJcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBkaXYudG9jLXJvdy5wYXJlbnQtaGlkZGVuIHsKCQlkaXNwbGF5OiBub25lOwoJfQoJLmRyYWdfZW5hYmxlZCAudG9jLXJvdy5kcmFnZ2VkIHsKCQlib3JkZXI6IDJweCBkYXNoZWQgZ3JleTsKCX0KPC9zdHlsZT4KCjxzdHlsZT4KCWRpdi50b2Mtcm93LXNlcGFyYXRvciB7CgkJaGVpZ2h0OiAycHg7CgkJbWFyZ2luOiAzcHggMHB4OwoJCWJhY2tncm91bmQ6ICNhYWE7CgkJZGlzcGxheTogbm9uZTsKCX0KCWRpdi50b2Mtcm93LXNlcGFyYXRvci5hY3RpdmUgewoJCWRpc3BsYXk6IGJsb2NrOwoJfQoJZGl2LnRvYy1yb3ctc2VwYXJhdG9yLmFjdGl2ZS5ub3Nob3cgewoJCWRpc3BsYXk6IG5vbmU7Cgl9Cjwvc3R5bGU+CgqkbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEGtwqDjmwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJGNmYTc5MTk2LTllMDQtNGQwZS1hNmIxLTU2NDFlMTIzZjNkM7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgANmRa1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTCq3N0YXR1c190cmVlhKRuYW1lqG5vdGVib29rqHN1YnRhc2tzhKZzYXZpbmeEpG5hbWWmc2F2aW5nqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2QQm4qvPyKpzdGFydGVkX2F0y0HZBCbiq5KKqXdvcmtzcGFjZYSkbmFtZal3b3Jrc3BhY2Woc3VidGFza3OCrGluaXRfcHJvY2Vzc4SkbmFtZaxpbml0X3Byb2Nlc3Ooc3VidGFza3OEoTSEpG5hbWWhNKhzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEF40w1Omqc3RhcnRlZF9hdMtB2QQXjHPhi6ExhKRuYW1loTGoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HZBBeMbbMtqnN0YXJ0ZWRfYXTLQdkEF4wDwTyhMoSkbmFtZaEyqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2QQXjHLDAapzdGFydGVkX2F0y0HZBBeMbb9RoTOEpG5hbWWhM6hzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEF4xz4W2qc3RhcnRlZF9hdMtB2QQXjHLS3atmaW5pc2hlZF9hdMtB2QQXjTDzPapzdGFydGVkX2F0y0HZBBeMA8D5rmNyZWF0ZV9wcm9jZXNzhKRuYW1lrmNyZWF0ZV9wcm9jZXNzqHN1YnRhc2tzgqExhKRuYW1loTGoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HZBBeK8rftqnN0YXJ0ZWRfYXTLQdkEF4oQDoShMoSkbmFtZaEyqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2QQXjAPAz6pzdGFydGVkX2F0y0HZBBeK8tBfq2ZpbmlzaGVkX2F0y0HZBBeMA7QLqnN0YXJ0ZWRfYXTLQdkEF4oQDmerZmluaXNoZWRfYXTLQdkEF40w816qc3RhcnRlZF9hdMtB2QQXihAOLKNwa2eEpG5hbWWjcGtnqHN1YnRhc2tzgahhbmFseXNpc4SkbmFtZahhbmFseXNpc6hzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEJto9Q3yqc3RhcnRlZF9hdMtB2QQm2j1DbKtmaW5pc2hlZF9hdMtB2QQm2j1DfKpzdGFydGVkX2F0y0HZBCbaPUMxo3J1boSkbmFtZaNydW6oc3VidGFza3OCsHJlc29sdmVfdG9wb2xvZ3mEpG5hbWWwcmVzb2x2ZV90b3BvbG9neahzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEJto9e56qc3RhcnRlZF9hdMtB2QQm2j1wtahldmFsdWF0ZYSkbmFtZahldmFsdWF0ZahzdWJ0YXNrc4GhMYSkbmFtZaExqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2QQm2j3OvKpzdGFydGVkX2F0y0HZBCbaPZYxq2ZpbmlzaGVkX2F0y0HZBCbaPe8LqnN0YXJ0ZWRfYXTLQdkEJto9e56rZmluaXNoZWRfYXTLQdkEJto97weqc3RhcnRlZF9hdMtB2QQm2j1wi6tmaW5pc2hlZF9hdMCqc3RhcnRlZF9hdMtB2QQXigWNLrFjZWxsX2RlcGVuZGVuY2llc94AGdkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJkhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJktGRvd25zdHJlYW1fY2VsbHNfbWFwg6NhbHSQpGZyZXGR2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDeiYmyR2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODiydXBzdHJlYW1fY2VsbHNfbWFwjqpAQm9uZHNMaXN0kK1CYXNlLmdldGluZGV4kKE6kNkgTWFpbi5QbHV0b1J1bm5lci5Db3JlLmFwcGxpY2FibGWQq1BsdXRvRXh0cmFzkdkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjuU1haW4uUGx1dG9SdW5uZXIuQmFzZS5nZXSQp1BsdXRvVUmR2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmOlQGJpbmSQqEVkaXRhYmxlkNkoTWFpbi5QbHV0b1J1bm5lci5QbHV0b1J1bm5lci5jcmVhdGVfYm9uZJCkTWFpbpCkQmFzZZChKpCqU2NydWJiYWJsZZDZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN4S0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN7Rkb3duc3RyZWFtX2NlbGxzX21hcIWpZmllbGRib25kkLBmaWVsZGRlc2NyaXB0aW9ukKNhc2SR2SQxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODmoYXNkX2JvbmSS2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2bZJDc1ZmM0MGEzLTQyMzEtNDEyNS1iNTJjLWFkMjFmNWI4YTM4OKNBU0SQsnVwc3RyZWFtX2NlbGxzX21hcN4AHKdAbWRfc3RykKhoYXNmaWVsZJCmU3RyaW5nkKRAaHRskKRNYWlukKlUZXh0RmllbGSQqkBmaWVsZGRhdGGQt0h5cGVydGV4dExpdGVyYWwuUmVzdWx0kKRAZG9jkK1CYXNlLmdldGluZGV4kNkgTWFpbi5QbHV0b1J1bm5lci5Db3JlLmFwcGxpY2FibGWQoTqQpWVycm9ykLdIeXBlcnRleHRMaXRlcmFsLkJ5cGFzc5CqU3RydWN0Qm9uZJC5TWFpbi5QbHV0b1J1bm5lci5CYXNlLmdldJClQGJpbmSQuiNfX190aGlzX3BsdXRvX21vZHVsZV9uYW1lkKtCYXNlLkBrd2RlZpCmU2xpZGVykNkoTWFpbi5QbHV0b1J1bm5lci5QbHV0b1J1bm5lci5jcmVhdGVfYm9uZJCkQmFzZZCjVmFskKNJbnSQsEh5cGVydGV4dExpdGVyYWyR2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmOkVHlwZZClVW5pb26QqlNjcnViYmFibGWQ2SQxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODmEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODm0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGjYXNkkdkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE32SQ5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzSEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzS0ZG93bnN0cmVhbV9jZWxsc19tYXCCp250X2JvbmSS2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2bZJDc1ZmM0MGEzLTQyMzEtNDEyNS1iNTJjLWFkMjFmNWI4YTM4OKJudJHZJGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3ObJ1cHN0cmVhbV9jZWxsc19tYXCPp0BtZF9zdHKQrUJhc2UuZ2V0aW5kZXiQp0BOVEJvbmSQ2SBNYWluLlBsdXRvUnVubmVyLkNvcmUuYXBwbGljYWJsZZChOpClZXJyb3KQuU1haW4uUGx1dG9SdW5uZXIuQmFzZS5nZXSQpUBiaW5kkKZTbGlkZXKQ2ShNYWluLlBsdXRvUnVubmVyLlBsdXRvUnVubmVyLmNyZWF0ZV9ib25kkKRNYWlukKRCYXNlkKNWYWyQpFR5cGWQqGhhc2ZpZWxkkNkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBom50kdkkOWZhZjIyNTgtM2YyYi00NTBjLWJiZmUtZDgyMzFlMGU0ZDc02SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDeEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDe0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGkZnJlcZHZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZNkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2JhhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2JhtGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwtGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjhLRwcmVjZWRlbmNlX2hldXJpc3RpYwenY2VsbF9pZNkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjtGRvd25zdHJlYW1fY2VsbHNfbWFwhLBTdHJ1Y3RCb25kTW9kdWxlkKtQbHV0b0V4dHJhc5HZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZKdQbHV0b1VJkdkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJksEh5cGVydGV4dExpdGVyYWyS2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTfZJDk3OGY3MGVhLTM5M2UtNGYzZC05M2ZiLWM1YTgzNDQzZDA3ObJ1cHN0cmVhbV9jZWxsc19tYXCA2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjOEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjO0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDGEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDG0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDOEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDO0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjKEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjK0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKqcG9wb3V0d3JhcJCjTE9MkdkkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc52SQ2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2WEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2W0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjCEtHByZWNlZGVuY2VfaGV1cmlzdGljAadjZWxsX2lk2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjC0ZG93bnN0cmVhbV9jZWxsc19tYXCCo1BrZ5HZJDFmZmM2NDg5LTZhM2QtNGJkMS05NGU1LTRhODQzYjYxNGIyMKZSZXZpc2WQsnVwc3RyZWFtX2NlbGxzX21hcISkQmFzZZCjUGtnkdkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwtEJhc2UuY3VycmVudF9wcm9qZWN0kKxQa2cuYWN0aXZhdGWQ2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDWEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDW0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzmEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzm0ZG93bnN0cmVhbV9jZWxsc19tYXCDqWZpZWxkYm9uZJCwZmllbGRkZXNjcmlwdGlvbpCjTE9MkdkkNmM1NmMyMDUtYWM3Mi00NTU2LWI5NWUtYjI3OGU0YjNmODIysnVwc3RyZWFtX2NlbGxzX21hcN4AEadAbWRfc3RykK1CYXNlLmdldGluZGV4kKE6kKhoYXNmaWVsZJClZXJyb3KQt0h5cGVydGV4dExpdGVyYWwuQnlwYXNzkKtCYXNlLkBrd2RlZpCmU2xpZGVykKRAaHRskKRCYXNlkKpAZmllbGRkYXRhkKNWYWyQo0ludJCkVHlwZZCwSHlwZXJ0ZXh0TGl0ZXJhbJHZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY7dIeXBlcnRleHRMaXRlcmFsLlJlc3VsdJCqU2NydWJiYWJsZZDZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NrRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMYS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMbRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZrRkb3duc3RyZWFtX2NlbGxzX21hcIGjYmxjkdkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4snVwc3RyZWFtX2NlbGxzX21hcISqQEJvbmRzTGlzdJCnbnRfYm9uZJHZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NKZQb3BvdXSQqGFzZF9ib25kkdkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE32SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODiEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODi0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIWnbnRfYm9uZJHZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NKNibGOR2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2apQm9uZFRhYmxlkKhhc2RfYm9uZJHZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN6JibJHZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZNkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QzhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QztGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBt0V4dGVuZGVkVGFibGVPZkNvbnRlbnRzkLRjZWxsX2V4ZWN1dGlvbl9vcmRlctwAGdkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIw2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmPZJDVmYmQxNDAxLWM3YTEtNGQ0Zi1iMTZkLWFjOWQ0NWUyZmVkNdkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2Qz2SQ1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDbZJDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYdkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE32SQxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODnZJDY1YTNlZDhlLTYyMDQtNGFlZS1hZGZjLWJlZmU5ZWE1MTUzZdkkOGM4ZmQ1NDktMGFmYy00NDUyLWJkNmEtNjU2NDg2MmExZDYz2SQ5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzTZJGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3OdkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU12SQyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTnZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZNkkOGQ5MTIyOTctOTI1ZS00YzhiLTk4YjgtMTliNDNjOWIyOWQ32SQ5YTFiYWEzZC0xNDIwLTQ3M2MtODM4MC1iYjVjMjM4ODFlMDDZJDkzMjU1YzI0LWQ0ODYtNDE2ZC1hZWZjLTc1NzVmZWZmNzU0M9kkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc52SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjLZJDM4NTM1Y2JlLTA5M2QtNDQ1Mi1iMmE5LTk5OTE4MzE5OTgwMdkkOTVhZDk0MjgtNzNmOC00ZjU3LTkxODUtOTY4NWI5YTIxMjNm2SQzNzNiYzI0NC0xMTBhLTQzZjgtYWFhMS01MWI1Y2I3NTExMjjZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMdkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4tGxhc3RfaG90X3JlbG9hZF90aW1lywAAAAAAAAAAqXNob3J0cGF0aLJ0ZXN0X2JvbmRzdGFibGUuamyucHJvY2Vzc19zdGF0dXOlcmVhZHmkcGF0aNlJL2hvbWUvYW1lbmdhbGkvUmVwb3MvZ2l0aHViL21pbmUvUGx1dG9FeHRyYXMvbm90ZWJvb2tzL3Rlc3RfYm9uZHN0YWJsZS5qbK5sYXN0X3NhdmVfdGltZctB2QQm4quSbKpjZWxsX29yZGVy3AAZ2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjDZJDVmYmQxNDAxLWM3YTEtNGQ0Zi1iMTZkLWFjOWQ0NWUyZmVkNdkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJj2SRjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDPZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NtkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2Jh2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTfZJDE0NDJhMmViLWIzOGItNDc1Ny1iMDJjLTk2YjU5OTA4NDg4OdkkNjVhM2VkOGUtNjIwNC00YWVlLWFkZmMtYmVmZTllYTUxNTNl2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjPZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NNkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc52SQ4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTXZJDI5NTkyMTk0LTJmODktNDljYy05YTIwLTdhOGU5Y2Q0NGFlOdkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJk2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDfZJDlhMWJhYTNkLTE0MjAtNDczYy04MzgwLWJiNWMyMzg4MWUwMNkkOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQz2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNznZJDZjNTZjMjA1LWFjNzItNDU1Ni1iOTVlLWIyNzhlNGIzZjgyMtkkMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAx2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2bZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyONkkYjNmYjIzYjgtODY1Mi00NjliLThkMGMtMGM2YzI3MjNiNjMx2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODixcHVibGlzaGVkX29iamVjdHOApW5icGtniLJpbnN0YWxsZWRfdmVyc2lvbnOAsHRlcm1pbmFsX291dHB1dHOAp2VuYWJsZWTCt3Jlc3RhcnRfcmVjb21tZW5kZWRfbXNnwLRyZXN0YXJ0X3JlcXVpcmVkX21zZ8CtYnVzeV9wYWNrYWdlc5CvaW5zdGFsbF90aW1lX25zwKxpbnN0YW50aWF0ZWTDq2NlbGxfaW5wdXRz3gAZ2SQ2MDkxY2RmNC1jMGVjLTQ1ZjYtOGFhMC1kNGZhZjY2NjZkMmSEp2NlbGxfaWTZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZKRjb2Rl2gEzYmwgPSBAQm9uZHNMaXN0ICJNeSBHcm91cCBvZiBCb25kcyIgbGV0IHR2ID0gUGx1dG9VSS5FeHBlcmltZW50YWwudHJhbnNmb3JtZWRfdmFsdWUKCSAjIFdlIHVzZSB0cmFuc2Zvcm1lZF92YWx1ZSB0byB0cmFuc2xhdGUgR0h6IHRvIEh6IGluIHRoZSBib3VuZCB2YXJpYWJsZSBgZnJlcWAKCSJGcmVxdWVuY3kgW0dIel0iID0gQGJpbmQgZnJlcSB0dih4IC0+IHggKiAxZTksIEVkaXRhYmxlKDIwOyBzdWZmaXggPSAiIEdIeiIpKQoJbWQiQWx0aXR1ZGUgYGBoYGAgW21dIiA9IEBiaW5kIGFsdCBTY3J1YmJhYmxlKDEwMDoxMDoyMDApCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE3hKdjZWxsX2lk2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTekY29kZdoCUmJlZ2luCiIiIgoJc3RydWN0IEFTRAoiIiIKQmFzZS5Aa3dkZWYgc3RydWN0IEFTRAoJYTo6SW50IAoJYjo6SW50CgljOjpTdHJpbmcKCSJUaGlzIGZpZWxkIGlzIF9zcGVjaWFsXyIKCWQ6OlN0cmluZwoJZTo6SW50CmVuZApAZmllbGRkYXRhIEFTRCBiZWdpbgoJYSA9IChtZCJNYXJrZG93biBkZXNjcmlwdGlvbiwgaW5jbHVkaW5nIGBgTGFUZVhgYCIsIFNsaWRlcigxOjEwKSkKCWIgPSAoQGh0bCgiPHNwYW4+RmllbGQgd2l0aCA8Yj5IVE1MPC9iPiBkZXNjcmlwdGlvbjwvc3Bhbj4iKSwgU2NydWJiYWJsZSgxOjEwKSkKCWMgPSAoIk5vcm1hbCBTdHJpbmcgRGVzY3JpcHRpb24iLCBUZXh0RmllbGQoKSkKCWQgPSBUZXh0RmllbGQoKSAjIE5vIGRlc2NyaXB0aW9uLCBkZWZhdWx0cyB0byB0aGUgZG9jc3RyaW5nIHNpbmNlIGl0J3MgcHJlc2VudAoJZSA9IFNsaWRlcigyMDoyNSkgIyBObyBkZXNjcmlwdGlvbiwgZGVmYXVsdHMgdG8gdGhlIGZpZWxkbmFtZSBhcyBubyBkb2NzdHJpbmcgaXMgcHJlc2VudAplbmQKYXNkX2JvbmQgPSBAYmluZCBhc2QgU3RydWN0Qm9uZChBU0Q7IGRlc2NyaXB0aW9uID0gIkN1c3RvbSBEZXNjcmlwdGlvbiIpCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5hKdjZWxsX2lk2SQxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODmkY29kZaNhc2SobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NISnY2VsbF9pZNkkOWZhZjIyNTgtM2YyYi00NTBjLWJiZmUtZDgyMzFlMGU0ZDc0pGNvZGXZx250X2JvbmQgPSBAYmluZCBudCBATlRCb25kICJNeSBGYW5jeSBOVHVwbGUiIGJlZ2luCglhID0gKCJEZXNjcmlwdGlvbiIsIFNsaWRlcigxOjEwKSkKCWIgPSAobWQiKipCb2xkKiogZmllbGQiLCBTbGlkZXIoMToxMCkpCgljID0gU2xpZGVyKDE6MTApICMgTm8gZGVzY3JpcHRpb24sIGRlZmF1bHRzIHRvIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAplbmSobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3OYSnY2VsbF9pZNkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5pGNvZGWibnSobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDhkOTEyMjk3LTkyNWUtNGM4Yi05OGI4LTE5YjQzYzliMjlkN4SnY2VsbF9pZNkkOGQ5MTIyOTctOTI1ZS00YzhiLTk4YjgtMTliNDNjOWIyOWQ3pGNvZGWkZnJlcahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1hKdjZWxsX2lk2SQ4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTWkY29kZbZtZCIiIgojIEBCb25kc0xpc3QKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ5ZGE2NTg3NC02MDhhLTRjODQtYTBlNi04MTNjNjI0YzA3YmGEp2NlbGxfaWTZJDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYaRjb2Rl2gGKbWQiIiIKR2VuZXJhdGluZyBhdXRvbWF0aWMgd2lkZ2V0cyBmb3IgY3VzdG9tIHN0cnVjdHMgaXMgcXVpdGUgc3RyYWlnaHRmb3J3YXJkIHdpdGggdGhlIGFpZCBvZiB0aGUgYEBmaWVsZGRhdGFgIG1hY3JvIGFuZCB0aGUgYFN0cnVjdEJvbmRgIHR5cGUuCgpUaGUgdG9wLWxlZnQgYXJyb3cgY2FuIGJlIHVzZWQgdG8gc2hvdy1oaWRlIHRoZSBmaWVsZCBlbGVtZW50cyAodXNlZnVsIGluc2lkZSBhIGBCb25kVGFibGVgLCBzaG93biBiZWxvdyksIHdoaWxlIHRoZSBncmVlbiB0b2dnbGUgb24gdGhlIHRvcC1yaWdodCBjYW4gYmUgdXNlZCB0byBkaXNhYmxlIHRlbXBvcmFyaWx5IHRoZSBzeW5jaCBiZXR3ZWVuIHRoZSBKUyB3aWRnZXRzIGFuZCB0aGUgYm9uZCB2YWx1ZXMgaW4gUGx1dG8uCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5hKdjZWxsX2lk2SQyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTmkY29kZdoDVW1kIiIiCkluIHNvbWUgY2FzZXMsIG9uZSBkb2VzIG5vdCB3YW50IHRvIGhhdmUgYSBzaW5nbGUgYm9uZCB3cmFwcGluZyBlaXRoZXIgYSBTdHJ1Y3R1cmUgb3IgYSBOYW1lZFR1cGxlLCBhbmQgc2luZ2xlIGluZGVwZW5kZW50IGJvbmRzIGFyZSBtb3JlIGNvbnZlbmllbnQuCgpgQEJvbmRzTGlzdGAgaXMgYSBjb252ZW5pZW5jZSBtYWNybyB0byBjcmVhdGUgYW4gb2JqZWN0IG9mIHR5cGUgYEJvbmRzTGlzdGAgd2hpY2ggc2ltcGx5IGFsbG93IHRvIGFkZCBhIGRlc2NyaXB0aW9uIHRvIHNlcGFyYXRlIGJvbmRzIGFuZCBncm91cCB0aGVtIGFsbCB0b2dldGhlciBpbiBhIHRhYmxlLWxpa2UgZm9ybWF0IGVxdWl2YWxlbnQgdG8gdGhvc2Ugb2YgYFN0cnVjdEJvbmRgLgoKISEhIG5vdGUKCVVubGlrZSBgU3RydWN0Qm9uZGAsIGEgQm9uZHNMaXN0IGlzIGFscmVhZHkgY29tcG9zZWQgb2YgYm9uZCBjcmVhdGVkIHdpdGggYEBiaW5kYCBhbmQgaXQganVzdCBncm91cHMgdGhlbSB1cCB3aXRoIGEgZGVzY3JpcHRpb24uIFRoZSBvdXRwdXQgb2YgYEBCb25kc0xpc3RgIGlzIG5vdCBzdXBwb3NlZCB0byBiZSBib3VuZCB0byBhIHZhcmlhYmxlIHVzaW5nIGBAYmluZGAuXAoJVGhlIGJvbmRzIGdyb3VwZWQgaW4gYSBCb25kc0xpc3Qgc3RpbGwgYWN0IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseSBmcm9tIG9uZSBhbm90aGVyLgoKU2VlIHRoZSBleGFtcGxlIGJlbG93IGZvciB1bmRlcnN0YW5kaW5nIHRoZSBzeW50aGF4LiBUaGUgaGVhZGVyIG9mIGEgQm9uZHNMaXN0IGlzIHNob3duIGluIGFuIG9yYW5nZSBiYWNrZ3JvdW5kIHRvIGVhc2lseSBkaWZmZXJlbnRpYXRlIGl0IGZyb20gYFN0cnVjdEJvbmRgLgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDlhMWJhYTNkLTE0MjAtNDczYy04MzgwLWJiNWMyMzg4MWUwMISnY2VsbF9pZNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwpGNvZGWybWQiIiIKIyBQb3BvdXQKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmOEp2NlbGxfaWTZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY6Rjb2Rl2aFiZWdpbgoJdXNpbmcgUGx1dG9FeHRyYXMKCXVzaW5nIFBsdXRvRXh0cmFzLlN0cnVjdEJvbmRNb2R1bGUgIyBUaGlzIHN1Ym1vZHVsZSBoYXMgdGhlIGZlYXR1cmVzIGxpc3RlZCBpbiB0aGlzIG5vdGVib29rCgl1c2luZyBQbHV0b1VJCgl1c2luZyBIeXBlcnRleHRMaXRlcmFsCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOGM4ZmQ1NDktMGFmYy00NDUyLWJkNmEtNjU2NDg2MmExZDYzhKdjZWxsX2lk2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjOkY29kZdoBpW1kIiIiClNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgYFN0cnVjdEJvbmRgIHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiAKClRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gYEBOVEJvbmRgIHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLgoKVGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSBgU3RydWN0Qm9uZGAgd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDM4NTM1Y2JlLTA5M2QtNDQ1Mi1iMmE5LTk5OTE4MzE5OTgwMYSnY2VsbF9pZNkkMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAxpGNvZGXaATdtZCIiIgpUaGUgYWJpbGl0eSB0byBhbHNvIHdyYXAgcHJlLWV4aXN0aW5nIGJvbmRzIGFyb3VuZCBTdHJ1Y3RCb25kcyBpcyBjb252ZW5pZW50IGZvciBvcmdhbml6aW5nIHRoZSB2YXJpb3VzIGJvbmRzIG9uZSBoYXZlIGluIGEgYEJvbmRzTGlzdGAgb3IgYEJvbmRUYWJsZWAKCkFzIGFuIGV4YW1wbGUsIG9uZSBjYW4gY3JlYXRlIGEgYEJvbmRzTGlzdGAgY29udGFpbmluZyB0aGUgdHdvIGBTdHJ1Y3RCb25kYCBib25kcyBnZW5lcmF0ZWQgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGlzIG5vdGVib29rIHdpdGggdGhlIGZvbGx3aW5nIGNvZGUuCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQzhKdjZWxsX2lk2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDOkY29kZdoDM21kIiIiClRoZSBzdHJ1Y3R1cmVzIGFib3ZlIGNhbiBhbHNvIGJlIHVzZWQgbmVzdGVkIHdpdGhpbiBvbmUgYW5vdGhlci4gVG8gZmFjaWxpdGF0ZSBhY2Nlc3NpbmcgbmVzdGVkIHN0cnVjdHVyZXMsIG9uZSBjYW4gdXNlIHRoZSBgUG9wb3V0YCB0eXBlLgoKSW4gaXRzIHNpbXBsZSBmb3JtLCB5b3UgY2FuIGdpdmUgYW4gaW5zdGFuY2Ugb2YgYSBTdHJ1Y3RCb25kLCBhIGJvbmQgd3JhcHBpbmcgYSBTdHJ1Y3RCb25kIG9yIGEgQm9uZHNMaXN0IGFzIGlucHV0IHRvIFBvcG91dCB0byBjcmVhdGUgYSB0YWJsZSB0aGF0IGlzIGhpZGRlbiBiZWhpbmQgYSBwb3B1cCB3aW5kb3cuCklmIGFuIGluc3RhbmNlIHByZXNlbnQsIGJ1dCB5b3Ugd2FudCBhIGN1c3RvbSB0eXBlIGZvciB3aGljaCB5b3UgaGF2ZSBkZWZpbmVkIGN1c3RvbSBib25kcyBhbmQgZGVzY3JpcHRpb25zIHdpdGggYEBmaWVsZGRhdGFgIHRvIGFwcGVhciBhcyBwb3BvdXQsIHlvdSBjYW4gdXNlIHRoZSBmdW5jdGlvbiBgcG9wb3V0d3JhcChUWVBFKWAgdG8gZ2VuZXJhdGUgYSBzbWFsbCBpY29uIHdoaWNoIGhpZGVzIGEgcG9wdXAgY29udGFpbmluZyB0aGUgYFN0cnVjdEJvbmRgIG9mIHRoZSBwcm92aWRlZCB0eXBlIGBUWVBFYC4KClRoZSBTdHJ1Y3RCb25kIHRhYmxlIGFwcGVhcnMgb24gaG92ZXIgdXBvbiB0aGUgaWNvbiwgY2FuIGJlIG1hZGUgZml4ZWQgYnkgY2xpY2tpbmcgb24gdGhlIGljb24gYW5kIGNhbiB0aGVuIGJlIG1vdmVkIGFyb3VuZCBvciByZXNpemVkLgpBIGRvdWJsZSBjbGljayBvbiB0aGUgaGVhZGVyIG9mIHRoZSBwb3BvdXQgaGlkZXMgaXQgYWdhaW46CiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkNmM1NmMyMDUtYWM3Mi00NTU2LWI5NWUtYjI3OGU0YjNmODIyhKdjZWxsX2lk2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjKkY29kZa9wb3BvdXR3cmFwKExPTCmobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDY1YTNlZDhlLTYyMDQtNGFlZS1hZGZjLWJlZmU5ZWE1MTUzZYSnY2VsbF9pZNkkNjVhM2VkOGUtNjIwNC00YWVlLWFkZmMtYmVmZTllYTUxNTNlpGNvZGWzbWQiIiIKIyBATlRCb25kCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwhKdjZWxsX2lk2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjCkY29kZdlJYmVnaW4KCWltcG9ydCBQa2cKCVBrZy5hY3RpdmF0ZShCYXNlLmN1cnJlbnRfcHJvamVjdCgpKQoJdXNpbmcgUmV2aXNlCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzwqhkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTDq2NvZGVfZm9sZGVkwtkkNWZiZDE0MDEtYzdhMS00ZDRmLWIxNmQtYWM5ZDQ1ZTJmZWQ1hKdjZWxsX2lk2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDWkY29kZbRtZCIiIgojIFBhY2thZ2VzCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc5hKdjZWxsX2lk2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzmkY29kZdmlYmVnaW4KQmFzZS5Aa3dkZWYgc3RydWN0IExPTAoJYTo6SW50IAoJYjo6SW50CmVuZApAZmllbGRkYXRhIExPTCBiZWdpbgoJYSA9IChtZCJXb25kZXIhIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCBCPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQplbmQKZW5kqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQ1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDaEp2NlbGxfaWTZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NqRjb2Rltm1kIiIiCiMgU3RydWN0Qm9uZAoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOISnY2VsbF9pZNkkMzczYmMyNDQtMTEwYS00M2Y4LWFhYTEtNTFiNWNiNzUxMTI4pGNvZGW1bWQiIiIKIyBCb25kVGFibGUKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SRiM2ZiMjNiOC04NjUyLTQ2OWItOGQwYy0wYzZjMjcyM2I2MzGEp2NlbGxfaWTZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMaRjb2Rl2gIZbWQiIiIKVGhlIGZpbmFsIGNvbnZlbmllbmNlIHN0cnVjdHVyZSBwcm92aWRlZCBieSB0aGlzIG1vZHVsZSBpcyB0aGUgYEJvbmRUYWJsZWAuIEl0IGNhbiBiZSBjcmVhdGVkIHRvIGdyb3VwIGEgbGlzdCBvZiBib25kcyBpbiBhIGZsb2F0aW5nIHRhYmxlIHRoYXQgc3RheXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgbm90ZWJvb2sgKHNpbWlsYXIgdG8gdGhlIFRhYmxlT2ZDb250ZW50cyBvZiBQbHV0b1VJKSBhbmQgY2FuIGJlIG1vdmVkIGFyb3VuZCBhbmQgcmVzaXplZCBvciBoaWRkZW4gZm9yIGNvbnZlbmllbmNlLgoKVGhlIEJvbmRUYWJsZSBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGVpdGhlciB3aXRoIGJvbmRzIGNvbnRhaW5pbmcgYFN0cnVjdEJvbmRgIG9yIHdpdGggYEJvbmRzTGlzdGAuIEZ1dHVyZSB0eXBlcyB3aXRoIHNpbWlsYXIgc3RydWN0dXJlIHdpbGwgYWxzbyBiZSBhZGRlZC4KCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiBhIGJvbmR0YWJsZSBjb250YWluaW5nIGFsbCB0aGUgZXhhbXBsZXMgb2YgdGhpcyBub3RlYm9vay4KIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2aEp2NlbGxfaWTZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZqRjb2Rl2XFibGMgPSBAQm9uZHNMaXN0ICJQb3BvdXQgQ29udGFpbmVyIiBiZWdpbgoJIlN0cnVjdHVyZSBBU0QiID0gUG9wb3V0KGFzZF9ib25kKQoJIk5hbWVkVHVwbGUiID0gUG9wb3V0KG50X2JvbmQpCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4hKdjZWxsX2lk2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODikY29kZdlHQm9uZFRhYmxlKFsKCWFzZF9ib25kLAoJbnRfYm9uZCwKCWJsLAoJYmxjCl07IGRlc2NyaXB0aW9uID0gIk15IEJvbmRzIimobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJGNmYTc5MTk2LTllMDQtNGQwZS1hNmIxLTU2NDFlMTIzZjNkM4SnY2VsbF9pZNkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QzpGNvZGW5RXh0ZW5kZWRUYWJsZU9mQ29udGVudHMoKahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwqtub3RlYm9va19pZNkkOWE5ZmJmZDgtYzI1ZC0xMWVkLTMzZjctNGRhMWZiYTdjYjk2q2luX3RlbXBfZGlywqhtZXRhZGF0YYGsY3VzdG9tX2F0dHJzkaxoaWRlLWVuYWJsZWQ=";
window.pluto_preamble_html = undefined;
</script>

<meta name="pluto-insertion-spot-parameters">
<script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.ccb2d097.js" type="module" defer="" integrity="sha384-z/NFGf3WX4Q71MXWsHtnW1TkhMuBwNMHerzZkEXKB+k3hp2YD+NPRGBVu9ALkE4R" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.b9f0ac7b.js" integrity="sha384-bgokkaJz2F/u6BCZYRcl36Jkfwy7x9SeobwBF3EWarMEaCfg5aSU3Z7nSuLQdETn" crossorigin="anonymous"></script><script type="text/javascript" id="MathJax-script" integrity="sha384-4kE/rQ11E8xT9QgrCBTyvenkuPfQo8rXYQvJZuMgxyPOoUfpatjQPlgdv6V5yhUK" crossorigin="" not-the-src-yet="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-svg-full.js" async=""></script></head><body class="loading no-MÎ±Î¸Jax"> <div style="display:flex;min-height:100vh;"> <pluto-editor class="fullscreen"></pluto-editor> </div> </body></html>