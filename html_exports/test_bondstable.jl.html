<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"><meta charset="utf-8">
<meta name="pluto-insertion-spot-meta">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#2a2928"><meta name="color-scheme" content="light dark"><link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon-16x16.347d2855.png" integrity="sha384-3qsGeVLdddzV9oIkj3PhXXQX2CZCjOD/CiyrPQOX6InOWw3HAHClrsQhPfX9uRAj" crossorigin="anonymous"><link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon-32x32.8789add4.png" integrity="sha384-cOe5vSoBIgKNgkUL27p9RpsGVY0uBg9PejLccDy+fR8ZD1Iv5dF1MGHjIZAIZwm6" crossorigin="anonymous"><link rel="icon" type="image/png" sizes="96x96" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon-96x96.48689391.png" integrity="sha384-TN49cYb8GyNmrZT14bsYXXo4l1x1NJeJ/EHuVAauAKsNPopPHLojijs9jFT4Vs8c" crossorigin="anonymous"><link rel="pluto-logo-big" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/logo.004c1d7c.svg" integrity="sha384-GkQkODcGxsrSRJCkeakBXihum0GUM44cwBgKyutDimectXCbCgj6Vu3jlrueqEcN" crossorigin="anonymous"><link rel="pluto-logo-small" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/favicon_unsaturated.d1387b25.svg" integrity="sha384-omwjH+Qy3hpAVf5FYd/pkaDBuVAfsEDRN7eBxEA8Ek00OAWP+aiV+GpEYk3I7lyo" crossorigin="anonymous"><script type="module" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.c73f088f.js" integrity="sha384-DX1flYmpVrvPu5Z9JJtDatXQGsS20eFFpJuNDVzFK+yfHdoLNoBYPb79KrbknLzZ" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/juliamono.c6034ab4.css" integrity="sha384-n0za6lUXlyf4XC+nGkZWj3TLDnRbNpAcoi4PZGSlQMPoyqGa9kGY+ZXkUgZGIhQt" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.e1a53700.css" integrity="sha384-L38U7X8v0kZCLcn973v3EAbuJy7tzzkX02adfa2LDv1pWRGiT7b2NuAkH1oOJWKS" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/vollkorn.089565a8.css" integrity="sha384-jnV/84VtSgBLF70H+s2rxJcOUZIMDR+X/ElFZA83i9ZtZSWiIMFAgPyrWkOJV08q" crossorigin="anonymous"><script defer="">console.log("Pluto.jl, by Fons van der Plas (https://github.com/fonsp), MikoÅ‚aj Bochenski (https://github.com/malyvsen), Michiel Dral (https://github.com/dralletje) and friends ðŸŒˆ");</script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.4b96dd74.js" defer="" integrity="sha384-Y+UtWANyXLeovyghpAI8j9/VZXWboD6G5ZCckOsJO99PawAh/utJxFikf62WBaSu" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.9f9dc874.js" defer="" integrity="sha384-tkFo1EK72I9JvoTmHFa199dfRzW8mkXPUkHb/N7UhYI+bxKzX3Kh8LNCZz1ltsFF" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.90ede145.js" defer="" integrity="sha384-CuNU9gQg6fa/yynNqNWjHWzPm4nj+d7O6+HXsNGSqClhs/bYQIbBC3Lw/kh8Ukui" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.dbeed08a.js" defer="" integrity="sha384-1BEdQwXfZi4ZpsNV8w1X8pQcVK1/DS/+/M8OTo3gol7mdEspSN7nT6llX57NQCSt" crossorigin="anonymous"></script><script id="iframe-resizer-content-window-script" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.6386bd9d.js" crossorigin="anonymous" defer="" integrity="sha384-tgN2a0VDi/lCYwZuDqT7L+A/Y/9kpxf3HV7zv2BJ5Fu7zW0EClq0nM4crfK3TRPs"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.23c14a79.css" type="text/css" integrity="sha384-jLh920NaGkBLzSCGy8Gmwt4oVTxaevvnAKcgWLvK8tgTEKiVEAN9OoYSRTDBcMJY" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.3394571b.css" type="text/css" media="all" data-pluto-file="hide-ui" integrity="sha384-CZthudKXQngXEkYHKw7orzD3ShUAud4YcXeMNAI4M+C79j5BokFyKOsZh0iDW5wr" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.d3307b27.css" type="text/css" integrity="sha384-3x2qZDazgbcSpu1KwtC7K1OB1Tkfg6mRNoxs0wf+u5qGDUVfPW9p0dgiiuz/vnWq" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.1f4cf2ca.css" type="text/css" integrity="sha384-lBSBsn8FT1UzGOsNVudfV8RSHQEuNWqrCb6xQnF10uvF9AiCzYsCRXvKlhtQvV3c" crossorigin="anonymous"><link rel="preload" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/juliamono.c6034ab4.css" as="style" integrity="sha384-n0za6lUXlyf4XC+nGkZWj3TLDnRbNpAcoi4PZGSlQMPoyqGa9kGY+ZXkUgZGIhQt" crossorigin="anonymous"><link rel="preload" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/vollkorn.089565a8.css" as="style" integrity="sha384-jnV/84VtSgBLF70H+s2rxJcOUZIMDR+X/ElFZA83i9ZtZSWiIMFAgPyrWkOJV08q" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.e82e08bd.css" type="text/css" integrity="sha384-7YN+h8b6N4N65qk8TG/J2KPF95D8z3sGNd06rokz4CX9oWu0KnRAF5cVWu3BkkaN" crossorigin="anonymous"><script data-pluto-file="launch-parameters">
window.pluto_notebook_id = undefined;
window.pluto_isolated_cell_ids = undefined;
window.pluto_notebookfile = "data:text/julia;charset=utf-8;base64,IyMjIEEgUGx1dG8uamwgbm90ZWJvb2sgIyMjCiMgdjAuMTkuMjIKCiM+IGN1c3RvbV9hdHRycyA9IFsiaGlkZS1lbmFibGVkIl0KCnVzaW5nIE1hcmtkb3duCnVzaW5nIEludGVyYWN0aXZlVXRpbHMKCiMgVGhpcyBQbHV0byBub3RlYm9vayB1c2VzIEBiaW5kIGZvciBpbnRlcmFjdGl2aXR5LiBXaGVuIHJ1bm5pbmcgdGhpcyBub3RlYm9vayBvdXRzaWRlIG9mIFBsdXRvLCB0aGUgZm9sbG93aW5nICdtb2NrIHZlcnNpb24nIG9mIEBiaW5kIGdpdmVzIGJvdW5kIHZhcmlhYmxlcyBhIGRlZmF1bHQgdmFsdWUgKGluc3RlYWQgb2YgYW4gZXJyb3IpLgptYWNybyBiaW5kKGRlZiwgZWxlbWVudCkKICAgIHF1b3RlCiAgICAgICAgbG9jYWwgaXYgPSB0cnkgQmFzZS5sb2FkZWRfbW9kdWxlc1tCYXNlLlBrZ0lkKEJhc2UuVVVJRCgiNmU2OTZjNzItNjU0Mi0yMDY3LTcyNjUtNDIyMDZjNzU2MTUwIiksICJBYnN0cmFjdFBsdXRvRGluZ2V0amVzIildLkJvbmRzLmluaXRpYWxfdmFsdWUgY2F0Y2g7IGIgLT4gbWlzc2luZzsgZW5kCiAgICAgICAgbG9jYWwgZWwgPSAkKGVzYyhlbGVtZW50KSkKICAgICAgICBnbG9iYWwgJChlc2MoZGVmKSkgPSBDb3JlLmFwcGxpY2FibGUoQmFzZS5nZXQsIGVsKSA/IEJhc2UuZ2V0KGVsKSA6IGl2KGVsKQogICAgICAgIGVsCiAgICBlbmQKZW5kCgojIOKVlOKVkOKVoSAxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjAKIyDilaDilZDilaEgc2tpcF9hc19zY3JpcHQgPSB0cnVlCiM94pWg4pWQ4pWhCmJlZ2luCglpbXBvcnQgUGtnCglQa2cuYWN0aXZhdGUoQmFzZS5jdXJyZW50X3Byb2plY3QoKSkKCXVzaW5nIFJldmlzZQplbmQKICDilaDilZDilaEgPSMKCiMg4pWU4pWQ4pWhIDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyYwpiZWdpbgoJdXNpbmcgUGx1dG9FeHRyYXMKCXVzaW5nIFBsdXRvRXh0cmFzLlN0cnVjdEJvbmRNb2R1bGUgIyBUaGlzIHN1Ym1vZHVsZSBoYXMgdGhlIGZlYXR1cmVzIGxpc3RlZCBpbiB0aGlzIG5vdGVib29rCgl1c2luZyBQbHV0b1VJCgl1c2luZyBIeXBlcnRleHRMaXRlcmFsCmVuZAoKIyDilZTilZDilaEgOGEyN2FmZTgtMjUzZC00MDkxLWE1OTItYmVhNWQ2ZjJlODM0CgoKIyDilZTilZDilaEgNWZiZDE0MDEtYzdhMS00ZDRmLWIxNmQtYWM5ZDQ1ZTJmZWQ1Cm1kIiIiCiMgUGFja2FnZXMKIiIiCgojIOKVlOKVkOKVoSBjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDMKRXh0ZW5kZWRUYWJsZU9mQ29udGVudHMoKQoKIyDilZTilZDilaEgNWE5YjI3YzMtZGYwMi00MTVjLTg3YmQtMDZlYmQzYzlkMjQ2Cm1kIiIiCiMgU3RydWN0Qm9uZAoiIiIKCiMg4pWU4pWQ4pWhIDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYQptZCIiIgpHZW5lcmF0aW5nIGF1dG9tYXRpYyB3aWRnZXRzIGZvciBjdXN0b20gc3RydWN0cyBpcyBxdWl0ZSBzdHJhaWdodGZvcndhcmQgd2l0aCB0aGUgYWlkIG9mIHRoZSBgQGZpZWxkZGF0YWAgbWFjcm8gYW5kIHRoZSBgU3RydWN0Qm9uZGAgdHlwZS4KClRoZSB0b3AtbGVmdCBhcnJvdyBjYW4gYmUgdXNlZCB0byBzaG93LWhpZGUgdGhlIGZpZWxkIGVsZW1lbnRzICh1c2VmdWwgaW5zaWRlIGEgYEJvbmRUYWJsZWAsIHNob3duIGJlbG93KSwgd2hpbGUgdGhlIGdyZWVuIHRvZ2dsZSBvbiB0aGUgdG9wLXJpZ2h0IGNhbiBiZSB1c2VkIHRvIGRpc2FibGUgdGVtcG9yYXJpbHkgdGhlIHN5bmNoIGJldHdlZW4gdGhlIEpTIHdpZGdldHMgYW5kIHRoZSBib25kIHZhbHVlcyBpbiBQbHV0by4KIiIiCgojIOKVlOKVkOKVoSA5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTcKYmVnaW4KIiIiCglzdHJ1Y3QgQVNECiIiIgpCYXNlLkBrd2RlZiBzdHJ1Y3QgQVNECglhOjpJbnQgCgliOjpJbnQKCWM6OlN0cmluZwoJIlRoaXMgZmllbGQgaXMgX3NwZWNpYWxfIgoJZDo6U3RyaW5nCgllOjpJbnQKZW5kCkBmaWVsZGRhdGEgQVNEIGJlZ2luCglhID0gKG1kIk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgYGBMYVRlWGBgIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQoJYyA9ICgiTm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbiIsIFRleHRGaWVsZCgpKQoJZCA9IFRleHRGaWVsZCgpICMgTm8gZGVzY3JpcHRpb24sIGRlZmF1bHRzIHRvIHRoZSBkb2NzdHJpbmcgc2luY2UgaXQncyBwcmVzZW50CgllID0gU2xpZGVyKDIwOjI1KSAjIE5vIGRlc2NyaXB0aW9uLCBkZWZhdWx0cyB0byB0aGUgZmllbGRuYW1lIGFzIG5vIGRvY3N0cmluZyBpcyBwcmVzZW50CmVuZAphc2RfYm9uZCA9IEBiaW5kIGFzZCBTdHJ1Y3RCb25kKEFTRDsgZGVzY3JpcHRpb24gPSAiQ3VzdG9tIERlc2NyaXB0aW9uIikKZW5kCgojIOKVlOKVkOKVoSAxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODkKYXNkCgojIOKVlOKVkOKVoSA2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2UKbWQiIiIKIyBATlRCb25kCiIiIgoKIyDilZTilZDilaEgOGM4ZmQ1NDktMGFmYy00NDUyLWJkNmEtNjU2NDg2MmExZDYzCm1kIiIiClNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgYFN0cnVjdEJvbmRgIHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiAKClRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gYEBOVEJvbmRgIHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLgoKVGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSBgU3RydWN0Qm9uZGAgd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLgoiIiIKCiMg4pWU4pWQ4pWhIDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NApudF9ib25kID0gQGJpbmQgbnQgQE5UQm9uZCAiTXkgRmFuY3kgTlR1cGxlIiBiZWdpbgoJYSA9ICgiRGVzY3JpcHRpb24iLCBTbGlkZXIoMToxMCkpCgliID0gKG1kIipCb2xkKiBmaWVsZCIsIFNsaWRlcigxOjEwKSkKCWMgPSBTbGlkZXIoMToxMCkgIyBObyBkZXNjcmlwdGlvbiwgZGVmYXVsdHMgdG8gdGhlIG5hbWUgb2YgdGhlIGZpZWxkCmVuZAoKIyDilZTilZDilaEgYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5Cm50CgojIOKVlOKVkOKVoSA4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTUKbWQiIiIKIyBAQm9uZHNMaXN0CiIiIgoKIyDilZTilZDilaEgMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5Cm1kIiIiCkluIHNvbWUgY2FzZXMsIG9uZSBkb2VzIG5vdCB3YW50IHRvIGhhdmUgYSBzaW5nbGUgYm9uZCB3cmFwcGluZyBlaXRoZXIgYSBTdHJ1Y3R1cmUgb3IgYSBOYW1lZFR1cGxlLCBhbmQgc2luZ2xlIGluZGVwZW5kZW50IGJvbmRzIGFyZSBtb3JlIGNvbnZlbmllbnQuCgpgQEJvbmRzTGlzdGAgaXMgYSBjb252ZW5pZW5jZSBtYWNybyB0byBjcmVhdGUgYW4gb2JqZWN0IG9mIHR5cGUgYEJvbmRzTGlzdGAgd2hpY2ggc2ltcGx5IGFsbG93IHRvIGFkZCBhIGRlc2NyaXB0aW9uIHRvIHNlcGFyYXRlIGJvbmRzIGFuZCBncm91cCB0aGVtIGFsbCB0b2dldGhlciBpbiBhIHRhYmxlLWxpa2UgZm9ybWF0IGVxdWl2YWxlbnQgdG8gdGhvc2Ugb2YgYFN0cnVjdEJvbmRgLgoKISEhIG5vdGUKCVVubGlrZSBgU3RydWN0Qm9uZGAsIGEgQm9uZHNMaXN0IGlzIGFscmVhZHkgY29tcG9zZWQgb2YgYm9uZCBjcmVhdGVkIHdpdGggYEBiaW5kYCBhbmQgaXQganVzdCBncm91cHMgdGhlbSB1cCB3aXRoIGEgZGVzY3JpcHRpb24uIFRoZSBvdXRwdXQgb2YgYEBCb25kc0xpc3RgIGlzIG5vdCBzdXBwb3NlZCB0byBiZSBib3VuZCB0byBhIHZhcmlhYmxlIHVzaW5nIGBAYmluZGAuXAoJVGhlIGJvbmRzIGdyb3VwZWQgaW4gYSBCb25kc0xpc3Qgc3RpbGwgYWN0IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseSBmcm9tIG9uZSBhbm90aGVyLgoKU2VlIHRoZSBleGFtcGxlIGJlbG93IGZvciB1bmRlcnN0YW5kaW5nIHRoZSBzeW50aGF4LiBUaGUgaGVhZGVyIG9mIGEgQm9uZHNMaXN0IGlzIHNob3duIGluIGFuIG9yYW5nZSBiYWNrZ3JvdW5kIHRvIGVhc2lseSBkaWZmZXJlbnRpYXRlIGl0IGZyb20gYFN0cnVjdEJvbmRgLgoiIiIKCiMg4pWU4pWQ4pWhIDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZApibCA9IEBCb25kc0xpc3QgIk15IEdyb3VwIG9mIEJvbmRzIiBsZXQgdHYgPSBQbHV0b1VJLkV4cGVyaW1lbnRhbC50cmFuc2Zvcm1lZF92YWx1ZQoJICMgV2UgdXNlIHRyYW5zZm9ybWVkX3ZhbHVlIHRvIHRyYW5zbGF0ZSBHSHogdG8gSHogaW4gdGhlIGJvdW5kIHZhcmlhYmxlIGBmcmVxYAoJIkZyZXF1ZW5jeSBbR0h6XSIgPSBAYmluZCBmcmVxIHR2KHggLT4geCAqIDFlOSwgRWRpdGFibGUoMjA7IHN1ZmZpeCA9ICIgR0h6IikpCgltZCJBbHRpdHVkZSBgYGhgYCBbbV0iID0gQGJpbmQgYWx0IFNjcnViYmFibGUoMTAwOjEwOjIwMCkKZW5kCgojIOKVlOKVkOKVoSA4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDcKZnJlcQoKIyDilZTilZDilaEgOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwCm1kIiIiCiMgUG9wb3V0CiIiIgoKIyDilZTilZDilaEgOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQzCm1kIiIiClRoZSBzdHJ1Y3R1cmVzIGFib3ZlIGNhbiBhbHNvIGJlIHVzZWQgbmVzdGVkIHdpdGhpbiBvbmUgYW5vdGhlci4gVG8gZmFjaWxpdGF0ZSBhY2Nlc3NpbmcgbmVzdGVkIHN0cnVjdHVyZXMsIG9uZSBjYW4gdXNlIHRoZSBgUG9wb3V0YCB0eXBlLgoKSW4gaXRzIHNpbXBsZSBmb3JtLCB5b3UgY2FuIGdpdmUgYW4gaW5zdGFuY2Ugb2YgYSBTdHJ1Y3RCb25kLCBhIGJvbmQgd3JhcHBpbmcgYSBTdHJ1Y3RCb25kIG9yIGEgQm9uZHNMaXN0IGFzIGlucHV0IHRvIFBvcG91dCB0byBjcmVhdGUgYSB0YWJsZSB0aGF0IGlzIGhpZGRlbiBiZWhpbmQgYSBwb3B1cCB3aW5kb3cuCklmIGFuIGluc3RhbmNlIHByZXNlbnQsIGJ1dCB5b3Ugd2FudCBhIGN1c3RvbSB0eXBlIGZvciB3aGljaCB5b3UgaGF2ZSBkZWZpbmVkIGN1c3RvbSBib25kcyBhbmQgZGVzY3JpcHRpb25zIHdpdGggYEBmaWVsZGRhdGFgIHRvIGFwcGVhciBhcyBwb3BvdXQsIHlvdSBjYW4gdXNlIHRoZSBmdW5jdGlvbiBgcG9wb3V0d3JhcChUWVBFKWAgdG8gZ2VuZXJhdGUgYSBzbWFsbCBpY29uIHdoaWNoIGhpZGVzIGEgcG9wdXAgY29udGFpbmluZyB0aGUgYFN0cnVjdEJvbmRgIG9mIHRoZSBwcm92aWRlZCB0eXBlIGBUWVBFYC4KClRoZSBTdHJ1Y3RCb25kIHRhYmxlIGFwcGVhcnMgb24gaG92ZXIgdXBvbiB0aGUgaWNvbiwgY2FuIGJlIG1hZGUgZml4ZWQgYnkgY2xpY2tpbmcgb24gdGhlIGljb24gYW5kIGNhbiB0aGVuIGJlIG1vdmVkIGFyb3VuZCBvciByZXNpemVkLgpBIGRvdWJsZSBjbGljayBvbiB0aGUgaGVhZGVyIG9mIHRoZSBwb3BvdXQgaGlkZXMgaXQgYWdhaW46CiIiIgoKIyDilZTilZDilaEgOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc5CmJlZ2luCkJhc2UuQGt3ZGVmIHN0cnVjdCBMT0wKCWE6OkludCAKCWI6OkludAplbmQKQGZpZWxkZGF0YSBMT0wgYmVnaW4KCWEgPSAobWQiV29uZGVyISIsIFNsaWRlcigxOjEwKSkKCWIgPSAoQGh0bCgiPHNwYW4+RmllbGQgQjwvc3Bhbj4iKSwgU2NydWJiYWJsZSgxOjEwKSkKZW5kCmVuZAoKIyDilZTilZDilaEgNmM1NmMyMDUtYWM3Mi00NTU2LWI5NWUtYjI3OGU0YjNmODIyCnBvcG91dHdyYXAoTE9MKQoKIyDilZTilZDilaEgMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAxCm1kIiIiClRoZSBhYmlsaXR5IHRvIGFsc28gd3JhcCBwcmUtZXhpc3RpbmcgYm9uZHMgYXJvdW5kIFN0cnVjdEJvbmRzIGlzIGNvbnZlbmllbnQgZm9yIG9yZ2FuaXppbmcgdGhlIHZhcmlvdXMgYm9uZHMgb25lIGhhdmUgaW4gYSBgQm9uZHNMaXN0YCBvciBgQm9uZFRhYmxlYAoKQXMgYW4gZXhhbXBsZSwgb25lIGNhbiBjcmVhdGUgYSBgQm9uZHNMaXN0YCBjb250YWluaW5nIHRoZSB0d28gYFN0cnVjdEJvbmRgIGJvbmRzIGdlbmVyYXRlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgbm90ZWJvb2sgd2l0aCB0aGUgZm9sbHdpbmcgY29kZS4KIiIiCgojIOKVlOKVkOKVoSA5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2YKYmxjID0gQEJvbmRzTGlzdCAiUG9wb3V0IENvbnRhaW5lciIgYmVnaW4KCSJTdHJ1Y3R1cmUgQVNEIiA9IFBvcG91dChhc2RfYm9uZCkKCSJOYW1lZFR1cGxlIiA9IFBvcG91dChudF9ib25kKQplbmQKCiMg4pWU4pWQ4pWhIDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOAptZCIiIgojIEJvbmRUYWJsZQoiIiIKCiMg4pWU4pWQ4pWhIGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMQptZCIiIgpUaGUgZmluYWwgY29udmVuaWVuY2Ugc3RydWN0dXJlIHByb3ZpZGVkIGJ5IHRoaXMgbW9kdWxlIGlzIHRoZSBgQm9uZFRhYmxlYC4gSXQgY2FuIGJlIGNyZWF0ZWQgdG8gZ3JvdXAgYSBsaXN0IG9mIGJvbmRzIGluIGEgZmxvYXRpbmcgdGFibGUgdGhhdCBzdGF5cyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBub3RlYm9vayAoc2ltaWxhciB0byB0aGUgVGFibGVPZkNvbnRlbnRzIG9mIFBsdXRvVUkpIGFuZCBjYW4gYmUgbW92ZWQgYXJvdW5kIGFuZCByZXNpemVkIG9yIGhpZGRlbiBmb3IgY29udmVuaWVuY2UuCgpUaGUgQm9uZFRhYmxlIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgZWl0aGVyIHdpdGggYm9uZHMgY29udGFpbmluZyBgU3RydWN0Qm9uZGAgb3Igd2l0aCBgQm9uZHNMaXN0YC4gRnV0dXJlIHR5cGVzIHdpdGggc2ltaWxhciBzdHJ1Y3R1cmUgd2lsbCBhbHNvIGJlIGFkZGVkLgoKSGVyZSBpcyBhbiBleGFtcGxlIG9mIGEgYm9uZHRhYmxlIGNvbnRhaW5pbmcgYWxsIHRoZSBleGFtcGxlcyBvZiB0aGlzIG5vdGVib29rLgoiIiIKCiMg4pWU4pWQ4pWhIDc1ZmM0MGEzLTQyMzEtNDEyNS1iNTJjLWFkMjFmNWI4YTM4OApCb25kVGFibGUoWwoJYXNkX2JvbmQsCgludF9ib25kLAoJYmwsCglibGMKXTsgZGVzY3JpcHRpb24gPSAiTXkgQm9uZHMiKQoKIyDilZTilZDilaEgQ2VsbCBvcmRlcjoKIyDilaDilZAxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjAKIyDilaDilZA4YTI3YWZlOC0yNTNkLTQwOTEtYTU5Mi1iZWE1ZDZmMmU4MzQKIyDilZ/ilIA1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDUKIyDilaDilZA1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmMKIyDilaDilZBjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDMKIyDilZ/ilIA1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDYKIyDilZ/ilIA5ZGE2NTg3NC02MDhhLTRjODQtYTBlNi04MTNjNjI0YzA3YmEKIyDilaDilZA5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTcKIyDilaDilZAxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODkKIyDilZ/ilIA2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2UKIyDilaDilZA4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjMKIyDilaDilZA5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzQKIyDilaDilZBjMTgzZTM4Zi04NGUzLTRhMWYtYTYzMS02ZDFkYjM5ZjExNzkKIyDilZ/ilIA4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTUKIyDilZ/ilIAyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTkKIyDilaDilZA2MDkxY2RmNC1jMGVjLTQ1ZjYtOGFhMC1kNGZhZjY2NjZkMmQKIyDilaDilZA4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDcKIyDilZ/ilIA5YTFiYWEzZC0xNDIwLTQ3M2MtODM4MC1iYjVjMjM4ODFlMDAKIyDilZ/ilIA5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDMKIyDilaDilZA5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzkKIyDilaDilZA2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjIKIyDilZ/ilIAzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDEKIyDilaDilZA5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2YKIyDilZ/ilIAzNzNiYzI0NC0xMTBhLTQzZjgtYWFhMS01MWI1Y2I3NTExMjgKIyDilZ/ilIBiM2ZiMjNiOC04NjUyLTQ2OWItOGQwYy0wYzZjMjcyM2I2MzEKIyDilaDilZA3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODgK";
window.pluto_disable_ui = true;
window.pluto_slider_server_url = undefined;
window.pluto_binder_url = "https://mybinder.org/v2/gh/fonsp/pluto-on-binder/v0.19.22";
window.pluto_statefile = "data:;base64,3gARpWJvbmRzhKNhbHSBpXZhbHVlzJaibnSBpXZhbHVlkZORB5EDkQWjYXNkgaV2YWx1ZZGVkQKRBpGjQVNEkaCRBKRmcmVxgaV2YWx1ZRSsY2VsbF9yZXN1bHRz3gAa2SQ2MDkxY2RmNC1jMGVjLTQ1ZjYtOGFhMC1kNGZhZjY2NjZkMmSKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52iIoPGJvbmRzbGlzdC1jb250YWluZXIgY2xhc3M9J25vLXBvcG91dCc+Cgk8Ym9uZHNsaXN0LWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nY29sbGFwc2UgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nIHRpdGxlPSJUaGlzIGxpc3QgY29udGFpbnMgaW5kZXBlbmRlbnQgYm9uZHMiPk15IEdyb3VwIG9mIEJvbmRzPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgZnJlcWAnPgoJCUZyZXF1ZW5jeSBbR0h6XQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPGJvbmQgZGVmPSJmcmVxIiB1bmlxdWVfaWQ9IlQ2TElFOHpIQVRIUCI+CjxzY3JpcHQ+Cgljb25zdCBkM2Zvcm1hdCA9IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCgljb25zdCBlbHAgPSBodG1sYAoJPHNwYW4gY2xhc3M9Im51bWJlcl9FZGl0YWJsZSIgc3R5bGU9IgoJdG91Y2gtYWN0aW9uOiBub25lOwoJcGFkZGluZzogMGVtIC4yZW07Cglib3JkZXItcmFkaXVzOiAuM2VtOwoJZm9udC13ZWlnaHQ6IGJvbGQ7Ij48c3BhbiBjb250ZW50RWRpdGFibGU9dHJ1ZT4yMDwvc3Bhbj4gR0h6PC9zcGFuPgoJYAoKCWNvbnN0IGZvcm1hdHRlciA9IHMgPT4gZDNmb3JtYXQuZm9ybWF0KCIiKShzKQoJY29uc3QgZWwgPSBlbHAucXVlcnlTZWxlY3Rvcigic3BhbiIpCgoJbGV0IGxvY2FsVmFsID0gcGFyc2VGbG9hdCgyMCkKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcigyMCkKCQoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGVscCwidmFsdWUiLHsKCQlnZXQ6ICgpID0+IGxvY2FsVmFsLAoJCXNldDogeCA9PiB7CgkJCWxvY2FsVmFsID0gcGFyc2VGbG9hdCh4KQoJCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoeCkKCQl9Cgl9KQoKCS8vIEZ1bmN0aW9uIHRvIGJsdXIgdGhlIGVsZW1lbnQgd2hlbiBwcmVzc2luZyBlbnRlciBpbnN0ZWFkIG9mIGFkZGluZyBhIG5ld2xpbmUKCWNvbnN0IG9uRW50ZXIgPSAoZSkgPT4gewoJCWlmIChlLmtleUNvZGUgPT09IDEzKSB7CgkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCWlmIChlbC5pbm5lclRleHQgPT09ICIiKSB7CgkJCWVscC52YWx1ZSA9IDIwICAgCgkJfSBlbHNlIHsKCQkJZWxwLnZhbHVlID0gIGVsLmlubmVyVGV4dAoJCX0KCQllbHAuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgkJZWwuYmx1cigpCgkJfQoJfQoKCWVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywoZSkgPT4gewoJCWNvbnNvbGUubG9nKGUpCgkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKQoJfSkKCglmdW5jdGlvbiBzZWxlY3RUZXh0KGVsKXsKCQl2YXIgc2VsLCByYW5nZTsKCQlpZiAod2luZG93LmdldFNlbGVjdGlvbiAmJiBkb2N1bWVudC5jcmVhdGVSYW5nZSkgeyAvL0Jyb3dzZXIgY29tcGF0aWJpbGl0eQoJCXNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKCQlpZihzZWwudG9TdHJpbmcoKSA9PSAnJyl7IC8vbm8gdGV4dCBzZWxlY3Rpb24KCQkJd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCXJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsgLy9yYW5nZSBvYmplY3QKCQkJCXJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhlbCk7IC8vc2V0cyBSYW5nZQoJCQkJc2VsLnJlbW92ZUFsbFJhbmdlcygpOyAvL3JlbW92ZSBhbGwgcmFuZ2VzIGZyb20gc2VsZWN0aW9uCgkJCQlzZWwuYWRkUmFuZ2UocmFuZ2UpOy8vYWRkIFJhbmdlIHRvIGEgU2VsZWN0aW9uLgoJCQl9LDEpOwoJCX0KCQl9ZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7IC8vb2xkZXIgaWUKCQkJc2VsID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CgkJCWlmKHNlbC50ZXh0ID09ICcnKXsgLy9ubyB0ZXh0IHNlbGVjdGlvbgoJCQkJcmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpOy8vQ3JlYXRlcyBUZXh0UmFuZ2Ugb2JqZWN0CgkJCQlyYW5nZS5tb3ZlVG9FbGVtZW50VGV4dChlbCk7Ly9zZXRzIFJhbmdlCgkJCQlyYW5nZS5zZWxlY3QoKTsgLy9tYWtlIHNlbGVjdGlvbi4KCQkJfQoJCX0KCX0KCgllbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJyxvbkVudGVyKQoJZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKSA9PiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpKSAvLyBtb2RpZnkgdGV4dAoJZWxwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSkgPT4gc2VsZWN0VGV4dChlbCkpIC8vIFNlbGVjdCBhbGwgdGV4dAoKCXJldHVybiBlbHAKCjwvc2NyaXB0Pgo8c3R5bGU+CglAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBsaWdodCkgewoJCXNwYW4ubnVtYmVyX0VkaXRhYmxlIHsKCQkJYmFja2dyb3VuZDogaHNsKDIwNCwgOTUlLCA4NCUpOwoJCX0KCX0KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKCQlzcGFuLm51bWJlcl9FZGl0YWJsZSB7CgkJCWJhY2tncm91bmQ6IGhzbCgyMDQsIDk1JSwgNDAlKTsKCQl9Cgl9Cjwvc3R5bGU+CjwvYm9uZD4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBncmlkOwoJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJfQoJCWJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCgkJYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kLXZhbHVlIGJvbmQgewoJCQlkaXNwbGF5OiBmbGV4OyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJCWJvbmQtdmFsdWUgaW5wdXQgewoJCQl3aWR0aDogMTAwJTsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgo8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYWx0YCc+CgkJPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPkFsdGl0dWRlIDxzcGFuIGNsYXNzPSJ0ZXgiPiRoJDwvc3Bhbj4gJiM5MTttJiM5Mzs8L3A+CjwvZGl2PgoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPGJvbmQgZGVmPSJhbHQiIHVuaXF1ZV9pZD0ib24zZHF1SEZWV1pqIj48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxMDAsIDExMCwgMTIwLCAxMzAsIDE0MCwgMTUwLCAxNjAsIDE3MCwgMTgwLCAxOTAsIDIwMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij4xNTA8L3NwYW4+CmAKCgoKbGV0IG9sZF94ID0gMApsZXQgb2xkX2luZGV4ID0gMApjb25zdCBpbml0aWFsX2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIDE1MCkKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoMTUwKQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L2JvbmQ+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCQoJPC9ib25kc2xpc3QtY29udGVudHM+Cgk8c2NyaXB0IGlkPSdhY2d2ZG9zb2V5Jz4KCQljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb250YWluZXIuY29sbGFwc2UgPSAoZm9yY2UpID0+IHsKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJCX0KCQljb25zdCBjb2xsYXBzZV9idG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi5jb2xsYXBzZScpCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gY29udGFpbmVyLmNvbGxhcHNlKCkKCTwvc2NyaXB0PgoJPHN0eWxlPgoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQlkaXNwbGF5OiBmbGV4OwoJCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CgkJfQkJCgkJYm9uZHNsaXN0LWhlYWRlcjpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJCXRvcDogMHB4OwoJCQlib3R0b206IDBweDsKCQkJbGVmdDogMHB4OwoJCQlyaWdodDogMHB4OwoJCQl6LWluZGV4OiAtMTsKCQkJYmFja2dyb3VuZDogI2ZmYWM0NTQwOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dCA+IGJvbmRzbGlzdC1oZWFkZXIgewoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCXBhZGRpbmctdG9wOiAxMnB4OwoJCQltYXJnaW4tdG9wOiAtMTJweDsKCQkJei1pbmRleDogMTA7CgkJfQoJCWJvbmRzbGlzdC1jb250ZW50cyB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLm5vLXBvcG91dDpiZWZvcmUgewoJCQljb250ZW50OiAnJzsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWp1c3RpZnktc2VsZjogY2VudGVyOwoJCQlib3JkZXItYm90dG9tOiAycHggc29saWQ7CgkJCXBhZGRpbmctdG9wOiA1cHg7CgkJCXdpZHRoOiAxMDAlOwoJCQlhbGlnbi1zZWxmOiBzdGFydDsKCQkJcG9zaXRpb246IHN0aWNreTsKCQkJdG9wOiAwcHg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQkJei1pbmRleDogMjA7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuYm9uZHNsaXN0LWljb24gewoJCQktLXNpemU6IDE3cHg7CgkJCWRpc3BsYXk6IGJsb2NrOwoJCQlhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQliYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQliYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkID4gYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQkJd2lkdGg6IDMwcHg7CgkJCW1hcmdpbjogMCAxMHB4OwoJCX0KCQlib25kc2xpc3QtaGVhZGVyIHsKCQkJZGlzcGxheTogZmxleDsKCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCXdpZHRoOiAxMDAlOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQlmbGV4LWdyb3c6IDE7CgkJCWZvbnQtc2l6ZTogMThweDsKCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewoJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgYm9uZHNsaXN0LWhlYWRlciArICogewoJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIgewoJCQlkaXNwbGF5OiBncmlkOwoJCSAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkgICAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCSAgICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJICAgIHJvdy1nYXA6IDVweDsKCQl9CgkJYm9uZHN0YWJsZS1jb250YWluZXIgYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQkKPC9zdHlsZT4KPC9ib25kc2xpc3QtY29udGFpbmVyPgqkbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlomJssmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQkDS9sL7BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJkuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAV7uybVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaaL88Ym9uZCBkZWY9ImFzZCIgdW5pcXVlX2lkPSJ4dVJWbUJjT2g3SHkiPjxzdHJ1Y3QtYm9uZCBjbGFzcz0nQVNEJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+QVNEPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWJ1cWlkcHFycCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5NYXJrZG93biBkZXNjcmlwdGlvbiwgaW5jbHVkaW5nIDxzcGFuIGNsYXNzPSJ0ZXgiPiRMYVRlWCQ8L3NwYW4+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnJweWlma3hjaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd2cnB5aWZreGNpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidnJweWlma3hjaSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PHNwYW4+RmllbGQgd2l0aCA8Yj5IVE1MPC9iPiBkZXNjcmlwdGlvbjwvc3Bhbj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ25tcW1xem5ibScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNjcmlwdD4KLy8gd2VpcmQgaW1wb3J0IHRvIG1ha2UgaXQgZmFzdGVyLiBUaGUgYGF3YWl0IGltcG9ydGAgY2FuIHN0aWxsIGRlbGF5IGV4ZWN1dGlvbiBieSBvbmUgZnJhbWUgaWYgaXQgaXMgYWxyZWFkeSBsb2FkZWQuLi4Kd2luZG93LmQzZm9ybWF0ID0gd2luZG93LmQzZm9ybWF0ID8/IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCmNvbnN0IGFyZ21pbiA9IHhzID0+IHhzLmluZGV4T2YoTWF0aC5taW4oLi4ueHMpKQpjb25zdCBjbG9zZXN0X2luZGV4ID0gKHhzLCB5KSA9PiBhcmdtaW4oeHMubWFwKHggPT4gTWF0aC5hYnMoeC15KSkpCgpjb25zdCB2YWx1ZXMgPSBbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTBdCgpjb25zdCBlbCA9IGh0bWxgCjxzcGFuIHRpdGxlPSJDbGljayBhbmQgZHJhZyB0aGlzIG51bWJlciBsZWZ0IG9yIHJpZ2h0ISIgc3R5bGU9ImN1cnNvcjogY29sLXJlc2l6ZTsKdG91Y2gtYWN0aW9uOiBub25lOwpiYWNrZ3JvdW5kOiByZ2IoMjUyLCAyMDksIDIwNCk7CmNvbG9yOiBibGFjazsKcGFkZGluZzogMGVtIC4yZW07CmJvcmRlci1yYWRpdXM6IC4zZW07CmZvbnQtd2VpZ2h0OiBib2xkOyI+Njwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgNikKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoNikKCmNvbnN0IG9uU2NydWIgPSAoZSkgPT4gewoJY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRYIC0gb2xkX3gKCWNvbnN0IG5ld19pbmRleCA9IE1hdGgubWluKHZhbHVlcy5sZW5ndGgtMSwgTWF0aC5tYXgoMCwgCgkJTWF0aC5yb3VuZChvZmZzZXQvMTApICsgb2xkX2luZGV4CgkpKQoKCWlmKG5ld19pbmRleCAhPT0gY3VycmVudF9pbmRleCkgewoJCWN1cnJlbnRfaW5kZXggPSBuZXdfaW5kZXgKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgkJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgl9Cn0KCmNvbnN0IG9ucG9pbnRlcmRvd24gPSAoZSkgPT4gewoJd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCkKCW9sZF94ID0gZS5jbGllbnRYCglvbGRfaW5kZXggPSBjdXJyZW50X2luZGV4Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCmNvbnN0IG9uZGJsY2xpY2sgPSAoZSkgPT4gewoJY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCmNvbnN0IG9ucG9pbnRlcnVwID0gKCkgPT4gewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCgplbC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UKCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKfSkKCnJldHVybiBlbAoKPC9zY3JpcHQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nZ25tcW1xem5ibSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImdubXFtcXpuYm0iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPk5vcm1hbCBTdHJpbmcgRGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncXJ2a3hneGhicCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3Fydmt4Z3hoYnAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJxcnZreGd4aGJwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2QnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2QnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGRgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+VGhpcyBmaWVsZCBpcyA8ZW0+c3BlY2lhbDwvZW0+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZCc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnBtd3RxYWhoaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZwbXd0cWFoaGknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cG13dHFhaGhpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2UnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2UnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGVgIj5lPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2UnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J21kbHFkbm9mZXgnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzYnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdtZGxxZG5vZmV4Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibWRscWRub2ZleCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nbHBhc2tnemtwbic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImxwYXNrZ3prcG4iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgYEFTRGAiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FidXFpZHBxcnAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYnVxaWRwcXJwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3p6d3N1eWVua2MnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCS0tc2l6ZTogMTVweDsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlhcHBlYXJhbmNlOiBub25lOwoJCWJhY2tncm91bmQ6ICNjNmM2YzY7CgkJb3V0bGluZTogbm9uZTsKCQlib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCW1hcmdpbjogMCAxMHB4OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKCQliYWNrZ3JvdW5kOiAjNEJEODY1OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICcnOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlib3JkZXItcmFkaXVzOiA1MCU7CgkJdG9wOiAwcHg7CgkJbGVmdDogMHB4OwoJCWJhY2tncm91bmQ6ICNmZmY7CgkJdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwoJCWJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQl0cmFuc2l0aW9uOiAuMXM7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKCQlsZWZ0OiB2YXIoLS1zaXplKQoJfQo8L3N0eWxlPgoKPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nb2hscWZydWxhbic+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIkN1c3RvbSBEZXNjcmlwdGlvbiIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBB2se0kosHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTe5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4IKG3xtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keYWmcHJlZml4o0FTRKhlbGVtZW50c5WSoWGSoTKqdGV4dC9wbGFpbpKhYpKhNqp0ZXh0L3BsYWlukqFjkqUiQVNEIqp0ZXh0L3BsYWlukqFkkqIiIqp0ZXh0L3BsYWlukqFlkqIyM6p0ZXh0L3BsYWlupHR5cGWmc3RydWN0rHByZWZpeF9zaG9ydKNBU0Sob2JqZWN0aWSwZjRmMjRiNzNlM2Q3ZDg2ZqRtaW1l2SFhcHBsaWNhdGlvbi92bmQucGx1dG8udHJlZStvYmplY3Sscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEIKE2cFSwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDE0NDJhMmViLWIzOGItNDc1Ny1iMDJjLTk2YjU5OTA4NDg4OblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lPrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NIqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaSbM8Ym9uZCBkZWY9Im50IiB1bmlxdWVfaWQ9Im9wNUs5eVQzMWcyVyI+PHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyg6YSwgOmIsIDpjKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5NeSBGYW5jeSBOVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdrcWNvb3ltY3dtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6YmtuaXBmeHh5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+RGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ3R6bm1tYWVkbCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdndHpubW1hZWRsJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ3R6bm1tYWVkbCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6YmtuaXBmeHh5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPjxlbT5Cb2xkPC9lbT4gZmllbGQ8L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6Y3Bvb3V3a216JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3pjcG9vdXdrbXonPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ6Y3Bvb3V3a216Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pia25pcGZ4eHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5jPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29rZ3l6YnhjY2EnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nb2tneXpieGNjYSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm9rZ3l6YnhjY2EiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J3pia25pcGZ4eHknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ6YmtuaXBmeHh5Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIGBOYW1lZFR1cGxlYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdrcWNvb3ltY3dtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAia3Fjb295bWN3bSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdvcWhzeGlndGhpJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCWN1cnNvcjogcG9pbnRlcjsKCQktLXNpemU6IDE1cHg7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYXBwZWFyYW5jZTogbm9uZTsKCQliYWNrZ3JvdW5kOiAjYzZjNmM2OwoJCW91dGxpbmU6IG5vbmU7CgkJYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQltYXJnaW46IDAgMTBweDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CgkJYmFja2dyb3VuZDogIzRCRDg2NTsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKCQljb250ZW50OiAnJzsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYm9yZGVyLXJhZGl1czogNTAlOwoJCXRvcDogMHB4OwoJCWxlZnQ6IDBweDsKCQliYWNrZ3JvdW5kOiAjZmZmOwoJCXRyYW5zZm9ybTogc2NhbGUoMS4xKTsKCQlib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJdHJhbnNpdGlvbjogLjFzOwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CgkJbGVmdDogdmFyKC0tc2l6ZSkKCX0KPC9zdHlsZT4KCjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J3poYXhhemdoamknPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJNeSBGYW5jeSBOVHVwbGUiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlp250X2JvbmSybGFzdF9ydW5fdGltZXN0YW1wy0HZBCUgZ/2xsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzS5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4Omz1YtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keYOoZWxlbWVudHOTkqFhkqE3qnRleHQvcGxhaW6SoWKSoTOqdGV4dC9wbGFpbpKhY5KhNap0ZXh0L3BsYWlupHR5cGWqTmFtZWRUdXBsZahvYmplY3RpZLBkNzc1ZWJiN2Q5ODU4NTQzpG1pbWXZIWFwcGxpY2F0aW9uL3ZuZC5wbHV0by50cmVlK29iamVjdKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQlISPSs7BwZXJzaXN0X2pzX3N0YXRlw7doYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWVJtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOGEyN2FmZTgtMjUzZC00MDkxLWE1OTItYmVhNWQ2ZjJlODM0iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keaCkbWltZap0ZXh0L3BsYWlurHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBBrcf8//sHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ4YTI3YWZlOC0yNTNkLTQwOTEtYTU5Mi1iZWE1ZDZmMmU4MzS5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AAXZCtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOGQ5MTIyOTctOTI1ZS00YzhiLTk4YjgtMTliNDNjOWIyOWQ3iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keaYyLjBlMTCkbWltZap0ZXh0L3BsYWlurHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCQNL5hSsHBlcnNpc3RfanNfc3RhdGXDt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDe5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZX61cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTWKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52TA8ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPkBCb25kc0xpc3Q8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEHKbCLIiwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDhhYjJhZjRjLTkyYTItNDI5Zi1iNjQxLTk1YTAyODgwOGFlNblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAD9O61cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ5ZGE2NTg3NC02MDhhLTRjODQtYTBlNi04MTNjNjI0YzA3YmGKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gHTPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPkdlbmVyYXRpbmcgYXV0b21hdGljIHdpZGdldHMgZm9yIGN1c3RvbSBzdHJ1Y3RzIGlzIHF1aXRlIHN0cmFpZ2h0Zm9yd2FyZCB3aXRoIHRoZSBhaWQgb2YgdGhlIDxjb2RlPkBmaWVsZGRhdGE8L2NvZGU+IG1hY3JvIGFuZCB0aGUgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4gdHlwZS48L3A+CjxwPlRoZSB0b3AtbGVmdCBhcnJvdyBjYW4gYmUgdXNlZCB0byBzaG93LWhpZGUgdGhlIGZpZWxkIGVsZW1lbnRzICYjNDA7dXNlZnVsIGluc2lkZSBhIDxjb2RlPkJvbmRUYWJsZTwvY29kZT4sIHNob3duIGJlbG93JiM0MTssIHdoaWxlIHRoZSBncmVlbiB0b2dnbGUgb24gdGhlIHRvcC1yaWdodCBjYW4gYmUgdXNlZCB0byBkaXNhYmxlIHRlbXBvcmFyaWx5IHRoZSBzeW5jaCBiZXR3ZWVuIHRoZSBKUyB3aWRnZXRzIGFuZCB0aGUgYm9uZCB2YWx1ZXMgaW4gUGx1dG8uPC9wPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEIEnCVqOwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAKCWC1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTmKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gQaPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPkluIHNvbWUgY2FzZXMsIG9uZSBkb2VzIG5vdCB3YW50IHRvIGhhdmUgYSBzaW5nbGUgYm9uZCB3cmFwcGluZyBlaXRoZXIgYSBTdHJ1Y3R1cmUgb3IgYSBOYW1lZFR1cGxlLCBhbmQgc2luZ2xlIGluZGVwZW5kZW50IGJvbmRzIGFyZSBtb3JlIGNvbnZlbmllbnQuPC9wPgo8cD48Y29kZT5AQm9uZHNMaXN0PC9jb2RlPiBpcyBhIGNvbnZlbmllbmNlIG1hY3JvIHRvIGNyZWF0ZSBhbiBvYmplY3Qgb2YgdHlwZSA8Y29kZT5Cb25kc0xpc3Q8L2NvZGU+IHdoaWNoIHNpbXBseSBhbGxvdyB0byBhZGQgYSBkZXNjcmlwdGlvbiB0byBzZXBhcmF0ZSBib25kcyBhbmQgZ3JvdXAgdGhlbSBhbGwgdG9nZXRoZXIgaW4gYSB0YWJsZS1saWtlIGZvcm1hdCBlcXVpdmFsZW50IHRvIHRob3NlIG9mIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+LjwvcD4KPGRpdiBjbGFzcz0iYWRtb25pdGlvbiBub3RlIj48cCBjbGFzcz0iYWRtb25pdGlvbi10aXRsZSI+Tm90ZTwvcD48cD5Vbmxpa2UgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4sIGEgQm9uZHNMaXN0IGlzIGFscmVhZHkgY29tcG9zZWQgb2YgYm9uZCBjcmVhdGVkIHdpdGggPGNvZGU+QGJpbmQ8L2NvZGU+IGFuZCBpdCBqdXN0IGdyb3VwcyB0aGVtIHVwIHdpdGggYSBkZXNjcmlwdGlvbi4gVGhlIG91dHB1dCBvZiA8Y29kZT5AQm9uZHNMaXN0PC9jb2RlPiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgYm91bmQgdG8gYSB2YXJpYWJsZSB1c2luZyA8Y29kZT5AYmluZDwvY29kZT4uPGJyIC8+VGhlIGJvbmRzIGdyb3VwZWQgaW4gYSBCb25kc0xpc3Qgc3RpbGwgYWN0IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseSBmcm9tIG9uZSBhbm90aGVyLjwvcD4KPC9kaXY+CjxwPlNlZSB0aGUgZXhhbXBsZSBiZWxvdyBmb3IgdW5kZXJzdGFuZGluZyB0aGUgc3ludGhheC4gVGhlIGhlYWRlciBvZiBhIEJvbmRzTGlzdCBpcyBzaG93biBpbiBhbiBvcmFuZ2UgYmFja2dyb3VuZCB0byBlYXNpbHkgZGlmZmVyZW50aWF0ZSBpdCBmcm9tIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+LjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBB/61RJqsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTm5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ACdrJtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedksPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5Qb3BvdXQ8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEIDYMVFCwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDlhMWJhYTNkLTE0MjAtNDczYy04MzgwLWJiNWMyMzg4MWUwMLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAG5Yu1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmOKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5oKRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEGtqn+SuwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAWTnu1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjOKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gHsPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4gdG8gc2ltcGx5IGNyZWF0ZSBhcmJpdHJhcnkgTmFtZWRUdXBsZXMuIDwvcD4KPHA+VGhpcyBpcyBwb3NzaWJsZSB3aXRoIHRoZSBjb252ZW5pZW5jZSBtYWNybyA8Y29kZT5ATlRCb25kPC9jb2RlPiB3aGljaCBjYW4gYmUgY2FsbGVkIGFzIHNob3duIGJlbG93IHRvIGNyZWF0ZSBhIG5pY2UgZGlzcGxheSBmb3IgYW4gaW50ZXJhY3RpdmUgYm9uZCBjcmVhdGluZyBhbiBhcmJpdHJhcnkgTmFtZWRUdXBsZS48L3A+CjxwPlRoZSBtYWNybyBzaW1wbHkgY3JlYXRlIGEgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4gd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBByAsI7rsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjO5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AC21otXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAxiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedoBgzxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGUgYWJpbGl0eSB0byBhbHNvIHdyYXAgcHJlLWV4aXN0aW5nIGJvbmRzIGFyb3VuZCBTdHJ1Y3RCb25kcyBpcyBjb252ZW5pZW50IGZvciBvcmdhbml6aW5nIHRoZSB2YXJpb3VzIGJvbmRzIG9uZSBoYXZlIGluIGEgPGNvZGU+Qm9uZHNMaXN0PC9jb2RlPiBvciA8Y29kZT5Cb25kVGFibGU8L2NvZGU+PC9wPgo8cD5BcyBhbiBleGFtcGxlLCBvbmUgY2FuIGNyZWF0ZSBhIDxjb2RlPkJvbmRzTGlzdDwvY29kZT4gY29udGFpbmluZyB0aGUgdHdvIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IGJvbmRzIGdlbmVyYXRlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgbm90ZWJvb2sgd2l0aCB0aGUgZm9sbHdpbmcgY29kZS48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQjvTz7wrBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAxuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAYMbrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDkzMjU1YzI0LWQ0ODYtNDE2ZC1hZWZjLTc1NzVmZWZmNzU0M4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaA5g8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+VGhlIHN0cnVjdHVyZXMgYWJvdmUgY2FuIGFsc28gYmUgdXNlZCBuZXN0ZWQgd2l0aGluIG9uZSBhbm90aGVyLiBUbyBmYWNpbGl0YXRlIGFjY2Vzc2luZyBuZXN0ZWQgc3RydWN0dXJlcywgb25lIGNhbiB1c2UgdGhlIDxjb2RlPlBvcG91dDwvY29kZT4gdHlwZS48L3A+CjxwPkluIGl0cyBzaW1wbGUgZm9ybSwgeW91IGNhbiBnaXZlIGFuIGluc3RhbmNlIG9mIGEgU3RydWN0Qm9uZCwgYSBib25kIHdyYXBwaW5nIGEgU3RydWN0Qm9uZCBvciBhIEJvbmRzTGlzdCBhcyBpbnB1dCB0byBQb3BvdXQgdG8gY3JlYXRlIGEgdGFibGUgdGhhdCBpcyBoaWRkZW4gYmVoaW5kIGEgcG9wdXAgd2luZG93LiBJZiBhbiBpbnN0YW5jZSBwcmVzZW50LCBidXQgeW91IHdhbnQgYSBjdXN0b20gdHlwZSBmb3Igd2hpY2ggeW91IGhhdmUgZGVmaW5lZCBjdXN0b20gYm9uZHMgYW5kIGRlc2NyaXB0aW9ucyB3aXRoIDxjb2RlPkBmaWVsZGRhdGE8L2NvZGU+IHRvIGFwcGVhciBhcyBwb3BvdXQsIHlvdSBjYW4gdXNlIHRoZSBmdW5jdGlvbiA8Y29kZT5wb3BvdXR3cmFwJiM0MDtUWVBFJiM0MTs8L2NvZGU+IHRvIGdlbmVyYXRlIGEgc21hbGwgaWNvbiB3aGljaCBoaWRlcyBhIHBvcHVwIGNvbnRhaW5pbmcgdGhlIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IG9mIHRoZSBwcm92aWRlZCB0eXBlIDxjb2RlPlRZUEU8L2NvZGU+LjwvcD4KPHA+VGhlIFN0cnVjdEJvbmQgdGFibGUgYXBwZWFycyBvbiBob3ZlciB1cG9uIHRoZSBpY29uLCBjYW4gYmUgbWFkZSBmaXhlZCBieSBjbGlja2luZyBvbiB0aGUgaWNvbiBhbmQgY2FuIHRoZW4gYmUgbW92ZWQgYXJvdW5kIG9yIHJlc2l6ZWQuIEEgZG91YmxlIGNsaWNrIG9uIHRoZSBoZWFkZXIgb2YgdGhlIHBvcG91dCBoaWRlcyBpdCBhZ2Fpbjo8L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQjzzyC5LBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQzuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAfwC7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDZjNTZjMjA1LWFjNzItNDU1Ni1iOTVlLWIyNzhlNGIzZjgyMoqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaXbs8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cG9wb3V0LWNvbnRhaW5lciBrZXk9J3pxeHFkd2JqaHUnPgoJPHBvcG91dC1oZWFkZXI+PHNwYW4gY2xhc3M9J3BvcG91dC1pY29uIHBvcG91dCc+PC9zcGFuPjwvcG9wb3V0LWhlYWRlcj4KCTxwb3BvdXQtY29udGVudHM+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWF6Y3pjaG16aCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHN0cnVjdC1ib25kIGNsYXNzPSdNYWluLnZhciZxdW90O3dvcmtzcGFjZSMxNzImcXVvdDsuTE9MJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TE9MPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0naWppZW11YXZkYycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXV6Y3RpcXV0aCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5Xb25kZXImIzMzOzwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2Jpdnd3aXpidnMnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYml2d3dpemJ2cyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImJpdnd3aXpidnMiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXV6Y3RpcXV0aCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYic+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYicgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYmAiPjxzcGFuPkZpZWxkIEI8L3NwYW4+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2InPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FpdGhicnBjem8nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzY3JpcHQ+Ci8vIHdlaXJkIGltcG9ydCB0byBtYWtlIGl0IGZhc3Rlci4gVGhlIGBhd2FpdCBpbXBvcnRgIGNhbiBzdGlsbCBkZWxheSBleGVjdXRpb24gYnkgb25lIGZyYW1lIGlmIGl0IGlzIGFscmVhZHkgbG9hZGVkLi4uCndpbmRvdy5kM2Zvcm1hdCA9IHdpbmRvdy5kM2Zvcm1hdCA/PyBhd2FpdCBpbXBvcnQoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9ybWF0QDIvK2VzbSIpCgpjb25zdCBhcmdtaW4gPSB4cyA9PiB4cy5pbmRleE9mKE1hdGgubWluKC4uLnhzKSkKY29uc3QgY2xvc2VzdF9pbmRleCA9ICh4cywgeSkgPT4gYXJnbWluKHhzLm1hcCh4ID0+IE1hdGguYWJzKHgteSkpKQoKY29uc3QgdmFsdWVzID0gWzEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwXQoKY29uc3QgZWwgPSBodG1sYAo8c3BhbiB0aXRsZT0iQ2xpY2sgYW5kIGRyYWcgdGhpcyBudW1iZXIgbGVmdCBvciByaWdodCEiIHN0eWxlPSJjdXJzb3I6IGNvbC1yZXNpemU7CnRvdWNoLWFjdGlvbjogbm9uZTsKYmFja2dyb3VuZDogcmdiKDI1MiwgMjA5LCAyMDQpOwpjb2xvcjogYmxhY2s7CnBhZGRpbmc6IDBlbSAuMmVtOwpib3JkZXItcmFkaXVzOiAuM2VtOwpmb250LXdlaWdodDogYm9sZDsiPjY8L3NwYW4+CmAKCgoKbGV0IG9sZF94ID0gMApsZXQgb2xkX2luZGV4ID0gMApjb25zdCBpbml0aWFsX2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIDYpCmxldCBjdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoKY29uc3QgZm9ybWF0dGVyID0gcyA9PiAiIiArIGQzZm9ybWF0LmZvcm1hdCgiIikocykgKyAiIgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbCwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXNbY3VycmVudF9pbmRleF0sCglzZXQ6IHggPT4gewoJCWN1cnJlbnRfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgeCkKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgl9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCi8vIGluaXRpYWwgdmFsdWUKZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKDYpCgpjb25zdCBvblNjcnViID0gKGUpID0+IHsKCWNvbnN0IG9mZnNldCA9IGUuY2xpZW50WCAtIG9sZF94Cgljb25zdCBuZXdfaW5kZXggPSBNYXRoLm1pbih2YWx1ZXMubGVuZ3RoLTEsIE1hdGgubWF4KDAsIAoJCU1hdGgucm91bmQob2Zmc2V0LzEwKSArIG9sZF9pbmRleAoJKSkKCglpZihuZXdfaW5kZXggIT09IGN1cnJlbnRfaW5kZXgpIHsKCQljdXJyZW50X2luZGV4ID0gbmV3X2luZGV4CgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQoJfQp9Cgpjb25zdCBvbnBvaW50ZXJkb3duID0gKGUpID0+IHsKCXdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpCglvbGRfeCA9IGUuY2xpZW50WAoJb2xkX2luZGV4ID0gY3VycmVudF9pbmRleAoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQplbC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgpjb25zdCBvbmRibGNsaWNrID0gKGUpID0+IHsKCWN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4CgllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKfQplbC5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgpjb25zdCBvbnBvaW50ZXJ1cCA9ICgpID0+IHsKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0Kd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQoKZWwub25zZWxlY3RzdGFydCA9ICgpID0+IGZhbHNlCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCn0pCgpyZXR1cm4gZWwKCjwvc2NyaXB0PjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FpdGhicnBjem8nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhaXRoYnJwY3pvIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdtdXpjdGlxdXRoJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibXV6Y3RpcXV0aCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgTE9MYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0naWppZW11YXZkYyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImlqaWVtdWF2ZGMiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nc2FiYWN6ZmVqbyc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdmYWpsYm9xd2tjJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTE9MIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCWJvbmQgPiBzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSd6cXhxZHdiamh1Jz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogMTBweDsKCQlqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCX0KCXBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogbm9uZTsKCQl3aWR0aDogNDAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nOiA4cHg7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKIAlwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogYmxvY2s7CgkJcG9zaXRpb246IGZpeGVkOwoJCXotaW5kZXg6IDUwMDsKCX0KCXBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKCQlib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwoJfQoJLnBvcG91dC1pY29uIHsKCQktLXNpemU6IDIwcHg7CgkgICAgZGlzcGxheTogYmxvY2s7CgkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQltaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJfQoJLnBvcG91dC1pY29uLnBvcG91dCB7CQoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCXVzZXItc2VsZWN0OiBub25lOwoJfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSdhYXpjemNobXpoJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWF6Y3pjaG16aCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCQhZ677sHBlcnNpc3RfanNfc3RhdGXDt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjK5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4EP4n5tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNjVhM2VkOGUtNjIwNC00YWVlLWFkZmMtYmVmZTllYTUxNTNliqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedktPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5ATlRCb25kPC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBBwoh+mFsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2W5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AA/gftXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwiqZxdWV1ZWTCpGxvZ3ORiKRsaW5l/6Ntc2eS2U0bWzMybRtbMW0gIEFjdGl2YXRpbmcbWzIybRtbMzltIHByb2plY3QgYXQgYH4vUmVwb3MvZ2l0aHViL21pbmUvUGx1dG9FeHRyYXNgCqp0ZXh0L3BsYWlup2NlbGxfaWTZJDFmZmM2NDg5LTZhM2QtNGJkMS05NGU1LTRhODQzYjYxNGIyMKZrd2FyZ3OQomlkuU1haW5fUGx1dG9SdW5uZXJfMzA0M2RiOGOkZmlsZdlEL2hvbWUvYW1lbmdhbGkvLmp1bGlhL3BhY2thZ2VzL1BsdXRvL1pCb2pSL3NyYy9ydW5uZXIvUGx1dG9SdW5uZXIuamylZ3JvdXCrUGx1dG9SdW5uZXKlbGV2ZWyuTG9nTGV2ZWwoLTU1NSmncnVubmluZ8Kmb3V0cHV0hqRib2R5oKRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEGtqm14iwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDFmZmM2NDg5LTZhM2QtNGJkMS05NGU1LTRhODQzYjYxNGIyMLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgG6Jva1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPDp2Vycm9yZWTC2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDWKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52S48ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPlBhY2thZ2VzPC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBBrbW4v0sHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDW5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AA+CXtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc5iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keaCkbWltZap0ZXh0L3BsYWlurHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBCQhRjcRsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzm5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AX2/xtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNWE5YjI3YzMtZGYwMi00MTVjLTg3YmQtMDZlYmQzYzlkMjQ2iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedkwPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5TdHJ1Y3RCb25kPC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBBeo4j9XsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDa5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ASjA3tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMzczYmMyNDQtMTEwYS00M2Y4LWFhYTEtNTFiNWNiNzUxMTI4iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedkvPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5Cb25kVGFibGU8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEI9QCOqOwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAEkfS1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SRiM2ZiMjNiOC04NjUyLTQ2OWItOGQwYy0wYzZjMjcyM2I2MzGKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gJoPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlRoZSBmaW5hbCBjb252ZW5pZW5jZSBzdHJ1Y3R1cmUgcHJvdmlkZWQgYnkgdGhpcyBtb2R1bGUgaXMgdGhlIDxjb2RlPkJvbmRUYWJsZTwvY29kZT4uIEl0IGNhbiBiZSBjcmVhdGVkIHRvIGdyb3VwIGEgbGlzdCBvZiBib25kcyBpbiBhIGZsb2F0aW5nIHRhYmxlIHRoYXQgc3RheXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgbm90ZWJvb2sgJiM0MDtzaW1pbGFyIHRvIHRoZSBUYWJsZU9mQ29udGVudHMgb2YgUGx1dG9VSSYjNDE7IGFuZCBjYW4gYmUgbW92ZWQgYXJvdW5kIGFuZCByZXNpemVkIG9yIGhpZGRlbiBmb3IgY29udmVuaWVuY2UuPC9wPgo8cD5UaGUgQm9uZFRhYmxlIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgZWl0aGVyIHdpdGggYm9uZHMgY29udGFpbmluZyA8Y29kZT5TdHJ1Y3RCb25kPC9jb2RlPiBvciB3aXRoIDxjb2RlPkJvbmRzTGlzdDwvY29kZT4uIEZ1dHVyZSB0eXBlcyB3aXRoIHNpbWlsYXIgc3RydWN0dXJlIHdpbGwgYWxzbyBiZSBhZGRlZC48L3A+CjxwPkhlcmUgaXMgYW4gZXhhbXBsZSBvZiBhIGJvbmR0YWJsZSBjb250YWluaW5nIGFsbCB0aGUgZXhhbXBsZXMgb2YgdGhpcyBub3RlYm9vay48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQkBp16HLBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkYjNmYjIzYjgtODY1Mi00NjliLThkMGMtMGM2YzI3MjNiNjMxuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAcezbVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZoqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHna9KY8Ym9uZHNsaXN0LWNvbnRhaW5lciBjbGFzcz0nbm8tcG9wb3V0Jz4KCTxib25kc2xpc3QtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdjb2xsYXBzZSBib25kc2xpc3QtaWNvbic+PC9zcGFuPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbicgdGl0bGU9IlRoaXMgbGlzdCBjb250YWlucyBpbmRlcGVuZGVudCBib25kcyI+UG9wb3V0IENvbnRhaW5lcjwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0ndG9nZ2xlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+Cgk8L2JvbmRzbGlzdC1oZWFkZXI+Cgk8Ym9uZHNsaXN0LWNvbnRlbnRzPgoJPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYGFzZGAnPgoJCVN0cnVjdHVyZSBBU0QKCTwvYm9uZC1kZXNjcmlwdGlvbj4KCTxib25kLXZhbHVlPgoJCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwb3BvdXQtY29udGFpbmVyIGtleT0ndXlsY2hmbGhheic+Cgk8cG9wb3V0LWhlYWRlcj48c3BhbiBjbGFzcz0ncG9wb3V0LWljb24gcG9wb3V0Jz48L3NwYW4+PC9wb3BvdXQtaGVhZGVyPgoJPHBvcG91dC1jb250ZW50cz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdndmNtbm9jdWd3JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48Ym9uZCBkZWY9ImFzZCIgdW5pcXVlX2lkPSJ4dVJWbUJjT2g3SHkiPjxzdHJ1Y3QtYm9uZCBjbGFzcz0nTWFpbi52YXImcXVvdDt3b3Jrc3BhY2UjNzEmcXVvdDsuQVNEJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+QVNEPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWJ1cWlkcHFycCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5NYXJrZG93biBkZXNjcmlwdGlvbiwgaW5jbHVkaW5nIDxzcGFuIGNsYXNzPSJ0ZXgiPiRMYVRlWCQ8L3NwYW4+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnJweWlma3hjaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd2cnB5aWZreGNpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidnJweWlma3hjaSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PHNwYW4+RmllbGQgd2l0aCA8Yj5IVE1MPC9iPiBkZXNjcmlwdGlvbjwvc3Bhbj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ25tcW1xem5ibScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNjcmlwdD4KLy8gd2VpcmQgaW1wb3J0IHRvIG1ha2UgaXQgZmFzdGVyLiBUaGUgYGF3YWl0IGltcG9ydGAgY2FuIHN0aWxsIGRlbGF5IGV4ZWN1dGlvbiBieSBvbmUgZnJhbWUgaWYgaXQgaXMgYWxyZWFkeSBsb2FkZWQuLi4Kd2luZG93LmQzZm9ybWF0ID0gd2luZG93LmQzZm9ybWF0ID8/IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCmNvbnN0IGFyZ21pbiA9IHhzID0+IHhzLmluZGV4T2YoTWF0aC5taW4oLi4ueHMpKQpjb25zdCBjbG9zZXN0X2luZGV4ID0gKHhzLCB5KSA9PiBhcmdtaW4oeHMubWFwKHggPT4gTWF0aC5hYnMoeC15KSkpCgpjb25zdCB2YWx1ZXMgPSBbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTBdCgpjb25zdCBlbCA9IGh0bWxgCjxzcGFuIHRpdGxlPSJDbGljayBhbmQgZHJhZyB0aGlzIG51bWJlciBsZWZ0IG9yIHJpZ2h0ISIgc3R5bGU9ImN1cnNvcjogY29sLXJlc2l6ZTsKdG91Y2gtYWN0aW9uOiBub25lOwpiYWNrZ3JvdW5kOiByZ2IoMjUyLCAyMDksIDIwNCk7CmNvbG9yOiBibGFjazsKcGFkZGluZzogMGVtIC4yZW07CmJvcmRlci1yYWRpdXM6IC4zZW07CmZvbnQtd2VpZ2h0OiBib2xkOyI+Njwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgNikKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoNikKCmNvbnN0IG9uU2NydWIgPSAoZSkgPT4gewoJY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRYIC0gb2xkX3gKCWNvbnN0IG5ld19pbmRleCA9IE1hdGgubWluKHZhbHVlcy5sZW5ndGgtMSwgTWF0aC5tYXgoMCwgCgkJTWF0aC5yb3VuZChvZmZzZXQvMTApICsgb2xkX2luZGV4CgkpKQoKCWlmKG5ld19pbmRleCAhPT0gY3VycmVudF9pbmRleCkgewoJCWN1cnJlbnRfaW5kZXggPSBuZXdfaW5kZXgKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgkJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgl9Cn0KCmNvbnN0IG9ucG9pbnRlcmRvd24gPSAoZSkgPT4gewoJd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCkKCW9sZF94ID0gZS5jbGllbnRYCglvbGRfaW5kZXggPSBjdXJyZW50X2luZGV4Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCmNvbnN0IG9uZGJsY2xpY2sgPSAoZSkgPT4gewoJY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCmNvbnN0IG9ucG9pbnRlcnVwID0gKCkgPT4gewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCgplbC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UKCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKfSkKCnJldHVybiBlbAoKPC9zY3JpcHQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nZ25tcW1xem5ibSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImdubXFtcXpuYm0iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPk5vcm1hbCBTdHJpbmcgRGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncXJ2a3hneGhicCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3Fydmt4Z3hoYnAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJxcnZreGd4aGJwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2QnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2QnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGRgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+VGhpcyBmaWVsZCBpcyA8ZW0+c3BlY2lhbDwvZW0+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZCc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnBtd3RxYWhoaScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZwbXd0cWFoaGknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cG13dHFhaGhpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2UnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2UnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGVgIj5lPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2UnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J21kbHFkbm9mZXgnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzYnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdtZGxxZG5vZmV4Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibWRscWRub2ZleCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nbHBhc2tnemtwbic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImxwYXNrZ3prcG4iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgYEFTRGAiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FidXFpZHBxcnAnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYnVxaWRwcXJwIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3p6d3N1eWVua2MnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCS0tc2l6ZTogMTVweDsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlhcHBlYXJhbmNlOiBub25lOwoJCWJhY2tncm91bmQ6ICNjNmM2YzY7CgkJb3V0bGluZTogbm9uZTsKCQlib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCW1hcmdpbjogMCAxMHB4OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKCQliYWNrZ3JvdW5kOiAjNEJEODY1OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICcnOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlib3JkZXItcmFkaXVzOiA1MCU7CgkJdG9wOiAwcHg7CgkJbGVmdDogMHB4OwoJCWJhY2tncm91bmQ6ICNmZmY7CgkJdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwoJCWJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQl0cmFuc2l0aW9uOiAuMXM7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKCQlsZWZ0OiB2YXIoLS1zaXplKQoJfQo8L3N0eWxlPgoKPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nb2hscWZydWxhbic+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIkN1c3RvbSBEZXNjcmlwdGlvbiIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQlzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9ib25kPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9wb3BvdXQtY29udGVudHM+CjwvcG9wb3V0LWNvbnRhaW5lcj4KPHNjcmlwdCBpZD0ndXlsY2hmbGhheic+CgkvLyBMb2FkIHRoZSBmbG9hdGluZy11aSBhbmQgaW50ZXJhY3QgbGlicmFyaWVzCgl3aW5kb3cuZmxvYXRpbmdfdWkgPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL0BmbG9hdGluZy11aS9kb20nKQoKCWNvbnN0IHsgY29tcHV0ZVBvc2l0aW9uLCBhdXRvUGxhY2VtZW50IH0gPSBmbG9hdGluZ191aQoJCgljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCWNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZAoJY29uc3QgY29udGVudHMgPSBjb250YWluZXIubGFzdEVsZW1lbnRDaGlsZAoKCS8vIExvYWQgdGhlIGludGVyYWN0anMgcGFydAoJCgkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewoJCWRpc3BsYXk6IGZsZXg7CgkJYm9yZGVyOiAzcHggZGFzaGVkIHRyYW5zcGFyZW50OwoJCWJvcmRlci1yYWRpdXM6IDEwcHg7CgkJanVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cgl9Cglwb3BvdXQtY29udGVudHMgewoJCWRpc3BsYXk6IG5vbmU7CgkJd2lkdGg6IDQwMHB4OwoJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIAlib3JkZXI6IDNweCBzb2xpZCB2YXIoLS1vdmVybGF5LWJ1dHRvbi1ib3JkZXIpOwogICAgCWJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAJcGFkZGluZzogOHB4OwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgPiBwb3BvdXQtY29udGVudHMsCiAJcG9wb3V0LWNvbnRhaW5lci5oZWFkZXItaG92ZXIgPiBwb3BvdXQtY29udGVudHMgewoJCWRpc3BsYXk6IGJsb2NrOwoJCXBvc2l0aW9uOiBmaXhlZDsKCQl6LWluZGV4OiA1MDA7Cgl9Cglwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CgkJYm9yZGVyLWNvbG9yOiB2YXIoLS1wbHV0by1sb2dzLXdhcm4tYWNjZW50LWNvbG9yKTsKCX0KCS5wb3BvdXQtaWNvbiB7CgkJLS1zaXplOiAyMHB4OwoJICAgIGRpc3BsYXk6IGJsb2NrOwoJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJbWluLWhlaWdodDogdmFyKC0tc2l6ZSk7CgkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCX0KCS5wb3BvdXQtaWNvbi5wb3BvdXQgewkKCSAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIC5wb3BvdXQgewoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCXRvdWNoLWFjdGlvbjogbm9uZTsKCQl1c2VyLXNlbGVjdDogbm9uZTsKCX0KPC9zdHlsZT4KPHNjcmlwdCBpZD0nZ3ZjbW5vY3Vndyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImd2Y21ub2N1Z3ciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQl9CgkJYm9uZHRhYmxlLWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiwKCQlib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmQtdmFsdWUgYm9uZCB7CgkJCWRpc3BsYXk6IGZsZXg7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9CgkJYm9uZC12YWx1ZSBpbnB1dCB7CgkJCXdpZHRoOiAxMDAlOyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+Cjxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBudGAnPgoJCU5hbWVkVHVwbGUKCTwvYm9uZC1kZXNjcmlwdGlvbj4KCTxib25kLXZhbHVlPgoJCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwb3BvdXQtY29udGFpbmVyIGtleT0ncnBudWN6YWlpdCc+Cgk8cG9wb3V0LWhlYWRlcj48c3BhbiBjbGFzcz0ncG9wb3V0LWljb24gcG9wb3V0Jz48L3NwYW4+PC9wb3BvdXQtaGVhZGVyPgoJPHBvcG91dC1jb250ZW50cz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdnb2Fyd21qcGhsJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48Ym9uZCBkZWY9Im50IiB1bmlxdWVfaWQ9Im9wNUs5eVQzMWcyVyI+PHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyg6YSwgOmIsIDpjKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5NeSBGYW5jeSBOVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdrcWNvb3ltY3dtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6YmtuaXBmeHh5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+RGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ3R6bm1tYWVkbCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdndHpubW1hZWRsJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ3R6bm1tYWVkbCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6YmtuaXBmeHh5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPjxlbT5Cb2xkPC9lbT4gZmllbGQ8L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6Y3Bvb3V3a216JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3pjcG9vdXdrbXonPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ6Y3Bvb3V3a216Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pia25pcGZ4eHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5jPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29rZ3l6YnhjY2EnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nb2tneXpieGNjYSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm9rZ3l6YnhjY2EiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J3pia25pcGZ4eHknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ6YmtuaXBmeHh5Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIGBOYW1lZFR1cGxlYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdrcWNvb3ltY3dtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAia3Fjb295bWN3bSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdvcWhzeGlndGhpJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCWN1cnNvcjogcG9pbnRlcjsKCQktLXNpemU6IDE1cHg7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYXBwZWFyYW5jZTogbm9uZTsKCQliYWNrZ3JvdW5kOiAjYzZjNmM2OwoJCW91dGxpbmU6IG5vbmU7CgkJYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQltYXJnaW46IDAgMTBweDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CgkJYmFja2dyb3VuZDogIzRCRDg2NTsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKCQljb250ZW50OiAnJzsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYm9yZGVyLXJhZGl1czogNTAlOwoJCXRvcDogMHB4OwoJCWxlZnQ6IDBweDsKCQliYWNrZ3JvdW5kOiAjZmZmOwoJCXRyYW5zZm9ybTogc2NhbGUoMS4xKTsKCQlib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJdHJhbnNpdGlvbjogLjFzOwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CgkJbGVmdDogdmFyKC0tc2l6ZSkKCX0KPC9zdHlsZT4KCjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J3poYXhhemdoamknPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJNeSBGYW5jeSBOVHVwbGUiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J3JwbnVjemFpaXQnPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQoJLy8gV2UgdXNlIHRoZSBpbnRlcmFjdGpzIGxpYnJhcnkgdG8gcHJvdmlkZSBkcmFnIGFuZCByZXNpemUgaGFuZGxpbmcgYWNyb3NzIGRldmljZXMKCWNvbnN0IHsgZGVmYXVsdDogaW50ZXJhY3QgfSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvaW50ZXJhY3RqcycpCgoJY29udGVudHMub2Zmc2V0ID0gY29udGVudHMub2Zmc2V0ID8/IHsgeDogMCwgeTogMH0KCWNvbnN0IHN0YXJ0UG9zaXRpb24gPSB7eDogMCwgeTogMH0KCWludGVyYWN0KGNvbnRlbnRzLnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAuZGVzY3JpcHRpb24sIGJvbmRzbGlzdC1oZWFkZXIgLmRlc2NyaXB0aW9uJykpLmRyYWdnYWJsZSh7CgkJbGlzdGVuZXJzOiB7CgkJCXN0YXJ0IChldmVudCkgewoJCQkJY29udGVudHMub2Zmc2V0LnkgPSBzdGFydFBvc2l0aW9uLnkgPSBjb250ZW50cy5vZmZzZXRUb3AKCQkJCWNvbnRlbnRzLm9mZnNldC54ID0gc3RhcnRQb3NpdGlvbi54ID0gY29udGVudHMub2Zmc2V0TGVmdAoJCQl9LAoJCQltb3ZlIChldmVudCkgewoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC54ICs9IGV2ZW50LmR4CgkJICAgICAgY29udGVudHMub2Zmc2V0LnkgKz0gZXZlbnQuZHkKCQkKCQkgICAgICBjb250ZW50cy5zdHlsZS50b3AgPSBgbWluKDk1dmgsICR7Y29udGVudHMub2Zmc2V0Lnl9cHhgCgkJICAgICAgY29udGVudHMuc3R5bGUubGVmdCA9IGBtaW4oOTV2dywgJHtjb250ZW50cy5vZmZzZXQueH1weGAKCQkgICAgfSwKCQl9Cgl9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIGhlYWRlciByZXNldCB0aGUgcG9zaXRpb24KCQljb250YWluZXIucG9wb3V0KCkKCX0pCglpbnRlcmFjdChjb250ZW50cykKCSAgLnJlc2l6YWJsZSh7CgkgICAgZWRnZXM6IHsgdG9wOiB0cnVlLCBsZWZ0OiBmYWxzZSwgYm90dG9tOiB0cnVlLCByaWdodDogdHJ1ZSB9LAoJICAgIGxpc3RlbmVyczogewoJICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CQkKCSAgICAgICAgT2JqZWN0LmFzc2lnbihldmVudC50YXJnZXQuc3R5bGUsIHsKCSAgICAgICAgICB3aWR0aDogYCR7ZXZlbnQucmVjdC53aWR0aH1weGAsCgkgICAgICAgICAgaGVpZ2h0OiBgJHtldmVudC5yZWN0LmhlaWdodH1weGAsCgkgICAgICAgIH0pCgkgICAgICB9CgkgICAgfQoJICB9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIHJlc2l6ZSByZXNldCB0aGUgd2lkdGgKCQkJY29udGVudHMuc3R5bGUud2lkdGggPSAnJwoJCSAgCWNvbnRlbnRzLnN0eWxlLmhlaWdodCA9ICcnCgkgIH0pCgoKCWZ1bmN0aW9uIHBvc2l0aW9uQ29udGVudHMoKSB7CgkJY29tcHV0ZVBvc2l0aW9uKGhlYWRlciwgY29udGVudHMsIHsKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJCW1pZGRsZXdhcmU6IFthdXRvUGxhY2VtZW50KCldLAoJCX0pLnRoZW4oKHBvcykgPT4gewoJCQljb250ZW50cy5zdHlsZS5sZWZ0ID0gcG9zLnggKyAicHgiCgkJCWNvbnRlbnRzLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCX0pCgl9CgoJY29udGFpbmVyLnBvcG91dCA9IChmb3JjZSA9IHVuZGVmaW5lZCkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdwb3BwZWQnLCBmb3JjZSkKCQlwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCgloZWFkZXIub25jbGljayA9IChlKSA9PiB7Y29udGFpbmVyLnBvcG91dCgpfQoKCWNvbnRlbnRzLm9ubW91c2VlbnRlciA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCB0cnVlKQoJY29udGVudHMub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIGZhbHNlKQoKCWhlYWRlci5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCB0cnVlKQoJCWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHBlZCcpID8gbnVsbCA6IHBvc2l0aW9uQ29udGVudHMoKQoJfQoJaGVhZGVyLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgZmFsc2UpCjwvc2NyaXB0Pgo8c3R5bGU+Cglwb3BvdXQtaGVhZGVyIHsKCQlkaXNwbGF5OiBmbGV4OwoJCWJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKCQlib3JkZXItcmFkaXVzOiAxMHB4OwoJCWp1c3RpZnktY29udGVudDogY2VudGVyOwoJfQoJcG9wb3V0LWNvbnRlbnRzIHsKCQlkaXNwbGF5OiBub25lOwoJCXdpZHRoOiA0MDBweDsKCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CiAgICAJYm9yZGVyOiAzcHggc29saWQgdmFyKC0tb3ZlcmxheS1idXR0b24tYm9yZGVyKTsKICAgIAlib3JkZXItcmFkaXVzOiAxMHB4OwogICAgCXBhZGRpbmc6IDhweDsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLAogCXBvcG91dC1jb250YWluZXIuaGVhZGVyLWhvdmVyID4gcG9wb3V0LWNvbnRlbnRzIHsKCQlkaXNwbGF5OiBibG9jazsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJei1pbmRleDogNTAwOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5jb250ZW50cy1ob3ZlciA+IHBvcG91dC1oZWFkZXIgewoJCWJvcmRlci1jb2xvcjogdmFyKC0tcGx1dG8tbG9ncy13YXJuLWFjY2VudC1jb2xvcik7Cgl9CgkucG9wb3V0LWljb24gewoJCS0tc2l6ZTogMjBweDsKCSAgICBkaXNwbGF5OiBibG9jazsKCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCW1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwoJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cgl9CgkucG9wb3V0LWljb24ucG9wb3V0IHsJCgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXhwYW5kLnN2Zyk7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKCSAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jb250cmFjdC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQl0b3VjaC1hY3Rpb246IG5vbmU7CgkJdXNlci1zZWxlY3Q6IG5vbmU7Cgl9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J2dvYXJ3bWpwaGwnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJnb2Fyd21qcGhsIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBncmlkOwoJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJfQoJCWJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCgkJYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kLXZhbHVlIGJvbmQgewoJCQlkaXNwbGF5OiBmbGV4OyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJCWJvbmQtdmFsdWUgaW5wdXQgewoJCQl3aWR0aDogMTAwJTsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgoJCgk8L2JvbmRzbGlzdC1jb250ZW50cz4KCTxzY3JpcHQgaWQ9J210dWVzc3pzaG0nPgoJCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnRhaW5lci5jb2xsYXBzZSA9IChmb3JjZSkgPT4gewoJCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJywgZm9yY2UpCgkJfQoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdzcGFuLmNvbGxhcHNlJykKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiBjb250YWluZXIuY29sbGFwc2UoKQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJYm9uZHNsaXN0LWhlYWRlciB7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWRpc3BsYXk6IGZsZXg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQl9CQkKCQlib25kc2xpc3QtaGVhZGVyOmJlZm9yZSB7CgkJCWNvbnRlbnQ6ICcnOwoJCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJdG9wOiAwcHg7CgkJCWJvdHRvbTogMHB4OwoJCQlsZWZ0OiAwcHg7CgkJCXJpZ2h0OiAwcHg7CgkJCXotaW5kZXg6IC0xOwoJCQliYWNrZ3JvdW5kOiAjZmZhYzQ1NDA7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0ID4gYm9uZHNsaXN0LWhlYWRlciB7CgkJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCQlwb3NpdGlvbjogc3RpY2t5OwoJCQl0b3A6IDBweDsKCQkJcGFkZGluZy10b3A6IDEycHg7CgkJCW1hcmdpbi10b3A6IC0xMnB4OwoJCQl6LWluZGV4OiAxMDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRlbnRzIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0OmJlZm9yZSB7CgkJCWNvbnRlbnQ6ICcnOwoJCQlkaXNwbGF5OiBibG9jazsKCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJanVzdGlmeS1zZWxmOiBjZW50ZXI7CgkJCWJvcmRlci1ib3R0b206IDJweCBzb2xpZDsKCQkJcGFkZGluZy10b3A6IDVweDsKCQkJd2lkdGg6IDEwMCU7CgkJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCQlwb3NpdGlvbjogc3RpY2t5OwoJCQl0b3A6IDBweDsKCQkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwoJCQl6LWluZGV4OiAyMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5ib25kc2xpc3QtaWNvbiB7CgkJCS0tc2l6ZTogMTdweDsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCWJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCWJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCWJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJd2lkdGg6IHZhcigtLXNpemUpOwoJCQlmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCWN1cnNvcjogcG9pbnRlcjsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgPiBib25kc2xpc3QtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQl3aWR0aDogMzBweDsKCQkJbWFyZ2luOiAwIDEwcHg7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlkaXNwbGF5OiBmbGV4OwoJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJd2lkdGg6IDEwMCU7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCWZsZXgtZ3JvdzogMTsKCQkJZm9udC1zaXplOiAxOHB4OwoJCQlmb250LXdlaWdodDogNjAwOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCBib25kc2xpc3QtaGVhZGVyICsgKiB7CgkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCSAgICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJICAgIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkgICAgcm93LWdhcDogNXB4OwoJCX0KCQlib25kc3RhYmxlLWNvbnRhaW5lciBib25kc2xpc3QtY29udGFpbmVyIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCQo8L3N0eWxlPgo8L2JvbmRzbGlzdC1jb250YWluZXI+CqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWWjYmxjsmxhc3RfcnVuX3RpbWVzdGFtcMtB2QQlIGjZI7BwZXJzaXN0X2pzX3N0YXRlw7doYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOTVhZDk0MjgtNzNmOC00ZjU3LTkxODUtOTY4NWI5YTIxMjNmuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXNDw+1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODiKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52wAB3rM8Ym9uZHRhYmxlLWNvbnRhaW5lciBrZXk9J2N3Y2Nrb29va2YnPgoJPGJvbmR0YWJsZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J3RhYmxlLWhlbHAgaWNvbic+PC9zcGFuPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TXkgQm9uZHM8L3NwYW4+CgkJPHNwYW4gY2xhc3M9J3RhYmxlLWNvbGxhcHNlIGljb24nPjwvc3Bhbj4KCTwvYm9uZHRhYmxlLWhlYWRlcj4KCTxib25kdGFibGUtY29udGVudHM+CgkJPGJvbmQgZGVmPSJhc2QiIHVuaXF1ZV9pZD0ieHVSVm1CY09oN0h5Ij48c3RydWN0LWJvbmQgY2xhc3M9J0FTRCc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPkFTRDwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FidXFpZHBxcnAnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+TWFya2Rvd24gZGVzY3JpcHRpb24sIGluY2x1ZGluZyA8c3BhbiBjbGFzcz0idGV4Ij4kTGFUZVgkPC9zcGFuPjwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3ZycHlpZmt4Y2knIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnJweWlma3hjaSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZycHlpZmt4Y2kiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYic+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYicgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYmAiPjxzcGFuPkZpZWxkIHdpdGggPGI+SFRNTDwvYj4gZGVzY3JpcHRpb248L3NwYW4+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2InPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2dubXFtcXpuYm0nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzY3JpcHQ+Ci8vIHdlaXJkIGltcG9ydCB0byBtYWtlIGl0IGZhc3Rlci4gVGhlIGBhd2FpdCBpbXBvcnRgIGNhbiBzdGlsbCBkZWxheSBleGVjdXRpb24gYnkgb25lIGZyYW1lIGlmIGl0IGlzIGFscmVhZHkgbG9hZGVkLi4uCndpbmRvdy5kM2Zvcm1hdCA9IHdpbmRvdy5kM2Zvcm1hdCA/PyBhd2FpdCBpbXBvcnQoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9ybWF0QDIvK2VzbSIpCgpjb25zdCBhcmdtaW4gPSB4cyA9PiB4cy5pbmRleE9mKE1hdGgubWluKC4uLnhzKSkKY29uc3QgY2xvc2VzdF9pbmRleCA9ICh4cywgeSkgPT4gYXJnbWluKHhzLm1hcCh4ID0+IE1hdGguYWJzKHgteSkpKQoKY29uc3QgdmFsdWVzID0gWzEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwXQoKY29uc3QgZWwgPSBodG1sYAo8c3BhbiB0aXRsZT0iQ2xpY2sgYW5kIGRyYWcgdGhpcyBudW1iZXIgbGVmdCBvciByaWdodCEiIHN0eWxlPSJjdXJzb3I6IGNvbC1yZXNpemU7CnRvdWNoLWFjdGlvbjogbm9uZTsKYmFja2dyb3VuZDogcmdiKDI1MiwgMjA5LCAyMDQpOwpjb2xvcjogYmxhY2s7CnBhZGRpbmc6IDBlbSAuMmVtOwpib3JkZXItcmFkaXVzOiAuM2VtOwpmb250LXdlaWdodDogYm9sZDsiPjY8L3NwYW4+CmAKCgoKbGV0IG9sZF94ID0gMApsZXQgb2xkX2luZGV4ID0gMApjb25zdCBpbml0aWFsX2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIDYpCmxldCBjdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoKY29uc3QgZm9ybWF0dGVyID0gcyA9PiAiIiArIGQzZm9ybWF0LmZvcm1hdCgiIikocykgKyAiIgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbCwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXNbY3VycmVudF9pbmRleF0sCglzZXQ6IHggPT4gewoJCWN1cnJlbnRfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgeCkKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgl9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCi8vIGluaXRpYWwgdmFsdWUKZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKDYpCgpjb25zdCBvblNjcnViID0gKGUpID0+IHsKCWNvbnN0IG9mZnNldCA9IGUuY2xpZW50WCAtIG9sZF94Cgljb25zdCBuZXdfaW5kZXggPSBNYXRoLm1pbih2YWx1ZXMubGVuZ3RoLTEsIE1hdGgubWF4KDAsIAoJCU1hdGgucm91bmQob2Zmc2V0LzEwKSArIG9sZF9pbmRleAoJKSkKCglpZihuZXdfaW5kZXggIT09IGN1cnJlbnRfaW5kZXgpIHsKCQljdXJyZW50X2luZGV4ID0gbmV3X2luZGV4CgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQoJfQp9Cgpjb25zdCBvbnBvaW50ZXJkb3duID0gKGUpID0+IHsKCXdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpCglvbGRfeCA9IGUuY2xpZW50WAoJb2xkX2luZGV4ID0gY3VycmVudF9pbmRleAoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQplbC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgpjb25zdCBvbmRibGNsaWNrID0gKGUpID0+IHsKCWN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4CgllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKfQplbC5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgpjb25zdCBvbnBvaW50ZXJ1cCA9ICgpID0+IHsKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0Kd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQoKZWwub25zZWxlY3RzdGFydCA9ICgpID0+IGZhbHNlCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCn0pCgpyZXR1cm4gZWwKCjwvc2NyaXB0PjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2dubXFtcXpuYm0nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJnbm1xbXF6bmJtIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5Ob3JtYWwgU3RyaW5nIERlc2NyaXB0aW9uPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3Fydmt4Z3hoYnAnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdxcnZreGd4aGJwJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAicXJ2a3hneGhicCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdkJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdkJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBkYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlRoaXMgZmllbGQgaXMgPGVtPnNwZWNpYWw8L2VtPjwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2QnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3ZwbXd0cWFoaGknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd2cG13dHFhaGhpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidnBtd3RxYWhoaSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdlJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdlJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBlYCI+ZTwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdlJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtZGxxZG5vZmV4JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PSc2JyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nbWRscWRub2ZleCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm1kbHFkbm9mZXgiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J2xwYXNrZ3prcG4nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJscGFza2d6a3BuIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIGBBU0RgIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhYnVxaWRwcXJwJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWJ1cWlkcHFycCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSd6endzdXllbmtjJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCWN1cnNvcjogcG9pbnRlcjsKCQktLXNpemU6IDE1cHg7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYXBwZWFyYW5jZTogbm9uZTsKCQliYWNrZ3JvdW5kOiAjYzZjNmM2OwoJCW91dGxpbmU6IG5vbmU7CgkJYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQltYXJnaW46IDAgMTBweDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CgkJYmFja2dyb3VuZDogIzRCRDg2NTsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKCQljb250ZW50OiAnJzsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYm9yZGVyLXJhZGl1czogNTAlOwoJCXRvcDogMHB4OwoJCWxlZnQ6IDBweDsKCQliYWNrZ3JvdW5kOiAjZmZmOwoJCXRyYW5zZm9ybTogc2NhbGUoMS4xKTsKCQlib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJdHJhbnNpdGlvbjogLjFzOwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CgkJbGVmdDogdmFyKC0tc2l6ZSkKCX0KPC9zdHlsZT4KCjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J29obHFmcnVsYW4nPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJDdXN0b20gRGVzY3JpcHRpb24iCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48Ym9uZCBkZWY9Im50IiB1bmlxdWVfaWQ9Im9wNUs5eVQzMWcyVyI+PHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyg6YSwgOmIsIDpjKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5NeSBGYW5jeSBOVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdrcWNvb3ltY3dtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6YmtuaXBmeHh5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+RGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ3R6bm1tYWVkbCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdndHpubW1hZWRsJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ3R6bm1tYWVkbCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6YmtuaXBmeHh5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPjxlbT5Cb2xkPC9lbT4gZmllbGQ8L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd6Y3Bvb3V3a216JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3pjcG9vdXdrbXonPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ6Y3Bvb3V3a216Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pia25pcGZ4eHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5jPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29rZ3l6YnhjY2EnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nb2tneXpieGNjYSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm9rZ3l6YnhjY2EiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J3pia25pcGZ4eHknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ6YmtuaXBmeHh5Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIGBOYW1lZFR1cGxlYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdrcWNvb3ltY3dtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAia3Fjb295bWN3bSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdvcWhzeGlndGhpJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCWN1cnNvcjogcG9pbnRlcjsKCQktLXNpemU6IDE1cHg7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYXBwZWFyYW5jZTogbm9uZTsKCQliYWNrZ3JvdW5kOiAjYzZjNmM2OwoJCW91dGxpbmU6IG5vbmU7CgkJYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQltYXJnaW46IDAgMTBweDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CgkJYmFja2dyb3VuZDogIzRCRDg2NTsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKCQljb250ZW50OiAnJzsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWhlaWdodDogdmFyKC0tc2l6ZSk7CgkJYm9yZGVyLXJhZGl1czogNTAlOwoJCXRvcDogMHB4OwoJCWxlZnQ6IDBweDsKCQliYWNrZ3JvdW5kOiAjZmZmOwoJCXRyYW5zZm9ybTogc2NhbGUoMS4xKTsKCQlib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJdHJhbnNpdGlvbjogLjFzOwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CgkJbGVmdDogdmFyKC0tc2l6ZSkKCX0KPC9zdHlsZT4KCjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J3poYXhhemdoamknPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJNeSBGYW5jeSBOVHVwbGUiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48Ym9uZHNsaXN0LWNvbnRhaW5lciBjbGFzcz0nbm8tcG9wb3V0Jz4KCTxib25kc2xpc3QtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdjb2xsYXBzZSBib25kc2xpc3QtaWNvbic+PC9zcGFuPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbicgdGl0bGU9IlRoaXMgbGlzdCBjb250YWlucyBpbmRlcGVuZGVudCBib25kcyI+TXkgR3JvdXAgb2YgQm9uZHM8L3NwYW4+CgkJPHNwYW4gY2xhc3M9J3RvZ2dsZSBib25kc2xpc3QtaWNvbic+PC9zcGFuPgoJPC9ib25kc2xpc3QtaGVhZGVyPgoJPGJvbmRzbGlzdC1jb250ZW50cz4KCTxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBmcmVxYCc+CgkJRnJlcXVlbmN5IFtHSHpdCgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8Ym9uZCBkZWY9ImZyZXEiIHVuaXF1ZV9pZD0iVDZMSUU4ekhBVEhQIj4KPHNjcmlwdD4KCWNvbnN0IGQzZm9ybWF0ID0gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKCWNvbnN0IGVscCA9IGh0bWxgCgk8c3BhbiBjbGFzcz0ibnVtYmVyX0VkaXRhYmxlIiBzdHlsZT0iCgl0b3VjaC1hY3Rpb246IG5vbmU7CglwYWRkaW5nOiAwZW0gLjJlbTsKCWJvcmRlci1yYWRpdXM6IC4zZW07Cglmb250LXdlaWdodDogYm9sZDsiPjxzcGFuIGNvbnRlbnRFZGl0YWJsZT10cnVlPjIwPC9zcGFuPiBHSHo8L3NwYW4+CglgCgoJY29uc3QgZm9ybWF0dGVyID0gcyA9PiBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpCgljb25zdCBlbCA9IGVscC5xdWVyeVNlbGVjdG9yKCJzcGFuIikKCglsZXQgbG9jYWxWYWwgPSBwYXJzZUZsb2F0KDIwKQoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKDIwKQoJCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZWxwLCJ2YWx1ZSIsewoJCWdldDogKCkgPT4gbG9jYWxWYWwsCgkJc2V0OiB4ID0+IHsKCQkJbG9jYWxWYWwgPSBwYXJzZUZsb2F0KHgpCgkJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcih4KQoJCX0KCX0pCgoJLy8gRnVuY3Rpb24gdG8gYmx1ciB0aGUgZWxlbWVudCB3aGVuIHByZXNzaW5nIGVudGVyIGluc3RlYWQgb2YgYWRkaW5nIGEgbmV3bGluZQoJY29uc3Qgb25FbnRlciA9IChlKSA9PiB7CgkJaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJaWYgKGVsLmlubmVyVGV4dCA9PT0gIiIpIHsKCQkJZWxwLnZhbHVlID0gMjAgICAKCQl9IGVsc2UgewoJCQllbHAudmFsdWUgPSAgZWwuaW5uZXJUZXh0CgkJfQoJCWVscC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCQllbC5ibHVyKCkKCQl9Cgl9CgoJZWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLChlKSA9PiB7CgkJY29uc29sZS5sb2coZSkKCQllLnByZXZlbnREZWZhdWx0KCkKCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpCgl9KQoKCWZ1bmN0aW9uIHNlbGVjdFRleHQoZWwpewoJCXZhciBzZWwsIHJhbmdlOwoJCWlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uICYmIGRvY3VtZW50LmNyZWF0ZVJhbmdlKSB7IC8vQnJvd3NlciBjb21wYXRpYmlsaXR5CgkJc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpOwoJCWlmKHNlbC50b1N0cmluZygpID09ICcnKXsgLy9ubyB0ZXh0IHNlbGVjdGlvbgoJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewoJCQkJcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOyAvL3JhbmdlIG9iamVjdAoJCQkJcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGVsKTsgLy9zZXRzIFJhbmdlCgkJCQlzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7IC8vcmVtb3ZlIGFsbCByYW5nZXMgZnJvbSBzZWxlY3Rpb24KCQkJCXNlbC5hZGRSYW5nZShyYW5nZSk7Ly9hZGQgUmFuZ2UgdG8gYSBTZWxlY3Rpb24uCgkJCX0sMSk7CgkJfQoJCX1lbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsgLy9vbGRlciBpZQoJCQlzZWwgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKCQkJaWYoc2VsLnRleHQgPT0gJycpeyAvL25vIHRleHQgc2VsZWN0aW9uCgkJCQlyYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7Ly9DcmVhdGVzIFRleHRSYW5nZSBvYmplY3QKCQkJCXJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KGVsKTsvL3NldHMgUmFuZ2UKCQkJCXJhbmdlLnNlbGVjdCgpOyAvL21ha2Ugc2VsZWN0aW9uLgoJCQl9CgkJfQoJfQoKCWVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLG9uRW50ZXIpCgllbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpID0+IGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkpIC8vIG1vZGlmeSB0ZXh0CgllbHAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKSA9PiBzZWxlY3RUZXh0KGVsKSkgLy8gU2VsZWN0IGFsbCB0ZXh0CgoJcmV0dXJuIGVscAoKPC9zY3JpcHQ+CjxzdHlsZT4KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGxpZ2h0KSB7CgkJc3Bhbi5udW1iZXJfRWRpdGFibGUgewoJCQliYWNrZ3JvdW5kOiBoc2woMjA0LCA5NSUsIDg0JSk7CgkJfQoJfQoJQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewoJCXNwYW4ubnVtYmVyX0VkaXRhYmxlIHsKCQkJYmFja2dyb3VuZDogaHNsKDIwNCwgOTUlLCA0MCUpOwoJCX0KCX0KPC9zdHlsZT4KPC9ib25kPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQl9CgkJYm9uZHRhYmxlLWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiwKCQlib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmQtdmFsdWUgYm9uZCB7CgkJCWRpc3BsYXk6IGZsZXg7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9CgkJYm9uZC12YWx1ZSBpbnB1dCB7CgkJCXdpZHRoOiAxMDAlOyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+Cjxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBhbHRgJz4KCQk8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+QWx0aXR1ZGUgPHNwYW4gY2xhc3M9InRleCI+JGgkPC9zcGFuPiAmIzkxO20mIzkzOzwvcD4KPC9kaXY+Cgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8Ym9uZCBkZWY9ImFsdCIgdW5pcXVlX2lkPSJvbjNkcXVIRlZXWmoiPjxzY3JpcHQ+Ci8vIHdlaXJkIGltcG9ydCB0byBtYWtlIGl0IGZhc3Rlci4gVGhlIGBhd2FpdCBpbXBvcnRgIGNhbiBzdGlsbCBkZWxheSBleGVjdXRpb24gYnkgb25lIGZyYW1lIGlmIGl0IGlzIGFscmVhZHkgbG9hZGVkLi4uCndpbmRvdy5kM2Zvcm1hdCA9IHdpbmRvdy5kM2Zvcm1hdCA/PyBhd2FpdCBpbXBvcnQoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9ybWF0QDIvK2VzbSIpCgpjb25zdCBhcmdtaW4gPSB4cyA9PiB4cy5pbmRleE9mKE1hdGgubWluKC4uLnhzKSkKY29uc3QgY2xvc2VzdF9pbmRleCA9ICh4cywgeSkgPT4gYXJnbWluKHhzLm1hcCh4ID0+IE1hdGguYWJzKHgteSkpKQoKY29uc3QgdmFsdWVzID0gWzEwMCwgMTEwLCAxMjAsIDEzMCwgMTQwLCAxNTAsIDE2MCwgMTcwLCAxODAsIDE5MCwgMjAwXQoKY29uc3QgZWwgPSBodG1sYAo8c3BhbiB0aXRsZT0iQ2xpY2sgYW5kIGRyYWcgdGhpcyBudW1iZXIgbGVmdCBvciByaWdodCEiIHN0eWxlPSJjdXJzb3I6IGNvbC1yZXNpemU7CnRvdWNoLWFjdGlvbjogbm9uZTsKYmFja2dyb3VuZDogcmdiKDI1MiwgMjA5LCAyMDQpOwpjb2xvcjogYmxhY2s7CnBhZGRpbmc6IDBlbSAuMmVtOwpib3JkZXItcmFkaXVzOiAuM2VtOwpmb250LXdlaWdodDogYm9sZDsiPjE1MDwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgMTUwKQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcigxNTApCgpjb25zdCBvblNjcnViID0gKGUpID0+IHsKCWNvbnN0IG9mZnNldCA9IGUuY2xpZW50WCAtIG9sZF94Cgljb25zdCBuZXdfaW5kZXggPSBNYXRoLm1pbih2YWx1ZXMubGVuZ3RoLTEsIE1hdGgubWF4KDAsIAoJCU1hdGgucm91bmQob2Zmc2V0LzEwKSArIG9sZF9pbmRleAoJKSkKCglpZihuZXdfaW5kZXggIT09IGN1cnJlbnRfaW5kZXgpIHsKCQljdXJyZW50X2luZGV4ID0gbmV3X2luZGV4CgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQoJfQp9Cgpjb25zdCBvbnBvaW50ZXJkb3duID0gKGUpID0+IHsKCXdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpCglvbGRfeCA9IGUuY2xpZW50WAoJb2xkX2luZGV4ID0gY3VycmVudF9pbmRleAoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQplbC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgpjb25zdCBvbmRibGNsaWNrID0gKGUpID0+IHsKCWN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4CgllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKfQplbC5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgpjb25zdCBvbnBvaW50ZXJ1cCA9ICgpID0+IHsKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0Kd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQoKZWwub25zZWxlY3RzdGFydCA9ICgpID0+IGZhbHNlCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCn0pCgpyZXR1cm4gZWwKCjwvc2NyaXB0PjwvYm9uZD4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBncmlkOwoJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJfQoJCWJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCgkJYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCX0KCQlib25kLXZhbHVlIGJvbmQgewoJCQlkaXNwbGF5OiBmbGV4OyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJCWJvbmQtdmFsdWUgaW5wdXQgewoJCQl3aWR0aDogMTAwJTsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgoJCgk8L2JvbmRzbGlzdC1jb250ZW50cz4KCTxzY3JpcHQgaWQ9J2FjZ3Zkb3NvZXknPgoJCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnRhaW5lci5jb2xsYXBzZSA9IChmb3JjZSkgPT4gewoJCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJywgZm9yY2UpCgkJfQoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdzcGFuLmNvbGxhcHNlJykKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiBjb250YWluZXIuY29sbGFwc2UoKQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJYm9uZHNsaXN0LWhlYWRlciB7CgkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCWRpc3BsYXk6IGZsZXg7CgkJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQl9CQkKCQlib25kc2xpc3QtaGVhZGVyOmJlZm9yZSB7CgkJCWNvbnRlbnQ6ICcnOwoJCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJdG9wOiAwcHg7CgkJCWJvdHRvbTogMHB4OwoJCQlsZWZ0OiAwcHg7CgkJCXJpZ2h0OiAwcHg7CgkJCXotaW5kZXg6IC0xOwoJCQliYWNrZ3JvdW5kOiAjZmZhYzQ1NDA7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0ID4gYm9uZHNsaXN0LWhlYWRlciB7CgkJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCQlwb3NpdGlvbjogc3RpY2t5OwoJCQl0b3A6IDBweDsKCQkJcGFkZGluZy10b3A6IDEycHg7CgkJCW1hcmdpbi10b3A6IC0xMnB4OwoJCQl6LWluZGV4OiAxMDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRlbnRzIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0OmJlZm9yZSB7CgkJCWNvbnRlbnQ6ICcnOwoJCQlkaXNwbGF5OiBibG9jazsKCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJanVzdGlmeS1zZWxmOiBjZW50ZXI7CgkJCWJvcmRlci1ib3R0b206IDJweCBzb2xpZDsKCQkJcGFkZGluZy10b3A6IDVweDsKCQkJd2lkdGg6IDEwMCU7CgkJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCQlwb3NpdGlvbjogc3RpY2t5OwoJCQl0b3A6IDBweDsKCQkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwoJCQl6LWluZGV4OiAyMDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5ib25kc2xpc3QtaWNvbiB7CgkJCS0tc2l6ZTogMTdweDsKCQkJZGlzcGxheTogYmxvY2s7CgkJCWFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCWJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCWJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCWJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJd2lkdGg6IHZhcigtLXNpemUpOwoJCQlmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCWN1cnNvcjogcG9pbnRlcjsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgPiBib25kc2xpc3QtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCQl3aWR0aDogMzBweDsKCQkJbWFyZ2luOiAwIDEwcHg7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgewoJCQlkaXNwbGF5OiBmbGV4OwoJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJd2lkdGg6IDEwMCU7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCWZsZXgtZ3JvdzogMTsKCQkJZm9udC1zaXplOiAxOHB4OwoJCQlmb250LXdlaWdodDogNjAwOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCBib25kc2xpc3QtaGVhZGVyICsgKiB7CgkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lciB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCSAgICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJICAgIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkgICAgcm93LWdhcDogNXB4OwoJCX0KCQlib25kc3RhYmxlLWNvbnRhaW5lciBib25kc2xpc3QtY29udGFpbmVyIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCQo8L3N0eWxlPgo8L2JvbmRzbGlzdC1jb250YWluZXI+Cjxib25kc2xpc3QtY29udGFpbmVyIGNsYXNzPSduby1wb3BvdXQnPgoJPGJvbmRzbGlzdC1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2NvbGxhcHNlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJyB0aXRsZT0iVGhpcyBsaXN0IGNvbnRhaW5zIGluZGVwZW5kZW50IGJvbmRzIj5Qb3BvdXQgQ29udGFpbmVyPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYXNkYCc+CgkJU3RydWN0dXJlIEFTRAoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSd1eWxjaGZsaGF6Jz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3R5bmNqcGx1a2knIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0iYXNkIiB1bmlxdWVfaWQ9Inh1UlZtQmNPaDdIeSI+PHN0cnVjdC1ib25kIGNsYXNzPSdNYWluLnZhciZxdW90O3dvcmtzcGFjZSM3MSZxdW90Oy5BU0QnPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5BU0Q8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYnVxaWRwcXJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgPHNwYW4gY2xhc3M9InRleCI+JExhVGVYJDwvc3Bhbj48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cnB5aWZreGNpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZycHlpZmt4Y2knPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2cnB5aWZreGNpIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2xwYXNrZ3prcG4nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdnbm1xbXF6bmJtJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdnbm1xbXF6bmJtJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZ25tcW1xem5ibSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdscGFza2d6a3BuJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+Tm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdxcnZreGd4aGJwJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncXJ2a3hneGhicCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInFydmt4Z3hoYnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZGAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGlzIGZpZWxkIGlzIDxlbT5zcGVjaWFsPC9lbT48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdkJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2cG13dHFhaGhpJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnBtd3RxYWhoaSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZwbXd0cWFoaGkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHBhc2tnemtwbicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZWAiPmU8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbWRscWRub2ZleCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nNicgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J21kbHFkbm9mZXgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJtZGxxZG5vZmV4Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdscGFza2d6a3BuJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHBhc2tnemtwbiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBgQVNEYCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWJ1cWlkcHFycCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFidXFpZHBxcnAiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nenp3c3V5ZW5rYyc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJLS1zaXplOiAxNXB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWFwcGVhcmFuY2U6IG5vbmU7CgkJYmFja2dyb3VuZDogI2M2YzZjNjsKCQlvdXRsaW5lOiBub25lOwoJCWJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CgkJbWFyZ2luOiAwIDEwcHg7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewoJCWJhY2tncm91bmQ6ICM0QkQ4NjU7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CgkJY29udGVudDogJyc7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQloZWlnaHQ6IHZhcigtLXNpemUpOwoJCWJvcmRlci1yYWRpdXM6IDUwJTsKCQl0b3A6IDBweDsKCQlsZWZ0OiAwcHg7CgkJYmFja2dyb3VuZDogI2ZmZjsKCQl0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CgkJYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCXRyYW5zaXRpb246IC4xczsKCX0KCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewoJCWxlZnQ6IHZhcigtLXNpemUpCgl9Cjwvc3R5bGU+Cgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdvaGxxZnJ1bGFuJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiQ3VzdG9tIERlc2NyaXB0aW9uIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSd1eWxjaGZsaGF6Jz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkKCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogMTBweDsKCQlqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCX0KCXBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogbm9uZTsKCQl3aWR0aDogNDAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgCWJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICAJYm9yZGVyLXJhZGl1czogMTBweDsKICAgIAlwYWRkaW5nOiA4cHg7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKIAlwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CgkJZGlzcGxheTogYmxvY2s7CgkJcG9zaXRpb246IGZpeGVkOwoJCXotaW5kZXg6IDUwMDsKCX0KCXBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKCQlib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwoJfQoJLnBvcG91dC1pY29uIHsKCQktLXNpemU6IDIwcHg7CgkgICAgZGlzcGxheTogYmxvY2s7CgkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQltaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJfQoJLnBvcG91dC1pY29uLnBvcG91dCB7CQoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CgkgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCXVzZXItc2VsZWN0OiBub25lOwoJfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSd0eW5janBsdWtpJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidHluY2pwbHVraSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCX0KCQlib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLAoJCWJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZC12YWx1ZSBib25kIHsKCQkJZGlzcGxheTogZmxleDsgLy8gTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dAoJCX0KCQlib25kLXZhbHVlIGlucHV0IHsKCQkJd2lkdGg6IDEwMCU7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9Cgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYG50YCc+CgkJTmFtZWRUdXBsZQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSdycG51Y3phaWl0Jz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J214bXFvZ21vZnInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0ibnQiIHVuaXF1ZV9pZD0ib3A1Szl5VDMxZzJXIj48c3RydWN0LWJvbmQgY2xhc3M9J05hbWVkVHVwbGV7KDphLCA6YiwgOmMpfSc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk15IEZhbmN5IE5UdXBsZTwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2txY29veW1jd20nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pia25pcGZ4eHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj5EZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdndHpubW1hZWRsJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2d0em5tbWFlZGwnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJndHpubW1hZWRsIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pia25pcGZ4eHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+PGVtPkJvbGQ8L2VtPiBmaWVsZDwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2InPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pjcG9vdXdrbXonIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nemNwb291d2tteic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInpjcG9vdXdrbXoiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nemJrbmlwZnh4eScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPmM8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2tneXpieGNjYScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdva2d5emJ4Y2NhJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAib2tneXpieGNjYSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgkKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCQo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nemJrbmlwZnh4eSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInpia25pcGZ4eHkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgYE5hbWVkVHVwbGVgIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2txY29veW1jd20nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJrcWNvb3ltY3dtIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoJCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J29xaHN4aWd0aGknPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCS0tc2l6ZTogMTVweDsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlhcHBlYXJhbmNlOiBub25lOwoJCWJhY2tncm91bmQ6ICNjNmM2YzY7CgkJb3V0bGluZTogbm9uZTsKCQlib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwoJCW1hcmdpbjogMCAxMHB4OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKCQliYWNrZ3JvdW5kOiAjNEJEODY1OwoJfQoJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICcnOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJaGVpZ2h0OiB2YXIoLS1zaXplKTsKCQlib3JkZXItcmFkaXVzOiA1MCU7CgkJdG9wOiAwcHg7CgkJbGVmdDogMHB4OwoJCWJhY2tncm91bmQ6ICNmZmY7CgkJdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwoJCWJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKCQl0cmFuc2l0aW9uOiAuMXM7Cgl9Cgl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKCQlsZWZ0OiB2YXIoLS1zaXplKQoJfQo8L3N0eWxlPgoKPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nemhheGF6Z2hqaSc+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIk15IEZhbmN5IE5UdXBsZSIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQlzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9ib25kPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9wb3BvdXQtY29udGVudHM+CjwvcG9wb3V0LWNvbnRhaW5lcj4KPHNjcmlwdCBpZD0ncnBudWN6YWlpdCc+CgkvLyBMb2FkIHRoZSBmbG9hdGluZy11aSBhbmQgaW50ZXJhY3QgbGlicmFyaWVzCgl3aW5kb3cuZmxvYXRpbmdfdWkgPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL0BmbG9hdGluZy11aS9kb20nKQoKCWNvbnN0IHsgY29tcHV0ZVBvc2l0aW9uLCBhdXRvUGxhY2VtZW50IH0gPSBmbG9hdGluZ191aQoJCgljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCWNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZAoJY29uc3QgY29udGVudHMgPSBjb250YWluZXIubGFzdEVsZW1lbnRDaGlsZAoKCS8vIExvYWQgdGhlIGludGVyYWN0anMgcGFydAoJCgkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewoJCWRpc3BsYXk6IGZsZXg7CgkJYm9yZGVyOiAzcHggZGFzaGVkIHRyYW5zcGFyZW50OwoJCWJvcmRlci1yYWRpdXM6IDEwcHg7CgkJanVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cgl9Cglwb3BvdXQtY29udGVudHMgewoJCWRpc3BsYXk6IG5vbmU7CgkJd2lkdGg6IDQwMHB4OwoJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIAlib3JkZXI6IDNweCBzb2xpZCB2YXIoLS1vdmVybGF5LWJ1dHRvbi1ib3JkZXIpOwogICAgCWJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAJcGFkZGluZzogOHB4OwoJfQoJcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgPiBwb3BvdXQtY29udGVudHMsCiAJcG9wb3V0LWNvbnRhaW5lci5oZWFkZXItaG92ZXIgPiBwb3BvdXQtY29udGVudHMgewoJCWRpc3BsYXk6IGJsb2NrOwoJCXBvc2l0aW9uOiBmaXhlZDsKCQl6LWluZGV4OiA1MDA7Cgl9Cglwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CgkJYm9yZGVyLWNvbG9yOiB2YXIoLS1wbHV0by1sb2dzLXdhcm4tYWNjZW50LWNvbG9yKTsKCX0KCS5wb3BvdXQtaWNvbiB7CgkJLS1zaXplOiAyMHB4OwoJICAgIGRpc3BsYXk6IGJsb2NrOwoJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJbWluLWhlaWdodDogdmFyKC0tc2l6ZSk7CgkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCX0KCS5wb3BvdXQtaWNvbi5wb3BvdXQgewkKCSAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKCX0KCXBvcG91dC1jb250YWluZXIucG9wcGVkIC5wb3BvdXQgewoJICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cgl9Cglwb3BvdXQtY29udGFpbmVyLnBvcHBlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCXRvdWNoLWFjdGlvbjogbm9uZTsKCQl1c2VyLXNlbGVjdDogbm9uZTsKCX0KPC9zdHlsZT4KPHNjcmlwdCBpZD0nbXhtcW9nbW9mcic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm14bXFvZ21vZnIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoJCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgkKPC9zY3JpcHQ+PC9zcGFuPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CgkJCWRpc3BsYXk6IGdyaWQ7CgkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQl9CgkJYm9uZHRhYmxlLWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiwKCQlib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKCQkJZGlzcGxheTogY29udGVudHM7CgkJfQoJCWJvbmQtdmFsdWUgYm9uZCB7CgkJCWRpc3BsYXk6IGZsZXg7IC8vIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQKCQl9CgkJYm9uZC12YWx1ZSBpbnB1dCB7CgkJCXdpZHRoOiAxMDAlOyAvLyBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0CgkJfQoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+CgkKCTwvYm9uZHNsaXN0LWNvbnRlbnRzPgoJPHNjcmlwdCBpZD0nbXR1ZXNzenNobSc+CgkJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29udGFpbmVyLmNvbGxhcHNlID0gKGZvcmNlKSA9PiB7CgkJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnLCBmb3JjZSkKCQl9CgkJY29uc3QgY29sbGFwc2VfYnRuID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4uY29sbGFwc2UnKQoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IGNvbnRhaW5lci5jb2xsYXBzZSgpCgk8L3NjcmlwdD4KCTxzdHlsZT4KCQlib25kc2xpc3QtaGVhZGVyIHsKCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJZGlzcGxheTogZmxleDsKCQkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwoJCX0JCQoJCWJvbmRzbGlzdC1oZWFkZXI6YmVmb3JlIHsKCQkJY29udGVudDogJyc7CgkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQkJcG9zaXRpb246IGFic29sdXRlOwoJCQl0b3A6IDBweDsKCQkJYm90dG9tOiAwcHg7CgkJCWxlZnQ6IDBweDsKCQkJcmlnaHQ6IDBweDsKCQkJei1pbmRleDogLTE7CgkJCWJhY2tncm91bmQ6ICNmZmFjNDU0MDsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5uby1wb3BvdXQgPiBib25kc2xpc3QtaGVhZGVyIHsKCQkJYWxpZ24tc2VsZjogc3RhcnQ7CgkJCXBvc2l0aW9uOiBzdGlja3k7CgkJCXRvcDogMHB4OwoJCQlwYWRkaW5nLXRvcDogMTJweDsKCQkJbWFyZ2luLXRvcDogLTEycHg7CgkJCXotaW5kZXg6IDEwOwoJCX0KCQlib25kc2xpc3QtY29udGVudHMgewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJYm9uZHNsaXN0LWNvbnRhaW5lci5uby1wb3BvdXQ6YmVmb3JlIHsKCQkJY29udGVudDogJyc7CgkJCWRpc3BsYXk6IGJsb2NrOwoJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQlqdXN0aWZ5LXNlbGY6IGNlbnRlcjsKCQkJYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkOwoJCQlwYWRkaW5nLXRvcDogNXB4OwoJCQl3aWR0aDogMTAwJTsKCQkJYWxpZ24tc2VsZjogc3RhcnQ7CgkJCXBvc2l0aW9uOiBzdGlja3k7CgkJCXRvcDogMHB4OwoJCQliYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CgkJCXotaW5kZXg6IDIwOwoJCX0KCQlib25kc2xpc3QtaGVhZGVyID4gLmJvbmRzbGlzdC1pY29uIHsKCQkJLS1zaXplOiAxN3B4OwoJCQlkaXNwbGF5OiBibG9jazsKCQkJYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCWZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJY3Vyc29yOiBwb2ludGVyOwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCA+IGJvbmRzbGlzdC1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewoJCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJCXdpZHRoOiAzMHB4OwoJCQltYXJnaW46IDAgMTBweDsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciB7CgkJCWRpc3BsYXk6IGZsZXg7CgkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQl3aWR0aDogMTAwJTsKCQl9CgkJYm9uZHNsaXN0LWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJZmxleC1ncm93OiAxOwoJCQlmb250LXNpemU6IDE4cHg7CgkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJfQoJCWJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJfQoJCWJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkIGJvbmRzbGlzdC1oZWFkZXIgKyAqIHsKCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCX0KCQlib25kc2xpc3QtY29udGFpbmVyIHsKCQkJZGlzcGxheTogZ3JpZDsKCQkgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJICAgIGdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkgICAganVzdGlmeS1pdGVtczogY2VudGVyOwoJCSAgICBhbGlnbi1pdGVtczogY2VudGVyOwoJCSAgICByb3ctZ2FwOiA1cHg7CgkJfQoJCWJvbmRzdGFibGUtY29udGFpbmVyIGJvbmRzbGlzdC1jb250YWluZXIgewoJCQlkaXNwbGF5OiBjb250ZW50czsKCQl9CgkJCjwvc3R5bGU+CjwvYm9uZHNsaXN0LWNvbnRhaW5lcj4KCgk8L2JvbmR0YWJsZS1jb250ZW50cz4KPC9ib25kdGFibGUtY29udGFpbmVyPgo8c2NyaXB0IGlkPSdjd2Nja29vb2tmJz4KCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJY29uc3QgY2VsbCA9IGNvbnRhaW5lci5jbG9zZXN0KCdwbHV0by1jZWxsJykKCgkKCWNvbnN0IGhlbHBfYnRuID0gaGVhZGVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb2xsYXBzZV9idG4gPSBoZWFkZXIubGFzdEVsZW1lbnRDaGlsZAoKCWNvbnRhaW5lci5jb2xsYXBzZSA9IChmb3JjZSkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnLCBmb3JjZSkKCX0KCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gZSA9PiBjb250YWluZXIuY29sbGFwc2UoKQoKCS8vIExvYWQgdGhlIGludGVyYWN0IHNjcmlwdAoJCgkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250YWluZXIub2Zmc2V0ID0gY29udGFpbmVyLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250YWluZXIucXVlcnlTZWxlY3RvcignYm9uZHRhYmxlLWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250YWluZXIub2Zmc2V0LnkgPSBzdGFydFBvc2l0aW9uLnkgPSBjb250YWluZXIub2Zmc2V0VG9wCgkJCQljb250YWluZXIub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250YWluZXIub2Zmc2V0TGVmdAoJCQl9LAoJCQltb3ZlIChldmVudCkgewoJCSAgICAgIGNvbnRhaW5lci5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRhaW5lci5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSBgbWluKDk1dmgsICR7Y29udGFpbmVyLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRhaW5lci5vZmZzZXQueH1weGAKCQkgICAgfSwKCQl9Cgl9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIGhlYWRlciByZXNldCB0aGUgcG9zaXRpb24KCQljb250YWluZXIuc3R5bGUudG9wID0gJycKCQljb250YWluZXIuc3R5bGUubGVmdCA9ICcnCgl9KQoJaW50ZXJhY3QoY29udGFpbmVyKQoJICAucmVzaXphYmxlKHsKCQlpZ25vcmVGcm9tOiAncG9wb3V0LWNvbnRhaW5lcicsCgkgICAgZWRnZXM6IHsgdG9wOiB0cnVlLCBsZWZ0OiBmYWxzZSwgYm90dG9tOiB0cnVlLCByaWdodDogdHJ1ZSB9LAoJICAgIGxpc3RlbmVyczogewoJICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CQkKCSAgICAgICAgT2JqZWN0LmFzc2lnbihldmVudC50YXJnZXQuc3R5bGUsIHsKCSAgICAgICAgICB3aWR0aDogYCR7ZXZlbnQucmVjdC53aWR0aH1weGAsCgkgICAgICAgICAgaGVpZ2h0OiBgJHtldmVudC5yZWN0LmhlaWdodH1weGAsCgkJCSAgbWF4SGVpZ2h0OiAnbm9uZScsCgkgICAgICAgIH0pCgkgICAgICB9CgkgICAgfQoJICB9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIHJlc2l6ZSByZXNldCB0aGUgd2lkdGgKCQkJY29udGFpbmVyLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gJycKCQkgIAljb250YWluZXIuc3R5bGUubWF4SGVpZ2h0ID0gJycKCSAgfSkKCgoJLy8gTm93IHdlIGFzc2lnbiBhIHNwZWNpZmljIGNsYXNzIHRvIGFsbCB0b2dnbGUtY29udGFpbmVyIHRoYXQgYXJlIGRpcmVjdCBjaGlsZHJlbgoJZm9yIChjb25zdCB0ciBvZiBjb250ZW50cy5xdWVyeVNlbGVjdG9yQWxsKCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKSkgewoJCXRyLmNsb3Nlc3QoJ3BvcG91dC1jb250YWluZXInKSA/PyB0ci5jbGFzc0xpc3QudG9nZ2xlKCduby1wb3BvdXQnLCB0cnVlKQoJfQoJLy8gV2UgYWxzbyBmbGFnIHRoZSBmaXJzdCB0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgaW4gdGhlIHRhYmxlCgljb250ZW50cy5maXJzdEVsZW1lbnRDaGlsZC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIubm8tcG9wb3V0Jyk/LmNsYXNzTGlzdC50b2dnbGUoJ2ZpcnN0Jyx0cnVlKQoKCS8vIENsaWNrIHRvIGdvIHRvIGRlZmluaXRpb24KCWNvbnRhaW5lci5qdW1wVG9DZWxsID0gKCkgPT4gewoJCWNlbGwuc2Nyb2xsSW50b1ZpZXcoKQoJfQoJaGVscF9idG4ub25jbGljayA9IGNvbnRhaW5lci5qdW1wVG9DZWxsCjwvc2NyaXB0Pgo8c3R5bGU+Cglib25kdGFibGUtY29udGFpbmVyIHsKCQlkaXNwbGF5OiBmbGV4OwoJCWZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CgkJcG9zaXRpb246IGZpeGVkOwoJCXRvcDogNTBweDsKCQlsZWZ0OiAxMHB4OwoJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIAlib3JkZXI6IDNweCBzb2xpZCAjZTdlN2U3OwogICAgCWJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAJcGFkZGluZy1sZWZ0OiA4cHg7CiAgICAJcGFkZGluZy10b3A6IDhweDsKCQl6LWluZGV4OiA2MDA7CgkJd2lkdGg6IDQwMHB4OwoJCW1heC1oZWlnaHQ6IDYwMHB4OwoJCXRyYW5zaXRpb246IHRyYW5zZm9ybSAzMDBtcyBjdWJpYy1iZXppZXIoMC4xOCwgMC44OSwgMC40NSwgMS4xMik7Cgl9Cglib25kdGFibGUtY29udGFpbmVyOm5vdCguY29sbGFwc2VkKSA+ICogewoJCXBhZGRpbmctcmlnaHQ6IDhweDsKCX0KCWJvbmR0YWJsZS1jb250ZW50cyB7CgkJZGlzcGxheTogZ3JpZDsKCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCXBhZGRpbmctYm90dG9tOiA4cHg7CgkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQlyb3ctZ2FwOiA1cHg7CgkJb3ZlcmZsb3c6IGF1dG87Cgl9Cglib25kdGFibGUtY29udGVudHMgdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLm5vLXBvcG91dCwKCWJvbmR0YWJsZS1jb250ZW50cyA+ICosIAoJYm9uZHRhYmxlLWNvbnRlbnRzIHN0cnVjdC1ib25kIHsKCQlkaXNwbGF5OiBjb250ZW50cwoJfQoJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLm5vLXBvcG91dDpiZWZvcmUgewoJCWNvbnRlbnQ6ICcnOwogIAkJZGlzcGxheTogYmxvY2s7CgkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQlqdXN0aWZ5LXNlbGY6IGNlbnRlcjsKCQlib3JkZXItYm90dG9tOiAycHggc29saWQ7CgkJcGFkZGluZy10b3A6IDVweDsKCQl3aWR0aDogMTAwJTsKCQlhbGlnbi1zZWxmOiBzdGFydDsKCQlwb3NpdGlvbjogc3RpY2t5OwoJCXRvcDogMHB4OwoJCWJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKCQl6LWluZGV4OiAyMDsKCX0KCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5uby1wb3BvdXQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCWFsaWduLXNlbGY6IHN0YXJ0OwoJCXBvc2l0aW9uOiBzdGlja3k7CgkJdG9wOiAwcHg7CgkJYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwoJCXBhZGRpbmctdG9wOiAxMnB4OwoJCW1hcmdpbi10b3A6IC0xMnB4OwoJCXotaW5kZXg6IDEwOwoJfQoJYm9uZHRhYmxlLWhlYWRlciB7CgkJZGlzcGxheTogZmxleDsKCQlqdXN0aWZ5LWl0ZW1zOiBzdHJldGNoOwoJfQoJYm9uZHRhYmxlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJZmxleC1ncm93OiAxOwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQlmb250LXNpemU6IDIwcHg7CgkJZm9udC13ZWlnaHQ6IDgwMDsKCQl0b3VjaC1hY3Rpb246IG5vbmU7CgkJdXNlci1zZWxlY3Q6IG5vbmU7Cgl9Cglib25kdGFibGUtaGVhZGVyID4gLmljb24gewoJCWZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJY3Vyc29yOiBwb2ludGVyOwoJfQoJYm9uZHRhYmxlLWhlYWRlciAudGFibGUtY29sbGFwc2UgewoJCS0tc2l6ZTogMjNweDsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvYXJyb3ctYmFjay5zdmciKTsKCX0KCWJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIC50YWJsZS1jb2xsYXBzZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL29wdGlvbnMtb3V0bGluZS5zdmciKTsKCQltYXJnaW4tcmlnaHQ6IDBweDsKCX0KCWJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIC50YWJsZS1jb2xsYXBzZTpob3ZlciB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2Fycm93LWZvcndhcmQuc3ZnIik7Cgl9Cglib25kdGFibGUtY29udGFpbmVyLmNvbGxhcHNlZCB7CgkJdHJhbnNmb3JtOiB0cmFuc2xhdGVYKGNhbGMoLTEwMCUgKyAzNXB4KSk7CgkJaGVpZ2h0OiBhdXRvICFpbXBvcnRhbnQ7CgkJbGVmdDogMHB4ICFpbXBvcnRhbnQ7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQlwYWRkaW5nOiA1cHg7Cgl9Cglib25kdGFibGUtY29udGFpbmVyLmNvbGxhcHNlZCBib25kdGFibGUtY29udGVudHMsCglib25kdGFibGUtY29udGFpbmVyLmNvbGxhcHNlZCBzZXBhcmF0b3IgewoJCWRpc3BsYXk6IG5vbmU7Cgl9CglAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKSB7CgkJYm9uZHRhYmxlLWNvbnRhaW5lciB7CgkJCWJvcmRlci1jb2xvcjogIzdkN2Q3ZDsKCQl9Cgl9Cjwvc3R5bGU+CgqkbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdkEJSBpH9qwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDc1ZmM0MGEzLTQyMzEtNDEyNS1iNTJjLWFkMjFmNWI4YTM4OLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzQrntXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QziqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedq9HTxzY3JpcHQ+CgkKY29uc3QgaW5kZW50ID0gdHJ1ZQpjb25zdCBhc2lkZSA9IHRydWUKY29uc3QgdGl0bGVfdGV4dCA9ICJUYWJsZSBvZiBDb250ZW50cyIKY29uc3QgaW5jbHVkZV9kZWZpbml0aW9ucyA9IGZhbHNlCgoKY29uc3QgdG9jTm9kZSA9IGh0bWxgPG5hdiBjbGFzcz0icGx1dG91aS10b2MiPgoJPGhlYWRlcj4KCSA8c3BhbiBjbGFzcz0idG9jLXRvZ2dsZSBvcGVuLXRvYyI+PC9zcGFuPgoJIDxzcGFuIGNsYXNzPSJ0b2MtdG9nZ2xlIGNsb3NlZC10b2MiPjwvc3Bhbj4KCSAke3RpdGxlX3RleHR9Cgk8L2hlYWRlcj4KCTxzZWN0aW9uPjwvc2VjdGlvbj4KPC9uYXY+YAoKdG9jTm9kZS5jbGFzc0xpc3QudG9nZ2xlKCJhc2lkZSIsIGFzaWRlKQp0b2NOb2RlLmNsYXNzTGlzdC50b2dnbGUoImluZGVudCIsIGluZGVudCkKCgpjb25zdCBnZXRQYXJlbnRDZWxsID0gZWwgPT4gZWwuY2xvc2VzdCgicGx1dG8tY2VsbCIpCgpjb25zdCBnZXRIZWFkZXJzID0gKCkgPT4gewoJY29uc3QgZGVwdGggPSBNYXRoLm1heCgxLCBNYXRoLm1pbig2LCAzKSkgLy8gc2hvdWxkIGJlIGluIHJhbmdlIDE6NgoJY29uc3QgcmFuZ2UgPSBBcnJheS5mcm9tKHtsZW5ndGg6IGRlcHRofSwgKHgsIGkpID0+IGkrMSkgLy8gWzEsIC4uLiwgZGVwdGhdCgkKCWNvbnN0IHNlbGVjdG9yID0gWwoJCS4uLihpbmNsdWRlX2RlZmluaXRpb25zID8gWwoJCQlgcGx1dG8tbm90ZWJvb2sgcGx1dG8tY2VsbCAucGx1dG8tZG9jcy1iaW5kaW5nYCwgCgkJCWBwbHV0by1ub3RlYm9vayBwbHV0by1jZWxsIGFzc2lnbmVlOm5vdCg6ZW1wdHkpYCwgCgkJXSA6IFtdKSwKCQkuLi5yYW5nZS5tYXAoaSA9PiBgcGx1dG8tbm90ZWJvb2sgcGx1dG8tY2VsbCBoJHtpfWApCgldLmpvaW4oIiwiKQoJcmV0dXJuIEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpLmZpbHRlcihlbCA9PiAKCQkvLyBleGNsdWRlIGhlYWRlcnMgaW5zaWRlIG9mIGEgcGx1dG8tZG9jcy1iaW5kaW5nIGJsb2NrCgkJIShlbC5ub2RlTmFtZS5zdGFydHNXaXRoKCJIIikgJiYgZWwuY2xvc2VzdCgiLnBsdXRvLWRvY3MtYmluZGluZyIpKQoJKQp9CgoKY29uc3QgZG9jdW1lbnRfY2xpY2tfaGFuZGxlciA9IChldmVudCkgPT4gewoJY29uc3QgcGF0aCA9IChldmVudC5wYXRoIHx8IGV2ZW50LmNvbXBvc2VkUGF0aCgpKQoJY29uc3QgdG9jID0gcGF0aC5maW5kKGVsZW0gPT4gZWxlbT8uY2xhc3NMaXN0Py5jb250YWlucz8uKCJ0b2MtdG9nZ2xlIikpCglpZiAodG9jKSB7CgkJZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkKCQl0b2MuY2xvc2VzdCgiLnBsdXRvdWktdG9jIikuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZSIpCgl9Cn0KCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZG9jdW1lbnRfY2xpY2tfaGFuZGxlcikKCgpjb25zdCBoZWFkZXJfdG9faW5kZXhfZW50cnlfbWFwID0gbmV3IE1hcCgpCmNvbnN0IGN1cnJlbnRseV9oaWdobGlnaHRlZF9zZXQgPSBuZXcgU2V0KCkKCmNvbnN0IGxhc3RfdG9jX2VsZW1lbnRfY2xpY2tfdGltZSA9IHsgY3VycmVudDogMCB9Cgpjb25zdCBpbnRlcnNlY3Rpb25fY2FsbGJhY2sgPSAoaXhzKSA9PiB7CglsZXQgb25fdG9wID0gaXhzLmZpbHRlcihpeCA9PiBpeC5pbnRlcnNlY3Rpb25SYXRpbyA+IDAgJiYgaXguaW50ZXJzZWN0aW9uUmVjdC55IDwgaXgucm9vdEJvdW5kcy5oZWlnaHQgLyAyKQoJaWYob25fdG9wLmxlbmd0aCA+IDApewoJCWN1cnJlbnRseV9oaWdobGlnaHRlZF9zZXQuZm9yRWFjaChhID0+IGEuY2xhc3NMaXN0LnJlbW92ZSgiaW4tdmlldyIpKQoJCWN1cnJlbnRseV9oaWdobGlnaHRlZF9zZXQuY2xlYXIoKQoJCW9uX3RvcC5zbGljZSgwLDEpLmZvckVhY2goaSA9PiB7CgkJCWxldCBkaXYgPSBoZWFkZXJfdG9faW5kZXhfZW50cnlfbWFwLmdldChpLnRhcmdldCkKCQkJZGl2LmNsYXNzTGlzdC5hZGQoImluLXZpZXciKQoJCQljdXJyZW50bHlfaGlnaGxpZ2h0ZWRfc2V0LmFkZChkaXYpCgkJCQoJCQkvLy8gc2Nyb2xsIGludG8gdmlldwoJCQkvKgoJCQljb25zdCB0b2NfaGVpZ2h0ID0gdG9jTm9kZS5vZmZzZXRIZWlnaHQKCQkJY29uc3QgZGl2X3BvcyA9IGRpdi5vZmZzZXRUb3AKCQkJY29uc3QgZGl2X2hlaWdodCA9IGRpdi5vZmZzZXRIZWlnaHQKCQkJY29uc3QgY3VycmVudF9zY3JvbGwgPSB0b2NOb2RlLnNjcm9sbFRvcAoJCQljb25zdCBoZWFkZXJfaGVpZ2h0ID0gdG9jTm9kZS5xdWVyeVNlbGVjdG9yKCJoZWFkZXIiKS5vZmZzZXRIZWlnaHQKCQkJCgkJCWNvbnN0IHNjcm9sbF90b190b3AgPSBkaXZfcG9zIC0gaGVhZGVyX2hlaWdodAoJCQljb25zdCBzY3JvbGxfdG9fYm90dG9tID0gZGl2X3BvcyArIGRpdl9oZWlnaHQgLSB0b2NfaGVpZ2h0CgkJCQoJCQkvLyBpZiB3ZSBzZXQgYSBzY3JvbGxUb3AsIHRoZW4gdGhlIGJyb3dzZXIgd2lsbCBzdG9wIGFueSBjdXJyZW50bHkgb25nb2luZyBzbW9vdGhzY3JvbGwgYW5pbWF0aW9uLiBTbyBsZXQncyBvbmx5IGRvIHRoaXMgaWYgeW91IGFyZSBub3QgY3VycmVudGx5IGluIGEgc21vb3Roc2Nyb2xsLgoJCQlpZihEYXRlLm5vdygpIC0gbGFzdF90b2NfZWxlbWVudF9jbGlja190aW1lLmN1cnJlbnQgPj0gMjAwMCkKCQkJCWlmKGN1cnJlbnRfc2Nyb2xsIDwgc2Nyb2xsX3RvX2JvdHRvbSl7CgkJCQkJdG9jTm9kZS5zY3JvbGxUb3AgPSBzY3JvbGxfdG9fYm90dG9tCgkJCQl9IGVsc2UgaWYoY3VycmVudF9zY3JvbGwgPiBzY3JvbGxfdG9fdG9wKXsKCQkJCQl0b2NOb2RlLnNjcm9sbFRvcCA9IHNjcm9sbF90b190b3AKCQkJCX0KCQkJKi8KCQl9KQoJfQp9CmxldCBpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMSA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihpbnRlcnNlY3Rpb25fY2FsbGJhY2ssIHsKCXJvb3Q6IG51bGwsIC8vIGkuZS4gdGhlIHZpZXdwb3J0CiAgCXRocmVzaG9sZDogMSwKCXJvb3RNYXJnaW46ICItMTVweCIsIC8vIHNsaWdodGx5IHNtYWxsZXIgdGhhbiB0aGUgdmlld3BvcnQKCS8vIGRlbGF5OiAxMDAsCn0pCmxldCBpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMiA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihpbnRlcnNlY3Rpb25fY2FsbGJhY2ssIHsKCXJvb3Q6IG51bGwsIC8vIGkuZS4gdGhlIHZpZXdwb3J0CiAgCXRocmVzaG9sZDogMSwKCXJvb3RNYXJnaW46ICIxNXB4IiwgLy8gc2xpZ2h0bHkgbGFyZ2VyIHRoYW4gdGhlIHZpZXdwb3J0CgkvLyBkZWxheTogMTAwLAp9KQoKY29uc3QgcmVuZGVyID0gKGVsZW1lbnRzKSA9PiB7CgloZWFkZXJfdG9faW5kZXhfZW50cnlfbWFwLmNsZWFyKCkKCWN1cnJlbnRseV9oaWdobGlnaHRlZF9zZXQuY2xlYXIoKQoJaW50ZXJzZWN0aW9uX29ic2VydmVyXzEuZGlzY29ubmVjdCgpCglpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMi5kaXNjb25uZWN0KCkKCgkJbGV0IGxhc3RfbGV2ZWwgPSBgSDFgCglyZXR1cm4gaHRtbGAke2VsZW1lbnRzLm1hcChoID0+IHsKCWNvbnN0IHBhcmVudF9jZWxsID0gZ2V0UGFyZW50Q2VsbChoKQoKCQlsZXQgW2NsYXNzTmFtZSwgdGl0bGVfZWxdID0gaC5tYXRjaGVzKGAucGx1dG8tZG9jcy1iaW5kaW5nYCkgPyBbInBsdXRvLWRvY3MtYmluZGluZy1lbCIsIGguZmlyc3RFbGVtZW50Q2hpbGRdIDogW2gubm9kZU5hbWUsIGhdCgoJY29uc3QgYSA9IGh0bWxgPGEgCgkJY2xhc3M9IiR7Y2xhc3NOYW1lfSIgCgkJdGl0bGU9IiR7dGl0bGVfZWwuaW5uZXJUZXh0fSIKCQlocmVmPSIjJHtwYXJlbnRfY2VsbC5pZH0iCgk+JHt0aXRsZV9lbC5pbm5lckhUTUx9PC9hPmAKCS8qIGEub25tb3VzZW92ZXI9KCk9PnsKCQlwYXJlbnRfY2VsbC5maXJzdEVsZW1lbnRDaGlsZC5jbGFzc0xpc3QuYWRkKAoJCQknaGlnaGxpZ2h0LXBsdXRvLWNlbGwtc2hvdWxkZXInCgkJKQoJfQoJYS5vbm1vdXNlb3V0PSgpID0+IHsKCQlwYXJlbnRfY2VsbC5maXJzdEVsZW1lbnRDaGlsZC5jbGFzc0xpc3QucmVtb3ZlKAoJCQknaGlnaGxpZ2h0LXBsdXRvLWNlbGwtc2hvdWxkZXInCgkJKQoJfSAqLwoJCQoJCQoJYS5vbmNsaWNrPShlKSA9PiB7CgkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCWxhc3RfdG9jX2VsZW1lbnRfY2xpY2tfdGltZS5jdXJyZW50ID0gRGF0ZS5ub3coKQoJCWguc2Nyb2xsSW50b1ZpZXcoewoJCQliZWhhdmlvcjogJ3Ntb290aCcsIAoJCQlibG9jazogJ3N0YXJ0JwoJCX0pCgl9CgoJY29uc3Qgcm93ID0gIGh0bWxgPGRpdiBjbGFzcz0idG9jLXJvdyAke2NsYXNzTmFtZX0gYWZ0ZXItJHtsYXN0X2xldmVsfSI+JHthfTwvZGl2PmAKCQlpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMS5vYnNlcnZlKHRpdGxlX2VsKQoJCWludGVyc2VjdGlvbl9vYnNlcnZlcl8yLm9ic2VydmUodGl0bGVfZWwpCgkJaGVhZGVyX3RvX2luZGV4X2VudHJ5X21hcC5zZXQodGl0bGVfZWwsIHJvdykKCglpZihjbGFzc05hbWUuc3RhcnRzV2l0aCgiSCIpKQoJCWxhc3RfbGV2ZWwgPSBjbGFzc05hbWUKCQkKCXJldHVybiByb3cKfSl9YAp9Cgpjb25zdCBpbnZhbGlkYXRlZCA9IHsgY3VycmVudDogZmFsc2UgfQoKY29uc3QgdXBkYXRlQ2FsbGJhY2sgPSAoKSA9PiB7CglpZiAoIWludmFsaWRhdGVkLmN1cnJlbnQpIHsKCQl0b2NOb2RlLnF1ZXJ5U2VsZWN0b3IoInNlY3Rpb24iKS5yZXBsYWNlV2l0aCgKCQkJaHRtbGA8c2VjdGlvbj4ke3JlbmRlcihnZXRIZWFkZXJzKCkpfTwvc2VjdGlvbj5gCgkJKQoJfQp9CnVwZGF0ZUNhbGxiYWNrKCkKc2V0VGltZW91dCh1cGRhdGVDYWxsYmFjaywgMTAwKQpzZXRUaW1lb3V0KHVwZGF0ZUNhbGxiYWNrLCAxMDAwKQpzZXRUaW1lb3V0KHVwZGF0ZUNhbGxiYWNrLCA1MDAwKQoKY29uc3Qgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJwbHV0by1ub3RlYm9vayIpCgoKLy8gV2UgaGF2ZSBhIG11dGF0aW9ub2JzZXJ2ZXIgZm9yIGVhY2ggY2VsbDoKY29uc3QgbXV0X29ic2VydmVycyA9IHsKCWN1cnJlbnQ6IFtdLAp9Cgpjb25zdCBjcmVhdGVDZWxsT2JzZXJ2ZXJzID0gKCkgPT4gewoJbXV0X29ic2VydmVycy5jdXJyZW50LmZvckVhY2goKG8pID0+IG8uZGlzY29ubmVjdCgpKQoJbXV0X29ic2VydmVycy5jdXJyZW50ID0gQXJyYXkuZnJvbShub3RlYm9vay5xdWVyeVNlbGVjdG9yQWxsKCJwbHV0by1jZWxsIikpLm1hcChlbCA9PiB7CgkJY29uc3QgbyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHVwZGF0ZUNhbGxiYWNrKQoJCW8ub2JzZXJ2ZShlbCwge2F0dHJpYnV0ZUZpbHRlcjogWyJjbGFzcyJdfSkKCQlyZXR1cm4gbwoJfSkKfQpjcmVhdGVDZWxsT2JzZXJ2ZXJzKCkKCi8vIEFuZCBvbmUgZm9yIHRoZSBub3RlYm9vaydzIGNoaWxkIGxpc3QsIHdoaWNoIHVwZGF0ZXMgb3VyIGNlbGwgb2JzZXJ2ZXJzOgpjb25zdCBub3RlYm9va09ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4gewoJdXBkYXRlQ2FsbGJhY2soKQoJY3JlYXRlQ2VsbE9ic2VydmVycygpCn0pCm5vdGVib29rT2JzZXJ2ZXIub2JzZXJ2ZShub3RlYm9vaywge2NoaWxkTGlzdDogdHJ1ZX0pCgovLyBBbmQgZmluYWxseSwgYW4gb2JzZXJ2ZXIgZm9yIHRoZSBkb2N1bWVudC5ib2R5IGNsYXNzTGlzdCwgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHRvYyBhbHNvIHdvcmtzIHdoZW4gaXQgaXMgbG9hZGVkIGR1cmluZyBub3RlYm9vayBpbml0aWFsaXphdGlvbgpjb25zdCBib2R5Q2xhc3NPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHVwZGF0ZUNhbGxiYWNrKQpib2R5Q2xhc3NPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHthdHRyaWJ1dGVGaWx0ZXI6IFsiY2xhc3MiXX0pCgovLyBIaWRlL3Nob3cgdGhlIFRvQyB3aGVuIHRoZSBzY3JlZW4gZ2V0cyBzbWFsbApsZXQgbSA9IG1hdGNoTWVkaWEoIihtYXgtd2lkdGg6IDEwMDBweCkiKQpsZXQgbWF0Y2hfbGlzdGVuZXIgPSAoKSA9PiAKCXRvY05vZGUuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZSIsIG0ubWF0Y2hlcykKbWF0Y2hfbGlzdGVuZXIoKQptLmFkZExpc3RlbmVyKG1hdGNoX2xpc3RlbmVyKQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJaW52YWxpZGF0ZWQuY3VycmVudCA9IHRydWUKCWludGVyc2VjdGlvbl9vYnNlcnZlcl8xLmRpc2Nvbm5lY3QoKQoJaW50ZXJzZWN0aW9uX29ic2VydmVyXzIuZGlzY29ubmVjdCgpCglub3RlYm9va09ic2VydmVyLmRpc2Nvbm5lY3QoKQoJYm9keUNsYXNzT2JzZXJ2ZXIuZGlzY29ubmVjdCgpCgltdXRfb2JzZXJ2ZXJzLmN1cnJlbnQuZm9yRWFjaCgobykgPT4gby5kaXNjb25uZWN0KCkpCglkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGRvY3VtZW50X2NsaWNrX2hhbmRsZXIpCgltLnJlbW92ZUxpc3RlbmVyKG1hdGNoX2xpc3RlbmVyKQp9KQoKcmV0dXJuIHRvY05vZGUKPC9zY3JpcHQ+CjxzdHlsZT4KQG1lZGlhIG5vdCBwcmludCB7CgoucGx1dG91aS10b2MgewoJZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgIlNlZ29lIFVJIiwgUm9ib3RvLCBPeHlnZW4tU2FucywgQ2FudGFyZWxsLCBIZWx2ZXRpY2EsIEFyaWFsLCAiQXBwbGUgQ29sb3IgRW1vamkiLAoJCSJTZWdvZSBVSSBFbW9qaSIsICJTZWdvZSBVSSBTeW1ib2wiLCBzeXN0ZW0tdWksIHNhbnMtc2VyaWY7CgktLW1haW4tYmctY29sb3I6ICNmYWZhZmE7CgktLXBsdXRvLW91dHB1dC1jb2xvcjogaHNsKDAsIDAlLCAzNiUpOwoJLS1wbHV0by1vdXRwdXQtaC1jb2xvcjogaHNsKDAsIDAlLCAyMSUpOwoJLS1zaWRlYmFyLWxpLWFjdGl2ZS1iZzogcmdiKDIzNSwgMjM1LCAyMzUpOwoJLS1pY29uLWZpbHRlcjogdW5zZXQ7Cn0KCkBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKCS5wbHV0b3VpLXRvYyB7CgkJLS1tYWluLWJnLWNvbG9yOiAjMzAzMDMwOwoJCS0tcGx1dG8tb3V0cHV0LWNvbG9yOiBoc2woMCwgMCUsIDkwJSk7CgkJLS1wbHV0by1vdXRwdXQtaC1jb2xvcjogaHNsKDAsIDAlLCA5NyUpOwoJCS0tc2lkZWJhci1saS1hY3RpdmUtYmc6IHJnYig4MiwgODIsIDgyKTsKCQktLWljb24tZmlsdGVyOiBpbnZlcnQoMSk7Cgl9Cn0KCi5wbHV0b3VpLXRvYy5hc2lkZSB7Cgljb2xvcjogdmFyKC0tcGx1dG8tb3V0cHV0LWNvbG9yKTsKCXBvc2l0aW9uOiBmaXhlZDsKCXJpZ2h0OiAxcmVtOwoJdG9wOiA1cmVtOwoJd2lkdGg6IG1pbig4MHZ3LCAzMDBweCk7CglwYWRkaW5nOiAwLjVyZW07CglwYWRkaW5nLXRvcDogMGVtOwoJLyogYm9yZGVyOiAzcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjE1KTsgKi8KCWJvcmRlci1yYWRpdXM6IDEwcHg7CgkvKiBib3gtc2hhZG93OiAwIDAgMTFweCAwcHggIzAwMDAwMDEwOyAqLwoJbWF4LWhlaWdodDogY2FsYygxMDB2aCAtIDVyZW0gLSA5MHB4KTsKCW92ZXJmbG93OiBhdXRvOwoJei1pbmRleDogNDA7CgliYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1tYWluLWJnLWNvbG9yKTsKCXRyYW5zaXRpb246IHRyYW5zZm9ybSAzMDBtcyBjdWJpYy1iZXppZXIoMC4xOCwgMC44OSwgMC40NSwgMS4xMik7Cn0KCi5wbHV0b3VpLXRvYy5hc2lkZS5oaWRlIHsKCXRyYW5zZm9ybTogdHJhbnNsYXRlWChjYWxjKDEwMCUgLSAyOHB4KSk7Cn0KLnBsdXRvdWktdG9jLmFzaWRlLmhpZGUgc2VjdGlvbiB7CglkaXNwbGF5OiBub25lOwp9Ci5wbHV0b3VpLXRvYy5hc2lkZS5oaWRlIGhlYWRlciB7CgltYXJnaW4tYm90dG9tOiAwZW07CglwYWRkaW5nLWJvdHRvbTogMGVtOwoJYm9yZGVyLWJvdHRvbTogbm9uZTsKfQp9ICAvKiBFbmQgb2YgTWVkaWEgcHJpbnQgcXVlcnkgKi8KLnBsdXRvdWktdG9jLmFzaWRlLmhpZGUgLm9wZW4tdG9jLAoucGx1dG91aS10b2MuYXNpZGU6bm90KC5oaWRlKSAuY2xvc2VkLXRvYywKLnBsdXRvdWktdG9jOm5vdCguYXNpZGUpIC5jbG9zZWQtdG9jIHsKCWRpc3BsYXk6IG5vbmU7Cn0KCkBtZWRpYSAocHJlZmVycy1yZWR1Y2VkLW1vdGlvbikgewogIC5wbHV0b3VpLXRvYy5hc2lkZSB7Cgl0cmFuc2l0aW9uLWR1cmF0aW9uOiAwczsKICB9Cn0KCi50b2MtdG9nZ2xlIHsKCWN1cnNvcjogcG9pbnRlcjsKICAgIHBhZGRpbmc6IDFlbTsKICAgIG1hcmdpbjogLTFlbTsKICAgIG1hcmdpbi1yaWdodDogLTAuN2VtOwogICAgbGluZS1oZWlnaHQ6IDFlbTsKICAgIGRpc3BsYXk6IGZsZXg7Cn0KCi50b2MtdG9nZ2xlOjpiZWZvcmUgewogICAgY29udGVudDogIiI7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICBoZWlnaHQ6IDFlbTsKICAgIHdpZHRoOiAxZW07CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvbGlzdC1vdXRsaW5lLnN2ZyIpOwoJLyogZ2VuZXJhdGVkIHVzaW5nIGh0dHBzOi8vZG9waWF6YS5vcmcvdG9vbHMvZGF0YXVyaS9pbmRleC5waHAgKi8KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kxTVRJaUlHaGxhV2RvZEQwaU5URXlJaUIyYVdWM1FtOTRQU0l3SURBZ05URXlJRFV4TWlJK1BIUnBkR3hsUG1sdmJtbGpiMjV6TFhZMUxXODhMM1JwZEd4bFBqeHNhVzVsSUhneFBTSXhOakFpSUhreFBTSXhORFFpSUhneVBTSTBORGdpSUhreVBTSXhORFFpSUhOMGVXeGxQU0ptYVd4c09tNXZibVU3YzNSeWIydGxPaU13TURBN2MzUnliMnRsTFd4cGJtVmpZWEE2Y205MWJtUTdjM1J5YjJ0bExXeHBibVZxYjJsdU9uSnZkVzVrTzNOMGNtOXJaUzEzYVdSMGFEb3pNbkI0SWk4K1BHeHBibVVnZURFOUlqRTJNQ0lnZVRFOUlqSTFOaUlnZURJOUlqUTBPQ0lnZVRJOUlqSTFOaUlnYzNSNWJHVTlJbVpwYkd3NmJtOXVaVHR6ZEhKdmEyVTZJekF3TUR0emRISnZhMlV0YkdsdVpXTmhjRHB5YjNWdVpEdHpkSEp2YTJVdGJHbHVaV3B2YVc0NmNtOTFibVE3YzNSeWIydGxMWGRwWkhSb09qTXljSGdpTHo0OGJHbHVaU0I0TVQwaU1UWXdJaUI1TVQwaU16WTRJaUI0TWowaU5EUTRJaUI1TWowaU16WTRJaUJ6ZEhsc1pUMGlabWxzYkRwdWIyNWxPM04wY205clpUb2pNREF3TzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaRHR6ZEhKdmEyVXRkMmxrZEdnNk16SndlQ0l2UGp4amFYSmpiR1VnWTNnOUlqZ3dJaUJqZVQwaU1UUTBJaUJ5UFNJeE5pSWdjM1I1YkdVOUltWnBiR3c2Ym05dVpUdHpkSEp2YTJVNkl6QXdNRHR6ZEhKdmEyVXRiR2x1WldOaGNEcHliM1Z1WkR0emRISnZhMlV0YkdsdVpXcHZhVzQ2Y205MWJtUTdjM1J5YjJ0bExYZHBaSFJvT2pNeWNIZ2lMejQ4WTJseVkyeGxJR040UFNJNE1DSWdZM2s5SWpJMU5pSWdjajBpTVRZaUlITjBlV3hsUFNKbWFXeHNPbTV2Ym1VN2MzUnliMnRsT2lNd01EQTdjM1J5YjJ0bExXeHBibVZqWVhBNmNtOTFibVE3YzNSeWIydGxMV3hwYm1WcWIybHVPbkp2ZFc1a08zTjBjbTlyWlMxM2FXUjBhRG96TW5CNElpOCtQR05wY21Oc1pTQmplRDBpT0RBaUlHTjVQU0l6TmpnaUlISTlJakUySWlCemRIbHNaVDBpWm1sc2JEcHViMjVsTzNOMGNtOXJaVG9qTURBd08zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkR0emRISnZhMlV0ZDJsa2RHZzZNekp3ZUNJdlBqd3ZjM1puUGc9PSIpOwogICAgYmFja2dyb3VuZC1zaXplOiAxZW07CglmaWx0ZXI6IHZhcigtLWljb24tZmlsdGVyKTsKfQoKLmFzaWRlIC50b2MtdG9nZ2xlLm9wZW4tdG9jOmhvdmVyOjpiZWZvcmUgewogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2Fycm93LWZvcndhcmQtb3V0bGluZS5zdmciKTsKCS8qIGdlbmVyYXRlZCB1c2luZyBodHRwczovL2RvcGlhemEub3JnL3Rvb2xzL2RhdGF1cmkvaW5kZXgucGhwICovCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJMU1USWlJR2hsYVdkb2REMGlOVEV5SWlCMmFXVjNRbTk0UFNJd0lEQWdOVEV5SURVeE1pSStQSFJwZEd4bFBtbHZibWxqYjI1ekxYWTFMV0U4TDNScGRHeGxQanh3YjJ4NWJHbHVaU0J3YjJsdWRITTlJakkyT0NBeE1USWdOREV5SURJMU5pQXlOamdnTkRBd0lpQnpkSGxzWlQwaVptbHNiRHB1YjI1bE8zTjBjbTlyWlRvak1EQXdPM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpEdHpkSEp2YTJVdGQybGtkR2c2TkRod2VDSXZQanhzYVc1bElIZ3hQU0l6T1RJaUlIa3hQU0l5TlRZaUlIZ3lQU0l4TURBaUlIa3lQU0l5TlRZaUlITjBlV3hsUFNKbWFXeHNPbTV2Ym1VN2MzUnliMnRsT2lNd01EQTdjM1J5YjJ0bExXeHBibVZqWVhBNmNtOTFibVE3YzNSeWIydGxMV3hwYm1WcWIybHVPbkp2ZFc1a08zTjBjbTlyWlMxM2FXUjBhRG8wT0hCNElpOCtQQzl6ZG1jKyIpOwp9Ci5hc2lkZSAudG9jLXRvZ2dsZS5jbG9zZWQtdG9jOmhvdmVyOjpiZWZvcmUgewogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2Fycm93LWJhY2stb3V0bGluZS5zdmciKTsKCS8qIGdlbmVyYXRlZCB1c2luZyBodHRwczovL2RvcGlhemEub3JnL3Rvb2xzL2RhdGF1cmkvaW5kZXgucGhwICovCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJMU1USWlJR2hsYVdkb2REMGlOVEV5SWlCMmFXVjNRbTk0UFNJd0lEQWdOVEV5SURVeE1pSStQSFJwZEd4bFBtbHZibWxqYjI1ekxYWTFMV0U4TDNScGRHeGxQanh3YjJ4NWJHbHVaU0J3YjJsdWRITTlJakkwTkNBME1EQWdNVEF3SURJMU5pQXlORFFnTVRFeUlpQnpkSGxzWlQwaVptbHNiRHB1YjI1bE8zTjBjbTlyWlRvak1EQXdPM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpEdHpkSEp2YTJVdGQybGtkR2c2TkRod2VDSXZQanhzYVc1bElIZ3hQU0l4TWpBaUlIa3hQU0l5TlRZaUlIZ3lQU0kwTVRJaUlIa3lQU0l5TlRZaUlITjBlV3hsUFNKbWFXeHNPbTV2Ym1VN2MzUnliMnRsT2lNd01EQTdjM1J5YjJ0bExXeHBibVZqWVhBNmNtOTFibVE3YzNSeWIydGxMV3hwYm1WcWIybHVPbkp2ZFc1a08zTjBjbTlyWlMxM2FXUjBhRG8wT0hCNElpOCtQQzl6ZG1jKyIpOwp9CgoKCi5wbHV0b3VpLXRvYyBoZWFkZXIgewoJZGlzcGxheTogZmxleDsKCWFsaWduLWl0ZW1zOiBjZW50ZXI7CglnYXA6IC4zZW07Cglmb250LXNpemU6IDEuNWVtOwoJLyogbWFyZ2luLXRvcDogLTAuMWVtOyAqLwoJbWFyZ2luLWJvdHRvbTogMC40ZW07CglwYWRkaW5nOiAwLjVyZW07CgltYXJnaW4tbGVmdDogMDsKCW1hcmdpbi1yaWdodDogMDsKCWZvbnQtd2VpZ2h0OiBib2xkOwoJLyogYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC4xNSk7ICovCglwb3NpdGlvbjogc3RpY2t5OwoJdG9wOiAwcHg7CgliYWNrZ3JvdW5kOiB2YXIoLS1tYWluLWJnLWNvbG9yKTsKCXotaW5kZXg6IDQxOwp9Ci5wbHV0b3VpLXRvYy5hc2lkZSBoZWFkZXIgewoJcGFkZGluZy1sZWZ0OiAwOwoJcGFkZGluZy1yaWdodDogMDsKfQoKLnBsdXRvdWktdG9jIHNlY3Rpb24gLnRvYy1yb3cgewoJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCW92ZXJmbG93OiBoaWRkZW47Cgl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCXBhZGRpbmc6IC4xZW07Cglib3JkZXItcmFkaXVzOiAuMmVtOwp9CgoucGx1dG91aS10b2Mgc2VjdGlvbiAudG9jLXJvdy5IMSB7CgltYXJnaW4tdG9wOiAxZW07Cn0KCgoucGx1dG91aS10b2MuYXNpZGUgc2VjdGlvbiAudG9jLXJvdy5pbi12aWV3IHsKCWJhY2tncm91bmQ6IHZhcigtLXNpZGViYXItbGktYWN0aXZlLWJnKTsKfQoKCgkKLmhpZ2hsaWdodC1wbHV0by1jZWxsLXNob3VsZGVyIHsKCWJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4wNSk7CgliYWNrZ3JvdW5kLWNsaXA6IHBhZGRpbmctYm94Owp9CgoucGx1dG91aS10b2Mgc2VjdGlvbiBhIHsKCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCWZvbnQtd2VpZ2h0OiBub3JtYWw7Cgljb2xvcjogdmFyKC0tcGx1dG8tb3V0cHV0LWNvbG9yKTsKfQoucGx1dG91aS10b2Mgc2VjdGlvbiBhOmhvdmVyIHsKCWNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtaC1jb2xvcik7Cn0KCi5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkgxIHsKCWZvbnQtd2VpZ2h0OiA3MDA7CglsaW5lLWhlaWdodDogMWVtOwp9CgoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gLmFmdGVyLUgyIGEgeyBwYWRkaW5nLWxlZnQ6IDEwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIC5hZnRlci1IMyBhIHsgcGFkZGluZy1sZWZ0OiAyMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiAuYWZ0ZXItSDQgYSB7IHBhZGRpbmctbGVmdDogMzBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gLmFmdGVyLUg1IGEgeyBwYWRkaW5nLWxlZnQ6IDQwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIC5hZnRlci1INiBhIHsgcGFkZGluZy1sZWZ0OiA1MHB4OyB9CgoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5IMSB7IHBhZGRpbmctbGVmdDogMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkgyIHsgcGFkZGluZy1sZWZ0OiAxMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkgzIHsgcGFkZGluZy1sZWZ0OiAyMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkg0IHsgcGFkZGluZy1sZWZ0OiAzMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkg1IHsgcGFkZGluZy1sZWZ0OiA0MHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkg2IHsgcGFkZGluZy1sZWZ0OiA1MHB4OyB9CgoKLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEucGx1dG8tZG9jcy1iaW5kaW5nLWVsLAoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5BU1NJR05FRQoJewoJZm9udC1mYW1pbHk6IEp1bGlhTW9ubywgbW9ub3NwYWNlOwoJZm9udC1zaXplOiAuOGVtOwoJLyogYmFja2dyb3VuZDogYmxhY2s7ICovCglmb250LXdlaWdodDogNzAwOwogICAgZm9udC1zdHlsZTogaXRhbGljOwoJY29sb3I6IHZhcigtLWNtLXZhci1jb2xvcik7IC8qIHRoaXMgaXMgc3RlYWxpbmcgYSB2YXJpYWJsZSBmcm9tIFBsdXRvLCBidXQgaXQncyBmaW5lIGlmIHRoYXQgZG9lc250IHdvcmsgKi8KfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5wbHV0by1kb2NzLWJpbmRpbmctZWw6OmJlZm9yZSwKLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuQVNTSUdORUU6OmJlZm9yZQoJewoJY29udGVudDogIj4gIjsKCW9wYWNpdHk6IC4zOwp9Cjwvc3R5bGU+Cgo8c2NyaXB0IGlkPSd1TjFKeFInPgoJCgkvKiAjIyMjIEJFR0lOTklORyBPRiBQQVJUIEFVVE9NQVRJQ0FMTFkgQURERUQgQlkgSFRMU0NSSVBUICMjIyMgKi8KCS8vIEFycmF5IHdoZXJlIGFsbCB0aGUgZXZlbnQgbGlzdGVuZXJzIGFyZSBzdG9yZWQKCWNvbnN0IF9ldmVudHNfbGlzdGVuZXJzXyA9IFtdCgoJLy8gRnVuY3Rpb24gdGhhdCBjYW4gYmUgY2FsbGVkIHRvIGFkZCBldmVudHMgbGlzdGVuZXJzIHdpdGhpbiB0aGUgc2NyaXB0CglmdW5jdGlvbiBhZGRTY3JpcHRFdmVudExpc3RlbmVycyhlbGVtZW50LCBsaXN0ZW5lcnMpIHsKCQlpZiAobGlzdGVuZXJzLmNvbnN0cnVjdG9yICE9IE9iamVjdCkge2Vycm9yKCdPbmx5IG9iamVjdHMgd2l0aCBrZXlzIGFzIGV2ZW50IG5hbWVzIGFuZCB2YWx1ZXMgYXMgbGlzdGVuZXIgZnVuY3Rpb25zIGFyZSBzdXBwb3J0ZWQnKX0KCQlfZXZlbnRzX2xpc3RlbmVyc18ucHVzaCh7ZWxlbWVudCwgbGlzdGVuZXJzfSkKCX0KCS8qICMjIyMgRU5EIE9GIFBBUlQgQVVUT01BVElDQUxMWSBBRERFRCBCWSBIVExTQ1JJUFQgIyMjIyAqLwoKCWNvbnN0IHVzZV9zbW9vdGhzY3JvbGwgPSB0cnVlCmNvbnN0IGhpZGVfcHJlYW1ibGUgPSB0cnVlCmNvbnN0IGZvcmNlX2hpZGVfZW5hYmxlZCA9IHRydWUKCgkhZnVuY3Rpb24odCl7dmFyIGUsbj10LnJlcXVlc3RBbmltYXRpb25GcmFtZXx8dC53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHQubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx0Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHQubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fGZ1bmN0aW9uKGUpe3Quc2V0VGltZW91dChlLDFlMy82MCl9LG89W10scj1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaHRtbCIpWzBdO2Z1bmN0aW9uIGkobil7dmFyIG89bi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxpPXQucGFnZVlPZmZzZXR8fHIuc2Nyb2xsVG9wfHxlLnNjcm9sbFRvcCxsPXQucGFnZVhPZmZzZXR8fHIuc2Nyb2xsTGVmdHx8ZS5zY3JvbGxMZWZ0LHM9ci5jbGllbnRUb3B8fGUuY2xpZW50VG9wfHwwLGE9ci5jbGllbnRMZWZ0fHxlLmNsaWVudExlZnR8fDA7cmV0dXJue3RvcDpvLnRvcCtpLXMsbGVmdDpvLmxlZnQrbC1hfX1mdW5jdGlvbiBsKHQpe3JldHVybi9FbGVtZW50Ly50ZXN0KHt9LnRvU3RyaW5nLmNhbGwodCkpfWZ1bmN0aW9uIHModCxlLG4pe3ZhciBvO2lmKCJudW1iZXIiPT10eXBlb2YgdClyZXR1cm4gdDtzd2l0Y2godCl7Y2FzZSJzdGFydCI6bz0wO2JyZWFrO2Nhc2UiZW5kIjpvPW4rMTA7YnJlYWs7Y2FzZSJjZW50ZXIiOm89bi8yO2JyZWFrO2RlZmF1bHQ6dmFyIHIsaT10LnNwbGl0KCIrIiksbD10LnNwbGl0KCItIik7aWYodC5pbmRleE9mKCIrIik+MCl0aHJvdyBuZXcgRXJyb3IoIlBvc2l0aW9uIGNhbiBvbmx5IGNvbnRhaW4gYSArIHNpZ24gYXQgdGhlIHN0YXJ0Iik7aWYodC5pbmRleE9mKCItIik+MCl0aHJvdyBuZXcgRXJyb3IoIlBvc2l0aW9uIGNhbiBvbmx5IGNvbnRhaW4gYSAtIHNpZ24gYXQgdGhlIHN0YXJ0Iik7aWYodC5pbmRleE9mKCIrIik+LTEmJnQuaW5kZXhPZigiLSIpPi0xKXRocm93IG5ldyBFcnJvcigiUG9zaXRpb24gY2Fubm90IGNvbnRhaW4gYm90aCArIGFuZCAtIHNpZ25zLiIpO2lmKHQuaW5kZXhPZigiJSIpPi0xJiZ0LmluZGV4T2YoIiUiKSE9PXQubGVuZ3RoLTEpdGhyb3cgbmV3IEVycm9yKCJQb3NpdGlvbiBjYW4gb25seSBjb250YWluIGEgJSBzeW1ib2wgYXQgdGhlIGVuZC4iKTtvPWlbMV0/KHI9aVsxXSkuaW5kZXhPZigiJSIpPi0xP2Urbioocj1yLnNwbGl0KCIlIilbMF0pLzEwMDplKyArcjpsWzFdPyhyPWxbMV0pLmluZGV4T2YoIiUiKT4tMT9lLW4qKHI9ci5zcGxpdCgiJSIpWzBdKS8xMDA6ZS0rcjp0LmluZGV4T2YoIiUiKT4tMT9uKihyPXQuc3BsaXQoIiUiKVswXSkvMTAwOit0fXJldHVybiBvfWZ1bmN0aW9uIGEodCxlLG4pe3QuYWRkRXZlbnRMaXN0ZW5lcj90LmFkZEV2ZW50TGlzdGVuZXIoZSxuLCExKTp0LmF0dGFjaEV2ZW50JiZ0LmF0dGFjaEV2ZW50KCJvbiIrZSxuKX1mdW5jdGlvbiBjKHQsZSxuKXt0LnJlbW92ZUV2ZW50TGlzdGVuZXI/dC5yZW1vdmVFdmVudExpc3RlbmVyKGUsbiwhMSk6dC5kZXRhY2hFdmVudCYmdC5kZXRhY2hFdmVudCgib24iK2Usbil9dmFyIHU9e2R1cmF0aW9uOjUwMCxwcmV2ZW50VXNlclNjcm9sbDohMCxzY3JvbGxFdmVudHM6WyJzY3JvbGwiLCJtb3VzZWRvd24iLCJ3aGVlbCIsIkRPTU1vdXNlU2Nyb2xsIiwibW91c2V3aGVlbCIsInRvdWNobW92ZSJdLHNjcm9sbEtleXM6WzM3LDM4LDM5LDQwLDMyXSxhbGxvd0FuaW1hdGlvbk92ZXJsYXA6ITEsZWFzaW5nOiJsaW5lYXIifTtmdW5jdGlvbiBmKCl7Zm9yKHZhciB0PTA7dDxhcmd1bWVudHMubGVuZ3RoO3QrKylpZihudWxsIT1hcmd1bWVudHNbdF0pcmV0dXJuIGFyZ3VtZW50c1t0XX1mdW5jdGlvbiBkKHQsZSxuLG8pe2lmKCJzdHJpbmciIT10eXBlb2YgdCl0aHJvdyBuZXcgRXJyb3IoIkJsb2NrIGFuZCBpbmxpbmUgdmFsdWVzIG11c3QgYmUgc3RyaW5ncyIpO2Z1bmN0aW9uIHIodCl7cmV0dXJuIGUtKG4tbykqdH1zd2l0Y2godCl7Y2FzZSJzdGFydCI6cmV0dXJuIGU7Y2FzZSJjZW50ZXIiOnJldHVybiByKC41KTtjYXNlImVuZCI6cmV0dXJuIHIoMSk7ZGVmYXVsdDppZih0LmluZGV4T2YoIiUiKT4tMSYmdC5zcGxpdCgiJSIpLmxlbmd0aDwzKXJldHVybiByKCt0LnNwbGl0KCIlIilbMF0vMTAwKTt0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYmxvY2sgb3IgaW5saW5lIHN0cmluZyB2YWx1ZSIpfX1mdW5jdGlvbiBoKGUsbil7aWYodC5nZXRDb21wdXRlZFN0eWxlKXt2YXIgbz1nZXRDb21wdXRlZFN0eWxlKGUsbnVsbCk7aWYoby5nZXRQcm9wZXJ0eVZhbHVlKXJldHVybiBvLmdldFByb3BlcnR5VmFsdWUobik7aWYoby5nZXRBdHRyaWJ1dGUpcmV0dXJuIG8uZ2V0QXR0cmlidXRlKG4pO2lmKG9bbl0pcmV0dXJuIG9bbl19ZWxzZSBpZihlLmN1cnJlbnRTdHlsZSlyZXR1cm4gZS5jdXJyZW50U3R5bGVbbl19ZnVuY3Rpb24gbShlKXtyZXR1cm4gZT97eDplLnNjcm9sbExlZnQseTplLnNjcm9sbFRvcH06e3g6dm9pZCAwIT09dC5wYWdlWE9mZnNldD90LnBhZ2VYT2Zmc2V0Oihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnR8fGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZXx8ZG9jdW1lbnQuYm9keSkuc2Nyb2xsTGVmdCx5OnZvaWQgMCE9PXQucGFnZVlPZmZzZXQ/dC5wYWdlWU9mZnNldDooZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50fHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGV8fGRvY3VtZW50LmJvZHkpLnNjcm9sbFRvcH19ZnVuY3Rpb24gcCh0LGUsbil7cmV0dXJuIHQ+ZT9lLShlLXQpKm46KHQtZSkqbitlfWZ1bmN0aW9uIGcodCl7Zm9yKHZhciBlPW8ubGVuZ3RoLG49ZS0xO24+PTA7bi0tKWlmKHQpe3ZhciByPW9bbl07dChyKSYmci5kZXN0cm95KCEwKX1lbHNlIG9bbl0uZGVzdHJveSghMCk7cmV0dXJuISFlfXQuc21vb3RoU2Nyb2xsPWZ1bmN0aW9uIHYodyl7aWYoZXx8KGU9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSksdz13fHx7fSx0aGlzIGluc3RhbmNlb2YgdilyZXR1cm57c21vb3RoU2Nyb2xsOmZ1bmN0aW9uKGUpe2U9ZXx8e307Zm9yKHZhciBuPTA7bjxiLmxlbmd0aDtuKyspe3ZhciBvPWJbbl07byBpbiBlfHwoZVtvXT13W29dKX10LnNtb290aFNjcm9sbChlKX19O3ZhciB5LEUseCxNPWYody55UG9zLHUueVBvcyksTz0rZih3LmR1cmF0aW9uLHUuZHVyYXRpb24pLFM9Zih3LnhQb3MsdS54UG9zKSxQPW0oKSxUPVAueCxMPVAueSxBPU1hdGgubWF4KGUuc2Nyb2xsSGVpZ2h0LGUub2Zmc2V0SGVpZ2h0LHIuY2xpZW50SGVpZ2h0LHIuc2Nyb2xsSGVpZ2h0LHIub2Zmc2V0SGVpZ2h0KSxrPU1hdGgubWF4KHIuY2xpZW50V2lkdGgsZS5zY3JvbGxXaWR0aCxyLnNjcm9sbFdpZHRoLGUub2Zmc2V0V2lkdGgsci5vZmZzZXRXaWR0aCksST1BLXQuaW5uZXJIZWlnaHQsSD1rLXQuaW5uZXJXaWR0aCxOPWYody5jb21wbGV0ZSx1LmNvbXBsZXRlKSxXPWYody5zY3JvbGxpbmdFbGVtZW50LHUuc2Nyb2xsaW5nRWxlbWVudCksQj1mKHcudG9FbGVtZW50LHUudG9FbGVtZW50KSxxPWYody5maXJzdEF4aXMsdS5maXJzdEF4aXMpLEM9Zih3LnByZXZlbnRVc2VyU2Nyb2xsLHUucHJldmVudFVzZXJTY3JvbGwpLEY9Zih3LmVhc2luZyx1LmVhc2luZyksUj1mKHcuYmxvY2ssdS5ibG9jayksSz1mKHcuaW5saW5lLHUuaW5saW5lKSxVPXQuaW5uZXJIZWlnaHQsWD10LmlubmVyV2lkdGgsWT0wLFE9Zih3LnNjcm9sbEV2ZW50cyx1LnNjcm9sbEV2ZW50cyksRD1mKHcuc2Nyb2xsS2V5cyx1LnNjcm9sbEtleXMpLFY9Zih3LnBhZGRpbmdUb3AsdS5wYWRkaW5nVG9wKSx6PWYody5wYWRkaW5nTGVmdCx1LnBhZGRpbmdMZWZ0KTtpZigic3RyaW5nIj09dHlwZW9mIEYpe3ZhciBqPUY7aWYoIShGPXYuZWFzaW5nW0ZdKSl0aHJvdyBuZXcgRXJyb3IoIkVhc2luZyBmdW5jdGlvbiAiK2orIiBkb2VzIG5vdCBleGlzdC4iKX1lbHNlIGlmKCJmdW5jdGlvbiIhPXR5cGVvZiBGKXRocm93IG5ldyBFcnJvcigiRWFzaW5nIG11c3QgYmUgdGhlIG5hbWUgb2YgYW4gZWFzaW5nIGZ1bmN0aW9uIG9yIGFuIGVhc2luZyBmdW5jdGlvbiIpO2lmKFcpe2lmKCFsKFcpKXRocm93IG5ldyBFcnJvcigiU2Nyb2xsaW5nIGVsZW1lbnQgbXVzdCBiZSBhIEhUTUwgZWxlbWVudCIpO1chPWUmJlchPXI/KEE9Vy5zY3JvbGxIZWlnaHQsaz1XLnNjcm9sbFdpZHRoLEk9QS1XLmNsaWVudEhlaWdodCxIPWstVy5jbGllbnRXaWR0aCxUPVcuc2Nyb2xsTGVmdCxMPVcuc2Nyb2xsVG9wLFU9cGFyc2VJbnQoaChXLCJoZWlnaHQiKSwxMCksWD1wYXJzZUludChoKFcsIndpZHRoIiksMTApLHk9ZnVuY3Rpb24odCxlKXtXLnNjcm9sbFRvcD1lLFcuc2Nyb2xsTGVmdD10fSk6KFc9dm9pZCAwLHk9dC5zY3JvbGxUbyl9ZWxzZSB5PXQuc2Nyb2xsVG87aWYoTT1udWxsIT1NP3MoTSxMLEkpOkwsUz1udWxsIT1TP3MoUyxULEgpOlQsaXNOYU4oTSkpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHlQb3MiKTtpZihpc05hTihTKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgeFBvcyIpO2lmKGlzTmFOKE8pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkdXJhdGlvbiIpO2lmKE89TWF0aC5tYXgoTywwKSxTPU1hdGgubWF4KFMsMCksTT1NYXRoLm1heChNLDApLEIpe2lmKCFsKEIpKXRocm93IG5ldyBFcnJvcigiRWxlbWVudCB0byBzY3JvbGwgdG8gbXVzdCBiZSBhIEhUTUwgZWxlbWVudCIpO3ZhciBHPWkoQik7aWYoVyl7dmFyIEo9aShXKTtNPVcuc2Nyb2xsVG9wKyhHLnRvcC1KLnRvcCktcGFyc2VJbnQoaChXLCJib3JkZXItdG9wLXdpZHRoIiksMTApLFM9Vy5zY3JvbGxMZWZ0KyhHLmxlZnQtSi5sZWZ0KS1wYXJzZUludChoKFcsImJvcmRlci1sZWZ0LXdpZHRoIiksMTApfWVsc2UgTT1HLnRvcCxTPUcubGVmdDtudWxsIT1SJiYoTT1kKFIsTSxVLEIub2Zmc2V0SGVpZ2h0KSksbnVsbCE9SyYmKFM9ZChLLFMsWCxCLm9mZnNldFdpZHRoKSl9aWYobnVsbCE9ViYmKE0rPVYpLG51bGwhPXomJihTKz16KSxNPU1hdGgubWluKE1hdGgucm91bmQoTSksQSksKFM9TWF0aC5taW4oTWF0aC5yb3VuZChTKSxrKSkhPT1UfHxNIT09TCl7aWYoUyE9PVQmJk0hPT1MfHwocT1udWxsKSxudWxsIT1xJiYoTy89MiksIUMpe2Zvcih2YXIgWj0wO1o8US5sZW5ndGg7WisrKXt2YXIgJD1RW1pdO1c/YShXLCQsXyk6KGEoZSwkLF8pLGEociwkLF8pKX1hKFd8fGRvY3VtZW50LCJrZXlkb3duIix0dCl9cmV0dXJuIHg9ZnVuY3Rpb24odCxlLHIsaSl7ciYmZyhmdW5jdGlvbih0KXtyZXR1cm4gdC5zY3JvbGxpbmdFbGVtPT1pfSk7dmFyIGwscz0hMSxhPWZ1bmN0aW9uKCl7c3x8KHQoKSxuKGEpKX0sYz1mdW5jdGlvbih0KXtpZighcyl7cz0hMDt2YXIgbj1mdW5jdGlvbih0KXtmb3IodmFyIGU9MDtlPG8ubGVuZ3RoO2UrKylpZihvW2VdLmRlc3Ryb3k9PT10KXJldHVybiBlfShjKTtudWxsIT1uJiZvLnNwbGljZShuLDEpLHQmJmUoITEsITApfX07cmV0dXJuIGw9e2Rlc3Ryb3k6YyxzY3JvbGxpbmdFbGVtOml9LG8ucHVzaChsKSxuKGEpLHtkZXN0cm95OmZ1bmN0aW9uKCl7YygpfX19KGZ1bmN0aW9uKCl7dmFyIGU9dC5wZXJmb3JtYW5jZSYmcGVyZm9ybWFuY2Uubm93P3BlcmZvcm1hbmNlLm5vdygpOituZXcgRGF0ZTtFfHwoRT1lKTt2YXIgbj1lLUU7aWYoeSgieSIhPXE/cChTLFQsRihuL08pKTpULCJ4IiE9cT9wKE0sTCxGKG4vTykpOkwpLG4+PU8paWYoeSgieSIhPXE/UzpULCJ4IiE9cT9NOkwpLG51bGwhPXEmJisrWTwyKXtzd2l0Y2gocSl7Y2FzZSJ4IjpxPSJ5IixUPVM7YnJlYWs7Y2FzZSJ5IjpxPSJ4IixMPU19RT1udWxsfWVsc2UgbnQoITEsITEpfSxudCwhZih3LmFsbG93QW5pbWF0aW9uT3ZlcmxhcCx1LmFsbG93QW5pbWF0aW9uT3ZlcmxhcCksVyl9ZnVuY3Rpb24gXygpe2V0KCksbnQoITAsITEpfWZ1bmN0aW9uIHR0KHQpe0QuaW5kZXhPZih0LmtleUNvZGUpPi0xJiYoZXQoKSxudCghMCwhMSkpfWZ1bmN0aW9uIGV0KCl7Zm9yKHZhciB0PTA7dDxRLmxlbmd0aDt0Kyspe3ZhciBuPVFbdF07Vz9jKFcsbixfKTooYyhlLG4sXyksYyhyLG4sXykpfWMoV3x8ZG9jdW1lbnQsImtleWRvd24iLHR0KX1mdW5jdGlvbiBudCh0LGUpe3ZhciBuPW0oVyk7eC5kZXN0cm95KCksQ3x8ZXQoKSxOJiZOKHt4UG9zOlMseVBvczpNLHNjcm9sbGluZ0VsZW1lbnQ6VyxkdXJhdGlvbjpPLGN1cnJlbnRYUG9zOm4ueCxjdXJyZW50WVBvczpuLnksaW50ZXJydXB0ZWQ6dCxjYW5jZWxlZDplfSl9fSxzbW9vdGhTY3JvbGwuc3RvcEFsbD1mdW5jdGlvbigpe3JldHVybiBnKCl9LHNtb290aFNjcm9sbC5lYXNpbmc9e2xpbmVhcjpmdW5jdGlvbih0KXtyZXR1cm4gdH0sc3dpbmc6ZnVuY3Rpb24odCl7cmV0dXJuLjUtTWF0aC5jb3ModCpNYXRoLlBJKS8yfX07Zm9yKHZhciB2PXtTaW5lOmZ1bmN0aW9uKHQpe3JldHVybiAxLU1hdGguY29zKHQqTWF0aC5QSS8yKX0sQ2lyYzpmdW5jdGlvbih0KXtyZXR1cm4gMS1NYXRoLnNxcnQoMS10KnQpfSxFbGFzdGljOmZ1bmN0aW9uKHQpe3JldHVybiAwPT09dHx8MT09PXQ/dDotTWF0aC5wb3coMiw4Kih0LTEpKSpNYXRoLnNpbigoODAqKHQtMSktNy41KSpNYXRoLlBJLzE1KX0sQmFjazpmdW5jdGlvbih0KXtyZXR1cm4gdCp0KigzKnQtMil9LEJvdW5jZTpmdW5jdGlvbih0KXtmb3IodmFyIGUsbj00O3Q8KChlPU1hdGgucG93KDIsLS1uKSktMSkvMTE7KTtyZXR1cm4gMS9NYXRoLnBvdyg0LDMtbiktNy41NjI1Kk1hdGgucG93KCgzKmUtMikvMjItdCwyKX19LHc9WyJRdWFkIiwiQ3ViaWMiLCJRdWFydCIsIlF1aW50IiwiRXhwbyJdLHk9MDt5PHcubGVuZ3RoO3krKyl2W3dbeV1dPWZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdyh0LHkrMil9O2Zvcih2YXIgRSBpbiB2KWlmKG51bGwhPUUmJm51bGwhPXZbRV0pe3ZhciB4PXZbRV07c21vb3RoU2Nyb2xsLmVhc2luZ1siZWFzZUluIitFXT14LHNtb290aFNjcm9sbC5lYXNpbmdbImVhc2VPdXQiK0VdPWZ1bmN0aW9uKHQpe3JldHVybiAxLXgoMS10KX0sc21vb3RoU2Nyb2xsLmVhc2luZ1siZWFzZUluT3V0IitFXT1mdW5jdGlvbih0KXtyZXR1cm4gdDwuNT94KDIqdCkvMjoxLXgoLTIqdCsyKS8yfX1zbW9vdGhTY3JvbGwuc2Nyb2xsaW5nPWZ1bmN0aW9uKCl7cmV0dXJuISFvLmxlbmd0aH07dmFyIGI9WyJ4UG9zIiwieVBvcyIsImR1cmF0aW9uIiwic2Nyb2xsaW5nRWxlbWVudCIsInRvRWxlbWVudCIsInByZXZlbnRVc2VyU2Nyb2xsIiwiZWFzaW5nIiwiY29tcGxldGUiLCJmaXJzdEF4aXMiLCJzY3JvbGxFdmVudHMiLCJzY3JvbGxLZXlzIiwiYmxvY2siLCJpbmxpbmUiLCJhbGxvd0FuaW1hdGlvbk92ZXJsYXAiLCJwYWRkaW5nVG9wIiwicGFkZGluZ0xlZnQiXTtzbW9vdGhTY3JvbGwuZGVmYXVsdHM9ZnVuY3Rpb24odCl7aWYobnVsbCE9dClmb3IodmFyIGU9MDtlPGIubGVuZ3RoO2UrKyl7dmFyIG49YltlXTtudWxsIT10W25dJiYodVtuXT10W25dKX1yZXR1cm4gdX0sc21vb3RoU2Nyb2xsLm5hdGl2ZVN1cHBvcnRlZD0ic2Nyb2xsQmVoYXZpb3IiaW4gci5zdHlsZX0od2luZG93KTsKCgpsZXQgY2VsbCA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgncGx1dG8tY2VsbCcpCmxldCBwbHV0b19hY3Rpb25zID0gY2VsbC5faW50ZXJuYWxfcGx1dG9fYWN0aW9ucwpsZXQgdG9jID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbmF2LnBsdXRvdWktdG9jJykKCmZ1bmN0aW9uIGdldFJvdyhlbCkgewoJY29uc3Qgcm93ID0gZWw/LmNsb3Nlc3QoJy50b2Mtcm93JykKCXJldHVybiByb3cKfQoJCmZ1bmN0aW9uIGdldF9saW5rX2lkKGVsKSB7Cgljb25zdCByb3cgPSBnZXRSb3coZWwpCglpZiAoXy5pc05pbChyb3cpKSB7IHJldHVybiBudWxsIH0KCWNvbnN0IGEgPSByb3cucXVlcnlTZWxlY3RvcignYScpCglyZXR1cm4gYS5ocmVmLnNsaWNlKC0zNikgLy8gZXh0cmFjdCB0aGUgbGFzdCAzNiBjaGFyYWN0ZXJzLCBjb3JyZXNwb25kaW5nIHRvIHRoZSBjZWxsIGlkCn0KCmZ1bmN0aW9uIGdldEhlYWRpbmdMZXZlbChyb3cpIHsKCWNvbnN0IGEgPSByb3cucXVlcnlTZWxlY3RvcignYScpCgkvLyBXZSByZXR1cm4gdGhlIGxpbmsgY2xhc3Mgd2l0aG91dCB0aGUgZmlyc3QgSAoJcmV0dXJuIE51bWJlcihhLmNsYXNzTGlzdFswXS5zbGljZSgxKSkKfQoKZnVuY3Rpb24gZ2VuZXJhdGVDaGVja2VyKHNlbGVjdG9yKSB7Cglzd2l0Y2ggKHR5cGVvZiBzZWxlY3RvcikgewoJCWNhc2UgJ3N0cmluZyc6CgkJCWNvbnN0IGZ1bmMgPSBlbCA9PiB7CgkJCQlyZXR1cm4gZWwubWF0Y2hlcyhzZWxlY3RvcikKCQkJfQoJCQlyZXR1cm4gZnVuYwoJCWNhc2UgJ2Z1bmN0aW9uJzoKCQkJcmV0dXJuIHNlbGVjdG9yCgkJZGVmYXVsdDoKCQkJY29uc29sZS5lcnJvcihgVGhlIHR5cGUgKCR7dHlwZW9mIHNlbGVjdG9yfSkgb2YgdGhlIHByb3ZpZGVkIGFyZ3VtZW50IGlzIG5vdCB2YWxpZGApCgl9Cn0KCi8vIEdldCBuZXh0IGFuZCBwcmV2aW91cyBzaWJsaW5nLCBhZGFwdGVkIGZyb206Ci8vIGh0dHBzOi8vZ29tYWtldGhpbmdzLmNvbS9maW5kaW5nLXRoZS1uZXh0LWFuZC1wcmV2aW91cy1zaWJsaW5nLWVsZW1lbnRzLXRoYXQtbWF0Y2gtYS1zZWxlY3Rvci13aXRoLXZhbmlsbGEtanMvCnZhciBnZXROZXh0U2libGluZyA9IGZ1bmN0aW9uIChlbGVtLCBzZWxlY3RvcikgewoKCS8vIEFkZGVkIHRvIHJldHVybiB1bmRlZmluZWQgaXMgY2FsbGVkIHdpdGggdW5kZWZpbmVkCglpZiAoXy5pc05pbChlbGVtKSkge3JldHVybiB1bmRlZmluZWR9CgoJLy8gR2V0IHRoZSBuZXh0IHNpYmxpbmcgZWxlbWVudAoJdmFyIHNpYmxpbmcgPSBlbGVtLm5leHRFbGVtZW50U2libGluZzsKCgkvLyBJZiB0aGVyZSdzIG5vIHNlbGVjdG9yLCByZXR1cm4gdGhlIGZpcnN0IHNpYmxpbmcKCWlmICghc2VsZWN0b3IpIHJldHVybiBzaWJsaW5nOwoKCWNvbnN0IGNoZWNrZXIgPSBnZW5lcmF0ZUNoZWNrZXIoc2VsZWN0b3IpCgoJLy8gSWYgdGhlIHNpYmxpbmcgbWF0Y2hlcyBvdXIgc2VsZWN0b3IsIHVzZSBpdAoJLy8gSWYgbm90LCBqdW1wIHRvIHRoZSBuZXh0IHNpYmxpbmcgYW5kIGNvbnRpbnVlIHRoZSBsb29wCgl3aGlsZSAoc2libGluZykgewoJCWlmIChjaGVja2VyKHNpYmxpbmcpKSByZXR1cm4gc2libGluZzsKCQlzaWJsaW5nID0gc2libGluZy5uZXh0RWxlbWVudFNpYmxpbmcKCX0KCn07CnZhciBnZXRQcmV2aW91c1NpYmxpbmcgPSBmdW5jdGlvbiAoZWxlbSwgc2VsZWN0b3IpIHsKCgkvLyBBZGRlZCB0byByZXR1cm4gdW5kZWZpbmVkIGlzIGNhbGxlZCB3aXRoIHVuZGVmaW5lZAoJaWYgKF8uaXNOaWwoZWxlbSkpIHtyZXR1cm4gdW5kZWZpbmVkfQoJCgkvLyBHZXQgdGhlIG5leHQgc2libGluZyBlbGVtZW50Cgl2YXIgc2libGluZyA9IGVsZW0ucHJldmlvdXNFbGVtZW50U2libGluZzsKCgkvLyBJZiB0aGVyZSdzIG5vIHNlbGVjdG9yLCByZXR1cm4gdGhlIGZpcnN0IHNpYmxpbmcKCWlmICghc2VsZWN0b3IpIHJldHVybiBzaWJsaW5nOwoKCWNvbnN0IGNoZWNrZXIgPSBnZW5lcmF0ZUNoZWNrZXIoc2VsZWN0b3IpCgoJLy8gSWYgdGhlIHNpYmxpbmcgbWF0Y2hlcyBvdXIgc2VsZWN0b3IsIHVzZSBpdAoJLy8gSWYgbm90LCBqdW1wIHRvIHRoZSBuZXh0IHNpYmxpbmcgYW5kIGNvbnRpbnVlIHRoZSBsb29wCgl3aGlsZSAoc2libGluZykgewoJCWlmIChjaGVja2VyKHNpYmxpbmcpKSByZXR1cm4gc2libGluZzsKCQlzaWJsaW5nID0gc2libGluZy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwoJfQoKfTsKCgovLyBHZXQgdGhlIGxhc3QgdG9jIGVudHJ5IGRlc2NlbmRhbnQgZnJvbSB0aGUgcHJvdmlkZWQgb25lCmZ1bmN0aW9uIGdldExhc3REZXNjZW5kYW50KGVsKSB7Cgljb25zdCByb3cgPSBnZXRSb3coZWwpCglpZiAoXy5pc05pbChyb3cpKSB7cmV0dXJufQoJY29uc3QgY2hpbGRyZW4gPSByb3cuZGlyZWN0Q2hpbGRyZW4KCWlmIChfLmlzRW1wdHkoY2hpbGRyZW4pKSB7CgkJcmV0dXJuIHJvdwoJfSBlbHNlIHsKCQlyZXR1cm4gZ2V0TGFzdERlc2NlbmRhbnQoXy5sYXN0KGNoaWxkcmVuKSkKCX0KfQoKLy8gRmluZCBhbGwgdGhlIGNlbGwgaWRzIGNvbnRhaW5lZCB3aXRoaW4gdGhlIHRhcmdldCB0b2Mgcm93cyBhbmQgYWxsIGl0cyBkZXNjZW5kYW50cwpmdW5jdGlvbiBnZXRCbG9ja0lkcyhlbCkgewoJY29uc3Qgcm93ID0gZ2V0Um93KGVsKQoJaWYgKF8uaXNOaWwocm93KSkge3JldHVybn0KCWZ1bmN0aW9uIGdldEluZGV4KHJvdykgewoJCXJldHVybiBlZGl0b3Jfc3RhdGUubm90ZWJvb2suY2VsbF9vcmRlci5pbmRleE9mKGdldF9saW5rX2lkKHJvdykpCgl9Cgljb25zdCBzdGFydCA9IGdldEluZGV4KHJvdykKCgljb25zdCBsYXN0Q2hpbGQgPSBnZXRMYXN0RGVzY2VuZGFudChyb3cpCgljb25zdCBlbmQgPSBnZXRJbmRleChnZXROZXh0U2libGluZyhsYXN0Q2hpbGQsICcudG9jLXJvdycpKQoKCXJldHVybiBlZGl0b3Jfc3RhdGUubm90ZWJvb2suY2VsbF9vcmRlci5zbGljZShzdGFydCwgZW5kIDwgMCA/IEluZmluaXR5IDogZW5kKQp9CgkKd2luZG93LnRvY191dGlscyA9IHsKCWdldE5leHRTaWJsaW5nLAoJZ2V0UHJldmlvdXNTaWJsaW5nLAoJZ2V0TGFzdERlc2NlbmRhbnQsCglnZXRCbG9ja0lkcywKfQoKLy8gRnVuY3Rpb25zIHRvIHNldCBhbmQgcHJvcGFnYXRlIGhpZGRlbiBhbmQgY29sbGFwc2VkIHN0YXRlcwoKZnVuY3Rpb24gcHJvcGFnYXRlX3BhcmVudChkaXYsIHBhcmVudD1udWxsKSB7CglpZiAocGFyZW50ICE9IG51bGwpIHsKCQlkaXYuYWxsUGFyZW50cyA9IF8udW5pb24oZGl2LmFsbFBhcmVudHMsIFtwYXJlbnRdKQkKCX0KCWlmIChfLmlzRW1wdHkoZGl2LmRpcmVjdENoaWxkcmVuKSkge3JldHVybn0KCWZvciAoY29uc3QgY2hpbGQgb2YgZGl2LmRpcmVjdENoaWxkcmVuKSB7CgkJcHJvcGFnYXRlX3BhcmVudChjaGlsZCwgcGFyZW50ID8/IGRpdikKCX0KfQoKLy8gUmV0dXJucyB0cnVlIGlmIHRoZSBjdXJyZW50IGhpZGRlbi9jb2xsYXBzZWQgdG9jIHN0YXRlIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBvbmUgc2F2ZWQgaW4gdGhlIGZpbGUgd2l0aGluIGNlbGwgbWV0YWRhdGEKZnVuY3Rpb24gc3RhdGVEaWZmZXJzRmlsZShzdGF0ZSkgewoJZm9yIChjb25zdCBbaWQsIHN0XSBvZiBfLmVudHJpZXMoc3RhdGUpKSB7CgkJaWYgKGhhc19jZWxsX2F0dHJpYnV0ZShpZCwgJ3RvYy1oaWRkZW4nKSAhPSBzdC5oaWRkZW4pIHsgcmV0dXJuIHRydWUgfQoJCWlmIChoYXNfY2VsbF9hdHRyaWJ1dGUoaWQsICd0b2MtY29sbGFwc2VkJykgIT0gc3QuY29sbGFwc2VkKSB7IHJldHVybiB0cnVlIH0KCX0KCXJldHVybiBmYWxzZQp9CgpmdW5jdGlvbiBzZXRfc3RhdGUoZGl2LCBzdGF0ZSwgdmFsdWUsIGluaXQgPSBmYWxzZSkgewoJZGl2LmNsYXNzTGlzdC50b2dnbGUoc3RhdGUsIHZhbHVlKQoJaWYgKCFpbml0KSB7CgkJd2luZG93LnRvY19zdGF0ZVtnZXRfbGlua19pZChkaXYpXVtzdGF0ZV0gPSB2YWx1ZQoJCXRvYy5jbGFzc0xpc3QudG9nZ2xlKCdmaWxlLXN0YXRlLWRpZmZlcnMnLCBzdGF0ZURpZmZlcnNGaWxlKHdpbmRvdy50b2Nfc3RhdGUpKQoJfQoJaWYgKF8uaXNFbXB0eShkaXYuZGlyZWN0Q2hpbGRyZW4pKSB7cmV0dXJufQoJZm9yIChjb25zdCBjaGlsZCBvZiBkaXYuZGlyZWN0Q2hpbGRyZW4pIHsKCQlwcm9wYWdhdGVfc3RhdGUoY2hpbGQsIHN0YXRlKQoJfQp9CmZ1bmN0aW9uIHByb3BhZ2F0ZV9zdGF0ZShkaXYsIHN0YXRlKSB7CglsZXQgbmV3X3N0YXRlID0gYHBhcmVudC0ke3N0YXRlfWAKCWRpdi5jbGFzc0xpc3QudG9nZ2xlKG5ld19zdGF0ZSwgZmFsc2UpCgkvLyBDaGVjayB0aGUgcGFyZW50cyBmb3IgdGhlIHN0YXRlCglmb3IgKGNvbnN0IHBhcmVudCBvZiBkaXYuYWxsUGFyZW50cykgewoJCWlmIChwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKHN0YXRlKSkgewoJCQlkaXYuY2xhc3NMaXN0LnRvZ2dsZShuZXdfc3RhdGUsIHRydWUpCgkJCWJyZWFrCgkJfQoJfQoJaWYgKF8uaXNFbXB0eShkaXYuZGlyZWN0Q2hpbGRyZW4pKSB7cmV0dXJufQoJZm9yIChjb25zdCBjaGlsZCBvZiBkaXYuZGlyZWN0Q2hpbGRyZW4pIHsKCQlwcm9wYWdhdGVfc3RhdGUoY2hpbGQsIHN0YXRlKQoJfQp9CgoKCWNvbnN0IGZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCS8vIHdpbmRvdy5mbG9hdGluZ191aSA9IGZsb2F0aW5nX3VpCgoKCQlmdW5jdGlvbiBhZGRfbm90ZWJvb2tfYXR0cmlidXRlcyhhdHRycykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5tZXRhZGF0YQoJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBfLnVuaW9uKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cnMpCgkJfSkKCQlsZXQgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwbHV0by1ub3RlYm9vaycpCgkJZm9yIChsZXQgYXR0ciBvZiBhdHRycykgewoJCQlub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgdHJ1ZSkKCQl9Cgl9CgoJZnVuY3Rpb24gcmVtb3ZlX25vdGVib29rX2F0dHJpYnV0ZXMoYXR0cnMpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2subWV0YWRhdGEKCQkJbGV0IGFmdGVyID0gXy5kaWZmZXJlbmNlKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cnMpCgkJCWlmIChfLmlzRW1wdHkoYWZ0ZXIpKSB7CgkJCQlkZWxldGUgbWRbImN1c3RvbV9hdHRycyJdCgkJCX0gZWxzZSB7CgkJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBhZnRlcgoJCQl9CgkJfSkKCQlsZXQgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwbHV0by1ub3RlYm9vaycpCgkJZm9yIChsZXQgYXR0ciBvZiBhdHRycykgewoJCQlub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgZmFsc2UpCgkJfQoJfQoKCWZ1bmN0aW9uIHRvZ2dsZV9ub3RlYm9va19hdHRyaWJ1dGUoYXR0ciwgZm9yY2U9J3RvZ2dsZScpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2subWV0YWRhdGEKCQkJbGV0IGYgPSBmb3JjZSA9PSAndG9nZ2xlJyA/IF8ueG9yIDogZm9yY2UgPyBfLnVuaW9uIDogXy5kaWZmZXJlbmNlCgkJCWxldCBhZnRlciA9IGYobWRbImN1c3RvbV9hdHRycyJdLCBbYXR0cl0pCgkJCWlmIChfLmlzRW1wdHkoYWZ0ZXIpKSB7CgkJCQlkZWxldGUgbWRbImN1c3RvbV9hdHRycyJdCgkJCX0gZWxzZSB7CgkJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBhZnRlcgoJCQl9CgkJfSkKCQlsZXQgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwbHV0by1ub3RlYm9vaycpCgkJZm9yY2UgPT0gJ3RvZ2dsZScgPyBub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0cikgOiBub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgZm9yY2UpCgl9CgoJaWYgKGZvcmNlX2hpZGVfZW5hYmxlZCkgewoJIAl0b2dnbGVfbm90ZWJvb2tfYXR0cmlidXRlKCdoaWRlLWVuYWJsZWQnLHRydWUpCgl9CgoKCWZ1bmN0aW9uIGhhc19jZWxsX2F0dHJpYnV0ZShjZWxsX2lkLCBhdHRyKSB7CgkJY29uc3QgbWQgPSBlZGl0b3Jfc3RhdGUubm90ZWJvb2suY2VsbF9pbnB1dHNbY2VsbF9pZF0ubWV0YWRhdGEKCQlyZXR1cm4gXy5pbmNsdWRlcyhtZFsiY3VzdG9tX2F0dHJzIl0sIGF0dHIpCgl9CgkKCWZ1bmN0aW9uIGFkZF9jZWxsX2F0dHJpYnV0ZXMoY2VsbF9pZCwgYXR0cnMpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2suY2VsbF9pbnB1dHNbY2VsbF9pZF0ubWV0YWRhdGEKCQkJbWRbImN1c3RvbV9hdHRycyJdID0gXy51bmlvbihtZFsiY3VzdG9tX2F0dHJzIl0sIGF0dHJzKQoJCX0pCgkJbGV0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjZWxsX2lkKQoJCWZvciAobGV0IGF0dHIgb2YgYXR0cnMpIHsKCQkJY2VsbC50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgdHJ1ZSkKCQl9Cgl9CgoJZnVuY3Rpb24gcmVtb3ZlX2NlbGxfYXR0cmlidXRlcyhjZWxsX2lkLCBhdHRycykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5jZWxsX2lucHV0c1tjZWxsX2lkXS5tZXRhZGF0YQoJCQlsZXQgYWZ0ZXIgPSBfLmRpZmZlcmVuY2UobWRbImN1c3RvbV9hdHRycyJdLCBhdHRycykKCQkJaWYgKF8uaXNFbXB0eShhZnRlcikpIHsKCQkJCWRlbGV0ZSBtZFsiY3VzdG9tX2F0dHJzIl0KCQkJfSBlbHNlIHsKCQkJCW1kWyJjdXN0b21fYXR0cnMiXSA9IGFmdGVyCgkJCX0KCQl9KQoJCWxldCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2VsbF9pZCkKCQlmb3IgKGxldCBhdHRyIG9mIGF0dHJzKSB7CgkJCWNlbGwudG9nZ2xlQXR0cmlidXRlKGF0dHIsIGZhbHNlKQoJCX0KCX0KCglmdW5jdGlvbiB0b2dnbGVfY2VsbF9hdHRyaWJ1dGUoY2VsbF9pZCwgYXR0ciwgZm9yY2U9J3RvZ2dsZScpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2suY2VsbF9pbnB1dHNbY2VsbF9pZF0ubWV0YWRhdGEKCQkJbGV0IGYgPSBmb3JjZSA9PSAndG9nZ2xlJyA/IF8ueG9yIDogZm9yY2UgPyBfLnVuaW9uIDogXy5kaWZmZXJlbmNlCgkJCWxldCBhZnRlciA9IGYobWRbImN1c3RvbV9hdHRycyJdLCBbYXR0cl0pCgkJCWlmIChfLmlzRW1wdHkoYWZ0ZXIpKSB7CgkJCQlkZWxldGUgbWRbImN1c3RvbV9hdHRycyJdCgkJCX0gZWxzZSB7CgkJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBhZnRlcgoJCQl9CgkJfSkKCQlsZXQgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNlbGxfaWQpCgkJZm9yY2UgPT0gJ3RvZ2dsZScgPyBjZWxsLnRvZ2dsZUF0dHJpYnV0ZShhdHRyKSA6IGNlbGwudG9nZ2xlQXR0cmlidXRlKGF0dHIsIGZvcmNlKQoJfQoKCgkvLyBGb3IgZWFjaCBmcm9tIGFuZCB0bywgd2UgaGF2ZSB0byBzcGVjaWZ5IGBwbHV0by1jZWxsW2lkXWAgaW4gdGhlIHBhcnQgYmVmb3JlIHRoZSBjb21tIGFuZCBqdXN0IGBbaWRdYCBpbiB0aGUgcGFydCBhZnRlciB0aGUgY29tbWEgdG8gZW5zdXJlIHRoZSBzcGVjaWZpY2l0eSBvZiB0aGUgdHdvIGNvbW1hLXNlcGFyYXRlZCBzZWxlY3RvcnMgaXMgdGhlIHNhbWUgKHRoZSBwYXJ0IGFmdGVyIHRoZSBjb21tYSBoYXMgdGhlIGFkZGl0aW9uIG9mIGB+IHBsdXRvLWNlbGxgLCBzbyBpdCBoYXMgaW5oZXJlbnRseSArMSBlbGVtZW50IHNwZWNpZmljaXR5KQoJZnVuY3Rpb24gaGlkZV9mcm9tX3RvX3N0cmluZyhmcm9tX2lkLCB0b19pZCkgewoJCWlmIChfLmlzRW1wdHkoZnJvbV9pZCkgJiYgXy5pc0VtcHR5KHRvX2lkKSkge3JldHVybiAnJ30KCQkKCQljb25zdCBmcm9tX3ByZXNlbGVjdG9yID0gXy5pc0VtcHR5KGZyb21faWQpID8gJycgOiBgcGx1dG8tY2VsbFtpZD0nJHtmcm9tX2lkfSddLCBwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIFtpZD0nJHtmcm9tX2lkfSddIH4gYAoJCWNvbnN0IHRvX3N0eWxlID0gXy5pc0VtcHR5KHRvX2lkKSA/ICcnIDogYHBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gcGx1dG8tY2VsbFtpZD0nJHt0b19pZH0nXSwgcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBbaWQ9JyR7dG9faWR9J10gfiBwbHV0by1jZWxsIHsKCQlkaXNwbGF5OiBibG9jazsKCX0KCSBgCgkJY29uc3Qgc3R5bGVfc3RyaW5nID0gCWBwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdICR7ZnJvbV9wcmVzZWxlY3Rvcn1wbHV0by1jZWxsIHsKCQlkaXNwbGF5OiBub25lOwoJfQoJJHt0b19zdHlsZX0KIGAKCQlyZXR1cm4gc3R5bGVfc3RyaW5nCgkJLy9yZXR1cm4gaHRtbGA8c3R5bGU+JHtzdHlsZV9zdHJpbmd9PC9zdHlsZT5gCgl9CgoJZnVuY3Rpb24gaGlkZV9mcm9tX3RvX2xpc3Rfc3RyaW5nKHZlY3RvcikgewoJCWxldCBvdXQgPSBgYAoJCWZvciAoY29uc3QgbGltcyBvZiB2ZWN0b3IpIHsKCQkJY29uc3QgZnJvbSA9IGxpbXNbMF0KCQkJY29uc3QgdG8gPSBsaW1zWzFdCgkJCQoJCQlvdXQgPSBgJHtvdXR9CSR7aGlkZV9mcm9tX3RvX3N0cmluZyhmcm9tLHRvKX1gCgkJfQoJCW91dCA9IGAke291dH0JcGx1dG8tY2VsbFthbHdheXMtc2hvd10gewogIAkJCWRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgCQl9CiAgYAoJCXJldHVybiBvdXQKCX0KCWZ1bmN0aW9uIGhpZGVfZnJvbV90b19saXN0KHZlY3RvcikgewoJCWNvbnN0IHN0ciA9IGhpZGVfZnJvbV90b19saXN0X3N0cmluZyh2ZWN0b3IpCgkJcmV0dXJuIGh0bWxgPHN0eWxlPiR7c3RyfTwvc3R5bGU+YAoJfQoJZnVuY3Rpb24gaGlkZV9saXN0X3N0eWxlKHZlY3RvcikgewoJCWxldCBzdHlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaWRlLWNlbGxzLXN0eWxlJykKCQlpZiAoc3R5bGUgPT0gbnVsbCkgewogIAkJCXN0eWxlID0gZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChodG1sYDxzdHlsZSBpZD0naGlkZS1jZWxscy1zdHlsZSc+PC9zdHlsZT5gKQoJCX0KCQlzdHlsZS5pbm5lckhUTUwgPSBoaWRlX2Zyb21fdG9fbGlzdF9zdHJpbmcodmVjdG9yKQoJfQoKCglmdW5jdGlvbiBzYXZlX3RvX2ZpbGUoKSB7CgkJY29uc3Qgc3RhdGUgPSB3aW5kb3cudG9jX3N0YXRlCgkJZm9yIChjb25zdCBbayx2XSBvZiBPYmplY3QuZW50cmllcyhzdGF0ZSkpIHsKCQkJdG9nZ2xlX2NlbGxfYXR0cmlidXRlKGssICd0b2MtaGlkZGVuJywgdi5oaWRkZW4pCQoJCQl0b2dnbGVfY2VsbF9hdHRyaWJ1dGUoaywgJ3RvYy1jb2xsYXBzZWQnLCB2LmNvbGxhcHNlZCkJCgkJfQoJCXNldFRpbWVvdXQoKCkgPT4gewoJCQl0b2MuY2xhc3NMaXN0LnRvZ2dsZSgnZmlsZS1zdGF0ZS1kaWZmZXJzJywgc3RhdGVEaWZmZXJzRmlsZShzdGF0ZSkpCgkJfSwgNTAwKQoJfQoKCgljb25zdCBoZWFkZXIgPSB0b2MucXVlcnlTZWxlY3RvcignaGVhZGVyJykKCWNvbnN0IGhlYWRlcl9jb250YWluZXIgPSBoZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgaHRtbGA8c3BhbiBjbGFzcz0ndG9jLWhlYWRlci1jb250YWluZXInPmApCgkKCQoJY29uc3Qgbm90ZWJvb2tfaGlkZV9pY29uID0gaGVhZGVyX2NvbnRhaW5lci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1oZWFkZXItaWNvbiB0b2MtaGVhZGVyLWhpZGUnPmApCgkKCWNvbnN0IHNhdmVfZmlsZV9pY29uID0gaGVhZGVyX2NvbnRhaW5lci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1oZWFkZXItaWNvbiB0b2MtaGVhZGVyLXNhdmUnPmApCglzYXZlX2ZpbGVfaWNvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNhdmVfdG9fZmlsZSkKCgloZWFkZXJfY29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgaHRtbGA8c3BhbiBjbGFzcz0ndG9jLWhlYWRlci1maWxsZXInPmApCgkKCWhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewoJCWlmIChlLnRhcmdldCAhPSBoZWFkZXIpIHtyZXR1cm59CgkJaWYgKHVzZV9zbW9vdGhzY3JvbGwpIHsKCQkJc21vb3RoU2Nyb2xsKHt0b0VsZW1lbnQ6IGNlbGwsIGJsb2NrOiAnc3RhcnQnfSkKCQl9IGVsc2UgewoJCQljZWxsLnNjcm9sbEludG9WaWV3KHtibG9jazogJ2NlbnRlcicsIGJlaGF2aW9yOiAnc21vb3RoJ30pCgkJfQoJfSkKCgloZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChlKSA9PiB7CgkJZmxvYXRpbmdfdWkuY29tcHV0ZVBvc2l0aW9uKGhlYWRlciwgaGVhZGVyX2NvbnRhaW5lciwgewoJCQlwbGFjZW1lbnQ6ICJsZWZ0IiwKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJfSkudGhlbihwb3MgPT4gewoJCQloZWFkZXJfY29udGFpbmVyLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCQkvLyBoZWFkZXJfY29udGFpbmVyLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJLy8gaGVhZGVyX2NvbnRhaW5lci5zdHlsZS5yaWdodCA9IGBjYWxjKDFyZW0gKyBtaW4oODB2dywgMzAwcHgpKWAKCQl9KQoJfSkKCglub3RlYm9va19oaWRlX2ljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewoJCQkvLyBXZSBmaW5kIHRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHBsdXRvLW5vdGVib29rIGVsZW1lbnQsIHRvIGF2b2lkIG1pc3NpbmcgdGhlIGNlbGwgd2hlbiBVSSBpcyBkaXNhYmxlZAoJCQljb25zdCB7IHggfSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3BsdXRvLW5vdGVib29rJykuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKCQkJY29uc3QgcmVmID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludCh4KzEsMTAwKS5jbG9zZXN0KCdwbHV0by1jZWxsJykKCQkJY29uc3QgeyB5IH0gPSByZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKCQkJdG9nZ2xlX25vdGVib29rX2F0dHJpYnV0ZSgnaGlkZS1lbmFibGVkJykKCQkJY29uc3QgZHkgPSByZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueSAtIHkKCQkJd2luZG93LnNjcm9sbEJ5KDAsIGR5KQoJfSkKCmNlbGwudG9nZ2xlQXR0cmlidXRlKCdhbHdheXMtc2hvdycsIHRydWUpCgoJZnVuY3Rpb24gdG9nZ2xlX3N0YXRlKG5hbWUpIHsKCQlyZXR1cm4gKGUpID0+IHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJbGV0IGRpdiA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2RpdicpCgkJCWNvbnN0IG5ld192YWwgPSAhZGl2LmNsYXNzTGlzdC5jb250YWlucyhuYW1lKQoJCQlzZXRfc3RhdGUoZGl2LCBuYW1lLCBuZXdfdmFsKQoJCX0KCX0KCglmdW5jdGlvbiB1cGRhdGVfaGlkZGVuKGUpIHsKCQlsZXQgbmV3X2hpZGUgPSBbXQoJCWlmIChoaWRlX3ByZWFtYmxlKSB7CgkJCW5ld19oaWRlLnB1c2goWycnLCBnZXRfbGlua19pZCh0b2MucXVlcnlTZWxlY3RvcignZGl2LnRvYy1yb3cnKSldKQoJCX0KCQlsZXQgdHJhY2tpbmdfaGlkZGVuID0gbnVsbAoJCWxldCBkaXZzID0gdG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi50b2Mtcm93JykKCQlmb3IgKGNvbnN0IGRpdiBvZiBkaXZzKSB7CgkJCWlmICh0cmFja2luZ19oaWRkZW4gIT0gbnVsbCkgewoJCQkJY29uc3QgaGlkZGVuID0gZGl2LmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykgfHwgZGl2LmNsYXNzTGlzdC5jb250YWlucygncGFyZW50LWhpZGRlbicpCgkJCQlpZiAoIWhpZGRlbikgewoJCQkJCW5ld19oaWRlLnB1c2goW3RyYWNraW5nX2hpZGRlbiwgZ2V0X2xpbmtfaWQoZGl2KV0pCQoJCQkJCXRyYWNraW5nX2hpZGRlbiA9IG51bGwKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWNvbnN0IGhpZGRlbiA9IGRpdi5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpCgkJCQlpZiAoaGlkZGVuKSB7CgkJCQkJdHJhY2tpbmdfaGlkZGVuID0gZ2V0X2xpbmtfaWQoZGl2KQoJCQkJfQoJCQl9CgkJfQoJCWlmICh0cmFja2luZ19oaWRkZW4gIT0gbnVsbCkgewoJCQkJbmV3X2hpZGUucHVzaChbdHJhY2tpbmdfaGlkZGVuLCAiIl0pCQoJCX0KCQloaWRlX2xpc3Rfc3R5bGUobmV3X2hpZGUpCgl9CgoJLy8gUmVwb3NpdGlvbiB0aGUgaGlkZV9jb250YWluZXIgdXNpbmcgdGhlIGZsb2F0aW5nLXVpIGxpYnJhcnkKCWZ1bmN0aW9uIHJlcG9zaXRpb25Ub29sdGlwKGUpIHsKCQljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiB9ID0gZmxvYXRpbmdfdWkKCQljb25zdCByZWYgPSBlLnRhcmdldAoJCWNvbnN0IHRvb2x0aXAgPSByZWYucXVlcnlTZWxlY3RvcignLnRvYy1oaWRlLWNvbnRhaW5lcicpCgkJaWYgKF8uaXNOaWwodG9vbHRpcCkpIHsKCQkJY29uc29sZS53YXJuKCJTb21ldGhpbmcgd2VudCB3cm9uZywgbm8gdG9vbHRpcCBmb3VuZCIpCgkJCXJldHVybgoJCX0KCQljb21wdXRlUG9zaXRpb24ocmVmLCB0b29sdGlwLCB7CgkJCXBsYWNlbWVudDogImxlZnQiLAoJCQlzdHJhdGVneTogImZpeGVkIiwKCQl9KS50aGVuKHBvcyA9PiB7CgkJCXRvb2x0aXAuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCQoJZnVuY3Rpb24gcHJvY2Vzc19yb3coZGl2LCBoaXN0b3J5LCBvbGRfc3RhdGUsIG5ld19zdGF0ZSkgewoKCQkvLyBXZSBhZGQgdGhlIHNlcGFyYXRvcgoJCWRpdi5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWJlZ2luJywgaHRtbGA8ZGl2IGNsYXNzPSd0b2Mtcm93LXNlcGFyYXRvcic+PC9kaXY+YCkKCQkvLyBJZiB3ZSBhcmUganVzdCBwcm9jZXNzaW5nIHRoZSBmaXJzdCBlbGVtZW50IChzbyB0aGUgbGFzdCByb3cpIHdlIGFsc28gYWRkIGEgc2VwYXJhdG9yIGF0IHRoZSBib3R0b20KCQlpZiAoXy5pc0VtcHR5KG5ld19zdGF0ZSkgJiYgXy5ldmVyeShoaXN0b3J5LCBfLmlzRW1wdHkpKSB7CgkJCWRpdi5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyZW5kJywgaHRtbGA8ZGl2IGNsYXNzPSd0b2Mtcm93LXNlcGFyYXRvcic+PC9kaXY+YCkKCQl9CgoJCS8vIFdlIGFkZCB0aGUgcmVwb3NpdGlvbiBldmVudCB0byB0aGUgcm93CgkJZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCByZXBvc2l0aW9uVG9vbHRpcCkKCQkKCQlsZXQgaWQgPSBnZXRfbGlua19pZChkaXYpCgkJY29uc3QgYSA9IGRpdi5xdWVyeVNlbGVjdG9yKCdhJykKCQlpZiAodXNlX3Ntb290aHNjcm9sbCkgewoJCQljb25zdCB0aGlzX2NlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkKCQkJYS5vbmNsaWNrID0gKGUpID0+IHsKCQkJCS8vIFdlIGF2b2lkIHRyaWdnZXJpbmcgdGhlIGNsaWNrIGlmIGNvbWluZyBvdXQgb2YgYSBkcmFnCgkJCQllLnByZXZlbnREZWZhdWx0KCkKCQkJCWlmICh0b2MuY2xhc3NMaXN0LmNvbnRhaW5zKCdyZWNlbnQtZHJhZycpKSB7IHJldHVybiB9CgkJCQlzbW9vdGhTY3JvbGwoe3RvRWxlbWVudDogdGhpc19jZWxsLCBibG9jazogJ3N0YXJ0J30pCgkJCX0KCQl9IGVsc2UgewoJCQlsZXQgb2xkX2YgPSBhLm9uY2xpY2s7CgkJCWEub25jbGljayA9IChlKSA9PiB7CgkJCQllLnByZXZlbnREZWZhdWx0KCkKCQkJCS8vIFdlIGF2b2lkIHRyaWdnZXJpbmcgdGhlIGNsaWNrIGlmIGNvbWluZyBvdXQgb2YgYSBkcmFnCgkJCQlpZiAodG9jLmNsYXNzTGlzdC5jb250YWlucygncmVjZW50LWRyYWcnKSkgeyByZXR1cm4gfQoJCQkJb2xkX2YoZSkKCQkJfQkJCQoJCX0KCQljb25zdCBsZXZlbCA9IGdldEhlYWRpbmdMZXZlbChkaXYpCgkJaWYgKGxldmVsID4gMSkgewoJCQloaXN0b3J5W2xldmVsXS51bnNoaWZ0KGRpdikKCQl9CgkJLy8gV2UgaXRlcmF0ZSB0aHJvdWdoIHRoZSBoaXN0b3J5IGFuZCBhc3NpZ24gdGhlIGRpcmVjdCBjaGlsZHJlbiBpZiB0aGV5IGV4aXN0LCB3aGlsZSBjbGVhcmluZyBsb3dlciBsZXZlbHMgaGlzdG9yeQoJCWZvciAobGV0IGkgPSA2OyBpID4gbGV2ZWw7IGktLSkgewoJCQlpZiAoXy5pc0VtcHR5KGhpc3RvcnlbaV0pKSB7Y29udGludWV9CgkJCWlmIChkaXYuZGlyZWN0Q2hpbGRyZW4gIT0gdW5kZWZpbmVkKSB7dGhyb3coJ211bHRpcGxlIGxldmVsIHdpdGggY2hpbGRyZW4sIHVuZXhwZWN0ZWQhJyl9CgkJCWRpdi5kaXJlY3RDaGlsZHJlbiA9IGhpc3RvcnlbaV0KCQkJaGlzdG9yeVtpXSA9IFtdIC8vIGVtcHR5IGFycmF5CgkJfQoJCWNvbnN0IGNvbGxhcHNlX3NwYW4gPSBhLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1pY29uIHRvYy1jb2xsYXBzZSc+YCkKCQlsZXQgaGlkZV9zdHlsZSA9IGAtLWhlaWdodDogJHthLmNsaWVudEhlaWdodH1weGAKCQljb25zdCBoaWRlX2NvbnRhaW5lciA9IGRpdi5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBodG1sYDxzcGFuIGNsYXNzPSd0b2MtaGlkZS1jb250YWluZXInIHN0eWxlPScke2hpZGVfc3R5bGV9Jz5gKQoJCWNvbnN0IGhpZGVfc3BhbiA9IGhpZGVfY29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1pY29uIHRvYy1oaWRlJz5gKQoJCWhpZGVfc3Bhbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CgkJCXRvZ2dsZV9zdGF0ZSgnaGlkZGVuJykoZSkKCQkJdXBkYXRlX2hpZGRlbihlKQoJCX0pCgkJaWYgKGRpdi5kaXJlY3RDaGlsZHJlbiA9PSB1bmRlZmluZWQpIHsKCQkJY29sbGFwc2Vfc3Bhbi5jbGFzc0xpc3QudG9nZ2xlKCduby1jaGlsZHJlbicsIHRydWUpCgkJfSBlbHNlIHsKCQkJcHJvcGFnYXRlX3BhcmVudChkaXYpCgkJCWNvbGxhcHNlX3NwYW4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVfc3RhdGUoJ2NvbGxhcHNlZCcpKQoJCX0KCQlsZXQgbWQgPSBlZGl0b3Jfc3RhdGUubm90ZWJvb2suY2VsbF9pbnB1dHNbaWRdLm1ldGFkYXRhCgkJbGV0IGNvbGxhcHNlZCA9IG9sZF9zdGF0ZVtpZF0/LmNvbGxhcHNlZCA/PyAgXy5pbmNsdWRlcyhtZFsnY3VzdG9tX2F0dHJzJ10sICd0b2MtY29sbGFwc2VkJykKCQlsZXQgaGlkZGVuID0gb2xkX3N0YXRlW2lkXT8uaGlkZGVuID8/IF8uaW5jbHVkZXMobWRbJ2N1c3RvbV9hdHRycyddLCAndG9jLWhpZGRlbicpCgkJc2V0X3N0YXRlKGRpdiwgJ2NvbGxhcHNlZCcsIGNvbGxhcHNlZCwgdHJ1ZSkKCQlzZXRfc3RhdGUoZGl2LCAnaGlkZGVuJywgaGlkZGVuLCB0cnVlKQoJCW5ld19zdGF0ZVtpZF0gPSB7IGNvbGxhcHNlZCwgaGlkZGVuIH0KCQkKCX0KCgljb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHsKCQljb25zdCByb3dzID0gdG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NlY3Rpb24gZGl2LnRvYy1yb3cnKQoJCWxldCBvbGRfc3RhdGUgPSB3aW5kb3cudG9jX3N0YXRlID8/IHt9CgkJbGV0IG5ld19zdGF0ZSA9IHt9CgkJbGV0IGhpc3RvcnkgPSB7CgkJCTI6IFtdLAoJCQkzOiBbXSwKCQkJNDogW10sCgkJCTU6IFtdLAoJCQk2OiBbXSwKCQl9CgkJZm9yIChjb25zdCByb3cgb2YgWy4uLnJvd3NdLnJldmVyc2UoKSkgewoJCQlwcm9jZXNzX3Jvdyhyb3csIGhpc3RvcnksIG9sZF9zdGF0ZSwgbmV3X3N0YXRlKQoJCX0KCQl3aW5kb3cudG9jX3N0YXRlID0gbmV3X3N0YXRlCgkJdG9jLmNsYXNzTGlzdC50b2dnbGUoJ2ZpbGUtc3RhdGUtZGlmZmVycycsIHN0YXRlRGlmZmVyc0ZpbGUobmV3X3N0YXRlKSkKCQl1cGRhdGVfaGlkZGVuKCkKCX0pCgoJb2JzZXJ2ZXIub2JzZXJ2ZSh0b2MsIHtjaGlsZExpc3Q6IHRydWV9KQoKCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCS8vIFdlIGhhdmUgdG8gZW5hYmxlIGR5bmFtaWNEcm9wIHRvIGhhdmUgZHJvcHpvbmUgcmVjb21wdXRlZCBvbiBkcmFnbW92ZQoJaW50ZXJhY3QuZHluYW1pY0Ryb3AodHJ1ZSkKCglmdW5jdGlvbiBkcmFnRW5hYmxlcihlKSB7CgkJaWYgKCF0b2MuY2xhc3NMaXN0LmNvbnRhaW5zKCdkcmFnX2VuYWJsZWQnKSB8fCBlLmtleSAhPT0gJ1NoaWZ0JykgeyByZXR1cm4gdHJ1ZSB9CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAia2V5ZG93biI6CgkJCQl0b2MuY2xhc3NMaXN0LmFkZCgnYWxsb3dfYWxsX2Ryb3AnKQoJCQkJYnJlYWs7CgkJCWNhc2UgImtleXVwIjoKCQkJCXRvYy5jbGFzc0xpc3QucmVtb3ZlKCdhbGxvd19hbGxfZHJvcCcpCgkJCQlicmVhazsKCQl9CgkJdXBkYXRlQWN0aXZlU2VwYXJhdG9yKCkKCX0KCgljb25zdCB3aW5kb3dfZXZlbnRzID0gewoJCWtleWRvd246IGRyYWdFbmFibGVyLAoJCWtleXVwOiBkcmFnRW5hYmxlciwKCX0KCglhZGRTY3JpcHRFdmVudExpc3RlbmVycyh3aW5kb3csIHdpbmRvd19ldmVudHMpCgoJLy8gSW50ZXJhY3QuanMgcGFydAoKCWxldCBhY3RpdmVEcm9wID0gdW5kZWZpbmVkCgoJZnVuY3Rpb24gdGFnQWRqYWNlbnRTZXBhcmF0b3JzKGVsLCBhY3RpdmUpIHsKCQljb25zdCBuZXh0ID0gZ2V0TmV4dFNpYmxpbmcoZWwsICcudG9jLXJvdy1zZXBhcmF0b3InKQoJCWNvbnN0IHByZXYgPSBnZXRQcmV2aW91c1NpYmxpbmcoZWwsICcudG9jLXJvdy1zZXBhcmF0b3InKQoJCWlmIChhY3RpdmUpIHsKICAJCQluZXh0Py5jbGFzc0xpc3QuYWRkKCdub3Nob3cnKQogIAkJCXByZXY/LmNsYXNzTGlzdC5hZGQoJ25vc2hvdycpCgkJfSBlbHNlIHsKICAJCQluZXh0Py5jbGFzc0xpc3QucmVtb3ZlKCdub3Nob3cnKQogIAkJCXByZXY/LmNsYXNzTGlzdC5yZW1vdmUoJ25vc2hvdycpCQkJCQoJCX0KCX0KCglmdW5jdGlvbiBnZXRTZXBhcmF0b3Ioc3RhcnRFbGVtZW50LCBiZWxvdywgYWxsb3dBbGwsIGhlYWRpbmdMZXZlbCA9IDgpIHsKCQlsZXQgc2VwYXJhdG9yCgkJaWYgKGJlbG93KSB7CgkJCWNvbnN0IHNlbGVjdG9yID0gJy50b2Mtcm93Om5vdCgucGFyZW50LWNvbGxhcHNlZCknCgkJCWNvbnN0IGNoZWNrZXJGdW5jID0gYWxsb3dBbGwgPyBnZW5lcmF0ZUNoZWNrZXIoc2VsZWN0b3IpIDogKGVsKSA9PiB7CgkJCQlpZiAoIWVsLm1hdGNoZXMoc2VsZWN0b3IpKSB7IHJldHVybiBmYWxzZSB9CgkJCQkvLyBDaGVjayBmb3IgdGhlIHJpZ2h0IGhlYWRpbmcgbGV2ZWwKCQkJCWZvciAobGV0IGkgPSBoZWFkaW5nTGV2ZWw7IGkgPiAwOyBpLS0pIHsKCQkJCQljb25zdCBjbCA9ICJIIiArIGkKCQkJCQlpZiAoZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNsKSkgeyByZXR1cm4gdHJ1ZSB9CgkJCQl9CgkJCQlyZXR1cm4gZmFsc2UKCQkJfQoJCQljb25zdCB2YWxpZFJvdyA9IGdldE5leHRTaWJsaW5nKHN0YXJ0RWxlbWVudCwgY2hlY2tlckZ1bmMpCgkJCS8vIElmIHRoZSBhY3RpdmVEcm9wIGlzIHRoZSBsYXN0IHJvdyBvciB0aGUgdGhlIGxhc3Qgbm9uLWNvbGxhcHNlZCBvbmUsIHRoZSB2YWxpZFJvdyB3aWxsIGJlIGB1bmRlZmluZWRgLCBzbyBpbiB0aGF0IGNhc2Ugd2UgdGFrZSB0aGUgbGFzdCBzZXBhcmF0b3IKCQkJc2VwYXJhdG9yID0gZ2V0UHJldmlvdXNTaWJsaW5nKHZhbGlkUm93LCAnLnRvYy1yb3ctc2VwYXJhdG9yJykgPz8gXy5sYXN0KHRvYy5xdWVyeVNlbGVjdG9yQWxsKCcudG9jLXJvdy1zZXBhcmF0b3InKSkKCQl9IGVsc2UgewoJCQlzZXBhcmF0b3IgPSBnZXRQcmV2aW91c1NpYmxpbmcoc3RhcnRFbGVtZW50LCAnLnRvYy1yb3ctc2VwYXJhdG9yJykKCQl9CgkJcmV0dXJuIHNlcGFyYXRvcgoJfQoKCWZ1bmN0aW9uIGdldEhpZ2hlclBhcmVudChyb3csIGxldmVsKSB7CgkJY29uc3QgY3VycmVudExldmVsID0gZ2V0SGVhZGluZ0xldmVsKHJvdykKCQlpZiAoY3VycmVudExldmVsIDw9IGxldmVsKSB7cmV0dXJuIHJvd30KCQlmb3IgKGNvbnN0IHBhciBvZiByb3cuYWxsUGFyZW50cykgewoJCQkvLyBQYXJlbnRzIGN5Y2xlIGZyb20gaGlnaGVyIGxldmVsIHRvIGxvd2VyIGxldmVscwoJCQlpZiAoZ2V0SGVhZGluZ0xldmVsKHBhcikgPD0gbGV2ZWwpIHtyZXR1cm4gcGFyfQoJCX0KCQlyZXR1cm4gcm93Cgl9CgkJCglsZXQgdW5jb2xsYXBzZWQgPSBbXQoKCWZ1bmN0aW9uIHJlQ29sbGFwc2Uocm93KSB7CgkJY29uc3QgcGFyZW50cyA9IHJvdz8uYWxsUGFyZW50cyA/PyBbXQoJCWNvbnN0IHRvUmVtb3ZlID0gXy5kaWZmZXJlbmNlKHVuY29sbGFwc2VkLCBbLi4ucGFyZW50cywgcm93XSkKCQlmb3IgKGNvbnN0IGVsIG9mIHRvUmVtb3ZlKSB7CgkJCS8vIGRlYnVnZ2VyCgkJCXNldF9zdGF0ZShlbCwgImNvbGxhcHNlZCIsIHRydWUpCgkJCV8ucmVtb3ZlKHVuY29sbGFwc2VkLCB4ID0+IHggPT09IGVsKQoJCX0KCX0KCgoJZnVuY3Rpb24gdXBkYXRlRHJvcFpvbmUocm93KSB7CgkJY29uc3QgcHJldiA9IHRvYy5xdWVyeVNlbGVjdG9yKCcudG9jLXJvdy5hY3RpdmVfZHJvcCcpCgkJaWYgKF8uaXNOaWwocm93KSB8fCBwcmV2ID09PSByb3cpIHtyZXR1cm59CgkJaWYgKHByZXY/LnRpbWVvdXRJZCkgewoJCQljbGVhclRpbWVvdXQocHJldi50aW1lb3V0SWQpCgkJCXByZXYudGltZW91dElkID0gdW5kZWZpbmVkCgkJfQoJCXByZXY/LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZV9kcm9wJykKCQlyb3cuY2xhc3NMaXN0LmFkZCgnYWN0aXZlX2Ryb3AnKQoJCXJlQ29sbGFwc2Uocm93KQoJCWlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2xsYXBzZWQnKSkgewoJCQlyb3cudGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7CgkJCQl1bmNvbGxhcHNlZC5wdXNoKHJvdykKCQkJCXNldF9zdGF0ZShyb3csICJjb2xsYXBzZWQiLCBmYWxzZSkKCQkJCXVwZGF0ZUFjdGl2ZVNlcGFyYXRvcigpCgkJCX0sIDUwMCkKCQl9CgkJYWN0aXZlRHJvcCA9IHJvdwoJfQoKCWZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZVNlcGFyYXRvcigpIHsKCQljb25zdCBlID0gdG9jLmxhc3REcmFnRXZlbnQKCQlpZiAoXy5pc05pbChlKSkgeyByZXR1cm4gfQoJCWNvbnN0IGVsQmVsb3cgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGUuY2xpZW50LngsIGUuY2xpZW50LnkpCgkJaWYgKCFlbEJlbG93Lm1hdGNoZXMoJy5wbHV0b3VpLXRvYyA6c2NvcGUnKSkgewoJCQkvLyBXZSBhcmUgb3V0IG9mIHRoZSBUb0MsIHJlY29sbGFwc2UgYW5kIHJlbW92ZSBhY3RpdmUgc2VwYXJhdG9yCgkJCXJlQ29sbGFwc2UodW5kZWZpbmVkKQoJCQl0b2MucXVlcnlTZWxlY3RvcignLnRvYy1yb3ctc2VwYXJhdG9yLmFjdGl2ZScpPy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQoJCQlyZXR1cm4KCQl9CgkJY29uc3Qgcm93QmVsb3cgPSBnZXRSb3coZWxCZWxvdykKCQl1cGRhdGVEcm9wWm9uZShyb3dCZWxvdykKCQlpZiAoXy5pc05pbChhY3RpdmVEcm9wKSkge3JldHVybn0KCQljb25zdCBhbGxvd0FsbCA9IHRvYy5jbGFzc0xpc3QuY29udGFpbnMoJ2FsbG93X2FsbF9kcm9wJykKCQljb25zdCBoZWFkaW5nTGV2ZWwgPSBnZXRIZWFkaW5nTGV2ZWwodG9jLmRyYWdnZWRFbGVtZW50KQoJCWNvbnN0IHsgeSwgaGVpZ2h0IH0gPSBhY3RpdmVEcm9wLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpCgkJbGV0IHRocmVzaG9sZFkgPSB5ICsgaGVpZ2h0LzIKCQlpZiAoIWFsbG93QWxsKSB7CgkJCS8vIFdlIG9ubHkgYWxsb3cgcHV0dGluZyB0aGUgZHJhZ2dlZCBlbGVtZW50IGFib3ZlL2JlbG93IHJvd3Mgd2l0aCBlcXVhbCBvciBoaWdoZXIgaGVhZGluZyBsZXZlbAoJCQljb25zdCBjdXJyZW50SGVhZGluZ0xldmVsID0gZ2V0SGVhZGluZ0xldmVsKGFjdGl2ZURyb3ApCgkJCWlmIChjdXJyZW50SGVhZGluZ0xldmVsID4gaGVhZGluZ0xldmVsKSB7CgkJCQkvLyBXZSB1cGRhdGUgdGhlIHRocmVzaG9sZCBiYXNlZCBvbiB0aGUgcmVsZXZhbnQgcGFyZW50CgkJCQljb25zdCBwYXIgPSBnZXRIaWdoZXJQYXJlbnQoYWN0aXZlRHJvcCwgaGVhZGluZ0xldmVsKQoJCQkJY29uc3QgeyB5LCBoZWlnaHQgfSA9IHBhci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQoJCQkJdGhyZXNob2xkWSA9IHkgKyBoZWlnaHQvMgkJCQkJCQoJCQl9CgkJfQoJCS8vIENoZWNrIGlmIHRoZSBjdXJyZW50IHBvc2l0aW9uIG9mIHRoZSBtb3VzZSBpcyBiZWxvdyBvciBhYm92ZSB0aGUgbWlkZGxlIG9mIHRoZSBhY3RpdmUgZHJvcCB6b25lCgkJY29uc3QgaXNCZWxvdyA9IGUuY2xpZW50LnkgPiB0aHJlc2hvbGRZCgkJY29uc3QgbmV3U2VwID0gZ2V0U2VwYXJhdG9yKGFjdGl2ZURyb3AsIGlzQmVsb3csIGFsbG93QWxsLCBoZWFkaW5nTGV2ZWwpCgkJY29uc3QgY3VycmVudFNlcCA9IHRvYy5xdWVyeVNlbGVjdG9yKCcudG9jLXJvdy1zZXBhcmF0b3IuYWN0aXZlJykgPz8gbmV3U2VwCgkJaWYgKGN1cnJlbnRTZXAgIT09IG5ld1NlcCkgewoJCQljdXJyZW50U2VwLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCgkJfQoJCW5ld1NlcC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKQoJfQoKCWNvbnN0IGRyYWdIYW5kbGVzID0gaW50ZXJhY3QoJy50b2Mtcm93JykuZHJhZ2dhYmxlKHsKCQljdXJzb3JDaGVja2VyIChhY3Rpb24sIGludGVyYWN0YWJsZSwgZWxlbWVudCwgaW50ZXJhY3RpbmcpIHsKCQkJLy8gY29uc29sZS5sb2coe2FjdGlvbiwgaW50ZXJhY3RhYmxlLCBlbGVtZW50LCBpbnRlcmFjdGluZ30pCgkJCXJldHVybiBudWxsCgkJfSwKCQltYW51YWxTdGFydDogdHJ1ZSwgLy8gbmVlZGVkIGZvciBjb25zaXN0ZW50IHN0YXJ0IGFmdGVyIGhvbGQKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQ6IGZ1bmN0aW9uIChlKSB7CgkJCQl0b2MuY2xhc3NMaXN0LmFkZCgnZHJhZ19lbmFibGVkJykKCQkJCWNvbnN0IHJvdyA9IGUudGFyZ2V0CgkJCQkvLyBjb25zb2xlLmxvZygnc3RhcnQ6ICcsIGUpCgkJCQl0b2MubGFzdERyYWdFdmVudCA9IGUKCQkJCXJvdy5jbGFzc0xpc3QuYWRkKCdkcmFnZ2VkJykKCQkJCXRvYy5kcmFnZ2VkRWxlbWVudCA9IHJvdwoJCQkJdGFnQWRqYWNlbnRTZXBhcmF0b3JzKHJvdywgdHJ1ZSkKCQkJfSwKCQkJbW92ZTogZnVuY3Rpb24gKGUpIHsKCQkJCXRvYy5sYXN0RHJhZ0V2ZW50ID0gZQoJCQkJdXBkYXRlQWN0aXZlU2VwYXJhdG9yKCkKCQkJfSwKCQkJLy8gbW92ZTogZnVuY3Rpb24gKGUpIHtjb25zb2xlLmxvZygnbW92ZTogJyxlKX0sCgkJCWVuZDogZnVuY3Rpb24gKGUpIHsKCQkJCWFjdGl2ZURyb3AgPSB1bmRlZmluZWQKCQkJCWUucHJldmVudERlZmF1bHQoKQoJCQkJdG9jLmxhc3REcmFnRXZlbnQgPSBlCgkJCQkvLyBjb25zb2xlLmxvZygnZW5kOiAnLCBlKQoJCQkJY29uc3Qgcm93ID0gZS50YXJnZXQKCQkJCS8vIENsZWFudXAKCQkJCXJvdy5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2VkJykKCQkJCXRvYy5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnX2VuYWJsZWQnKQkKCQkJCWZvciAoY29uc3QgZWwgb2YgdG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY3RpdmVfZHJvcCcpKSB7CgkJCQkJZWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlX2Ryb3AnKQoJCQkJfQoJCQkJcmVDb2xsYXBzZSgpCQkJCQoJCQkJdGFnQWRqYWNlbnRTZXBhcmF0b3JzKHJvdywgZmFsc2UpCQkJCQoJCQkJdG9jLmNsYXNzTGlzdC5yZW1vdmUoJ2FsbG93X2FsbF9kcm9wJykKCQkJCS8vIFdlIHRlbXBvcmFyeSBzZXQgdGhlIHJlY2VudERyYWcgZmxhZwoJCQkJdG9jLmNsYXNzTGlzdC5hZGQoJ3JlY2VudC1kcmFnJykKCQkJCXNldFRpbWVvdXQoKCkgPT4gewoJCQkJCXRvYy5jbGFzc0xpc3QucmVtb3ZlKCdyZWNlbnQtZHJhZycpCgkJCQl9LCAzMDApCgkJCQkvLyBDaGVjayBpZiB0aGVyZSBpcyBhbiBhY3RpdmUgZHJvcHpvbmUKCQkJCWNvbnN0IGRyb3Bab25lID0gdG9jLnF1ZXJ5U2VsZWN0b3IoJy50b2Mtcm93LXNlcGFyYXRvci5hY3RpdmUnKQoJCQkJaWYgKF8uaXNOaWwoZHJvcFpvbmUpIHx8IGRyb3Bab25lLmNsYXNzTGlzdC5jb250YWlucygnbm9zaG93JykpIHtyZXR1cm59CgkJCQlkcm9wWm9uZS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQoJCQkJLy8gV2UgZmluZCB0aGUgY2VsbCBhZnRlciB0aGUgYWN0aXZlIHNlcGFyYXRvciBhbmQgbW92ZSB0aGUgZHJhZ2dlZCByb3cgYmVmb3JlIHRoYXQKCQkJCWNvbnN0IHJvd0FmdGVyID0gZ2V0TmV4dFNpYmxpbmcoZHJvcFpvbmUpCgkJCQljb25zdCBjZWxsSWRzVG9Nb3ZlID0gZ2V0QmxvY2tJZHMocm93KQoJCQkJLy8gRmluZCB0aGUgaW5kZXggb2YgdGhlIGNlbGwgdGhhdCB3aWxsIHN0YXkgYWZ0ZXIgb3VyIG1vdmVkIGJsb2NrCgkJCQljb25zdCBlbmQgPSBlZGl0b3Jfc3RhdGUubm90ZWJvb2suY2VsbF9vcmRlci5pbmRleE9mKGdldF9saW5rX2lkKHJvd0FmdGVyKSkKCQkJCS8vIElmIHdlIGdvdCAtMSwgaXQgbWVhbnMgd2UgaGF2ZSB0byBwdXQgdGhlIGNlbGxzIGF0IHRoZSBlbmQKCQkJCXBsdXRvX2FjdGlvbnMubW92ZV9yZW1vdGVfY2VsbHMoY2VsbElkc1RvTW92ZSwgZW5kIDwgMCA/IEluZmluaXR5IDogZW5kKQoJCQkJdG9jLmRyYWdnZWRFbGVtZW50ID0gdW5kZWZpbmVkCQkKCQkJfSwKCQl9Cgl9KS5vbignaG9sZCcsZnVuY3Rpb24gKGUpIHsKCQlpZiAoZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGVfdWknKSkgeyBjb25zb2xlLmxvZygnVUkgZGlzYWJsZWQsIG5vIGludGVyYWN0aW9uIScpOyByZXR1cm4gfQoJCWUucHJldmVudERlZmF1bHQoKQoJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkKCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJLy8gY29uc29sZS5sb2coJ3RoaXMgaXMgaG9sZCcsIGUpCgkJdmFyIGludGVyYWN0aW9uID0gZS5pbnRlcmFjdGlvbgoKCSAgICBpZiAoIWludGVyYWN0aW9uLmludGVyYWN0aW5nKCkpIHsKCSAgICAgIGludGVyYWN0aW9uLnN0YXJ0KAoJICAgICAgICB7IG5hbWU6ICdkcmFnJyB9LAoJICAgICAgICBlLmludGVyYWN0YWJsZSwKCSAgICAgICAgZS5jdXJyZW50VGFyZ2V0LAoJICAgICAgKQoJICAgIH0KCX0pCgoKCgkKCS8qICMjIyMgQkVHSU5OSU5HIE9GIFBBUlQgQVVUT01BVElDQUxMWSBBRERFRCBCWSBIVExTQ1JJUFQgIyMjIyAqLwoJLy8gQXNzaWduIHRoZSB2YXJpb3VzIGV2ZW50cyBsaXN0ZW5lcnMgZGVmaW5lZCB3aXRoaW4gdGhlIHNjcmlwdAoJZm9yIChjb25zdCBpdGVtIG9mIF9ldmVudHNfbGlzdGVuZXJzXykgewoJCWNvbnN0IHsgZWxlbWVudCwgbGlzdGVuZXJzIH0gPSBpdGVtCgkJZm9yIChjb25zdCBbbmFtZSwgZnVuY10gb2YgXy5lbnRyaWVzKGxpc3RlbmVycykpIHsKICAJCQllbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZnVuYykKCQl9Cgl9CgkvKiAjIyMjIEVORCBPRiBQQVJUIEFVVE9NQVRJQ0FMTFkgQURERUQgQlkgSFRMU0NSSVBUICMjIyMgKi8KCgkKCWludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCQkJCgkJLyogIyMjIyBCRUdJTk5JTkcgT0YgUEFSVCBBVVRPTUFUSUNBTExZIEFEREVEIEJZIEhUTFNDUklQVCAjIyMjICovCgkJLy8gUmVtb3ZlIHRoZSBldmVudHMgbGlzdGVuZXJzIGR1cmluZyBpbnZhbGlkYXRpb24KCQlmb3IgKGNvbnN0IGl0ZW0gb2YgX2V2ZW50c19saXN0ZW5lcnNfKSB7CgkJCWNvbnN0IHsgZWxlbWVudCwgbGlzdGVuZXJzIH0gPSBpdGVtCgkJCWZvciAoY29uc3QgW25hbWUsIGZ1bmNdIG9mIF8uZW50cmllcyhsaXN0ZW5lcnMpKSB7CgkgIAkJCWVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCBmdW5jKQoJCQl9CgkJfQoJCS8qICMjIyMgRU5EIE9GIFBBUlQgQVVUT01BVElDQUxMWSBBRERFRCBCWSBIVExTQ1JJUFQgIyMjIyAqLwoKCQlvYnNlcnZlci5kaXNjb25uZWN0KCkKZHJhZ0hhbmRsZXMudW5zZXQoKQoKCgl9KQoKPC9zY3JpcHQ+Cgo8c3R5bGU+CQoJLnBsdXRvdWktdG9jIGhlYWRlciB7CgkJY3Vyc29yOiBwb2ludGVyOwoJfQoJc3Bhbi50b2MtaGVhZGVyLWNvbnRhaW5lciB7CgkJcG9zaXRpb246IGZpeGVkOwoJCWRpc3BsYXk6IG5vbmU7CgkJLS1zaXplOiAyNXB4OwoJCWhlaWdodDogY2FsYyg1MXB4IC0gMXJlbSk7CgkJZmxleC1kaXJlY3Rpb246IHJvdy1yZXZlcnNlOwoJCXJpZ2h0OiBjYWxjKDFyZW0gKyBtaW4oODB2aCwgMzAwcHgpKTsKCX0KCS50b2MtaGVhZGVyLWljb24gewoJCW1hcmdpbi1yaWdodDogMC4zcmVtOwoJCWFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCXdpZHRoOiB2YXIoLS1zaXplKTsKCQliYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCWZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJY3Vyc29yOiBwb2ludGVyOwoJfQoJLnRvYy1oZWFkZXItZmlsbGVyIHsKCQltYXJnaW46IC4yNXJlbTsKCX0KCWhlYWRlcjpob3ZlciBzcGFuLnRvYy1oZWFkZXItY29udGFpbmVyLAoJc3Bhbi50b2MtaGVhZGVyLWNvbnRhaW5lcjpob3ZlciB7CgkJZGlzcGxheTogZmxleDsKCX0KCS50b2MtaGVhZGVyLWhpZGUgewoJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V5ZS1vdXRsaW5lLnN2Zyk7CgkJb3BhY2l0eTogNTAlOwoJCS0tc2l6ZTogMWVtOwoJfQoJLnRvYy1oZWFkZXItc2F2ZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvc2F2ZS1vdXRsaW5lLnN2Zyk7CgkJb3BhY2l0eTogNTAlOwoJfQoJbmF2Om5vdCguZmlsZS1zdGF0ZS1kaWZmZXJzKSAudG9jLWhlYWRlci1zYXZlIHsKCQlkaXNwbGF5OiBub25lOwoJfQoJcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBzcGFuLnRvYy1oZWFkZXItaGlkZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXllLW9mZi1vdXRsaW5lLnN2Zyk7Cgl9Cjwvc3R5bGU+Cgo8c3R5bGU+CglzcGFuLnRvYy1oaWRlLWNvbnRhaW5lciB7CgkJLS13aWR0aDogbWluKDgwdncsIDMwMHB4KTsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJZGlzcGxheTogZmxleDsKCQlyaWdodDogY2FsYyh2YXIoLS13aWR0aCkgKyAxcmVtICsgMjJweCAtIDEwMHB4KTsKCQloZWlnaHQ6IHZhcigtLWhlaWdodCk7CgkJd2lkdGg6IDEwMHB4OwoJCXotaW5kZXg6IC0xOwoJfQoJc3Bhbi50b2MtaGlkZSB7CgkJdmlzaWJpbGl0eTogaGlkZGVuOwoJCW9wYWNpdHk6IDUwJTsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leWUtb3V0bGluZS5zdmcpOwoJCWN1cnNvcjogcG9pbnRlcjsKCX0KCWRpdi50b2Mtcm93LmhpZGRlbiBzcGFuLnRvYy1oaWRlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leWUtb2ZmLW91dGxpbmUuc3ZnKTsKCX0KCXNwYW4udG9jLWhpZGUtY29udGFpbmVyOmhvdmVyID4gLnRvYy1oaWRlLAoJZGl2LnRvYy1yb3c6aG92ZXIgLnRvYy1oaWRlIHsKCQl2aXNpYmlsaXR5OiB2aXNpYmxlOwoJfQoJZGl2LnRvYy1yb3cgYSB7CgkJZGlzcGxheTogZmxleDsKCX0KCXNwYW4udG9jLWljb24gewoJCS0tc2l6ZTogMTdweDsKCQlkaXNwbGF5OiBibG9jazsKCQlhbGlnbi1zZWxmOiBzdHJldGNoOwoJCWJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cgl9CglzcGFuLnRvYy1jb2xsYXBzZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJbWFyZ2luLXJpZ2h0OiAzcHg7CgkJbWluLXdpZHRoOiB2YXIoLS1zaXplKTsKCX0KCS5wbHV0b3VpLXRvYyBzZWN0aW9uIGRpdi50b2Mtcm93LmNvbGxhcHNlZCBzcGFuLnRvYy1jb2xsYXBzZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7Cgl9CgkucGx1dG91aS10b2Mgc2VjdGlvbiBkaXYudG9jLXJvdyBhIHNwYW4udG9jLWNvbGxhcHNlLm5vLWNoaWxkcmVuIHsKCQliYWNrZ3JvdW5kLWltYWdlOiBub25lOwoJfQoJZGl2LnRvYy1yb3cucGFyZW50LWhpZGRlbiB7CgkJdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmUgZG90dGVkIC41cHg7CgkJdGV4dC11bmRlcmxpbmUtb2Zmc2V0OiAycHg7Cgl9CglkaXYudG9jLXJvdy5oaWRkZW4gewoJCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lIGRhc2hlZCAxcHg7CgkJdGV4dC11bmRlcmxpbmUtb2Zmc2V0OiAycHg7Cgl9CgkucGx1dG91aS10b2MgZGl2LnBhcmVudC1jb2xsYXBzZWQgewoJCWRpc3BsYXk6IG5vbmU7Cgl9CglwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIGRpdi50b2Mtcm93LmhpZGRlbiwKCXBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gZGl2LnRvYy1yb3cucGFyZW50LWhpZGRlbiB7CgkJZGlzcGxheTogbm9uZTsKCX0KCS5kcmFnX2VuYWJsZWQgLnRvYy1yb3cuZHJhZ2dlZCB7CgkJYm9yZGVyOiAycHggZGFzaGVkIGdyZXk7Cgl9Cjwvc3R5bGU+Cgo8c3R5bGU+CglkaXYudG9jLXJvdy1zZXBhcmF0b3IgewoJCWhlaWdodDogMnB4OwoJCW1hcmdpbjogM3B4IDBweDsKCQliYWNrZ3JvdW5kOiAjYWFhOwoJCWRpc3BsYXk6IG5vbmU7Cgl9CglkaXYudG9jLXJvdy1zZXBhcmF0b3IuYWN0aXZlIHsKCQlkaXNwbGF5OiBibG9jazsKCX0KCWRpdi50b2Mtcm93LXNlcGFyYXRvci5hY3RpdmUubm9zaG93IHsKCQlkaXNwbGF5OiBub25lOwoJfQo8L3N0eWxlPgoKpG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HZBBrcKg45sHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDO5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ADZkWtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwqtzdGF0dXNfdHJlZYSkbmFtZahub3RlYm9va6hzdWJ0YXNrc4Smc2F2aW5nhKRuYW1lpnNhdmluZ6hzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEJSBN5/+qc3RhcnRlZF9hdMtB2QQlIE3iBKl3b3Jrc3BhY2WEpG5hbWWpd29ya3NwYWNlqHN1YnRhc2tzgqxpbml0X3Byb2Nlc3OEpG5hbWWsaW5pdF9wcm9jZXNzqHN1YnRhc2tzhKE0hKRuYW1loTSoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HZBBeNMNTpqnN0YXJ0ZWRfYXTLQdkEF4xz4YuhMYSkbmFtZaExqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2QQXjG2zLapzdGFydGVkX2F0y0HZBBeMA8E8oTKEpG5hbWWhMqhzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEF4xywwGqc3RhcnRlZF9hdMtB2QQXjG2/UaEzhKRuYW1loTOoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HZBBeMc+FtqnN0YXJ0ZWRfYXTLQdkEF4xy0t2rZmluaXNoZWRfYXTLQdkEF40w8z2qc3RhcnRlZF9hdMtB2QQXjAPA+a5jcmVhdGVfcHJvY2Vzc4SkbmFtZa5jcmVhdGVfcHJvY2Vzc6hzdWJ0YXNrc4KhMYSkbmFtZaExqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2QQXivK37apzdGFydGVkX2F0y0HZBBeKEA6EoTKEpG5hbWWhMqhzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEF4wDwM+qc3RhcnRlZF9hdMtB2QQXivLQX6tmaW5pc2hlZF9hdMtB2QQXjAO0C6pzdGFydGVkX2F0y0HZBBeKEA5nq2ZpbmlzaGVkX2F0y0HZBBeNMPNeqnN0YXJ0ZWRfYXTLQdkEF4oQDiyjcGtnhKRuYW1lo3BrZ6hzdWJ0YXNrc4GoYW5hbHlzaXOEpG5hbWWoYW5hbHlzaXOoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HZBCUgTMUmqnN0YXJ0ZWRfYXTLQdkEJSBMxRGrZmluaXNoZWRfYXTLQdkEJSBMxSKqc3RhcnRlZF9hdMtB2QQlIEzE26NydW6EpG5hbWWjcnVuqHN1YnRhc2tzgrByZXNvbHZlX3RvcG9sb2d5hKRuYW1lsHJlc29sdmVfdG9wb2xvZ3moc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HZBCUhI3PzqnN0YXJ0ZWRfYXTLQdkEJSEjb1ioZXZhbHVhdGWEpG5hbWWoZXZhbHVhdGWoc3VidGFza3OBoTGEpG5hbWWhMahzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdkEJSEj0u2qc3RhcnRlZF9hdMtB2QQlISOm56tmaW5pc2hlZF9hdMtB2QQlISPtQqpzdGFydGVkX2F0y0HZBCUhI3P3q2ZpbmlzaGVkX2F0y0HZBCUhI+0+qnN0YXJ0ZWRfYXTLQdkEJSEjUyKrZmluaXNoZWRfYXTAqnN0YXJ0ZWRfYXTLQdkEF4oFjS6xY2VsbF9kZXBlbmRlbmNpZXPeABrZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZLRkb3duc3RyZWFtX2NlbGxzX21hcIOjYWx0kKRmcmVxkdkkOGQ5MTIyOTctOTI1ZS00YzhiLTk4YjgtMTliNDNjOWIyOWQ3omJskdkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4snVwc3RyZWFtX2NlbGxzX21hcI6qQEJvbmRzTGlzdJCtQmFzZS5nZXRpbmRleJChOpDZIE1haW4uUGx1dG9SdW5uZXIuQ29yZS5hcHBsaWNhYmxlkKtQbHV0b0V4dHJhc5HZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY7lNYWluLlBsdXRvUnVubmVyLkJhc2UuZ2V0kKdQbHV0b1VJkdkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjpUBiaW5kkKhFZGl0YWJsZZDZKE1haW4uUGx1dG9SdW5uZXIuUGx1dG9SdW5uZXIuY3JlYXRlX2JvbmSQpE1haW6QpEJhc2WQoSqQqlNjcnViYmFibGWQ2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTeEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTe0ZG93bnN0cmVhbV9jZWxsc19tYXCFqWZpZWxkYm9uZJCwZmllbGRkZXNjcmlwdGlvbpCjYXNkkdkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5qGFzZF9ib25kktkkOTVhZDk0MjgtNzNmOC00ZjU3LTkxODUtOTY4NWI5YTIxMjNm2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODijQVNEkLJ1cHN0cmVhbV9jZWxsc19tYXDeABynQG1kX3N0cpCoaGFzZmllbGSQplN0cmluZ5CkQGh0bJCkTWFpbpCpVGV4dEZpZWxkkKpAZmllbGRkYXRhkLdIeXBlcnRleHRMaXRlcmFsLlJlc3VsdJCkQGRvY5CtQmFzZS5nZXRpbmRleJDZIE1haW4uUGx1dG9SdW5uZXIuQ29yZS5hcHBsaWNhYmxlkKE6kKVlcnJvcpC3SHlwZXJ0ZXh0TGl0ZXJhbC5CeXBhc3OQqlN0cnVjdEJvbmSQuU1haW4uUGx1dG9SdW5uZXIuQmFzZS5nZXSQpUBiaW5kkLojX19fdGhpc19wbHV0b19tb2R1bGVfbmFtZZCrQmFzZS5Aa3dkZWaQplNsaWRlcpDZKE1haW4uUGx1dG9SdW5uZXIuUGx1dG9SdW5uZXIuY3JlYXRlX2JvbmSQpEJhc2WQo1ZhbJCjSW50kLBIeXBlcnRleHRMaXRlcmFskdkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjpFR5cGWQpVVuaW9ukKpTY3J1YmJhYmxlkNkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBo2FzZJHZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN9kkOWZhZjIyNTgtM2YyYi00NTBjLWJiZmUtZDgyMzFlMGU0ZDc0hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWZhZjIyNTgtM2YyYi00NTBjLWJiZmUtZDgyMzFlMGU0ZDc0tGRvd25zdHJlYW1fY2VsbHNfbWFwgqdudF9ib25kktkkOTVhZDk0MjgtNzNmOC00ZjU3LTkxODUtOTY4NWI5YTIxMjNm2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODiibnSR2SRjMTgzZTM4Zi04NGUzLTRhMWYtYTYzMS02ZDFkYjM5ZjExNzmydXBzdHJlYW1fY2VsbHNfbWFwj6dAbWRfc3RykK1CYXNlLmdldGluZGV4kKdATlRCb25kkNkgTWFpbi5QbHV0b1J1bm5lci5Db3JlLmFwcGxpY2FibGWQoTqQpWVycm9ykLlNYWluLlBsdXRvUnVubmVyLkJhc2UuZ2V0kKVAYmluZJCmU2xpZGVykNkoTWFpbi5QbHV0b1J1bm5lci5QbHV0b1J1bm5lci5jcmVhdGVfYm9uZJCkTWFpbpCkQmFzZZCjVmFskKRUeXBlkKhoYXNmaWVsZJDZJGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3OYS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3ObRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgaJudJHZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NNkkOGEyN2FmZTgtMjUzZC00MDkxLWE1OTItYmVhNWQ2ZjJlODM0hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOGEyN2FmZTgtMjUzZC00MDkxLWE1OTItYmVhNWQ2ZjJlODM0tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCA2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDeEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDe0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGkZnJlcZHZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZNkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2JhhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2JhtGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwtGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjhLRwcmVjZWRlbmNlX2hldXJpc3RpYwenY2VsbF9pZNkkNWE0YWJkMjUtMTQzYS00OWVhLWE2YjktMmI2YzU1ZTcwYTJjtGRvd25zdHJlYW1fY2VsbHNfbWFwhLBTdHJ1Y3RCb25kTW9kdWxlkKtQbHV0b0V4dHJhc5HZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZKdQbHV0b1VJkdkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJksEh5cGVydGV4dExpdGVyYWyS2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTfZJDk3OGY3MGVhLTM5M2UtNGYzZC05M2ZiLWM1YTgzNDQzZDA3ObJ1cHN0cmVhbV9jZWxsc19tYXCA2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjOEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjO0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDGEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQzODUzNWNiZS0wOTNkLTQ0NTItYjJhOS05OTkxODMxOTk4MDG0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDOEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDO0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjKEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjK0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKqcG9wb3V0d3JhcJCjTE9MkdkkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc52SQ2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2WEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ2NWEzZWQ4ZS02MjA0LTRhZWUtYWRmYy1iZWZlOWVhNTE1M2W0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjCEtHByZWNlZGVuY2VfaGV1cmlzdGljAadjZWxsX2lk2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjC0ZG93bnN0cmVhbV9jZWxsc19tYXCCo1BrZ5HZJDFmZmM2NDg5LTZhM2QtNGJkMS05NGU1LTRhODQzYjYxNGIyMKZSZXZpc2WQsnVwc3RyZWFtX2NlbGxzX21hcISkQmFzZZCjUGtnkdkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwtEJhc2UuY3VycmVudF9wcm9qZWN0kKxQa2cuYWN0aXZhdGWQ2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDWEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDW0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzmEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzm0ZG93bnN0cmVhbV9jZWxsc19tYXCDqWZpZWxkYm9uZJCwZmllbGRkZXNjcmlwdGlvbpCjTE9MkdkkNmM1NmMyMDUtYWM3Mi00NTU2LWI5NWUtYjI3OGU0YjNmODIysnVwc3RyZWFtX2NlbGxzX21hcN4AEadAbWRfc3RykK1CYXNlLmdldGluZGV4kKE6kKhoYXNmaWVsZJClZXJyb3KQt0h5cGVydGV4dExpdGVyYWwuQnlwYXNzkKtCYXNlLkBrd2RlZpCmU2xpZGVykKRAaHRskKRCYXNlkKpAZmllbGRkYXRhkKNWYWyQo0ludJCkVHlwZZCwSHlwZXJ0ZXh0TGl0ZXJhbJHZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY7dIeXBlcnRleHRMaXRlcmFsLlJlc3VsdJCqU2NydWJiYWJsZZDZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NrRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMYS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMbRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZrRkb3duc3RyZWFtX2NlbGxzX21hcIGjYmxjkdkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4snVwc3RyZWFtX2NlbGxzX21hcISqQEJvbmRzTGlzdJCnbnRfYm9uZJHZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NKZQb3BvdXSQqGFzZF9ib25kkdkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE32SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODiEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODi0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIWnbnRfYm9uZJHZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NKNibGOR2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2apQm9uZFRhYmxlkKhhc2RfYm9uZJHZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN6JibJHZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZNkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QzhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QztGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBt0V4dGVuZGVkVGFibGVPZkNvbnRlbnRzkLRjZWxsX2V4ZWN1dGlvbl9vcmRlctwAGtkkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIw2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmPZJDhhMjdhZmU4LTI1M2QtNDA5MS1hNTkyLWJlYTVkNmYyZTgzNNkkNWZiZDE0MDEtYzdhMS00ZDRmLWIxNmQtYWM5ZDQ1ZTJmZWQ12SRjZmE3OTE5Ni05ZTA0LTRkMGUtYTZiMS01NjQxZTEyM2YzZDPZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NtkkOWRhNjU4NzQtNjA4YS00Yzg0LWEwZTYtODEzYzYyNGMwN2Jh2SQ5YTlmYzAxZS1jMjVkLTExZWQtMDE0Ny1iMTU1ZTYzZmZiYTfZJDE0NDJhMmViLWIzOGItNDc1Ny1iMDJjLTk2YjU5OTA4NDg4OdkkNjVhM2VkOGUtNjIwNC00YWVlLWFkZmMtYmVmZTllYTUxNTNl2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjPZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NNkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc52SQ4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTXZJDI5NTkyMTk0LTJmODktNDljYy05YTIwLTdhOGU5Y2Q0NGFlOdkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJk2SQ4ZDkxMjI5Ny05MjVlLTRjOGItOThiOC0xOWI0M2M5YjI5ZDfZJDlhMWJhYTNkLTE0MjAtNDczYy04MzgwLWJiNWMyMzg4MWUwMNkkOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQz2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNznZJDZjNTZjMjA1LWFjNzItNDU1Ni1iOTVlLWIyNzhlNGIzZjgyMtkkMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAx2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2bZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyONkkYjNmYjIzYjgtODY1Mi00NjliLThkMGMtMGM2YzI3MjNiNjMx2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODi0bGFzdF9ob3RfcmVsb2FkX3RpbWXLAAAAAAAAAACpc2hvcnRwYXRosnRlc3RfYm9uZHN0YWJsZS5qbK5wcm9jZXNzX3N0YXR1c6VyZWFkeaRwYXRo2UkvaG9tZS9hbWVuZ2FsaS9SZXBvcy9naXRodWIvbWluZS9QbHV0b0V4dHJhcy9ub3RlYm9va3MvdGVzdF9ib25kc3RhYmxlLmpsrmxhc3Rfc2F2ZV90aW1ly0HZBCUgTeH0qmNlbGxfb3JkZXLcABrZJDFmZmM2NDg5LTZhM2QtNGJkMS05NGU1LTRhODQzYjYxNGIyMNkkOGEyN2FmZTgtMjUzZC00MDkxLWE1OTItYmVhNWQ2ZjJlODM02SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDXZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY9kkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2Qz2SQ1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDbZJDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYdkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE32SQxNDQyYTJlYi1iMzhiLTQ3NTctYjAyYy05NmI1OTkwODQ4ODnZJDY1YTNlZDhlLTYyMDQtNGFlZS1hZGZjLWJlZmU5ZWE1MTUzZdkkOGM4ZmQ1NDktMGFmYy00NDUyLWJkNmEtNjU2NDg2MmExZDYz2SQ5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzTZJGMxODNlMzhmLTg0ZTMtNGExZi1hNjMxLTZkMWRiMzlmMTE3OdkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU12SQyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTnZJDYwOTFjZGY0LWMwZWMtNDVmNi04YWEwLWQ0ZmFmNjY2NmQyZNkkOGQ5MTIyOTctOTI1ZS00YzhiLTk4YjgtMTliNDNjOWIyOWQ32SQ5YTFiYWEzZC0xNDIwLTQ3M2MtODM4MC1iYjVjMjM4ODFlMDDZJDkzMjU1YzI0LWQ0ODYtNDE2ZC1hZWZjLTc1NzVmZWZmNzU0M9kkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc52SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjLZJDM4NTM1Y2JlLTA5M2QtNDQ1Mi1iMmE5LTk5OTE4MzE5OTgwMdkkOTVhZDk0MjgtNzNmOC00ZjU3LTkxODUtOTY4NWI5YTIxMjNm2SQzNzNiYzI0NC0xMTBhLTQzZjgtYWFhMS01MWI1Y2I3NTExMjjZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMdkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4sXB1Ymxpc2hlZF9vYmplY3RzgKVuYnBrZ4iyaW5zdGFsbGVkX3ZlcnNpb25zgLB0ZXJtaW5hbF9vdXRwdXRzgKdlbmFibGVkwrdyZXN0YXJ0X3JlY29tbWVuZGVkX21zZ8C0cmVzdGFydF9yZXF1aXJlZF9tc2fArWJ1c3lfcGFja2FnZXOQr2luc3RhbGxfdGltZV9uc8CsaW5zdGFudGlhdGVkw6tjZWxsX2lucHV0c94AGtkkNjA5MWNkZjQtYzBlYy00NWY2LThhYTAtZDRmYWY2NjY2ZDJkhKdjZWxsX2lk2SQ2MDkxY2RmNC1jMGVjLTQ1ZjYtOGFhMC1kNGZhZjY2NjZkMmSkY29kZdoBM2JsID0gQEJvbmRzTGlzdCAiTXkgR3JvdXAgb2YgQm9uZHMiIGxldCB0diA9IFBsdXRvVUkuRXhwZXJpbWVudGFsLnRyYW5zZm9ybWVkX3ZhbHVlCgkgIyBXZSB1c2UgdHJhbnNmb3JtZWRfdmFsdWUgdG8gdHJhbnNsYXRlIEdIeiB0byBIeiBpbiB0aGUgYm91bmQgdmFyaWFibGUgYGZyZXFgCgkiRnJlcXVlbmN5IFtHSHpdIiA9IEBiaW5kIGZyZXEgdHYoeCAtPiB4ICogMWU5LCBFZGl0YWJsZSgyMDsgc3VmZml4ID0gIiBHSHoiKSkKCW1kIkFsdGl0dWRlIGBgaGBgIFttXSIgPSBAYmluZCBhbHQgU2NydWJiYWJsZSgxMDA6MTA6MjAwKQplbmSobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDlhOWZjMDFlLWMyNWQtMTFlZC0wMTQ3LWIxNTVlNjNmZmJhN4SnY2VsbF9pZNkkOWE5ZmMwMWUtYzI1ZC0xMWVkLTAxNDctYjE1NWU2M2ZmYmE3pGNvZGXaAlJiZWdpbgoiIiIKCXN0cnVjdCBBU0QKIiIiCkJhc2UuQGt3ZGVmIHN0cnVjdCBBU0QKCWE6OkludCAKCWI6OkludAoJYzo6U3RyaW5nCgkiVGhpcyBmaWVsZCBpcyBfc3BlY2lhbF8iCglkOjpTdHJpbmcKCWU6OkludAplbmQKQGZpZWxkZGF0YSBBU0QgYmVnaW4KCWEgPSAobWQiTWFya2Rvd24gZGVzY3JpcHRpb24sIGluY2x1ZGluZyBgYExhVGVYYGAiLCBTbGlkZXIoMToxMCkpCgliID0gKEBodGwoIjxzcGFuPkZpZWxkIHdpdGggPGI+SFRNTDwvYj4gZGVzY3JpcHRpb248L3NwYW4+IiksIFNjcnViYmFibGUoMToxMCkpCgljID0gKCJOb3JtYWwgU3RyaW5nIERlc2NyaXB0aW9uIiwgVGV4dEZpZWxkKCkpCglkID0gVGV4dEZpZWxkKCkgIyBObyBkZXNjcmlwdGlvbiwgZGVmYXVsdHMgdG8gdGhlIGRvY3N0cmluZyBzaW5jZSBpdCdzIHByZXNlbnQKCWUgPSBTbGlkZXIoMjA6MjUpICMgTm8gZGVzY3JpcHRpb24sIGRlZmF1bHRzIHRvIHRoZSBmaWVsZG5hbWUgYXMgbm8gZG9jc3RyaW5nIGlzIHByZXNlbnQKZW5kCmFzZF9ib25kID0gQGJpbmQgYXNkIFN0cnVjdEJvbmQoQVNEOyBkZXNjcmlwdGlvbiA9ICJDdXN0b20gRGVzY3JpcHRpb24iKQplbmSobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDE0NDJhMmViLWIzOGItNDc1Ny1iMDJjLTk2YjU5OTA4NDg4OYSnY2VsbF9pZNkkMTQ0MmEyZWItYjM4Yi00NzU3LWIwMmMtOTZiNTk5MDg0ODg5pGNvZGWjYXNkqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQ5ZmFmMjI1OC0zZjJiLTQ1MGMtYmJmZS1kODIzMWUwZTRkNzSEp2NlbGxfaWTZJDlmYWYyMjU4LTNmMmItNDUwYy1iYmZlLWQ4MjMxZTBlNGQ3NKRjb2Rl2cVudF9ib25kID0gQGJpbmQgbnQgQE5UQm9uZCAiTXkgRmFuY3kgTlR1cGxlIiBiZWdpbgoJYSA9ICgiRGVzY3JpcHRpb24iLCBTbGlkZXIoMToxMCkpCgliID0gKG1kIipCb2xkKiBmaWVsZCIsIFNsaWRlcigxOjEwKSkKCWMgPSBTbGlkZXIoMToxMCkgIyBObyBkZXNjcmlwdGlvbiwgZGVmYXVsdHMgdG8gdGhlIG5hbWUgb2YgdGhlIGZpZWxkCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkYzE4M2UzOGYtODRlMy00YTFmLWE2MzEtNmQxZGIzOWYxMTc5hKdjZWxsX2lk2SRjMTgzZTM4Zi04NGUzLTRhMWYtYTYzMS02ZDFkYjM5ZjExNzmkY29kZaJudKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOGEyN2FmZTgtMjUzZC00MDkxLWE1OTItYmVhNWQ2ZjJlODM0hKdjZWxsX2lk2SQ4YTI3YWZlOC0yNTNkLTQwOTEtYTU5Mi1iZWE1ZDZmMmU4MzSkY29kZaCobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDhkOTEyMjk3LTkyNWUtNGM4Yi05OGI4LTE5YjQzYzliMjlkN4SnY2VsbF9pZNkkOGQ5MTIyOTctOTI1ZS00YzhiLTk4YjgtMTliNDNjOWIyOWQ3pGNvZGWkZnJlcahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOGFiMmFmNGMtOTJhMi00MjlmLWI2NDEtOTVhMDI4ODA4YWU1hKdjZWxsX2lk2SQ4YWIyYWY0Yy05MmEyLTQyOWYtYjY0MS05NWEwMjg4MDhhZTWkY29kZbZtZCIiIgojIEBCb25kc0xpc3QKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ5ZGE2NTg3NC02MDhhLTRjODQtYTBlNi04MTNjNjI0YzA3YmGEp2NlbGxfaWTZJDlkYTY1ODc0LTYwOGEtNGM4NC1hMGU2LTgxM2M2MjRjMDdiYaRjb2Rl2gGKbWQiIiIKR2VuZXJhdGluZyBhdXRvbWF0aWMgd2lkZ2V0cyBmb3IgY3VzdG9tIHN0cnVjdHMgaXMgcXVpdGUgc3RyYWlnaHRmb3J3YXJkIHdpdGggdGhlIGFpZCBvZiB0aGUgYEBmaWVsZGRhdGFgIG1hY3JvIGFuZCB0aGUgYFN0cnVjdEJvbmRgIHR5cGUuCgpUaGUgdG9wLWxlZnQgYXJyb3cgY2FuIGJlIHVzZWQgdG8gc2hvdy1oaWRlIHRoZSBmaWVsZCBlbGVtZW50cyAodXNlZnVsIGluc2lkZSBhIGBCb25kVGFibGVgLCBzaG93biBiZWxvdyksIHdoaWxlIHRoZSBncmVlbiB0b2dnbGUgb24gdGhlIHRvcC1yaWdodCBjYW4gYmUgdXNlZCB0byBkaXNhYmxlIHRlbXBvcmFyaWx5IHRoZSBzeW5jaCBiZXR3ZWVuIHRoZSBKUyB3aWRnZXRzIGFuZCB0aGUgYm9uZCB2YWx1ZXMgaW4gUGx1dG8uCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkMjk1OTIxOTQtMmY4OS00OWNjLTlhMjAtN2E4ZTljZDQ0YWU5hKdjZWxsX2lk2SQyOTU5MjE5NC0yZjg5LTQ5Y2MtOWEyMC03YThlOWNkNDRhZTmkY29kZdoDVW1kIiIiCkluIHNvbWUgY2FzZXMsIG9uZSBkb2VzIG5vdCB3YW50IHRvIGhhdmUgYSBzaW5nbGUgYm9uZCB3cmFwcGluZyBlaXRoZXIgYSBTdHJ1Y3R1cmUgb3IgYSBOYW1lZFR1cGxlLCBhbmQgc2luZ2xlIGluZGVwZW5kZW50IGJvbmRzIGFyZSBtb3JlIGNvbnZlbmllbnQuCgpgQEJvbmRzTGlzdGAgaXMgYSBjb252ZW5pZW5jZSBtYWNybyB0byBjcmVhdGUgYW4gb2JqZWN0IG9mIHR5cGUgYEJvbmRzTGlzdGAgd2hpY2ggc2ltcGx5IGFsbG93IHRvIGFkZCBhIGRlc2NyaXB0aW9uIHRvIHNlcGFyYXRlIGJvbmRzIGFuZCBncm91cCB0aGVtIGFsbCB0b2dldGhlciBpbiBhIHRhYmxlLWxpa2UgZm9ybWF0IGVxdWl2YWxlbnQgdG8gdGhvc2Ugb2YgYFN0cnVjdEJvbmRgLgoKISEhIG5vdGUKCVVubGlrZSBgU3RydWN0Qm9uZGAsIGEgQm9uZHNMaXN0IGlzIGFscmVhZHkgY29tcG9zZWQgb2YgYm9uZCBjcmVhdGVkIHdpdGggYEBiaW5kYCBhbmQgaXQganVzdCBncm91cHMgdGhlbSB1cCB3aXRoIGEgZGVzY3JpcHRpb24uIFRoZSBvdXRwdXQgb2YgYEBCb25kc0xpc3RgIGlzIG5vdCBzdXBwb3NlZCB0byBiZSBib3VuZCB0byBhIHZhcmlhYmxlIHVzaW5nIGBAYmluZGAuXAoJVGhlIGJvbmRzIGdyb3VwZWQgaW4gYSBCb25kc0xpc3Qgc3RpbGwgYWN0IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseSBmcm9tIG9uZSBhbm90aGVyLgoKU2VlIHRoZSBleGFtcGxlIGJlbG93IGZvciB1bmRlcnN0YW5kaW5nIHRoZSBzeW50aGF4LiBUaGUgaGVhZGVyIG9mIGEgQm9uZHNMaXN0IGlzIHNob3duIGluIGFuIG9yYW5nZSBiYWNrZ3JvdW5kIHRvIGVhc2lseSBkaWZmZXJlbnRpYXRlIGl0IGZyb20gYFN0cnVjdEJvbmRgLgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDlhMWJhYTNkLTE0MjAtNDczYy04MzgwLWJiNWMyMzg4MWUwMISnY2VsbF9pZNkkOWExYmFhM2QtMTQyMC00NzNjLTgzODAtYmI1YzIzODgxZTAwpGNvZGWybWQiIiIKIyBQb3BvdXQKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ1YTRhYmQyNS0xNDNhLTQ5ZWEtYTZiOS0yYjZjNTVlNzBhMmOEp2NlbGxfaWTZJDVhNGFiZDI1LTE0M2EtNDllYS1hNmI5LTJiNmM1NWU3MGEyY6Rjb2Rl2aFiZWdpbgoJdXNpbmcgUGx1dG9FeHRyYXMKCXVzaW5nIFBsdXRvRXh0cmFzLlN0cnVjdEJvbmRNb2R1bGUgIyBUaGlzIHN1Ym1vZHVsZSBoYXMgdGhlIGZlYXR1cmVzIGxpc3RlZCBpbiB0aGlzIG5vdGVib29rCgl1c2luZyBQbHV0b1VJCgl1c2luZyBIeXBlcnRleHRMaXRlcmFsCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOGM4ZmQ1NDktMGFmYy00NDUyLWJkNmEtNjU2NDg2MmExZDYzhKdjZWxsX2lk2SQ4YzhmZDU0OS0wYWZjLTQ0NTItYmQ2YS02NTY0ODYyYTFkNjOkY29kZdoBpW1kIiIiClNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgYFN0cnVjdEJvbmRgIHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiAKClRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gYEBOVEJvbmRgIHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLgoKVGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSBgU3RydWN0Qm9uZGAgd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDM4NTM1Y2JlLTA5M2QtNDQ1Mi1iMmE5LTk5OTE4MzE5OTgwMYSnY2VsbF9pZNkkMzg1MzVjYmUtMDkzZC00NDUyLWIyYTktOTk5MTgzMTk5ODAxpGNvZGXaATdtZCIiIgpUaGUgYWJpbGl0eSB0byBhbHNvIHdyYXAgcHJlLWV4aXN0aW5nIGJvbmRzIGFyb3VuZCBTdHJ1Y3RCb25kcyBpcyBjb252ZW5pZW50IGZvciBvcmdhbml6aW5nIHRoZSB2YXJpb3VzIGJvbmRzIG9uZSBoYXZlIGluIGEgYEJvbmRzTGlzdGAgb3IgYEJvbmRUYWJsZWAKCkFzIGFuIGV4YW1wbGUsIG9uZSBjYW4gY3JlYXRlIGEgYEJvbmRzTGlzdGAgY29udGFpbmluZyB0aGUgdHdvIGBTdHJ1Y3RCb25kYCBib25kcyBnZW5lcmF0ZWQgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGlzIG5vdGVib29rIHdpdGggdGhlIGZvbGx3aW5nIGNvZGUuCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkOTMyNTVjMjQtZDQ4Ni00MTZkLWFlZmMtNzU3NWZlZmY3NTQzhKdjZWxsX2lk2SQ5MzI1NWMyNC1kNDg2LTQxNmQtYWVmYy03NTc1ZmVmZjc1NDOkY29kZdoDM21kIiIiClRoZSBzdHJ1Y3R1cmVzIGFib3ZlIGNhbiBhbHNvIGJlIHVzZWQgbmVzdGVkIHdpdGhpbiBvbmUgYW5vdGhlci4gVG8gZmFjaWxpdGF0ZSBhY2Nlc3NpbmcgbmVzdGVkIHN0cnVjdHVyZXMsIG9uZSBjYW4gdXNlIHRoZSBgUG9wb3V0YCB0eXBlLgoKSW4gaXRzIHNpbXBsZSBmb3JtLCB5b3UgY2FuIGdpdmUgYW4gaW5zdGFuY2Ugb2YgYSBTdHJ1Y3RCb25kLCBhIGJvbmQgd3JhcHBpbmcgYSBTdHJ1Y3RCb25kIG9yIGEgQm9uZHNMaXN0IGFzIGlucHV0IHRvIFBvcG91dCB0byBjcmVhdGUgYSB0YWJsZSB0aGF0IGlzIGhpZGRlbiBiZWhpbmQgYSBwb3B1cCB3aW5kb3cuCklmIGFuIGluc3RhbmNlIHByZXNlbnQsIGJ1dCB5b3Ugd2FudCBhIGN1c3RvbSB0eXBlIGZvciB3aGljaCB5b3UgaGF2ZSBkZWZpbmVkIGN1c3RvbSBib25kcyBhbmQgZGVzY3JpcHRpb25zIHdpdGggYEBmaWVsZGRhdGFgIHRvIGFwcGVhciBhcyBwb3BvdXQsIHlvdSBjYW4gdXNlIHRoZSBmdW5jdGlvbiBgcG9wb3V0d3JhcChUWVBFKWAgdG8gZ2VuZXJhdGUgYSBzbWFsbCBpY29uIHdoaWNoIGhpZGVzIGEgcG9wdXAgY29udGFpbmluZyB0aGUgYFN0cnVjdEJvbmRgIG9mIHRoZSBwcm92aWRlZCB0eXBlIGBUWVBFYC4KClRoZSBTdHJ1Y3RCb25kIHRhYmxlIGFwcGVhcnMgb24gaG92ZXIgdXBvbiB0aGUgaWNvbiwgY2FuIGJlIG1hZGUgZml4ZWQgYnkgY2xpY2tpbmcgb24gdGhlIGljb24gYW5kIGNhbiB0aGVuIGJlIG1vdmVkIGFyb3VuZCBvciByZXNpemVkLgpBIGRvdWJsZSBjbGljayBvbiB0aGUgaGVhZGVyIG9mIHRoZSBwb3BvdXQgaGlkZXMgaXQgYWdhaW46CiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkNmM1NmMyMDUtYWM3Mi00NTU2LWI5NWUtYjI3OGU0YjNmODIyhKdjZWxsX2lk2SQ2YzU2YzIwNS1hYzcyLTQ1NTYtYjk1ZS1iMjc4ZTRiM2Y4MjKkY29kZa9wb3BvdXR3cmFwKExPTCmobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDY1YTNlZDhlLTYyMDQtNGFlZS1hZGZjLWJlZmU5ZWE1MTUzZYSnY2VsbF9pZNkkNjVhM2VkOGUtNjIwNC00YWVlLWFkZmMtYmVmZTllYTUxNTNlpGNvZGWzbWQiIiIKIyBATlRCb25kCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkMWZmYzY0ODktNmEzZC00YmQxLTk0ZTUtNGE4NDNiNjE0YjIwhKdjZWxsX2lk2SQxZmZjNjQ4OS02YTNkLTRiZDEtOTRlNS00YTg0M2I2MTRiMjCkY29kZdlJYmVnaW4KCWltcG9ydCBQa2cKCVBrZy5hY3RpdmF0ZShCYXNlLmN1cnJlbnRfcHJvamVjdCgpKQoJdXNpbmcgUmV2aXNlCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTDq2NvZGVfZm9sZGVkwtkkNWZiZDE0MDEtYzdhMS00ZDRmLWIxNmQtYWM5ZDQ1ZTJmZWQ1hKdjZWxsX2lk2SQ1ZmJkMTQwMS1jN2ExLTRkNGYtYjE2ZC1hYzlkNDVlMmZlZDWkY29kZbRtZCIiIgojIFBhY2thZ2VzCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkOTc4ZjcwZWEtMzkzZS00ZjNkLTkzZmItYzVhODM0NDNkMDc5hKdjZWxsX2lk2SQ5NzhmNzBlYS0zOTNlLTRmM2QtOTNmYi1jNWE4MzQ0M2QwNzmkY29kZdmlYmVnaW4KQmFzZS5Aa3dkZWYgc3RydWN0IExPTAoJYTo6SW50IAoJYjo6SW50CmVuZApAZmllbGRkYXRhIExPTCBiZWdpbgoJYSA9IChtZCJXb25kZXIhIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCBCPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQplbmQKZW5kqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQ1YTliMjdjMy1kZjAyLTQxNWMtODdiZC0wNmViZDNjOWQyNDaEp2NlbGxfaWTZJDVhOWIyN2MzLWRmMDItNDE1Yy04N2JkLTA2ZWJkM2M5ZDI0NqRjb2Rltm1kIiIiCiMgU3RydWN0Qm9uZAoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDM3M2JjMjQ0LTExMGEtNDNmOC1hYWExLTUxYjVjYjc1MTEyOISnY2VsbF9pZNkkMzczYmMyNDQtMTEwYS00M2Y4LWFhYTEtNTFiNWNiNzUxMTI4pGNvZGW1bWQiIiIKIyBCb25kVGFibGUKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SRiM2ZiMjNiOC04NjUyLTQ2OWItOGQwYy0wYzZjMjcyM2I2MzGEp2NlbGxfaWTZJGIzZmIyM2I4LTg2NTItNDY5Yi04ZDBjLTBjNmMyNzIzYjYzMaRjb2Rl2gIZbWQiIiIKVGhlIGZpbmFsIGNvbnZlbmllbmNlIHN0cnVjdHVyZSBwcm92aWRlZCBieSB0aGlzIG1vZHVsZSBpcyB0aGUgYEJvbmRUYWJsZWAuIEl0IGNhbiBiZSBjcmVhdGVkIHRvIGdyb3VwIGEgbGlzdCBvZiBib25kcyBpbiBhIGZsb2F0aW5nIHRhYmxlIHRoYXQgc3RheXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgbm90ZWJvb2sgKHNpbWlsYXIgdG8gdGhlIFRhYmxlT2ZDb250ZW50cyBvZiBQbHV0b1VJKSBhbmQgY2FuIGJlIG1vdmVkIGFyb3VuZCBhbmQgcmVzaXplZCBvciBoaWRkZW4gZm9yIGNvbnZlbmllbmNlLgoKVGhlIEJvbmRUYWJsZSBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGVpdGhlciB3aXRoIGJvbmRzIGNvbnRhaW5pbmcgYFN0cnVjdEJvbmRgIG9yIHdpdGggYEJvbmRzTGlzdGAuIEZ1dHVyZSB0eXBlcyB3aXRoIHNpbWlsYXIgc3RydWN0dXJlIHdpbGwgYWxzbyBiZSBhZGRlZC4KCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiBhIGJvbmR0YWJsZSBjb250YWluaW5nIGFsbCB0aGUgZXhhbXBsZXMgb2YgdGhpcyBub3RlYm9vay4KIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ5NWFkOTQyOC03M2Y4LTRmNTctOTE4NS05Njg1YjlhMjEyM2aEp2NlbGxfaWTZJDk1YWQ5NDI4LTczZjgtNGY1Ny05MTg1LTk2ODViOWEyMTIzZqRjb2Rl2XFibGMgPSBAQm9uZHNMaXN0ICJQb3BvdXQgQ29udGFpbmVyIiBiZWdpbgoJIlN0cnVjdHVyZSBBU0QiID0gUG9wb3V0KGFzZF9ib25kKQoJIk5hbWVkVHVwbGUiID0gUG9wb3V0KG50X2JvbmQpCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkNzVmYzQwYTMtNDIzMS00MTI1LWI1MmMtYWQyMWY1YjhhMzg4hKdjZWxsX2lk2SQ3NWZjNDBhMy00MjMxLTQxMjUtYjUyYy1hZDIxZjViOGEzODikY29kZdlHQm9uZFRhYmxlKFsKCWFzZF9ib25kLAoJbnRfYm9uZCwKCWJsLAoJYmxjCl07IGRlc2NyaXB0aW9uID0gIk15IEJvbmRzIimobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJGNmYTc5MTk2LTllMDQtNGQwZS1hNmIxLTU2NDFlMTIzZjNkM4SnY2VsbF9pZNkkY2ZhNzkxOTYtOWUwNC00ZDBlLWE2YjEtNTY0MWUxMjNmM2QzpGNvZGW5RXh0ZW5kZWRUYWJsZU9mQ29udGVudHMoKahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwqtub3RlYm9va19pZNkkOWE5ZmJmZDgtYzI1ZC0xMWVkLTMzZjctNGRhMWZiYTdjYjk2q2luX3RlbXBfZGlywqhtZXRhZGF0YYGsY3VzdG9tX2F0dHJzkaxoaWRlLWVuYWJsZWQ=";
window.pluto_preamble_html = undefined;
</script>

<meta name="pluto-insertion-spot-parameters">
<script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.ccb2d097.js" type="module" defer="" integrity="sha384-z/NFGf3WX4Q71MXWsHtnW1TkhMuBwNMHerzZkEXKB+k3hp2YD+NPRGBVu9ALkE4R" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.19.22/frontend-dist/editor.b9f0ac7b.js" integrity="sha384-bgokkaJz2F/u6BCZYRcl36Jkfwy7x9SeobwBF3EWarMEaCfg5aSU3Z7nSuLQdETn" crossorigin="anonymous"></script><script type="text/javascript" id="MathJax-script" integrity="sha384-4kE/rQ11E8xT9QgrCBTyvenkuPfQo8rXYQvJZuMgxyPOoUfpatjQPlgdv6V5yhUK" crossorigin="" not-the-src-yet="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-svg-full.js" async=""></script></head><body class="loading no-MÎ±Î¸Jax"> <div style="display:flex;min-height:100vh;"> <pluto-editor class="fullscreen"></pluto-editor> </div> </body></html>